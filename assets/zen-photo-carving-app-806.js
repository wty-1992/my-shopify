(function(e){function t(t){for(var i,o,s=t[0],l=t[1],c=t[2],h=0,p=[];h<s.length;h++)o=s[h],n[o]&&p.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);d&&d(t);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var e,t=0;t<r.length;t++){for(var a=r[t],i=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=a[0]))}return e}var i={},n={app:0},r=[];function o(t){if(i[t])return i[t].exports;var a=i[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=i,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(a,i,function(t){return e[t]}.bind(null,i));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var d=l;r.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"0891":function(e,t,a){"use strict";var i=a("1363"),n=a.n(i);n.a},1:function(e,t){},1363:function(e,t,a){},"1bbc":function(e,t,a){"use strict";var i=a("79f8"),n=a.n(i);n.a},2:function(e,t){},"21b5":function(e,t,a){},"2b78":function(e,t,a){"use strict";a.r(t);a("28a5");var i=a("7618");a("7514"),a("7f7f"),a("8449"),a("ac6a"),a("a481");
/*!
 * jQuery MobiScroll v2.5.1
 * http://mobiscroll.com
 *
 * Copyright 2010-2013, Acid Media
 * Licensed under the MIT license.
 *
 */
(function(e){function t(t,a){var i,n,r,l,d,S,j,L,A,z,U,R,q,V=this,H=e.mobiscroll,Y=t,X=e(Y),J=P({},M),G={},K=[],Q={},Z={},ee=X.is("input"),te=!1;function ae(t){if(e.isArray(J.readonly)){var a=e(".dwwl",l).index(t);return J.readonly[a]}return J.readonly}function ie(e){var t,a='<div class="dw-bf">',i=1;for(t in K[e])i%20==0&&(a+='</div><div class="dw-bf">'),a+='<div class="dw-li dw-v" data-val="'+t+'" style="height:'+n+"px;line-height:"+n+'px;"><div class="dw-i">'+K[e][t]+"</div></div>",i++;return a+="</div>",a}function ne(t){g=e(".dw-li",t).index(e(".dw-v",t).eq(0)),m=e(".dw-li",t).index(e(".dw-v",t).eq(-1)),b=e(".dw-ul",l).index(t),p=n,u=V}function re(e){var t=J.headerText;return t?"function"===typeof t?t.call(Y,e):t.replace(/\{value\}/i,e):""}function oe(){V.temp=ee&&null!==V.val&&V.val!=X.val()||null===V.values?J.parseValue(X.val()||"",V):V.values.slice(0),V.setValue(!0)}function se(t,a,i,n,r){!1!==de("validate",[l,a,t])&&(e(".dw-ul",l).each(function(i){var o=e(this),s=e('.dw-li[data-val="'+V.temp[i]+'"]',o),l=e(".dw-li",o),c=l.index(s),d=l.length,h=i==a||void 0===a;if(!s.hasClass("dw-v")){var p=s,g=s,m=0,u=0;while(c-m>=0&&!p.hasClass("dw-v"))m++,p=l.eq(c-m);while(c+u<d&&!g.hasClass("dw-v"))u++,g=l.eq(c+u);(u<m&&u&&2!==n||!m||c-m<0||1==n)&&g.hasClass("dw-v")?(s=g,c+=u):(s=p,c-=m)}s.hasClass("dw-sel")&&!h||(V.temp[i]=s.attr("data-val"),e(".dw-sel",o).removeClass("dw-sel"),s.addClass("dw-sel"),V.scroll(o,i,c,h?t:.1,h?r:void 0))}),V.change(i))}function le(t){if(!("inline"==J.display||d===e(window).width()&&j===e(window).height()&&t)){var a,i,n,r,o,s,c,h,p,g,m,u,v=0,f=0,x=e(window).scrollTop(),b=e(".dwwr",l),C=e(".dw",l),y={},w=void 0===J.anchor?X:J.anchor;d=e(window).width(),j=e(window).height(),S=window.innerHeight,S=S||j,/modal|bubble/.test(J.display)&&(e(".dwc",l).each(function(){a=e(this).outerWidth(!0),v+=a,f=a>f?a:f}),a=v>d?f:v,b.width(a)),L=C.outerWidth(),A=C.outerHeight(!0),"modal"==J.display?(i=(d-L)/2,n=x+(S-A)/2):"bubble"==J.display?(u=!0,p=e(".dw-arrw-i",l),s=w.offset(),c=s.top,h=s.left,r=w.outerWidth(),o=w.outerHeight(),i=h-(C.outerWidth(!0)-r)/2,i=i>d-L?d-(L+20):i,i=i>=0?i:20,n=c-A,n<x||c>x+S?(C.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),n=c+o):C.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),g=p.outerWidth(),m=h+r/2-(i+(L-g)/2),e(".dw-arr",l).css({left:m>g?g:m})):(y.width="100%","top"==J.display?n=x:"bottom"==J.display&&(n=x+S-A)),y.top=n<0?0:n,y.left=i,C.css(y),e(".dw-persp",l).height(0).height(n+A>e(document).height()?n+A:e(document).height()),u&&(n+A>x+S||c>x+S)&&e(window).scrollTop(n+A-S)}}function ce(e){if("touchstart"===e.type)E=!0,setTimeout(function(){E=!1},500);else if(E)return E=!1,!1;return!0}function de(t,i){var n;return i.push(V),e.each([R.defaults,G,a],function(e,a){a[t]&&(n=a[t].apply(Y,i))}),n}function he(e){var t=+e.data("pos"),a=t+1;c(e,a>m?g:a,1,!0)}function pe(e){var t=+e.data("pos"),a=t-1;c(e,a<g?m:a,2,!0)}V.enable=function(){J.disabled=!1,ee&&X.prop("disabled",!1)},V.disable=function(){J.disabled=!0,ee&&X.prop("disabled",!0)},V.scroll=function(e,t,a,r,o){function s(e,t,a,i){return a*Math.sin(e/i*(Math.PI/2))+t}function c(){clearInterval(Q[t]),delete Q[t],e.data("pos",a).closest(".dwwl").removeClass("dwa")}var d,h=(i-a)*n;h==Z[t]&&Q[t]||(r&&h!=Z[t]&&de("onAnimStart",[l,t,r]),Z[t]=h,e.attr("style",N+"-transition:all "+(r?r.toFixed(3):0)+"s ease-out;"+(F?N+"-transform:translate3d(0,"+h+"px,0);":"top:"+h+"px;")),Q[t]&&c(),r&&void 0!==o?(d=0,e.closest(".dwwl").addClass("dwa"),Q[t]=setInterval(function(){d+=.1,e.data("pos",Math.round(s(d,o,a-o,r))),d>=r&&c()},100)):e.data("pos",a))},V.setValue=function(t,a,i,n){e.isArray(V.temp)||(V.temp=J.parseValue(V.temp+"",V)),te&&t&&se(i),r=J.formatResult(V.temp),n||(V.values=V.temp.slice(0),V.val=r),a&&ee&&X.val(r).trigger("change")},V.getValues=function(){var e,t=[];for(e in V._selectedValues)t.push(V._selectedValues[e]);return t},V.validate=function(e,t,a,i){se(a,e,!0,t,i)},V.change=function(t){r=J.formatResult(V.temp),"inline"==J.display?V.setValue(!1,t):e(".dwv",l).html(re(r)),t&&de("onChange",[r])},V.changeWheel=function(t,a){if(l){var i,n,r=0,o=t.length;for(i in J.wheels)for(n in J.wheels[i]){if(e.inArray(r,t)>-1&&(K[r]=J.wheels[i][n],e(".dw-ul",l).eq(r).html(ie(r)),o--,!o))return le(),void se(a,void 0,!0);r++}}},V.isVisible=function(){return te},V.tap=function(e,t){var a,i;J.tap&&e.bind("touchstart",function(e){e.preventDefault(),a=o(e,"X"),i=o(e,"Y")}).bind("touchend",function(e){Math.abs(o(e,"X")-a)<20&&Math.abs(o(e,"Y")-i)<20&&t.call(this,e),I=!0,setTimeout(function(){I=!1},300)}),e.bind("click",function(e){I||t.call(this,e)})},V.show=function(t){if(J.disabled||te)return!1;"top"==J.display&&(z="slidedown"),"bottom"==J.display&&(z="slideup"),oe(),de("onBeforeShow",[l]);var a,i,s=0,p="";z&&!t&&(p="dw-"+z+" dw-in");var g='<div class="dw-trans '+J.theme+" dw-"+J.display+'">'+("inline"==J.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+p+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(J.headerText?'<div class="dwv"></div>':""));for(a=0;a<J.wheels.length;a++){for(i in g+='<div class="dwc'+("scroller"!=J.mode?" dwpm":" dwsc")+(J.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>',J.wheels[a])K[s]=J.wheels[a][i],g+='<td><div class="dwwl dwrc dwwl'+s+'">'+("scroller"!=J.mode?'<div class="dwwb dwwbp" style="height:'+n+"px;line-height:"+n+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+n+"px;line-height:"+n+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+i+'</div><div class="dww" style="height:'+J.rows*n+"px;min-width:"+J.width+'px;"><div class="dw-ul">',g+=ie(s),g+='</div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',s++;g+="</tr></table></div></div>"}g+=("inline"!=J.display?'<div class="dwbc'+(J.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb">'+J.setText+"</span></span>"+(J.button3?'<span class="dwbw dwb-n"><span class="dwb">'+J.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb">'+J.cancelText+"</span></span></div></div>":'<div class="dwcc"></div>')+"</div></div></div>",l=e(g),se(),de("onMarkupReady",[l]),"inline"!=J.display?(l.appendTo("body"),setTimeout(function(){l.removeClass("dw-trans").find(".dw").removeClass(p)},350)):X.is("div")?X.html(l):l.insertAfter(X),de("onMarkupInserted",[l]),te=!0,R.init(l,V),"inline"!=J.display&&(V.tap(e(".dwb-s span",l),function(){!1!==V.hide(!1,"set")&&(V.setValue(!1,!0),de("onSelect",[V.val]))}),V.tap(e(".dwb-c span",l),function(){V.cancel()}),J.button3&&V.tap(e(".dwb-n span",l),J.button3),J.scrollLock&&l.bind("touchmove",function(e){A<=S&&L<=d&&e.preventDefault()}),e("input,select,button").each(function(){e(this).prop("disabled")||e(this).addClass("dwtd").prop("disabled",!0)}),le(),e(window).bind("resize.dw",function(){clearTimeout(U),U=setTimeout(function(){le(!0)},100)})),l.delegate(".dwwl","DOMMouseScroll mousewheel",function(t){if(!ae(this)){t.preventDefault(),t=t.originalEvent;var a=t.wheelDelta?t.wheelDelta/120:t.detail?-t.detail/3:0,i=e(".dw-ul",this),n=+i.data("pos"),r=Math.round(n-a);ne(i),c(i,r,a<0?1:2)}}).delegate(".dwb, .dwwb",D,function(t){e(this).addClass("dwb-a")}).delegate(".dwwb",D,function(t){t.stopPropagation(),t.preventDefault();var a=e(this).closest(".dwwl");if(ce(t)&&!ae(a)&&!a.hasClass("dwa")){f=!0;var i=a.find(".dw-ul"),n=e(this).hasClass("dwwbp")?he:pe;ne(i),clearInterval(h),h=setInterval(function(){n(i)},J.delay),n(i)}}).delegate(".dwwl",D,function(t){t.preventDefault(),!ce(t)||v||ae(this)||f||(v=!0,e(document).bind(B,$),x=e(".dw-ul",this),O="clickpick"!=J.mode,_=+x.data("pos"),ne(x),T=void 0!==Q[b],C=o(t,"Y"),w=new Date,y=C,V.scroll(x,b,_,.001),O&&x.closest(".dwwl").addClass("dwa"))}),de("onShow",[l,r])},V.hide=function(t,a){if(!te||!1===de("onClose",[r,a]))return!1;e(".dwtd").prop("disabled",!1).removeClass("dwtd"),X.blur(),l&&("inline"!=J.display&&z&&!t?(l.addClass("dw-trans").find(".dw").addClass("dw-"+z+" dw-out"),setTimeout(function(){l.remove(),l=null},350)):(l.remove(),l=null),te=!1,Z={},e(window).unbind(".dw"))},V.cancel=function(){!1!==V.hide(!1,"cancel")&&de("onCancel",[V.val])},V.init=function(e){R=P({defaults:{},init:k},H.themes[e.theme||J.theme]),q=H.i18n[e.lang||J.lang],P(a,e),P(J,R.defaults,q,a),V.settings=J,X.unbind(".dw");var t=H.presets[J.preset];t&&(G=t.call(Y,V),P(J,G,a),P(W,G.methods)),i=Math.floor(J.rows/2),n=J.height,z=J.animate,void 0!==X.data("dwro")&&(Y.readOnly=s(X.data("dwro"))),te&&V.hide(),"inline"==J.display?V.show():(oe(),ee&&J.showOnFocus&&(X.data("dwro",Y.readOnly),Y.readOnly=!0,X.bind("focus.dw",function(){V.show()})))},V.trigger=function(e,t){return de(e,t)},V.values=null,V.val=null,V.temp=null,V._selectedValues={},V.init(a)}function a(e){var t;for(t in e)if(void 0!==A[e[t]])return!0;return!1}function n(){var e,t=["Webkit","Moz","O","ms"];for(e in t)if(a([t[e]+"Transform"]))return"-"+t[e].toLowerCase();return""}function r(e){return S[e.id]}function o(e,t){var a=e.originalEvent,i=e.changedTouches;return i||a&&a.changedTouches?a?a.changedTouches[0]["page"+t]:i[0]["page"+t]:e["page"+t]}function s(e){return!0===e||"true"==e}function l(e,t,a){return e=e>a?a:e,e=e<t?t:e,e}function c(t,a,i,n,r){a=l(a,g,m);var o=e(".dw-li",t).eq(a),s=void 0===r?a:r,c=b,d=n?a==s?.1:Math.abs(.1*(a-s)):0;u.temp[c]=o.attr("data-val"),u.scroll(t,c,a,d,r),setTimeout(function(){u.validate(c,i,d,r)},10)}function d(e,t,a){return W[t]?W[t].apply(e,Array.prototype.slice.call(a,1)):"object"===Object(i["a"])(t)?W.init.call(e,t):e}var h,p,g,m,u,v,f,x,b,C,y,w,_,T,O,I,E,S={},k=function(){},j=new Date,L=j.getTime(),A=document.createElement("modernizr").style,F=a(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),N=n(),P=e.extend,D="touchstart mousedown",B="touchmove mousemove",z="touchend mouseup",$=function(e){O&&(e.preventDefault(),y=o(e,"Y"),u.scroll(x,b,l(_+(C-y)/p,g-1,m+1))),T=!0},M={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,tap:!0,formatResult:function(e){return e.join(" ")},parseValue:function(e,t){var a,i,n,r=t.settings.wheels,o=e.split(" "),s=[],l=0;for(a=0;a<r.length;a++)for(i in r[a]){if(void 0!==r[a][i][o[l]])s.push(o[l]);else for(n in r[a][i]){s.push(n);break}l++}return s}},W={init:function(e){return void 0===e&&(e={}),this.each(function(){this.id||(L+=1,this.id="scoller"+L),S[this.id]=new t(this,e)})},enable:function(){return this.each(function(){var e=r(this);e&&e.enable()})},disable:function(){return this.each(function(){var e=r(this);e&&e.disable()})},isDisabled:function(){var e=r(this[0]);if(e)return e.settings.disabled},isVisible:function(){var e=r(this[0]);if(e)return e.isVisible()},option:function(e,t){return this.each(function(){var a=r(this);if(a){var n={};"object"===Object(i["a"])(e)?n=e:n[e]=t,a.init(n)}})},setValue:function(e,t,a,i){return this.each(function(){var n=r(this);n&&(n.temp=e,n.setValue(!0,t,a,i))})},getInst:function(){return r(this[0])},getValue:function(){var e=r(this[0]);if(e)return e.values},getValues:function(){var e=r(this[0]);if(e)return e.getValues()},show:function(){var e=r(this[0]);if(e)return e.show()},hide:function(){return this.each(function(){var e=r(this);e&&e.hide()})},destroy:function(){return this.each(function(){var t=r(this);t&&(t.hide(),e(this).unbind(".dw"),delete S[this.id],e(this).is("input")&&(this.readOnly=s(e(this).data("dwro"))))})}};e(document).bind(z,function(t){if(v){var a,i,n,r=new Date-w,o=l(_+(C-y)/p,g-1,m+1),s=x.offset().top;if(r<300?(a=(y-C)/r,i=a*a/.0012,y-C<0&&(i=-i)):i=y-C,n=Math.round(_-i/p),!i&&!T){var d=Math.floor((y-s)/p),b=e(".dw-li",x).eq(d),I=O;!1!==u.trigger("onValueTap",[b])?n=d:I=!0,I&&(b.addClass("dw-hl"),setTimeout(function(){b.removeClass("dw-hl")},200))}O&&c(x,n,0,!0,Math.round(o)),v=!1,x=null,e(document).unbind(B,$)}f&&(clearInterval(h),f=!1),e(".dwb-a").removeClass("dwb-a")}).bind("mouseover mouseup mousedown click",function(e){if(I)return e.stopPropagation(),e.preventDefault(),!1}),e.fn.mobiscroll=function(t){return P(this,e.mobiscroll.shorts),d(this,t,arguments)},e.mobiscroll=e.mobiscroll||{setDefaults:function(e){P(M,e)},presetShort:function(e){this.shorts[e]=function(t){return d(this,P(t,{preset:e}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}},e.scroller=e.scroller||e.mobiscroll,e.fn.scroller=e.fn.scroller||e.fn.mobiscroll,e.mobiscroll.i18n.zh=e.extend(e.mobiscroll.i18n.zh,{dateFormat:"yyyy-mm-dd",dateOrder:"yymmdd",dayNames:["����","��һ;","�ܶ�;","����","����","����","����"],dayNamesShort:["��","һ","��","��","��","��","��"],dayText:"��",hourText:"ʱ",minuteText:"��",monthNames:["һ��","����","����","����","����","����","����","����","����","ʮ��","ʮһ��","ʮ����"],monthNamesShort:["1��","2��","3��","4��","5��","6��","7��","8��","9��","10��","11��","12��"],monthText:"��",secText:"��",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"��"}),e.mobiscroll.i18n.zh=e.extend(e.mobiscroll.i18n.zh,{setText:"ȷ��",cancelText:"ȡ��"});var U={defaults:{dateOrder:"ddmmyy",mode:"mixed",rows:5,width:70,height:36,showLabel:!0,useShortLabels:!0}};e.mobiscroll.themes["android-ics"]=U,e.mobiscroll.themes["android-ics light"]=U})(jQuery)},3:function(e,t){},3394:function(e,t,a){},3996:function(e,t,a){"use strict";a("34ef"),a("28a5");var n=a("bc3a"),r=a.n(n),o=a("55db"),s=function(){var e=function(e){this.canvas="",this.cWidth="",this.cHeight="",this.isMobile="",this.baseWidth="",this.fixWidth=""};return e.prototype={setCanvaSize:function(){var e=window.innerWidth;this.fixWidth?this.width=this.fixWidth:e<=414?(this.width=e-70,this.isMobile=1):e>768&&e<=1024?(this.width=240,this.isPad=1):(this.isPc=1,this.width=this.baseWidth?this.baseWidth:500),this.height=this.width*this.cHeight/this.cWidth,this.scale=this.width/this.cWidth,this.canvas.setWidth(this.width),this.canvas.setHeight(this.height)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},serverUpload:function(e,t,a,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this;$.ajax({type:"POST",url:n.picurl+"pictured/capture",dataType:"json",data:{width:n.cWidth,height:n.cHeight,scaleX:n.request.scaleX*n.cWidth/n.width,scaleY:n.request.scaleY*n.cWidth/n.width,left:n.request.left*n.cWidth/n.width,top:n.request.top*n.cWidth/n.width,angle:n.request.angle,type:n.type,sku:n.sku,bgcolor:n.request.bgcolor||"",origin_data:n.request.originImage},beforeSend:function(){t()},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){a(e)},!1),e},success:function(e){200==e.state?i(e):500==e.state&&console.log(500)}})},cdnAsyncUpload:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(t,a){r()({method:"post",url:o["a"].tokencdn,dataType:"json"}).then(function(a){e(a.data.token,t)}).catch(function(e){console.log(e)})})},cdnUpload:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];$.ajax({type:"POST",async:!1,url:this.picurl+"assist/uptoken",dataType:"json",success:function(t){e(t.token)}})},convertBase64ToBlob:function(e){var t=e.split(","),a="",i="";t.length>1&&(i=t[1],a=t[0].substring(t[0].indexOf(":")+1,t[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},randomString:function(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=t.length,n="";for(i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*a));return n}},e}();s.util={awcdn:window._zenConfig.awcdn?window._zenConfig.awcdn:"https://pic.stylelab.com/",qncdn:window._zenConfig.qncdn?window._zenConfig.qncdn:"https://spic.qn.cdn.imaiyuan.com/",pdir:"img/photo/",cdir:"img/textdesign/",testConsole:function(){console.log("123")},getBasePhotoImg:function(e){return this.picurl+this.pdir+e+".png"},carvingTextObj:{},bigCarvingTexObj:[]},t["a"]=s},"3a11":function(e,t,a){"use strict";var i=a("c82c"),n=a.n(i);n.a},4689:function(e,t,a){"use strict";var i=a("f49c"),n=a.n(i);n.a},"4e8c":function(e,t,a){},"54d7":function(e,t,a){},"55db":function(e,t,a){"use strict";a("3b2b"),a("a481"),a("a032"),a("6b54");var i=a("7618"),n=(a("34ef"),a("28a5"),a("bc3a")),r=a.n(n),o=a("cea2"),s=window;void 0==s._zenConfig?(console.log("not defined"),s._zenConfig={}):console.log("has defined");var l=s._zenConfig;l.qncdn=l.qncdn?l.qncdn:"https://spic.qn.cdn.imaiyuan.com/",l.awcdn=l.awcdn?l.awcdn:"https://pic.stylelab.com/",l.tokencdn=l.awcdn+"assist/uptoken",l.qiniuObj="",l.qiniuObjOrigin="",l.randomString=function(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=t.length,i="",n=0;n<e;n++)i+=t.charAt(Math.floor(Math.random()*a));return i},l.convertBase64ToBlob=function(e){var t=e.split(","),a="",i="";t.length>1&&(i=t[1],a=t[0].substring(t[0].indexOf(":")+1,t[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},l.awUpload=function(e,t,a){r()({method:"post",url:l.awcdn+"pictured/capture",responseType:"json",headers:{"Content-Type":"text/plain;charset=utf-8"},onUploadProgress:function(e){e.lengthComputable&&(a.percentage=parseInt(e.loaded/e.total*100))},data:e}).then(function(e){t(e.data)}).catch(function(e){console.log(e)})},l.cdnUpload=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="",s="";"object"==Object(i["a"])(e)?(s=e.base64,n=e.key):(s=e,n=l.randomString(12)+".png"),r.a.get(l.tokencdn).then(function(e){var i=e.data.token,r={region:o["region"].na0,concurrentRequestLimit:3},c={fname:"",params:{},mimeType:null},d={next:function(e){a&&(a.percentage=parseInt(e.total.percent))},error:function(e){console.log(e.code),console.log(e.message),console.log(e.isRequestError),console.log(e.reqId)},complete:function(e){t({picture:l.qncdn+e.key})}},h=l.convertBase64ToBlob(s),p=o["upload"](h,n,i,c,r);p.subscribe(d)}).catch(function(e){console.log(e)})},l.cdnUploadNew=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="",s="";"object"==Object(i["a"])(e)?(s=e.base64,n=e.key):(s=e,n=l.randomString(12)+".png"),r.a.get(l.tokencdn).then(function(e){var i=e.data.token,r={region:o["region"].na0,concurrentRequestLimit:3},c={fname:"",params:{},mimeType:null},d={next:function(e){a&&(a.percentage=parseInt(e.total.percent))},error:function(e){console.log(e.code),console.log(e.message),console.log(e.isRequestError),console.log(e.reqId)},complete:function(e){t({picture:l.qncdn+e.key})}},h=l.convertBase64ToBlob(s),p=o["upload"](h,n,i,c,r);a.cropQiniuObj=p.subscribe(d)}).catch(function(e){console.log(e)})},l.cdnUploadNewOrigin=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="",s="";"object"==Object(i["a"])(e)?(s=e.base64,n=e.key):(s=e,n=l.randomString(12)+".png"),r.a.get(l.tokencdn).then(function(e){var i=e.data.token,r={region:o["region"].na0,concurrentRequestLimit:3},c={fname:"",params:{},mimeType:null},d={next:function(e){a&&(a.percentage=parseInt(e.total.percent))},error:function(e){console.log(e.code),console.log(e.message),console.log(e.isRequestError),console.log(e.reqId)},complete:function(e){t({picture:l.qncdn+e.key})}},h=l.convertBase64ToBlob(s),p=o["upload"](h,n,i,c,r);l.qiniuObjOrigin=p.subscribe(d)}).catch(function(e){console.log(e)})},l.asyncCdnUpload=function(e,t,a){return new Promise(function(i,n){r.a.get(l.tokencdn).then(function(n){var r=n.data.token,s={region:o["region"].na0,concurrentRequestLimit:3},c={fname:"",params:{},mimeType:null},d={next:function(e){a&&(a.percentage=parseInt(e.total.percent))},error:function(e){console.log(e.code),console.log(e.message),console.log(e.isRequestError),console.log(e.reqId)},complete:function(e){i(l.qncdn+e.key)}},h=l.convertBase64ToBlob(e),p=o["upload"](h,t,r,c,s);p.subscribe(d)}).catch(function(e){console.log(e)})})},l.defaultFunction=function(){return new Promise(function(e,t){e()})},l.convertBase64ToBlob=function(e){var t=e.split(","),a="",i="";t.length>1&&(i=t[1],a=t[0].substring(t[0].indexOf(":")+1,t[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},l.getLen=function(e,t){var a=-1,i=e.length,n=0;while(++a<i){var r="0x"+e[a].codePointAt(0).toString(16);if(r>=55296&&r<=56319){n=1;break}if(this.isEmojiCharacter(r)&&t.length>0&&t.indexOf(r)<0){n=1;break}}return n},l.isEmojiCharacter=function(e){return 8448<=e&&e<=10239||(11013<=e&&e<=11015||(10548<=e&&e<=10549||(12951<=e&&e<=12953||(169==e||174==e||12349==e||12336==e||11093==e||11036==e||11035==e||11088==e||void 0))))},l.dispatchCustomEvent=function(e,t){var a=new CustomEvent(e,{detail:t});window.dispatchEvent(a)},Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},l.getFilename=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t?"scrop/"+(new Date).Format("yyyyMMdd")+"/"+(new Date).Format("yyyyMMddhhmmss")+this.randomString(e):"scrop/"+(new Date).Format("yyyyMMdd")+"/"+this.randomString(e)},l.asyncFusion=function(e,t,a){return new Promise(function(i,n){var o={sku:e,tpl:t,image_base64:a,rspType:"base64"};r.a.post("https://ai.soufeel.com/reflect/faceFuse/template",o).then(function(e){if(console.log("res1=>",e),0==e.data.error){var t="data:image/png;base64,"+e.data.base64,a=new Image;a.src=t,a.onload=function(){var t=1e3,n=.7,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(t,a.width)/a.width,Math.min(t,a.height)/a.height);r.width=a.width*s,r.height=a.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),e.data.base64=r.toDataURL("image/jpeg",n),i(e)}}else i(e)})})},l.trimCanvas=function(e){var t=e.getContext("2d"),a=document.createElement("canvas").getContext("2d"),i=e.width,n=e.height,r=t.canvas.width/e.width;r>1&&(t.scale(1/r,1/r),l.zoomIt(e,1/r),t=e.getContext("2d"));var o,s,c,d=t.getImageData(0,0,i,n),h=d.data.length,p={top:null,left:null,right:null,bottom:null};for(o=0;o<h;o+=4)0!==d.data[o+3]&&(s=o/4%i,c=~~(o/4/i),null===p.top&&(p.top=c),null===p.left?p.left=s:s<p.left&&(p.left=s),null===p.right?p.right=s:p.right<s&&(p.right=s),null===p.bottom?p.bottom=c:p.bottom<c&&(p.bottom=c));var g=p.bottom-p.top,m=p.right-p.left,u=t.getImageData(p.left,p.top,m,g);return a.canvas.width=m,a.canvas.height=g,a.putImageData(u,0,0),a.canvas},l.zoomIt=function(e,t){if(e.setHeight(e.getHeight()*t),e.setWidth(e.getWidth()*t),e.backgroundImage){var a=e.backgroundImage;a.width=a.width*t,a.height=a.height*t,a.left=a.left*t,a.top=a.top*t}if(e.overlayImage){var i=e.overlayImage;i.width=i.width*t,i.height=i.height*t,i.left=i.left*t,i.top=i.top*t}var n=e.getObjects();for(var r in n){var o=n[r].scaleX,s=n[r].scaleY,l=n[r].left,c=n[r].top,d=o*t,h=s*t,p=l*t,g=c*t;n[r].scaleX=d,n[r].scaleY=h,n[r].left=p,n[r].top=g,n[r].setCoords()}e.renderAll(),e.calcOffset()},t["a"]=l},"56d7":function(e,t,a){"use strict";a.r(t);a("cadf"),a("551c"),a("f751"),a("097d");var i=a("2b0e"),n=a("2f62");a("7514");i["default"].use(n["a"]);var r={customInfo:"",photoCrop:"",photoAi:"",photoOrigin:"",engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",carvingInfo:"",photoDialogVisible:[{id:0,value:!1},{id:1,value:!1}],anotherImg:[{id:0,value:""},{id:1,value:""}],cropPhoto:[],photoDialogImg:[],cropImgShow:[],carvingDialogVisibleNew:!1,ifChangeImage:!1,dialogCount:0,showFooter:!0,changableNum:0,test:123123,fusionPreview:"",photoDialogVisibleNormal:!1,templateErrorMsg:""},o={getCustomInfo:function(e){return e.customInfo},getDialogCount:function(e){return e.dialogCount},getPhotoDialogVisible:function(e){return function(t){return e.photoDialogVisible.find(function(e){return e.id===t})}},getAnotherImg:function(e){return function(t){return e.anotherImg.find(function(e){return e.id===t})}},getPhotoCrop:function(e){return e.photoCrop},getPhotoAi:function(e){return e.photoAi},getPhotoOrigin:function(e){return e.photoOrigin},getEngravingCrop:function(e){return e.engravingCrop},isShow:function(e){return e.showFooter},getChangedNum:function(){return r.changableNum},showTest:function(e){return e.test},getFusionPreview:function(e){return e.fusionPreview},getPhotoDialogVisibleNormal:function(){return r.photoDialogVisibleNormal},getCropPhoto:function(e){return function(t){return e.cropPhoto[t]}},getPhotoDialogImg:function(e){return function(t){return e.photoDialogImg[t]}},getCropImgShow:function(e){return function(t){return e.cropImgShow[t]}},getTemplateErrorMsg:function(){return r.templateErrorMsg},getIfChangeImage:function(){return r.ifChangeImage},getCarvingDialogVisibleNew:function(){return r.carvingDialogVisibleNew}},s={setCustomInfo:function(e,t){return e.customInfo=t},setDialogCount:function(e,t){return e.dialogCount+=t},setPhotoDialogVisible:function(e,t){var a=e.photoDialogVisible.find(function(e){return e.id===t.id});Object.assign(a,t)},setAnotherImg:function(e,t){var a=e.anotherImg.find(function(e){return e.id===t.id});Object.assign(a,t)},setPhotoCrop:function(e,t){e.photoCrop=t},setPhotoAi:function(e,t){e.photoAi=t},setPhotoOrigin:function(e,t){e.photoOrigin=t},setEngravingCrop:function(e,t){e.engravingCrop=t},show:function(e){e.showFooter=!0},hide:function(e){e.showFooter=!1},newNum:function(e,t){e.changableNum+=t},changetest:function(){r.test="fffffffffffffff"},setFusionPreview:function(e,t){e.fusionPreview=t},setPhotoDialogVisibleNormal:function(e,t){return e.photoDialogVisibleNormal=t},setCropPhoto:function(e,t){return e.cropPhoto[t.index]=t.value},setPhotoDialogImg:function(e,t){return e.photoDialogImg[t.index]=t.value},setCropImgShow:function(e,t){return e.cropImgShow[t.index]=t.value},setTemplateErrorMsg:function(e,t){e.templateErrorMsg=t},setIfChangeImage:function(e,t){e.ifChangeImage=t},setCarvingDialogVisibleNew:function(e,t){return e.carvingDialogVisibleNew=t}},l={setCustomInfo:function(e,t){e.commit("setCustomInfo",t)},setDialogCount:function(e,t){e.commit("setDialogCount",t)},setPhotoDialogVisible:function(e,t){e.commit("setPhotoDialogVisible",t)},setAnotherImg:function(e,t){e.commit("setAnotherImg",t)},setPhotoCrop:function(e,t){e.commit("setPhotoCrop",t)},setPhotoAi:function(e,t){e.commit("setPhotoAi",t)},setPhotoOrigin:function(e,t){e.commit("setPhotoOrigin",t)},setEngravingCrop:function(e,t){e.commit("setEngravingCrop",t)},hideFooter:function(e){e.commit("hide")},showFooter:function(e){e.commit("show")},getNewNum:function(e,t){e.commit("newNum",t)},actionschangetest:function(e){e.commit("changetest")},setFusionPreview:function(e,t){e.commit("setFusionPreview",t)},setPhotoDialogVisibleNormal:function(e,t){e.commit("setPhotoDialogVisibleNormal",t)},setCropPhoto:function(e,t){e.commit("setCropPhoto",t)},setPhotoDialogImg:function(e,t){e.commit("setPhotoDialogImg",t)},setCropImgShow:function(e,t){e.commit("setCropImgShow",t)},setTemplateErrorMsg:function(e,t){e.commit("setTemplateErrorMsg",t)},setIfChangeImage:function(e,t){e.commit("setIfChangeImage",t)},setCarvingDialogVisibleNew:function(e,t){e.commit("setCarvingDialogVisibleNew",t)}},c=new n["a"].Store({state:r,getters:o,mutations:s,actions:l}),d=c,h=(a("0fae"),a("9e1f"),a("450d"),a("6ed5")),p=a.n(h),g=(a("0c67"),a("299c")),m=a.n(g),u=(a("826b"),a("c263")),v=a.n(u),f=(a("4ffc"),a("946e")),x=a.n(f),b=(a("a586"),a("7464")),C=a.n(b),y=(a("b0ee"),a("d180")),w=a.n(y),_=(a("a335"),a("c0bb")),T=a.n(_),O=(a("de31"),a("c69e")),I=a.n(O),E=(a("a769"),a("5cc3")),S=a.n(E),k=(a("adec"),a("3d2d")),j=a.n(k),L=(a("aaa5"),a("a578")),A=a.n(L),F=(a("6b30"),a("c284")),N=a.n(F),P=(a("f225"),a("89a9")),D=a.n(P),B=(a("f4f9"),a("c2cc")),z=a.n(B),M=(a("7a0f"),a("0f6c")),W=a.n(M),U=(a("1951"),a("eedf")),R=a.n(U),q=(a("6611"),a("e772")),V=a.n(q),H=(a("1f1a"),a("4e4b")),Y=a.n(H),X=(a("560b"),a("dcdc")),J=a.n(X),G=(a("fe07"),a("6ac5")),K=a.n(G),Q=(a("b5d8"),a("f494")),Z=a.n(Q),ee=(a("10cb"),a("f3ad")),te=a.n(ee),ae=(a("a7cc"),a("df33")),ie=a.n(ae),ne={install:function(e){e.use(ie.a),e.use(te.a),e.use(Z.a),e.use(K.a),e.use(J.a),e.use(Y.a),e.use(V.a),e.use(R.a),e.use(W.a),e.use(z.a),e.use(D.a),e.use(N.a),e.use(A.a),e.use(j.a),e.use(S.a),e.use(I.a),e.use(T.a),e.use(w.a),e.use(C.a),e.use(x.a),e.use(v.a),e.use(m.a),e.prototype.$msgbox=p.a}},re=ne,oe=a("b2d6"),se=a.n(oe),le=a("4897"),ce=a.n(le),de=(a("6107"),a("ed2c"),a("3394"),a("9541")),he=a.n(de),pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("PhotoCarving")],1)},ge=[],me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"zen-photo-carving"},[e._l(e.cropItems,function(e,t){return a("div",{key:e.id,staticClass:"crop-container"},[a("CropDialog",{ref:"cropDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.photoItems,function(e,t){return a("div",{key:e.id,staticClass:"photo-container",attrs:{id:"photo-container-"+t}},[a("PhotoDialog",{ref:"PhotoDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.crystalItems,function(e,t){return a("div",{key:e.id,staticClass:"crystal-container"},[a("CrystalDialog",{ref:"CrystalDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.photoCrystalItems,function(e,t){return a("div",{key:e.id},[a("PhotoCrystalDialog",{ref:"PhotoCrystalDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.nameCarvingItems,function(e,t){return a("div",{key:e.id,staticClass:"name-container"},[a("NameCarvingDialog",{ref:"NameCarvingDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.curveCarvingItems,function(e,t){return a("div",{key:e.id,staticClass:"curve-container"},[a("CurveCarvingDialog",{ref:"CurveCarvingDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.carvingItems,function(e,t){return a("div",{key:e.id,staticClass:"carving-container"},[a("CarvingDialog",{ref:"CarvingDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.crystalTextItems,function(e,t){return a("div",{key:e.id,staticClass:"crystal-text-container"},[a("CrystalText",{ref:"CrystalText",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),e._l(e.flipPhotoItems,function(e,t){return a("div",{key:e.id,staticClass:"flip-photo-container",attrs:{id:"flip-photo-container-"+t}},[a("FlipPhotoDialog",{ref:"FlipPhotoDialog",refInFor:!0,attrs:{param:{data:e,index:t}}})],1)}),a("SelectDialog",{ref:"selectDialog"}),a("div",{staticClass:"hidden-input"},[a("input",{staticClass:"zen-require",attrs:{type:"text",name:"properties[customInfo]",required:"required"},domProps:{value:this.$store.getters.getCustomInfo}})])],2)},ue=[],ve=a("bd86"),fe=a("55db"),xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"photo-box"},[0==e.photoStyle?a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow>1,expression:"isShow > 1"}],class:e.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[this.photoCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.photoCrop[e.param.index],width:"50",height:"40"},on:{click:function(t){return e.openimage()}}}):e._e(),e.cutDialogText&&e.anotherImg?a("img",{staticClass:"preview-thumbnail",attrs:{src:e.anotherImg,width:"50",height:"40"},on:{click:function(t){return e.openimage(e.anotherImg)}}}):e._e(),e.engravingCrop?a("img",{staticClass:"preview-thumbnail carving-preview-img",attrs:{src:e.engravingCrop,width:"50",height:"40"},on:{click:function(t){return e.openimage(e.engravingCrop)}}}):e._e(),this.photoCrop[e.param.index]?a("i",{staticClass:"show-img-icon",on:{click:function(t){return e.openimage()}}}):e._e(),this.photoCrop[e.param.index]?e._e():a("span",{staticClass:"area-photo-upload-text"},[e._v(e._s(e.uploadLabel)),e.hasNo?a("span",[e._v(" "+e._s(e.param.index+1))]):e._e(),e.photoRemark?a("span",[e._v(e._s(e.photoRemark))]):e._e(),e.requireVal?a("font",{attrs:{color:"red"}},[e._v("*")]):e._e()],1)]),a("div",{staticClass:"area-photo-upload-flex"},[e.isZuploader?a("button",{staticClass:"btn-upload-open",attrs:{type:"button"},on:{click:function(t){return e.zupload()}}},[e._v(e._s(e.btnUploadText))]):e.photoTemplateImages?a("button",{staticClass:"btn-upload-open",attrs:{type:"button"},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v(e._s(e.btnUploadText))]):a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload,accept:e.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[e._v(e._s(this.btnUploadText))])])],1)]):e._e(),1==e.photoStyle&&this.photoCrop[e.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai",staticStyle:{height:"0px !important"}},[a("img",{staticClass:"avatar",staticStyle:{height:"0px !important"},attrs:{src:this.photoCrop[e.param.index]}})]):e._e(),1==e.photoStyle?a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow>1,expression:"isShow > 1"}],staticClass:"area-photo-upload-rect"},[a("el-upload",{staticClass:"avatar-uploader photo-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload,accept:e.uploadAccept}},[this.photoCrop[e.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai"},[a("img",{staticClass:"avatar",attrs:{src:this.photoCrop[e.param.index]}})]):e._e(),this.photoCrop[e.param.index]?e._e():a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),this.photoCrop[e.param.index]?e._e():a("span",{staticClass:"upload-label"},[e._v(e._s(e.uploadLabel)),e.hasNo?a("span",[e._v(" "+e._s(e.param.index+1))]):e._e()])]),e.cutDialogText&&this.photoCrop[e.param.index]?a("img",{staticClass:"avatar-new",attrs:{src:this.photoCrop[e.param.index]}}):e._e(),e.cutDialogText&&e.anotherImg?a("img",{staticClass:"another-img",attrs:{src:e.anotherImg}}):e._e()],1):e._e(),a("div",{class:e.requirePromptTextClass},[e._v(e._s(e.requirePrompt))]),a("el-dialog",{staticClass:"select-carving-dialog",attrs:{title:"",visible:e.carvingVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.carvingVisible=t}}},[a("div",{staticClass:"carving-crop-img"},[this.photoCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.photoCrop[e.param.index],width:"250"}}):e._e()]),a("div",{staticClass:"tc mt20"},[a("button",{staticClass:"el-button el-button--danger",on:{click:function(t){return e.addCarving(1)}}},[e._v(e._s(e.addCarvingText))])]),a("div",{staticClass:"select-or-text tc"},[e._v(e._s(e.selectOrText))]),a("div",{staticClass:"tc"},[a("button",{staticClass:"el-button el-button--primary",on:{click:function(t){return e.addCarving(0)}}},[e._v(e._s(e.noCarvingText))])])]),a("el-dialog",{attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[""!==e.cutDialogText?a("div",{staticClass:"cutDialogBox"},[a("a",{attrs:{href:"javascript: void(0)"},on:{click:e.cutDialog}},[e._v(e._s(e.cutDialogText))])]):e._e(),a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),e.hasCropImg?e._e():a("div",{directives:[{name:"show",rawName:"v-show",value:e.toolShow,expression:"toolShow"}],staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt photo-prompt",domProps:{innerHTML:e._s(e.cropPrompt)}}),e.noteText?a("div",{staticClass:"crop-note"},[e._v(e._s(e.noteText))]):e._e(),e.hasCropImg?a("div",{directives:[{name:"show",rawName:"v-show",value:e.templateErrorMsg,expression:"templateErrorMsg"}],staticClass:"template-error"},[e._v(e._s(e.templateErrorMsg))]):e._e(),e.photoTemplateImages?a("div",{staticClass:"template-images-container"},[a("div",{staticClass:"template-title"},[e._v(e._s(e.photoTemplateTitle))]),a("ul",e._l(e.photoTemplateImages,function(t,i){return a("li",{key:i,class:{templateBorder:e.photoTemplateSelect[i],pointerEvent:e.photoLoad},on:{click:function(a){return e.changePhotoTemplate(t,i)}}},[e.printingImages?a("img",{attrs:{src:e.printingImages[i]}}):a("img",{attrs:{src:t}})])}),0)]):e._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1),a("div",{staticClass:"fuzzyMsg"},[e._v(e._s(e.fuzzyMsg))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:e.cancelCanvas}},[e._v(e._s(e.photoCancelText))]),e.photoTemplateImages?a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.ifChangeImage,expression:"!ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:e.isLoading,disabled:e.photoLoad},on:{click:e.templateImage}},[e._v(e._s(e.photoConfirmText))]):a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.ifChangeImage,expression:"!ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:e.isLoading,disabled:e.hasCropImg&&!e.previewImg||e.photoLoad},on:{click:e.photoImage}},[e._v(e._s(e.photoConfirmText))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.ifChangeImage,expression:"ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary"},on:{click:e.changeImage}},[e._v(e._s(e.changeImgText))])],1)]),e.inLoading&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.uploadLoadingImage}})])]):e._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{directives:[{name:"show",rawName:"v-show",value:e.previewImg||!e.hasCropImg,expression:"previewImg || !hasCropImg"}],attrs:{id:e.photoCanvasId}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.previewImg&&!e.templateErrorMsg&&e.hasCropImg,expression:"!previewImg && !templateErrorMsg && hasCropImg"}],staticClass:"lds-ring-box"},[e._m(0)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.templateErrorMsg&&e.hasCropImg,expression:"templateErrorMsg && hasCropImg"}],staticClass:"lds-ring-box"},[a("svg",{staticClass:"icon",staticStyle:{width:"64px",height:"64px","vertical-align":"middle",fill:"currentColor",overflow:"hidden",color:"#000"},attrs:{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1031"}},[a("path",{attrs:{d:"M593.8176 168.5504l356.00384 595.21024c26.15296 43.74528 10.73152 99.7376-34.44736 125.05088-14.39744 8.06912-30.72 12.30848-47.37024 12.30848H155.97568C103.75168 901.12 61.44 860.16 61.44 809.61536c0-16.09728 4.38272-31.92832 12.71808-45.8752L430.16192 168.5504c26.17344-43.7248 84.00896-58.65472 129.20832-33.34144a93.0816 93.0816 0 0 1 34.44736 33.34144zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88z m0-512a72.31488 72.31488 0 0 0-71.76192 81.3056l25.72288 205.7216a46.40768 46.40768 0 0 0 92.07808 0l25.72288-205.74208A72.31488 72.31488 0 0 0 512 307.2z","p-id":"1032"}})])])])],1)},be=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lds-ring"},[a("div"),a("div"),a("div"),a("div")])}],Ce=(a("a481"),a("ac6a"),a("3996")),ye=a("09b8"),we=function(){function e(e){this.init(e)}return e.prototype=Object.assign(new Ce["a"],{request:{},init:function(e){this.canvas=new ye["fabric"].Canvas(e["canvasid"]),this.cWidth=e.cWidth,this.cHeight=e.cHeight,this.baseImg=!!e.baseImg&&e.baseImg,this.type=e.type,this.sku=e.sku,this.bgcolor=e.bgcolor?e.bgcolor:"",this.isAiColor=e.isAiColor?e.isAiColor:"",this.ainame=e.ainame?e.ainame:"",this.isAiLucid=e.isAiLucid?e.isAiLucid:0,this.hasCropImg=!0===e.hasCropImg,this.quality=e.quality?e.quality:.5,this.compressSize=e.compressSize?e.compressSize:2500,this.coverPhoto=e.coverPhoto,this.bgImg=e.bgImg,this.isBgImg=e.isBgImg,this.isLockRotate=!0===e.isLockRotate,this.grayscale=!0===e.grayscale,this.photoTemplateCoord=e.photoTemplateCoord,this.photoTemplateImages=e.photoTemplateImages,this.flipX=!0===e.flipX,this.selectable=!1!==e.selectable,this.canvasScale=1,this.setCanvaSize(),this.setObject(this,this.baseImg),this.hasCropImg||this.photoTemplateImages||this.flipX||this.setBindMethod(this)},setObject:function(e,t){if(this.setCanvaSize(),e.canvasScale=e.scale,console.log(e.canvasScale),1==e.isBgImg){var a=e.bgImg;a||(a=Ce["a"].util.awcdn+Ce["a"].util.pdir+e.sku+"-bg.png"),e.canvas.setBackgroundImage(a+"?"+Math.random(),e.canvas.renderAll.bind(e.canvas),{scaleX:e.scale,scaleY:e.scale,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous"})}e.canvas.setOverlayImage(t,e.canvas.renderAll.bind(e.canvas),{originX:"left",originY:"top",scaleX:e.scale,scaleY:e.scale,crossOrigin:"anonymous"}),console.log(this.canvas)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},adjuster:function(e){var t=this.getBs();if(t){switch(e){case"move-left":t.set({left:t.left-5});break;case"move-right":t.set({left:t.left+5});break;case"move-up":t.set({top:t.top-5});break;case"move-down":t.set({top:t.top+5});break;case"zoom-big":t.set({scaleX:t.scaleX+.01,scaleY:t.scaleY+.01});break;case"zoom-small":t.set({scaleX:t.scaleX-.01,scaleY:t.scaleY-.01});break;case"rotate-left":t.set({angle:t.angle-45}).setCoords();break;case"rotate-right":t.set({angle:t.angle+45}).setCoords();break;case"reset":t.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords();break}this.setCoor()}},rotate:function(e){var t=this.getBs();if(t){var a="rotate_left"==e?-45:45;t.set({angle:t.angle+a}).setCoords(),this.setCoor()}},reset:function(){var e=this.getBs();e&&(e.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords(),this.setCoor())},setScale:function(e,t){var a=1;return e.width>t.width||e.height>t.height*a?(e.width>t.width&&(a=e.width/t.width),e.height>t.height*a&&(a*=e.height/(t.height*a))):a=t.height>t.width?e.width/t.width:e.height/t.height,a},setBindMethod:function(e){this.listenWheel(this,!0)},compressOld:function(e,t){var a=new Image;a.src=t,a.onload=function(){var a=.5,i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height),t=i.toDataURL("image/png",a),e.request.originImage=t}},compress:function(e,t){var a=new Image;a.src=t,a.onload=function(){var i=e.compressSize,n=e.quality,r=document.createElement("canvas"),o=r.getContext("2d");if(e.request.scale=Math.min(Math.min(i,a.width)/a.width,Math.min(i,a.height)/a.height),r.width=a.width*e.request.scale,r.height=a.height*e.request.scale,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),e.grayscale){for(var s=o.getImageData(0,0,this.width,this.height),l=0;l<s.height;l++)for(var c=0;c<s.width;c++){var d=4*l*s.width+4*c,h=(s.data[d]+s.data[d+1]+s.data[d+2])/3;s.data[d]=h,s.data[d+1]=h,s.data[d+2]=h}o.putImageData(s,0,0,0,0,s.width,s.height)}t=r.toDataURL("image/jpeg",n),e.request.originImage=t}},changeTemplate:function(e,t,a){if(console.log(this.scale),e.canvas.getObjects().length>0)var i=e.getBs();i&&"image"===i.type&&e.canvas.remove(i),ye["fabric"].Image.fromURL(t,function(t){t.hasControls=!1,t.hasBorders=!1;var i=e.photoTemplateCoord.width/t.width*this.scale,n=e.photoTemplateCoord.height/t.height*this.scale;t.set({scaleX:i,scaleY:n,left:e.photoTemplateCoord.left*e.scale,top:e.photoTemplateCoord.top*e.scale,lockMovementX:!0,lockMovementY:!0}),e.canvas.add(t),e.canvas.renderAll(),a()}.bind(e),{crossOrigin:"anonymous"})},change:function(e,t){if(e.compress(e,t),e.canvas.getObjects().length>0)var a=this.getBs();if(e.grayscale){var i=new Image;i.src=t,i.onload=function(){var i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height);for(var s=n.getImageData(0,0,this.width,this.height),l=0;l<s.height;l++)for(var c=0;c<s.width;c++){var d=4*l*s.width+4*c,h=(s.data[d]+s.data[d+1]+s.data[d+2])/3;s.data[d]=h,s.data[d+1]=h,s.data[d+2]=h}n.putImageData(s,0,0,0,0,s.width,s.height),t=i.toDataURL("image/png"),a&&"image"===a.type?a.setSrc(t,function(){e.coverPhoto?e.scale=e.setScale(e,a):e.scale=e.height>a.height?1:e.height/a.height,a.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale}),e.canvas.renderAll(!0),e.setCoor()}):ye["fabric"].Image.fromURL(t,function(t){t.hasControls=!1,t.hasBorders=!1,e.isLockRotate&&(t.lockRotation=!0),t.set({originX:"center",originY:"center"}),e.coverPhoto?e.scale=e.setScale(e,t):e.scale=e.height>t.height?1:e.height/t.height,t.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale}),e.canvas.add(t),e.canvas.sendToBack(t),e.canvas.renderAll(),e.setCoor()})}}else a&&"image"===a.type?a.setSrc(t,function(){e.coverPhoto?e.scale=e.setScale(e,a):e.scale=e.height>a.height?1:e.height/a.height,a.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale,flipX:e.flipX,selectable:e.selectable}),e.canvas.renderAll(!0),e.setCoor()}):ye["fabric"].Image.fromURL(t,function(t){t.hasControls=!1,t.hasBorders=!1,e.isLockRotate&&(t.lockRotation=!0),t.set({originX:"center",originY:"center"}),e.coverPhoto?e.scale=e.setScale(e,t):e.scale=e.height>t.height?1:e.height/t.height,t.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale,flipX:e.flipX,selectable:e.selectable}),e.canvas.add(t),e.canvas.sendToBack(t),e.canvas.renderAll(),e.setCoor()})},setCoor:function(){var e=this.getBs();e&&(this.request.scaleX=e.scaleX,this.request.scaleY=e.scaleY,this.request.left=e.left,this.request.top=e.top,this.request.angle=e.angle,this.canvas.renderAll())},addObject:function(e,t){ye["fabric"].Image.fromURL(t[0],function(a){a.set({originX:"center",originY:"center"}),1==e.isMobile?a.set({left:e.width/2,top:e.height/2,scaleX:150/a.width,scaleY:150/a.width}):a.set({left:e.cWidth/2,top:e.cHeight/2,scaleX:300/a.width,scaleY:300/a.width});var i=t[1],n=e.canvas.item(i);a.opacity=t[2],a.selectable=t[3],a.hasBorders=t[4],a.hasControls=t[5],e.canvas.remove(n).add(a).moveTo(a,i).renderAll(),e.setCoor()})},listenWheel:function(e,t){var a=e.canvas.wrapperEl;if(void 0!=a){var i=function(t){var a=0;t=window.event||t,a=t.detail?-t.detail/3:t.wheelDelta/120;t.preventDefault&&t.preventDefault();var i=e.canvas.findTarget(t);if(i){a=a/200;return i.width*i.scaleX>=50||a>0?(i.scaleX+=a,i.scaleY+=a):(i.scaleX=.01,i.scaleY=.01),i.setCoords(),e.setCoor(),!1}},n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.attachEvent?a.attachEvent("on"+n,i,t):a.addEventListener&&a.addEventListener(n,i,t)}}}),e.prototype.constructor=e,e}(),_e=we,Te=a("bc3a"),Oe=a.n(Te),Ie={name:"CropDialog",props:["param"],data:function(){return{uploadLabel:fe["a"].photo[this.param.index].uploadLabel?fe["a"].photo[this.param.index].uploadLabel:fe["a"].uploadLabel?fe["a"].uploadLabel:"Upload your Photo",btnUploadText:fe["a"].btnUploadText?fe["a"].btnUploadText:"Upload",changeText:fe["a"].changeText?fe["a"].changeText:"Change",photoCancelText:fe["a"].photoCancelText?fe["a"].photoCancelText:"Cancel",photoConfirmText:fe["a"].photoConfirmText?fe["a"].photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,requirePromptTextClass:"require-prompt-text require-prompt-text-"+this.param.index,photoStyle:fe["a"].photo[this.param.index].style?fe["a"].photo[this.param.index].style:0,checkFuzzy:!!fe["a"].photo[this.param.index].checkFuzzy&&fe["a"].photo[this.param.index].checkFuzzy,currentLanguage:fe["a"].photo[this.param.index].currentLanguage?fe["a"].photo[this.param.index].currentLanguage:"en",isShow:fe["a"].photo[this.param.index].isShow?fe["a"].photo[this.param.index].isShow:2,cutDialogText:fe["a"].photo[this.param.index].cutDialogText?fe["a"].photo[this.param.index].cutDialogText:"",dialogIndex:fe["a"].photo[this.param.index].dialogIndex,getVisible:fe["a"].photo[this.param.index].getVisible,isUpload:0,isLoading:!1,photoBase64:"",cropPrompt:!1===fe["a"].cropPrompt?"":fe["a"].cropPrompt,requirePrompt:!1===fe["a"].requirePrompt?"":fe["a"].requirePrompt,imgSrc:"",photoCrop:[],photoAi:[],photoOrigin:[],photoCanvasId:"photo-canvas-"+this.param.index,qncdn:fe["a"].qncdn.qncdn,awcdn:fe["a"].qncdn.awcdn,dialogWidth:this.$device.mobile?"100%":"40%",isFullscreen:!!this.$device.mobile,centerDialogVisibleVal:!1,percentage:0,fuzzyMsg:"",bgOpacity:fe["a"].bgOpacity?fe["a"].bgOpacity:.5,wrapperBackgroudColor:fe["a"].wrapperBackgroudColor?fe["a"].wrapperBackgroudColor:"#ffffff",uploadLoadingImage:fe["a"].uploadLoadingImage?fe["a"].uploadLoadingImage:"",noteText:fe["a"].noteText?fe["a"].noteText:"",fuzzyAsync:!1!==this.param.data.fuzzyAsync,require:!1!==this.param.data.require,requireVal:!1!==this.param.data.require,inLoading:!1,hasCropImg:!0===this.param.data.hasCropImg,changeImgText:this.param.data.changeImgText?this.param.data.changeImgText:"Change Image",addCarvingText:this.param.data.addCarvingText?this.param.data.addCarvingText:"Add Text",noCarvingText:this.param.data.noCarvingText?this.param.data.noCarvingText:"Without Text",selectOrText:this.param.data.selectOrText?this.param.data.selectOrText:"OR",hasCarving:!0===this.param.data.hasCarving,hasSelect:!0===this.param.data.hasSelect,carvingVisible:!1,engravingCrop:"",hasNo:!0===fe["a"].hasNo,photoLoad:!1,coverPhoto:!0===fe["a"].coverPhoto,isLockRotate:!0===this.param.data.isLockRotate,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,uploadAccept:fe["a"].uploadAccept?fe["a"].uploadAccept:"",processText:fe["a"].processText?fe["a"].processText:"Processing",photoRemark:this.param.data.photoRemark?this.param.data.photoRemark:"",bgImg:this.param.data.bgImg?this.param.data.bgImg:"",isBgImg:this.param.data.isBgImg?this.param.data.isBgImg:0,isZuploader:!0===this.param.data.isZuploader,zuploaderObj:this.param.data.zuploaderObj?this.param.data.zuploaderObj:{},zuploaderSource:"",objData:!0===this.param.data.objData,grayscale:!0===this.param.data.grayscale,dpi:this.param.data.dpi?this.param.data.dpi:72,flip:this.param.data.flip?this.param.data.flip:"",imgSuffix:this.param.data.imgSuffix?this.param.data.imgSuffix:"",photoTemplateImages:!!this.param.data.photoTemplateImages&&this.param.data.photoTemplateImages,printingImages:!!this.param.data.printingImages&&this.param.data.printingImages,printingCodes:this.param.data.printingCodes?this.param.data.printingCodes:[],photoTemplateCoord:this.param.data.photoTemplateCoord?this.param.data.photoTemplateCoord:{},photoTemplateUrl:"",photoTemplateCode:"",photoTemplateSelect:[],photoCodeList:[],photoTemplateTitle:this.param.data.photoTemplateTitle,toolShow:!1!==this.param.data.toolShow,photoBg:this.param.data.photoBg>-1?this.param.data.photoBg:-1}},computed:{centerDialogVisible:{get:function(){if(this.cutDialogText){var e=this.$store.getters.getPhotoDialogVisible(this.param.index);return e.value}return this.hasCropImg?this.$store.getters.getPhotoDialogVisibleNormal:this.centerDialogVisibleVal},set:function(e){if(this.cutDialogText){var t={id:this.param.index,value:e};this.$store.dispatch("setPhotoDialogVisible",t)}else this.hasCropImg?this.$store.dispatch("setPhotoDialogVisibleNormal",e):this.centerDialogVisibleVal=e}},anotherImg:{get:function(){var e=this.$store.getters.getAnotherImg(this.param.index);return e.value},set:function(e){var t={id:this.param.index,value:e};this.$store.dispatch("setAnotherImg",t)}},previewImg:{get:function(){return this.$store.getters.getFusionPreview},set:function(e){this.$store.dispatch("setFusionPreview",e)}},templateErrorMsg:{get:function(){return this.$store.getters.getTemplateErrorMsg},set:function(e){this.$store.dispatch("setTemplateErrorMsg",e)}},ifChangeImage:{get:function(){return this.$store.getters.getIfChangeImage},set:function(e){this.$store.dispatch("setIfChangeImage",e)}}},mounted:function(){var e=this;fe["a"].photoObj[this.param.index]=new _e({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,hasCropImg:e.hasCropImg,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:e.coverPhoto,bgImg:e.bgImg,isBgImg:e.isBgImg,isLockRotate:e.isLockRotate,grayscale:e.grayscale,photoTemplateCoord:e.photoTemplateCoord,photoTemplateImages:e.photoTemplateImages}),e.photoTemplateImages&&(e.photoTemplateUrl=e.photoTemplateImages[0],e.photoTemplateImages.forEach(function(t,a){if(0==e.printingCodes.length){var i=t.replace(".png","");e.printingImages&&(i=e.printingImages[a].replace(".png",""));var n=i.substr(i.lastIndexOf("/")+1);e.photoCodeList.push(n)}else e.photoCodeList.push(e.printingCodes[a]);a>0?e.photoTemplateSelect.push(!1):e.photoTemplateSelect.push(!0)}),e.photoTemplateCode=e.photoCodeList[0],e.photoLoad=!0,_zenConfig.photoObj[e.param.index].changeTemplate(_zenConfig.photoObj[e.param.index],e.photoTemplateUrl,function(){e.photoLoad=!1}));var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.photo)||(t.photo=[]),t.photo[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",ai:"",origin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t)),window.changePhotoSku=this.changePhotoSku,window.clearPhoto=this.clearPhoto},methods:{zupload:function(){var e=this;e.zuploaderObj.onConfirm=function(t){var a=new Image;a.src=t[0].objectURL,a.onload=function(){var i=document.createElement("canvas"),n=i.getContext("2d");i.width=a.width,i.height=a.height,n.drawImage(a,0,0,a.width,a.height);var r="jpeg";"undefined"!=typeof t[0].url&&(r=t[0].url.substring(t[0].url.lastIndexOf(".")+1,t[0].url.indexOf("?")).toLowerCase());var o=i.toDataURL("image/"+r);e.photoBase64=o,e.zuploaderSource=t[0].source,_zenConfig.photoObj[e.param.index].change(_zenConfig.photoObj[e.param.index],o),e.centerDialogVisible=!0}},Zuploader.render(e.zuploaderObj)},cancelCanvas:function(){var e=this;e.centerDialogVisible=!1,fe["a"].dispatchCustomEvent("EVENT_PHOTO_CANCEL_AFTER",{index:e.param.index})},avatarUpload:function(e){var t=this,a=this,i=new FileReader;i.onload=function(e){a.centerDialogVisible=!0,t.photoBase64=e.target.result,t.checkFuzzy&&(a.photoLoad=!0,a.photoConfirmText=a.processText,a.isLoading=!0,t.checkImageFuzzy(t.photoBase64));var i=t.photoBase64;a.cutDialogText?_zenConfig.photoObj.forEach(function(e,t){_zenConfig.photoObj[t].change(_zenConfig.photoObj[t],i)}):_zenConfig.photoObj[a.param.index].change(_zenConfig.photoObj[a.param.index],i)},i.readAsDataURL(e.file)},changePhotoTemplate:function(e,t){var a=this;a.photoLoad=!0,_zenConfig.photoObj[a.param.index].changeTemplate(_zenConfig.photoObj[a.param.index],e,function(){a.photoLoad=!1}),a.photoTemplateUrl=e,a.photoTemplateCode=a.photoCodeList[t],a.photoTemplateSelect.forEach(function(e,t){a.$set(a.photoTemplateSelect,t,!1)}),a.$set(a.photoTemplateSelect,t,!0)},onOpened:function(){var e=this;if(this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody),e.photoBg>-1){e.photoLoad=!0;var t="",a=JSON.parse(e.$store.getters.getCustomInfo);"undefined"!=typeof a.photo&&(t=a.photo[e.photoBg].crop),t&&fabric.Image.fromURL(t+"?"+Math.random(),function(t){t.scaleX=fe["a"].photoObj[e.param.index].canvas.width/t.width,t.scaleY=fe["a"].photoObj[e.param.index].canvas.height/t.height,fe["a"].photoObj[e.param.index].canvas.setBackgroundImage(t),fe["a"].photoObj[e.param.index].canvas.requestRenderAll(),e.photoLoad=!1},{crossOrigin:"Anonymous"})}},openimage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.photoCrop[this.param.index];this.$parent.openimage(e)},doAction:function(e){"reset"==e?this.getBs().set({left:fe["a"].photoObj[this.param.index].canvas.width/2,top:fe["a"].photoObj[this.param.index].canvas.height/2,angle:0,scaleX:fe["a"].photoObj[this.param.index].scale,scaleY:fe["a"].photoObj[this.param.index].scale}).setCoords():"left"==e?this.getBs().set({angle:this.getBs().angle-45}).setCoords():"right"==e?this.getBs().set({angle:this.getBs().angle+45}).setCoords():"sub"==e?this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords():"add"==e&&this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),fe["a"].photoObj[this.param.index].canvas.renderAll()},getBs:function(){return fe["a"].photoObj[this.param.index].canvas.item(0)},templateImage:function(){var e=this;e.uploadLoadingImage&&(e.centerDialogVisible=!1,e.inLoading=!0),this.isLoading=!0;var t=fe["a"].photoObj[e.param.index].canvas.toDataURL({format:"png",quality:.8});fe["a"].cdnUpload({base64:t,key:fe["a"].getFilename(12)+".png"},function(t){e.photoCrop[e.param.index]=t.picture;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.photo)||(a.photo=[]),a.photo[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:t.picture,ai:e.photoTemplateUrl,origin:e.photoTemplateUrl,item:fe["a"].photoObj[e.param.index].sku},e.photoTemplateCode&&(a.photo[e.param.index].printingCode=e.photoTemplateCode),e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.centerDialogVisible=!1,e.isLoading=!1,e.inLoading=!1,e.percentage=0,e.btnUploadText=e.changeText,fe["a"].dispatchCustomEvent("EVENT_PHOTO_SAVE_AFTER",{index:e.param.index,data:a})})},photoImage:function(){var e=this;e.uploadLoadingImage&&(e.centerDialogVisible=!1,e.inLoading=!0),this.isLoading=!0;var t=fe["a"].photoObj[e.param.index].getBs(),a=fe["a"].photoObj[e.param.index].request.originImage;e.hasCropImg&&(a=e.previewImg),fe["a"].awUpload({width:fe["a"].photoObj[e.param.index].cWidth,height:fe["a"].photoObj[e.param.index].cHeight,scaleX:t.scaleX*fe["a"].photoObj[e.param.index].cWidth/fe["a"].photoObj[e.param.index].width/fe["a"].photoObj[e.param.index].request.scale,scaleY:t.scaleY*fe["a"].photoObj[e.param.index].cWidth/fe["a"].photoObj[e.param.index].width/fe["a"].photoObj[e.param.index].request.scale,left:t.left*fe["a"].photoObj[e.param.index].cWidth/fe["a"].photoObj[e.param.index].width,top:t.top*fe["a"].photoObj[e.param.index].cWidth/fe["a"].photoObj[e.param.index].width,angle:t.angle,type:fe["a"].photoObj[e.param.index].type,sku:fe["a"].photoObj[e.param.index].sku,ainame:fe["a"].photoObj[e.param.index].ainame||"",isAiLucid:fe["a"].photoObj[e.param.index].isAiLucid||0,bgcolor:fe["a"].photoObj[e.param.index].bgcolor||"",origin_data:a,isAiColor:fe["a"].photoObj[e.param.index].isAiColor||"",isBgImg:e.isBgImg,dpi:e.dpi,flip:e.flip,imgSuffix:e.imgSuffix},function(a){if(void 0==a.crop?e.photoCrop[e.param.index]="":(e.$set(e.photoCrop,e.param.index,fe["a"].awcdn+a.crop),console.log("self.photoCrop[self.param.index] *********  "+e.photoCrop[e.param.index])),e.cutDialogText&&e.$store.dispatch("setAnotherImg",{id:e.dialogIndex,value:fe["a"].awcdn+a.crop}),e.hasCropImg){var i={index:e.param.index,value:fe["a"].awcdn+a.crop};e.$store.dispatch("setCropPhoto",i)}void 0==a.ai?e.photoAi[e.param.index]="":e.photoAi[e.param.index]=fe["a"].awcdn+a.ai,void 0==a.origin?e.photoOrigin[e.param.index]="":e.photoOrigin[e.param.index]=fe["a"].awcdn+a.origin;var n={};if(e.$store.getters.getCustomInfo&&(n=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(n.photo)||(n.photo=[]),n.photo[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:e.photoCrop[e.param.index],ai:e.photoAi[e.param.index],origin:e.photoOrigin[e.param.index],item:fe["a"].photoObj[e.param.index].sku},e.zuploaderSource&&(n.photo[e.param.index].source=e.zuploaderSource),e.objData){var r=fe["a"].photoObj[e.param.index].canvasScale,o={};o["width"]=fe["a"].photoObj[e.param.index].canvas.width,o["height"]=fe["a"].photoObj[e.param.index].canvas.height;var s={};s["width"]=t.width*t.scaleX,s["height"]=t.height*t.scaleX,s["angle"]=t.angle,s["center_x"]=t.left,s["center_y"]=t.top,n.photo[e.param.index].view_box=o,n.photo[e.param.index].cfgs=s,n.photo[e.param.index].scale=r}e.$store.dispatch("setCustomInfo",JSON.stringify(n)),e.cutDialogText&&0==e.param.index?e.cutDialog():e.centerDialogVisible=!1,e.isLoading=!1,e.inLoading=!1,e.percentage=0,e.btnUploadText=e.changeText,e.hasCarving&&(e.carvingVisible=!0),e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param),fe["a"].dispatchCustomEvent("EVENT_PHOTO_SAVE_AFTER",{index:e.param.index,data:n})},e)},checkImageFuzzy:function(e){var t=this;t.fuzzyMsg&&gtag("event","Fuzzy_Photo_Change",{event_category:"website"}),t.fuzzyMsg="";var a=new Image;a.src=e,a.onload=function(){var i=fe["a"].sizeFuzzy?fe["a"].sizeFuzzy:1e3,n=fe["a"].qualityFuzzy?fe["a"].qualityFuzzy:1,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,a.width)/a.width,Math.min(i,a.height)/a.height);r.width=a.width*s,r.height=a.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),e=r.toDataURL("image/jpeg",n),t.$ajax({method:"post",async:t.fuzzyAsync,url:"https://ai.soufeel.com/tencent/fuzzy?_language="+this.currentLanguage,data:{image:e}}).then(function(e){e.data.fuzzy&&(t.fuzzyMsg=e.data.msg,gtag("event","Fuzzy_Photo_Show",{event_category:fe["a"].fuzzyWebsite?fe["a"].fuzzyWebsite:"website"})),t.checkFuzzy&&(t.photoLoad=!1,t.photoConfirmText=fe["a"].photoConfirmText?fe["a"].photoConfirmText:"Confirm",t.isLoading=!1)}).catch(function(e){console.log(e),t.checkFuzzy&&(t.photoLoad=!1,t.photoConfirmText=fe["a"].photoConfirmText?fe["a"].photoConfirmText:"Confirm",t.isLoading=!1)})}},cutDialog:function(){this.centerDialogVisible=!1;var e={id:this.dialogIndex,value:!0};this.$store.dispatch("setPhotoDialogVisible",e)},clearPhoto:function(){var e=this;e.photoCrop[e.param.index]="";var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.photo)||(t.photo=[]),t.photo[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",ai:"",origin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t))},changePhotoSku:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fe["a"].photoObj[t].canvas.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fe["a"].photoObj[t].canvas.height,n=this;fe["a"].photoObj[t].sku=e;var r=fe["a"].photoUrl+e+".png";n.photoLoad=!0,a!=fe["a"].photoObj[t].canvas.width&&(fe["a"].photoObj[t].canvas.setWidth(a),fe["a"].photoObj[t].canvas.requestRenderAll()),i!=fe["a"].photoObj[t].canvas.height&&(fe["a"].photoObj[t].canvas.setHeight(i),fe["a"].photoObj[t].canvas.requestRenderAll()),fabric.Image.fromURL(r+"?"+Math.random(),function(e){e.scaleX=fe["a"].photoObj[t].canvas.width/e.width,e.scaleY=fe["a"].photoObj[t].canvas.height/e.height,fe["a"].photoObj[t].canvas.setOverlayImage(e),fe["a"].photoObj[t].canvas.requestRenderAll(),n.photoLoad=!1,console.log(n.photoLoad)},{crossOrigin:"Anonymous"})},changeImage:function(){this.centerDialogVisible=!1;var e=document.getElementsByClassName("crop-btn-upload-open")[0];e.click()},addCarving:function(e){this.carvingVisible=!1,e>0&&this.$parent.$refs.CarvingDialog[this.param.index].open(),fe["a"].dispatchCustomEvent("SELECT_CARVING_AFTER",{index:this.param.index,data:e})}},watch:{centerDialogVisible:function(e){!0===e?fe["a"].dispatchCustomEvent("EVENT_PHOTO_DIALOG",{index:this.param.index}):fe["a"].dispatchCustomEvent("EVENT_PHOTO_DIALOG_CLOSE",{index:this.param.index})}}},Ee=Ie,Se=(a("5bd0"),a("2877")),ke=Object(Se["a"])(Ee,xe,be,!1,null,"5491e509",null),je=ke.exports,Le=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"carving-box"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],class:e.areaCarvingClass},[a("div",{staticClass:"area-carving-preview-text"},[this.engravingCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[e.param.index],width:"50",height:"40"},on:{click:e.openimage}}):a("span",[a("span",{staticClass:"carving-pre-text"},[e._v(e._s(e.previewText))]),e.requireVal?a("font",{attrs:{color:"red"}},[e._v("*")]):e._e()],1)]),a("div",{staticClass:"btn-box",on:{click:e.open}},[e.inputMark?a("span",{staticClass:"input-mark"},[e._v(e._s(e.inputMark))]):e._e(),a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:e.open}},[e._v(e._s(e.btnText))])])]),a("div",{class:e.requireCarvingTextClass},[e._v(e._s(e.requirePrompt))]),a("el-dialog",{staticClass:"carving-dialog",class:{loadingDialog:e.isLoading},attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[e.isLoading&&e.uploadLoadingImage?e._e():a("div",[a("div",{staticClass:"custom-carving-container",staticStyle:{position:"relative"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showCanvas,expression:"showCanvas"}],ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{staticClass:"operation-part"},[e.templateImages?a("div",{staticClass:"template-images-container"},[a("div",{staticClass:"template-title"},[e._v(e._s(e.templateTitle))]),a("ul",e._l(e.templateImages,function(t,i){return a("li",{key:t.label,class:{templateBorder:e.templateSelect[i],pointerEvent:e.photoLoad},on:{click:function(a){return e.changeTemplate(t.url,t.label,i)}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.label,placement:"top"}},[a("img",{attrs:{src:t.icon}})]),a("p",{staticClass:"template-label"},[e._v(e._s(t.label))])],1)}),0)]):e._e(),e.isSelectStyle?a("el-row",[e.showFont?a("el-col",{attrs:{span:e.fontSpanNum}},[a("div",[e._v(e._s(e.fontFamilyLabel))]),a("el-select",{staticClass:"slt-font-size",on:{change:e.changeFont},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},e._l(e.engravingFontOptions,function(t){return a("el-option",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,value:t.value}},[e._v("\n                          "+e._s(t.value?t.label:"ABC")+"\n                      ")])}),1)],1):e._e(),e.showSize?a("el-col",{class:{tr:e.isSelectStyle},attrs:{span:e.fontSpanNum}},[a("div",{staticClass:"font-label tl"},[a("span",[e._v(e._s(e.fontSizeLabel))])]),a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:e.changeSize},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e()],1):e._e(),e.showColor?a("div",{staticClass:"block carving-color-list"},[a("span",{staticClass:"demonstration"},[e._v(e._s(e.fontColorLabel))]),a("el-color-picker",{attrs:{predefine:e.predefineColors},model:{value:e.fontColor,callback:function(t){e.fontColor=t},expression:"fontColor"}})],1):e._e(),a("div",{staticClass:"label-input-text"},[e._v(e._s(e.inputTextLabel))]),e._l(e.coors,function(t,i){return a("div",{key:t.value},[t.title?a("div",{staticClass:"item-title"},[e._v(e._s(t.title))]):e._e(),t.info?a("div",{staticClass:"item-info"},[e._v(e._s(t.info))]):e._e(),"emoji"==t.type?a("el-row",{staticClass:"emoji-container"},[a("el-radio-group",{staticClass:"emoji-part",on:{change:function(a){return e.changeText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},[t.emojiList?a("el-col",e._l(t.emojiList,function(t){return a("el-radio",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1):a("el-col",e._l(e.emojiDefaultList,function(t){return a("el-radio",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1):a("div",{staticClass:"textarea-text carving-textarea-box",class:{carvingError:e.isEmpty[i]}},["date"==t.type?a("el-date-picker",{attrs:{format:e.dateFormat,"value-format":e.dateValueFormat,clearable:e.clearableValue,placeholder:e.datePlaceholder,readonly:e.dateReadonly},on:{change:function(a){return e.changeText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}):"time"==t.type?a("el-time-picker",{attrs:{format:e.timeFormat,"value-format":e.timeValueFormat,clearable:e.clearableValue,"arrow-control":e.arrowControl,placeholder:e.timePlaceholder,readonly:e.dateReadonly},on:{change:function(a){return e.changeText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}):t.isSinglelineInput?a("el-input",{staticClass:"carving-textarea",attrs:{type:"text",placeholder:e.textPlaceHolderList[i],maxlength:e.textMaxlength[i]},on:{input:function(a){return e.changeText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}):a("el-input",{staticClass:"carving-textarea",attrs:{type:"textarea",rows:t.rows,resize:t.resize,placeholder:e.textPlaceHolderList[i],maxlength:e.textMaxlength[i]},on:{input:function(a){return e.changeText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}),e.leftText?a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+i}},[e._v(e._s(e.nameLeftNum[i]))]),e._v(" "+e._s(e.leftText))]):e._e()],1),a("span",{directives:[{name:"show",rawName:"v-show",value:e.carvingEmojiError[i]&&e.errorWordShow,expression:"carvingEmojiError[index] && errorWordShow"}],staticClass:"carvingErrorWord"},[e._v(e._s(e.emojiErrorField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.carvingLimitError[i],expression:"carvingLimitError[index]"}],staticClass:"carvingErrorWord"},[e._v(e._s(e.limitErrorField))]),!t.isSelectStyle&&t.fontList?a("el-row",{staticClass:"rad-font coors-font-list"},[t.fontLabel?a("div",{staticClass:"font-radio-label"},[e._v(e._s(t.fontLabel))]):e._e(),a("el-radio-group",{staticClass:"font-radio-part",on:{change:function(t){return e.changeCoorsFont(i,e.coorsFont[i])}},model:{value:e.coorsFont[i],callback:function(t){e.$set(e.coorsFont,i,t)},expression:"coorsFont[index]"}},[a("el-col",e._l(t.fontList,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1):e._e(),!t.isSelectStyle&&t.sizeList?a("el-row",{staticClass:"size-box"},[t.sizeLabel?a("el-col",{staticClass:"size-label-part"},[e._v(e._s(t.sizeLabel))]):e._e(),a("el-col",{staticClass:"size-select-part",attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:function(a){return e.changeCoorsSize(i,e.coorsSize[i],t.text)}},model:{value:e.coorsSize[i],callback:function(t){e.$set(e.coorsSize,i,t)},expression:"coorsSize[index]"}},e._l(t.sizeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e()],1)}),a("span",{directives:[{name:"show",rawName:"v-show",value:e.carvingNumoptionErrorWord,expression:"carvingNumoptionErrorWord"}],staticClass:"carvingErrorWord"},[e._v(e._s(e.carvingNumoptionErrorField))]),e._l(e.path,function(t,i){return a("div",{key:t.value},[t.title?a("div",{staticClass:"item-title"},[e._v(e._s(t.title))]):e._e(),t.info?a("div",{staticClass:"item-info"},[e._v(e._s(t.info))]):e._e(),a("div",{staticClass:"textarea-text carving-textarea-box",class:{carvingError:e.isCurveEmpty[i]}},[t.isSinglelineInput?a("el-input",{staticClass:"carving-textarea",attrs:{type:"text",placeholder:e.curvePlaceholderText[i],maxlength:t.limit},on:{input:function(a){return e.changeCurveText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}):a("el-input",{staticClass:"carving-textarea",attrs:{type:"textarea",rows:t.rows,resize:t.resize,placeholder:e.curvePlaceholderText[i],maxlength:t.limit},on:{input:function(a){return e.changeCurveText(i,t.text)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}}),e.leftText?a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+i}},[e._v(e._s(e.curveLeftNum[i]))]),e._v(" "+e._s(e.leftText))]):e._e()],1),a("span",{directives:[{name:"show",rawName:"v-show",value:e.curveEmojiError[i]&&e.errorWordShow,expression:"curveEmojiError[index] && errorWordShow"}],staticClass:"carvingErrorWord"},[e._v(e._s(e.emojiErrorField))])])}),e.showSize?a("el-row",{staticClass:"size-box"},[e.fontSizeSelectLabel?a("el-col",{staticClass:"size-label-part"},[e._v(e._s(e.fontSizeSelectLabel))]):e._e(),a("el-col",{staticClass:"size-select-part",attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:e.changeSize},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),!e.isSelectStyle&&e.showFont?a("el-row",{staticClass:"rad-font"},[e.fontRadioLabel?a("div",{staticClass:"font-radio-label"},[e._v(e._s(e.fontRadioLabel))]):e._e(),a("el-radio-group",{staticClass:"font-radio-part",on:{change:e.changeFont},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},[a("el-col",e._l(e.engravingFontOptions,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1):e._e(),e.uploadLoadingImage?e._e():a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1),a("div",{staticClass:"carving-prompt"},[e._v(e._s(e.cropPrompt))]),e.ifCarvingHorizontal?a("div",{staticClass:"dialog-footer-carving"},[a("el-button",{staticClass:"btn-carving btn-carving-cancel",on:{click:e.cancelCanvas}},[e._v(e._s(e.cancelText))]),a("el-button",{staticClass:"btn-carving btn-carving-confirm",attrs:{type:"primary",loading:e.isLoading,disabled:e.hasPhoto&&!e.carvingAble||e.oneSide&&!e.carvingAble||e.photoLoad||e.bgLoad},on:{click:e.saveCanvas}},[e._v(e._s(e.confirmText)),e.carvingMarkup?a("span",{staticClass:"carving-markup",domProps:{innerHTML:e._s(e.carvingMarkup)}}):e._e()])],1):e._e()],2)]),e.ifCarvingHorizontal?e._e():a("div",{staticClass:"dialog-footer-carving",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-carving",on:{click:e.cancelCanvas}},[e._v(e._s(e.cancelText))]),a("el-button",{staticClass:"btn-carving",attrs:{type:"primary",loading:e.isLoading,disabled:e.hasPhoto&&!e.carvingAble||e.oneSide&&!e.carvingAble||e.photoLoad},on:{click:e.saveCanvas}},[e._v(e._s(e.confirmText))])],1),a("div",{staticClass:"carving-info"},[a("div",{staticClass:"carving-notice"},[e.actionInfo?a("div",{staticClass:"action-info"},[e._v(e._s(e.actionInfo))]):e._e(),e.noteInfo?a("div",{staticClass:"note-info"},[e._v(e._s(e.noteInfo))]):e._e()]),e.handcraftInfo?a("div",{staticClass:"handcraft-info"},[e._v(e._s(e.handcraftInfo))]):e._e()])]),e.isLoading&&!e.loadingFullScreen&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:e.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1)]):e._e()]),e.isLoading&&e.loadingFullScreen?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.uploadLoadingImage}})])]):e._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:e.carvingCanvasId}})]),e.isTrim||e.isMarginLucency?a("div",{staticStyle:{display:"none"}},[a("canvas",{attrs:{id:"newtrimcanvas"}}),a("img",{attrs:{src:"",id:"my-image"}})]):e._e(),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}}),e.hasPhoto||e.bigBaseImg||e.isBigCarving>0?a("div",{staticClass:"big-canvas-box"},[a("canvas",{attrs:{id:"canvasBig"}}),a("canvas",{attrs:{id:"newbigtrimcanvas"}})]):e._e()],1)},Ae=[],Fe=(a("456d"),a("5df3"),a("28a5"),a("3b2b"),a("6c3a")),Ne=a("cea2"),Pe={name:"CropDialog",props:["param"],components:{},data:function(){return{confirmText:this.param.data.confirmText?this.param.data.confirmText:"Confirm",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",previewText:this.param.data.previewText?this.param.data.previewText:"Add Engraving",btnText:this.param.data.btnText?this.param.data.btnText:"Add",btnChangeText:this.param.data.btnChangeText?this.param.data.btnChangeText:"Change",inputTextLabel:this.param.data.inputTextLabel?this.param.data.inputTextLabel:"",carvingCancelText:this.param.data.carvingCancelText?this.param.data.carvingCancelText:"Cancel",carvingConfirmText:this.param.data.carvingConfirmText?this.param.data.carvingConfirmText:"Confirm",inputMark:this.param.data.inputMark?this.param.data.inputMark:"",areaCarvingClass:"area-carving area-carving-"+this.param.index,carvingCanvasId:"carving-canvas-"+this.param.index,dialogVisible:!1,centerDialogVisibleNormal:!1,info:"",w:"50px",h:"50px",percentage:0,isLoading:!1,base64:"",isBig:!1!==fe["a"].carving[this.param.index].isBig,isBigBG:!0===fe["a"].carving[this.param.index].isBigBG,isSelectStyle:!0===fe["a"].carving[this.param.index].isSelectStyle,fontSpanNum:fe["a"].carving[this.param.index].fontSpanNum?fe["a"].carving[this.param.index].fontSpanNum:12,fontSizeLabel:fe["a"].carving[this.param.index].fontSizeLabel?fe["a"].carving[this.param.index].fontSizeLabel:"Size:",fontFamilyLabel:fe["a"].carving[this.param.index].fontFamilyLabel?fe["a"].carving[this.param.index].fontFamilyLabel:"Font:",fontRadioLabel:fe["a"].fontRadioLabel?fe["a"].fontRadioLabel:"",fontSizeSelectLabel:fe["a"].fontSizeSelectLabel?fe["a"].fontSizeSelectLabel:"",fontColorLabel:fe["a"].carving[this.param.index].fontColorLabel?fe["a"].carving[this.param.index].fontColorLabel:"Color:",textPlaceHolder:fe["a"].carving[this.param.index].textPlaceHolder?fe["a"].carving[this.param.index].textPlaceHolder:"Type words here...",cropPrompt:fe["a"].carving[this.param.index].cropPrompt?fe["a"].carving[this.param.index].cropPrompt:"",bigParam:!!fe["a"].carving[this.param.index].bigParam&&fe["a"].carving[this.param.index].bigParam,coors:fe["a"].carving[this.param.index].coors,dialogWidth:this.$device.mobile?"100%":"40%",isFullscreen:!!this.$device.mobile,showSize:!1!==fe["a"].carving[this.param.index].showSize,showFont:!1!==fe["a"].carving[this.param.index].showFont,checkLimitAreaNew:!0===fe["a"].carving[this.param.index].checkLimitAreaNew,engravingCrop:[],engravingBig:[],engravingText:[],engravingSize:[],engravingFont:[],engravingCoord:[],coorsFont:[],coorsSize:[],engravingSizeOptions:fe["a"].carving[this.param.index].engravingSizeOptions?fe["a"].carving[this.param.index].engravingSizeOptions:{},engravingFontOptions:fe["a"].carving[this.param.index].engravingFontOptions?fe["a"].carving[this.param.index].engravingFontOptions:{},hasPhoto:!0===fe["a"].carving[this.param.index].hasPhoto,oneSide:!0===fe["a"].carving[this.param.index].oneSide,textHasControls:!0===fe["a"].carving[this.param.index].textHasControls,centeredScaling:!0===fe["a"].carving[this.param.index].centeredScaling,originX:fe["a"].carving[this.param.index].originX?fe["a"].carving[this.param.index].originX:"",originY:fe["a"].carving[this.param.index].originY?fe["a"].carving[this.param.index].originY:"",customIcons:!!fe["a"].carving[this.param.index].customIcons&&fe["a"].carving[this.param.index].customIcons,showColor:!0===fe["a"].carving[this.param.index].showColor,isShow:!1!==fe["a"].carving[this.param.index].isShow,showPhoto:!0===fe["a"].carving[this.param.index].showPhoto,bigCanvas:this.param.data.bigCanvas?this.param.data.bigCanvas:{width:2500,height:2e3},baseAiImg:fe["a"].carving[this.param.index].baseAiImg?fe["a"].carving[this.param.index].baseAiImg:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,baseWidth:fe["a"].carving[this.param.index].baseWidth?fe["a"].carving[this.param.index].baseWidth:500,fixWidth:fe["a"].carving[this.param.index].fixWidth?fe["a"].carving[this.param.index].fixWidth:"",bigCanvasWidth:500,bigCanvasHeight:400,carvingBigObj:[],fontColor:fe["a"].carving[this.param.index].defaultFontColor?fe["a"].carving[this.param.index].defaultFontColor:"#000000",isEmpty:[],carvingAble:!1,bgLoad:!0,uploadLoadingImage:fe["a"].uploadLoadingImage?fe["a"].uploadLoadingImage:"",bgOpacity:fe["a"].bgOpacity?fe["a"].bgOpacity:.5,wrapperBackgroudColor:fe["a"].wrapperBackgroudColor?fe["a"].wrapperBackgroudColor:"#ffffff",nameLeftNum:[],leftText:fe["a"].leftText?fe["a"].leftText:"",actionInfo:fe["a"].actionInfo?fe["a"].actionInfo:"",noteInfo:fe["a"].noteInfo?fe["a"].noteInfo:"",handcraftInfo:fe["a"].handcraftInfo?fe["a"].handcraftInfo:"",ifCarvingHorizontal:!0===fe["a"].ifCarvingHorizontal,requireCarvingTextClass:"require-carving-text require-carving-text-"+this.param.index,requirePrompt:fe["a"].requirePrompt,require:!1!==this.param.data.require,requireVal:!1!==this.param.data.require,photoLoad:!1,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,showCanvas:!1!==fe["a"].carving[this.param.index].showCanvas,emojiErrorField:fe["a"].carving[this.param.index].emojiErrorField,limitErrorField:fe["a"].carving[this.param.index].limitErrorField,errorWordShow:!0===fe["a"].carving[this.param.index].errorWordShow,carvingEmojiError:[],carvingLimitError:[],textMaxlength:[],coorSymbol:fe["a"].carving[this.param.index].coorSymbol?fe["a"].carving[this.param.index].coorSymbol:" ",textPlaceHolderList:[],codeArray:fe["a"].codeArray?fe["a"].codeArray:[],bigBaseImg:this.param.data.bigBaseImg?this.param.data.bigBaseImg:"",clearableValue:!0===fe["a"].carving[this.param.index].clearableValue,arrowControl:!1!==fe["a"].carving[this.param.index].arrowControl,dateFormat:fe["a"].carving[this.param.index].dateFormat?fe["a"].carving[this.param.index].dateFormat:"MM-dd-yy",dateValueFormat:fe["a"].carving[this.param.index].dateValueFormat?fe["a"].carving[this.param.index].dateValueFormat:"MM-dd-yy",timeFormat:fe["a"].carving[this.param.index].timeFormat?fe["a"].carving[this.param.index].timeFormat:"h:mm",timeValueFormat:fe["a"].carving[this.param.index].timeValueFormat?fe["a"].carving[this.param.index].timeValueFormat:"h:mm a",datePlaceholder:fe["a"].carving[this.param.index].datePlaceholder?fe["a"].carving[this.param.index].datePlaceholder:"Date of Birth",timePlaceholder:fe["a"].carving[this.param.index].timePlaceholder?fe["a"].carving[this.param.index].timePlaceholder:"Time of Birth",dateReadonly:!0===fe["a"].carving[this.param.index].dateReadonly,loadingFullScreen:this.param.data.loadingFullScreen,path:fe["a"].carving[this.param.index].path?fe["a"].carving[this.param.index].path:[],isCurveEmpty:[],curvePlaceholderText:[],curveLeftNum:[],curveEmojiError:[],templateImages:!!fe["a"].carving[this.param.index].templateImages&&fe["a"].carving[this.param.index].templateImages,templateCoord:fe["a"].carving[this.param.index].templateCoord?fe["a"].carving[this.param.index].templateCoord:{},templateUrl:"",templateLabel:"",templateSelect:[],templateOut:!0===fe["a"].carving[this.param.index].templateOut,templateTitle:fe["a"].carving[this.param.index].templateTitle,bigBgColor:fe["a"].carving[this.param.index].bigBgColor?fe["a"].carving[this.param.index].bigBgColor:"white",isAllowInput:!!fe["a"].carving[this.param.index].isAllowInput&&fe["a"].carving[this.param.index].isAllowInput,marginLucencyColor:fe["a"].carving[this.param.index].marginLucencyColor?fe["a"].carving[this.param.index].marginLucencyColor:[247,248,249],isTrim:!0===fe["a"].carving[this.param.index].isTrim,isMarginLucency:!0===fe["a"].carving[this.param.index].isMarginLucency,aiEnlarge:fe["a"].carving[this.param.index].aiEnlarge?fe["a"].carving[this.param.index].aiEnlarge:1,carvingMarkup:"",isBigCarving:fe["a"].carving[this.param.index].isBigCarving?fe["a"].carving[this.param.index].isBigCarving:0,carvingNumoption:!0===fe["a"].carving[this.param.index].carvingNumoption,carvingNumoptionErrorWord:!1,carvingNumoptionErrorField:fe["a"].carving[this.param.index].carvingNumoptionErrorField?fe["a"].carving[this.param.index].carvingNumoptionErrorField:"",bigBackgroundColor:fe["a"].carving[this.param.index].bigBackgroundColor?fe["a"].carving[this.param.index].bigBackgroundColor:"white",isOtherImg:!0===fe["a"].carving[this.param.index].isOtherImg,oneSideCheckPhoto:!1!==fe["a"].carving[this.param.index].oneSideCheckPhoto,hasSelect:!0===fe["a"].carving[this.param.index].hasSelect,isCheckFont:!1!==fe["a"].carving[this.param.index].isCheckFont,emojiDefaultList:fe["a"].carving[this.param.index].emojiDefaultList?fe["a"].carving[this.param.index].emojiDefaultList:["✿","❀","❤","➹","➷","℡","✚","☆","★","✟"],predefineColors:fe["a"].carving[this.param.index].predefineColors?fe["a"].carving[this.param.index].predefineColors:[]}},computed:{centerDialogVisible:{get:function(){return this.hasPhoto?this.$store.getters.getCarvingDialogVisibleNew:this.centerDialogVisibleNormal},set:function(e){this.hasPhoto?this.$store.dispatch("setCarvingDialogVisibleNew",e):this.centerDialogVisibleNormal=e}}},methods:{open:function(){this.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody);var e=this;if(this.bigBaseImg&&fabric.Image.fromURL(this.bigBaseImg+"?"+Math.random(),function(t){t.scaleX=e.cWidth/e.bigCanvas.width,t.scaleY=e.cHeight/e.bigCanvas.height,t.left=(e.cWidth-t.width*t.scaleX)/2,t.top=(e.cHeight-t.height*t.scaleY)/2,e.carvingBigObj.canvas.setBackgroundImage(t),e.carvingBigObj.canvas.requestRenderAll(),e.carvingAble=!0},{crossOrigin:"Anonymous"}),e.oneSide){e.oneSideCheckPhoto?e.carvingAble=!1:e.carvingAble=!0;var t=JSON.parse(e.$store.getters.getCustomInfo),a="";"undefined"!=typeof t.photo?a=t.photo[0].crop:"undefined"!=typeof t.crop&&(a=t.crop[0].crop),a&&fabric.Image.fromURL(a+"?"+Math.random(),function(t){t.scaleX=fe["a"].carvingObj[e.param.index].canvas.width/t.width,t.scaleY=fe["a"].carvingObj[e.param.index].canvas.height/t.height,fe["a"].carvingObj[e.param.index].canvas.setBackgroundImage(t),fe["a"].carvingObj[e.param.index].canvas.requestRenderAll(),e.carvingAble=!0},{crossOrigin:"Anonymous"})}},openimage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeText:function(e,t){if("monogram"==fe["a"].carvingObj[this.param.index].text[e].fontFamily){for(var a=t.toUpperCase(),i=[],n=0;n<a.length;n++)" "!=a[n]&&i.push(a[n]);this.coors[e].text=i.join(" ")}if(this.coors[e].isUppercase&&(this.coors[e].text=this.coors[e].text.toUpperCase()),this.coors[e].uppercaseNo){var r=parseInt(this.coors[e].uppercaseNo)-1,o="";r>0&&(o+=t.substr(0,r).toLowerCase()),o+=t.substr(r,1).toUpperCase(),o+=t.substr(parseInt(this.coors[e].uppercaseNo)).toLowerCase(),this.coors[e].text=o}if(this.isAllowInput){var s="",l=this.isAllowInput;l.forEach(function(e,t){s+="num"==e?"0-9":"",s+="alphabet"==e?"a-zA-Z":""}),""!=s&&(this.coors[e].text=this.coors[e].text.replace(new RegExp("[^"+s+"]","g"),""))}if(this.coors[e].isAllowInput){s="",l=this.coors[e].isAllowInput;l.forEach(function(e,t){s+="num"==e?"0-9":"",s+="alphabet"==e?"a-zA-Z":""}),""!=s&&(this.coors[e].text=this.coors[e].text.replace(new RegExp("[^"+s+"]","g"),""))}if(this.coors[e].spaceFlag&&this.coors[e].text.length>=parseInt(this.coors[e].spaceFlag.index)+this.coors[e].spaceFlag.flag.length&&this.coors[e].text.indexOf(this.coors[e].spaceFlag.flag)<0){var c=parseInt(this.coors[e].spaceFlag.index)-1,d=this.coors[e].text.split("");d[c]+=this.coors[e].spaceFlag.flag,this.coors[e].text=d.join("")}this.coors[e].isWrapCanvasText_?this.coors[e].text=fe["a"].carvingObj[this.param.index].changeText(this.coors[e].text,e):fe["a"].carvingObj[this.param.index].changeText(this.coors[e].text,e),parseInt(this.coors[e].limit)-this.coors[e].text.length>0?this.nameLeftNum[e]=parseInt(this.coors[e].limit)-this.coors[e].text.length:this.nameLeftNum[e]=0,fe["a"].dispatchCustomEvent("EVENT_CARVING_CHANGE_AFTER",{index:e,data:t})},changeCurveText:function(e,t){fe["a"].carvingObj[this.param.index].changeCurveText(this.path[e].text,e),this.curveLeftNum[e]=parseInt(this.path[e].limit)-t.length},changeSize:function(e){var t=this;t.coors.forEach(function(a,i){fe["a"].carvingObj[t.param.index].changeSize(e,i,a.text)})},changeFont:function(e){var t=this;t.isCheckFont?(t.bgLoad=!0,t.coors.forEach(function(a,i){fe["a"].carvingObj[t.param.index].changeFont(e,i,function(){t.bgLoad=!1})})):t.coors.forEach(function(a,i){fe["a"].carvingObj[t.param.index].changeFont(e,i)})},changeCoorsFont:function(e,t){var a=this;fe["a"].carvingObj[a.param.index].changeFont(t,e),a.engravingFont[a.param.index]=a.coorsFont.join("|")},changeCoorsSize:function(e,t,a){var i=this;fe["a"].carvingObj[i.param.index].changeSize(t,e,a),i.engravingSize[i.param.index]=i.coorsSize.join("|")},changeTemplate:function(e,t,a){var i=this;i.templateOut?(i.photoLoad=!0,fabric.Image.fromURL(e+"?"+Math.random(),function(e){e.scaleX=fe["a"].carvingObj[i.param.index].canvas.width/e.width,e.scaleY=fe["a"].carvingObj[i.param.index].canvas.height/e.height,fe["a"].carvingObj[i.param.index].canvas.setOverlayImage(e),fe["a"].carvingObj[i.param.index].canvas.requestRenderAll(),i.photoLoad=!1},{crossOrigin:"Anonymous"})):fe["a"].carvingObj[i.param.index].changeTemplate(fe["a"].carvingObj[i.param.index],e),i.templateUrl=e,i.templateLabel=t,i.templateSelect.forEach(function(e,t){i.$set(i.templateSelect,t,!1)}),i.$set(i.templateSelect,a,!0)},changeCoord:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this;t?e.forEach(function(t,i){fe["a"].carvingObj[a.param.index].changeCoord(e[i],i)}):a.coors.forEach(function(t,i){fe["a"].carvingObj[a.param.index].changeCoord(e,i)})},getFontFamily:function(e){return"font-family:"+e+";"},cancelCanvas:function(){var e=this;e.centerDialogVisible=!1,fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_CANCEL_AFTER",{index:e.param.index})},_loadFromJSON:function(e,t,a,i,n,r,o,s){var l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"",d=this;e.loadFromJSON(JSON.stringify(fe["a"].carvingObj[d.param.index].canvas),function(){if(d.isOtherImg){var h=e.getObjects(),p=e.width,g=e.height,m=0,u=0;h.forEach(function(t,a){console.log(t),t&&"text"===t.type&&(l&&t.set({fontSize:l}),c&&t.set({fill:c}),e.renderAll()),t&&"text"===t.type&&0==a&&(p=t.width,g=t.height,m=t.left,u=t.top)}),e.setWidth(p),e.setHeight(g),e.renderAll(),console.log(e.width),console.log(e.height),h.forEach(function(t,a){t&&"text"===t.type&&0==a&&(t.set({left:p/2,top:g/2}),e.add(t),e.renderAll()),t&&"text"===t.type&&0!=a&&(t.set({left:t.left-(m-p/2),top:t.top-(u-g/2)}),e.add(t),e.renderAll())})}else{h=e.getObjects();h.forEach(function(t){t&&"text"===t.type&&(t.set({left:t.left-o,top:t.top-s}),l&&t.set({fontSize:l}),c&&t.set({fill:c}),e.renderAll())})}if(console.log("multiplier===========",t),e.setBackgroundImage(null,e.renderAll.bind(e)),e.backgroundColor=d.bigBackgroundColor,d.isBigBG)e.setBackgroundImage(n,function(){e.setOverlayImage(null,e.renderAll.bind(e)),e.renderAll();var n=e.toDataURL({format:"png",multiplier:t,quality:.8}),r=fe["a"].asyncCdnUpload(n,a,null);Promise.all([r]).then(function(e){d.engravingBig[d.param.index]=e[0],console.log(d.engravingBig[d.param.index]),fe["a"].cdnUpload(i,function(e){d.btnText=d.btnChangeText,d.engravingCrop[d.param.index]=e.picture;var t={};d.$store.getters.getCustomInfo&&(t=JSON.parse(d.$store.getters.getCustomInfo)),Array.isArray(t.engraving)||(t.engraving=[]),t.engraving[d.param.index]={type:d.param.data.type?d.param.data.type:"",require:d.param.data.require?d.param.data.require:"",engravingCrop:e.picture,engravingBig:d.engravingBig[d.param.index],engravingText:d.engravingText[d.param.index],engravingSize:d.engravingSize[d.param.index],engravingFont:d.engravingFont[d.param.index],engravingCoord:d.engravingCoord[d.param.index],engravingFontColor:d.fontColor,templateUrl:d.templateUrl,templateLabel:d.templateLabel},d.$store.dispatch("setCustomInfo",JSON.stringify(t)),d.previewText=d.engravingText,d.isLoading=!1,d.centerDialogVisible=!1,d.percentage=0,d.showPhoto&&(d.$parent.$refs.PhotoDialog[0].engravingCrop=e.picture),d.hasSelect&&d.$parent.$refs.selectDialog.open(d.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:d.param.index,data:t}),"function"===typeof window.carvingCallback&&window.carvingCallback()},d)}).catch(function(e){console.log(e)})},{crossOrigin:"anonymous",scaleX:r,scaleY:r});else{e.setOverlayImage(null,e.renderAll.bind(e)),e.renderAll();var v=e.toDataURL({format:"png",multiplier:t,quality:.8}),f=fe["a"].asyncCdnUpload(v,a,null);Promise.all([f]).then(function(e){d.engravingBig[d.param.index]=e[0],console.log(d.engravingBig[d.param.index]),fe["a"].cdnUpload(i,function(e){d.btnText=d.btnChangeText,d.engravingCrop[d.param.index]=e.picture;var t={};d.$store.getters.getCustomInfo&&(t=JSON.parse(d.$store.getters.getCustomInfo)),Array.isArray(t.engraving)||(t.engraving=[]),t.engraving[d.param.index]={type:d.param.data.type?d.param.data.type:"",require:d.param.data.require?d.param.data.require:"",engravingCrop:e.picture,engravingBig:d.engravingBig[d.param.index],engravingText:d.engravingText[d.param.index],engravingSize:d.engravingSize[d.param.index],engravingFont:d.engravingFont[d.param.index],engravingCoord:d.engravingCoord[d.param.index],engravingFontColor:d.fontColor,templateUrl:d.templateUrl,templateLabel:d.templateLabel},d.$store.dispatch("setCustomInfo",JSON.stringify(t)),d.previewText=d.engravingText,d.isLoading=!1,d.centerDialogVisible=!1,d.percentage=0,d.showPhoto&&(d.$parent.$refs.PhotoDialog[0].engravingCrop=e.picture),d.hasSelect&&d.$parent.$refs.selectDialog.open(d.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:d.param.index,data:t}),"function"===typeof window.carvingCallback&&window.carvingCallback()},d)}).catch(function(e){console.log(e)})}})},getRectCoor:function(e){var t=[],a=[],i=0,n=0,r=[],o=[],s=0,l=0,c=[e.data[0],e.data[1],e.data[2],e.data[3]];console.log("rgb",c);for(var d=e.height,h=0;h<d;h++){for(var p=e.width,g=0;g<p;g++){var m=4*h*e.width+4*g,u=4*d*e.width-4*(g+1);if(e.data[m]==c[0]&&e.data[m+1]==c[1]&&e.data[m+2]==c[2]||0!=i||(t.w=g,t.h=h,i=1),e.data[u]==c[0]&&e.data[u+1]==c[1]&&e.data[u+2]==c[2]||0!=n||(a.w=g,a.h=h,n=1),s+l<2){for(var v=0;v<d;v++){var f=4*v*e.width+4*g,x=4*v*e.width+4*(p-1);if(e.data[f]==c[0]&&e.data[f+1]==c[1]&&e.data[f+2]==c[2]||0!=s||(r.w=g,r.h=v,s=1),e.data[x]==c[0]&&e.data[x+1]==c[1]&&e.data[x+2]==c[2]||0!=l||(o.w=g,o.h=v,l=1),s+l==2){console.log("最内层循环结束-break--");break}}p--}if(i+n+s+l==4){console.log("第二层循环结束-break;");break}}if(i+n+s+l==4){console.log("最外层循环结束--break;");break}d--}return{left:r.w,top:t.h,buttom:a.h,right:o.w}},replaceCanvasColor:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[247,248,249],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,0],i=1,n=e.height,r=0;r<n;r++){for(var o=0;o<e.width;o++){var s=4*r*e.width+4*o,l=4*n*e.width-4*(o+1);e.data[s]==t[0]&&e.data[s+1]==t[1]&&e.data[s+2]==t[2]&&i&&(e.data[s]=a[0],e.data[s+1]=a[1],e.data[s+2]=a[2],e.data[s+3]=a[3]),e.data[l]==t[0]&&e.data[l+1]==t[1]&&e.data[l+2]==t[2]&&i&&(e.data[l]=a[0],e.data[l+1]=a[1],e.data[l+2]=a[2],e.data[l+3]=a[3])}n--}return e},saveCanvas:function(){var e=this,t=[],a=!0,i=[];if(e.carvingNumoption){var n=0;e.coors.forEach(function(r,o){var s=r.text.replace(/(^\s*)|(\s*$)/g,"");if(s){n++;var l=0;"undefined"!=typeof r.spaceFlag&&s.indexOf(r.spaceFlag.flag)>-1&&(l=r.spaceFlag.flag.length),r.minLimit&&s.length-l<r.minLimit?(e.$set(e.carvingLimitError,o,!0),a=!1):1==fe["a"].getLen(r.text,e.codeArray)?(e.$set(e.carvingEmojiError,o,!0),a=!1):r.label?(i.indexOf(r.label)<0&&i.push(r.label),t.push(r.label+":"+r.text)):t.push(r.text)}}),n<1?(a=!1,e.carvingNumoptionErrorWord=!0):e.carvingNumoptionErrorWord=!1}else e.coors.forEach(function(n,r){e.$set(e.carvingEmojiError,r,!1),e.$set(e.carvingLimitError,r,!1);var o=n.text.replace(/(^\s*)|(\s*$)/g,"");if(o){var s=0;"undefined"!=typeof n.spaceFlag&&o.indexOf(n.spaceFlag.flag)>-1&&(s=n.spaceFlag.flag.length),n.minLimit&&o.length-s<n.minLimit?(e.$set(e.carvingLimitError,r,!0),a=!1):1==fe["a"].getLen(n.text,e.codeArray)?(e.$set(e.carvingEmojiError,r,!0),a=!1):(n.label?(i.indexOf(n.label)<0&&i.push(n.label),t.push(n.label+":"+n.text)):t.push(n.text),e.$set(e.isEmpty,r,!1))}else a=!1,e.$set(e.isEmpty,r,!0)});if(e.path.forEach(function(i,n){e.$set(e.curveEmojiError,n,!1);var r=i.text.replace(/(^\s*)|(\s*$)/g,"");r?1==fe["a"].getLen(i.text,e.codeArray)?(e.$set(e.curveEmojiError,n,!0),a=!1):(t.push(i.text),e.$set(e.isCurveEmpty,n,!1)):(a=!1,e.$set(e.isCurveEmpty,n,!0))}),i.length>0){var r=[];if(i.forEach(function(a){var i=0,n="";t.forEach(function(e){var t=e.split(":");a==t[0]&&(n+=i>0?"|"+e.replace(a+":",""):e.replace(a+":",""),i++)}),"pen"==a.toLowerCase()?n=e.coorSymbol+n:n+=e.coorSymbol,r.push(n)}),r.length>1){var o=[];r.forEach(function(t){o.push(t.replace(e.coorSymbol,""))}),e.engravingText[e.param.index]=o.join(e.coorSymbol)}else e.engravingText[e.param.index]=r[0]}else e.engravingText[e.param.index]=t.join("|");if(!a)return!1;var s=fe["a"].carvingObj[e.param.index].canvas.getObjects(),l=[];if(s.forEach(function(e,t){console.log(e),e&&"text"===e.type&&l.push("left:"+e.left+" top:"+e.top)}),e.engravingCoord[e.param.index]=l.join("|"),e.uploadLoadingImage&&e.loadingFullScreen&&(e.centerDialogVisible=!1),e.isLoading=!0,e.isTrim||e.isMarginLucency){var c=fe["a"].carvingObj[e.param.index].canvas.getContext("2d"),d=fe["a"].carvingObj[e.param.index].canvas.width,h=fe["a"].carvingObj[e.param.index].canvas.height,p=c.getImageData(0,0,d,h),g=p,m=document.getElementById("newtrimcanvas"),u=m.getContext("2d"),v=p.width,f=p.height;if(m.width=v,m.height=f,e.isTrim){var x=e.getRectCoor(p);v=p.width-x.right-x.left,f=p.height-x.top-x.buttom,m.width=v,m.height=f,u.putImageData(p,-x.left,-x.top,x.left,x.top,v,f),g=u.getImageData(0,0,v,f)}e.isMarginLucency&&u.putImageData(e.replaceCanvasColor(g,e.marginLucencyColor),0,0);var b=m.toDataURL({format:"png",quality:1}),C=new fabric.Canvas;C.setWidth(m.width),C.setHeight(m.height),fabric.Image.fromURL(b,function(t){C.add(t),C.renderAll(),e.base64=C.toDataURL({format:"png",multiplier:e.aiEnlarge,quality:.8});var a=fe["a"].getFilename(12),i=a+".png",n="";if(n=i?{base64:e.base64,key:i}:e.base64,e.isBig){var r=new fabric.Canvas,o=a+"-1.png",s=e.bigParam.width?e.bigParam.width:800,l=(e.bigParam.height&&e.bigParam.height,e.bigParam.fontWeight&&e.bigParam.fontWeight,e.bigParam.fontSize&&e.bigParam.fontSize,e.bigParam.fixFontSize?e.bigParam.fixFontSize:""),c=e.bigParam.fixFontColor?e.bigParam.fixFontColor:"";r.setWidth(fe["a"].carvingObj[e.param.index].canvas.width),r.setHeight(fe["a"].carvingObj[e.param.index].canvas.height);var d=s/fe["a"].carvingObj[e.param.index].canvas.width,h=1,p=0,g=0,m="";if(e.isBigBG){var u=fe["a"].carvingObj[e.param.index].canvas.width,v=fe["a"].carvingObj[e.param.index].canvas.height,f=new Image;f.src=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[e.param.index].sku+"-BIG.jpg",m=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[e.param.index].sku+"-BIG.jpg",f.onload=function(){console.log("bgimg-w-h:",f.width,f.height),f.width>f.height?(d=f.width/u,h=u/f.width,r.setWidth(u),r.setHeight(f.height*h),g=(v-f.height*h)/2):(d=f.height/v,h=v/f.height,r.setWidth(f.width*h),r.setHeight(v),p=(u-f.width*h)/2),console.log("multiplier",d),console.log("BIGscale",h),console.log(p,g),e._loadFromJSON(r,d,o,n,m,h,p,g)}}else e._loadFromJSON(r,d,o,n,m,h,p,g,l,c)}else{if(e.hasPhoto||e.bigBaseImg||e.isBigCarving>0){if(fe["a"].carvingObj[e.param.index].canvas.getObjects().length>0)if(e.isBigCarving>0){var x=fe["a"].carvingObj[e.param.index].canvas.getObjects();for(var b in Ce["a"].util.bigCarvingTexObj=[],x)"text"==x[b].type&&x[b].clone(function(e){Ce["a"].util.bigCarvingTexObj.push(e)});e.carvingBigObj.addMultiBigText()}else fe["a"].carvingObj[e.param.index].canvas.item(0).clone(function(e){Ce["a"].util.carvingTextObj=e}),e.coors.forEach(function(t,a){e.carvingBigObj.changeBigText(t.text,a)});fe["a"].zoomIt(e.carvingBigObj.canvas,e.bigCanvas.width/e.bigCanvasWidth);var y=e.carvingBigObj.canvas.getContext("2d"),w=e.carvingBigObj.canvas.width,_=e.carvingBigObj.canvas.height,T=y.getImageData(0,0,w,_),O=T,I=document.getElementById("newbigtrimcanvas"),E=I.getContext("2d"),S=T.width,k=T.height;I.width=S,I.height=k;var j=e.getRectCoor(T);S=T.width-j.right-j.left,k=T.height-j.top-j.buttom,I.width=S,I.height=k,E.putImageData(T,-j.left,-j.top,j.left,j.top,S,k),O=E.getImageData(0,0,S,k),E.putImageData(e.replaceCanvasColor(O,e.marginLucencyColor),0,0);var L=I.toDataURL({format:"png",quality:.8,multiplier:1})}fe["a"].cdnUpload(n,function(t){if(e.hasPhoto||e.bigBaseImg||e.isBigCarving>0)e.engravingCrop[e.param.index]=t.picture,e.hasPhoto&&e.isBigCarving<1&&(e.$parent.$refs.PhotoDialog[e.param.index].photoCrop[e.param.index]=t.picture),e.showPhoto&&(e.$parent.$refs.PhotoDialog[0].engravingCrop=t.picture),fe["a"].cdnUpload({base64:L,key:fe["a"].getFilename(12)+".png"},function(t){e.btnText=e.btnChangeText;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]);var i="";"undefined"!=typeof a.photo&&"undefined"!=typeof a.photo[0]&&(i=a.photo[0].origin),a.engraving[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",engravingCrop:e.engravingCrop[e.param.index],engravingAi:t.picture,engravingOrigin:i,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],engravingCoord:e.engravingCoord[e.param.index],engravingFontColor:e.fontColor,templateUrl:e.templateUrl,templateLabel:e.templateLabel},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.centerDialogVisible=!1,e.percentage=0,fe["a"].zoomIt(e.carvingBigObj.canvas,e.bigCanvasWidth/e.bigCanvas.width),e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a})});else{e.btnText=e.btnChangeText,e.engravingCrop[e.param.index]=t.picture;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]),a.engraving[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",engravingCrop:t.picture,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],engravingCoord:e.engravingCoord[e.param.index],engravingFontColor:e.fontColor,templateUrl:e.templateUrl,templateLabel:e.templateLabel},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.centerDialogVisible=!1,e.percentage=0,e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()}},e)}})}else{e.base64=fe["a"].carvingObj[e.param.index].canvas.toDataURL({format:"png",multiplier:e.aiEnlarge,quality:.8});var y=fe["a"].getFilename(12),w=y+".png",_="";if(_=w?{base64:e.base64,key:w}:e.base64,e.isBig){var T=new fabric.Canvas,O=y+"-1.png",I=e.bigParam.width?e.bigParam.width:800,E=(e.bigParam.height&&e.bigParam.height,e.bigParam.fontWeight&&e.bigParam.fontWeight,e.bigParam.fontSize&&e.bigParam.fontSize,e.bigParam.fixFontSize?e.bigParam.fixFontSize:""),S=e.bigParam.fixFontColor?e.bigParam.fixFontColor:"";T.setWidth(fe["a"].carvingObj[e.param.index].canvas.width),T.setHeight(fe["a"].carvingObj[e.param.index].canvas.height);var k=I/fe["a"].carvingObj[e.param.index].canvas.width,j=1,L=0,A=0,F="";if(e.isBigBG){var N=fe["a"].carvingObj[e.param.index].canvas.width,P=fe["a"].carvingObj[e.param.index].canvas.height,D=new Image;D.src=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[e.param.index].sku+"-BIG.jpg",F=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[e.param.index].sku+"-BIG.jpg",D.onload=function(){console.log("bgimg-w-h:",D.width,D.height),D.width>D.height?(k=D.width/N,j=N/D.width,T.setWidth(N),T.setHeight(D.height*j),A=(P-D.height*j)/2):(k=D.height/P,j=P/D.height,T.setWidth(D.width*j),T.setHeight(P),L=(N-D.width*j)/2),console.log("multiplier",k),console.log("BIGscale",j),console.log(L,A),e._loadFromJSON(T,k,O,_,F,j,L,A)}}else e._loadFromJSON(T,k,O,_,F,j,L,A,E,S)}else{if(e.hasPhoto||e.bigBaseImg||e.isBigCarving>0){if(fe["a"].carvingObj[e.param.index].canvas.getObjects().length>0)if(e.isBigCarving>0){var B=fe["a"].carvingObj[e.param.index].canvas.getObjects();for(var z in Ce["a"].util.bigCarvingTexObj=[],B)"text"==B[z].type&&B[z].clone(function(e){Ce["a"].util.bigCarvingTexObj.push(e)});e.carvingBigObj.addMultiBigText()}else fe["a"].carvingObj[e.param.index].canvas.item(0).clone(function(e){Ce["a"].util.carvingTextObj=e}),e.coors.forEach(function(t,a){e.carvingBigObj.changeBigText(t.text,a)});fe["a"].zoomIt(e.carvingBigObj.canvas,e.bigCanvas.width/e.bigCanvasWidth);var $=e.carvingBigObj.canvas.getContext("2d"),M=e.carvingBigObj.canvas.width,W=e.carvingBigObj.canvas.height,U=$.getImageData(0,0,M,W),R=U,q=document.getElementById("newbigtrimcanvas"),V=q.getContext("2d"),H=U.width,Y=U.height;q.width=H,q.height=Y;var X=e.getRectCoor(U);H=U.width-X.right-X.left,Y=U.height-X.top-X.buttom,q.width=H,q.height=Y,V.putImageData(U,-X.left,-X.top,X.left,X.top,H,Y),R=V.getImageData(0,0,H,Y),V.putImageData(e.replaceCanvasColor(R,e.marginLucencyColor),0,0);var J=q.toDataURL({format:"png",quality:.8,multiplier:1})}fe["a"].cdnUpload(_,function(t){if(e.hasPhoto||e.bigBaseImg||e.isBigCarving>0)e.engravingCrop[e.param.index]=t.picture,e.hasPhoto&&e.isBigCarving<0&&(e.$parent.$refs.PhotoDialog[e.param.index].photoCrop[e.param.index]=t.picture),e.showPhoto&&(e.$parent.$refs.PhotoDialog[0].engravingCrop=t.picture),fe["a"].cdnUpload({base64:J,key:fe["a"].getFilename(12)+".png"},function(t){e.btnText=e.btnChangeText;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]);var i="";"undefined"!=typeof a.photo&&"undefined"!=typeof a.photo[0]&&(i=a.photo[0].origin),a.engraving[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",engravingCrop:e.engravingCrop[e.param.index],engravingAi:t.picture,engravingOrigin:i,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],engravingCoord:e.engravingCoord[e.param.index],engravingFontColor:e.fontColor,templateUrl:e.templateUrl,templateLabel:e.templateLabel},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.centerDialogVisible=!1,e.percentage=0,fe["a"].zoomIt(e.carvingBigObj.canvas,e.bigCanvasWidth/e.bigCanvas.width),e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a})});else{e.btnText=e.btnChangeText,e.engravingCrop[e.param.index]=t.picture;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]),a.engraving[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",engravingCrop:t.picture,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],engravingCoord:e.engravingCoord[e.param.index],engravingFontColor:e.fontColor,templateUrl:e.templateUrl,templateLabel:e.templateLabel},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.centerDialogVisible=!1,e.percentage=0,e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param,1),fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()}},e)}}},changeCarvingMarkup:function(e){this.carvingMarkup=e},changeCarvingSku:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fe["a"].carvingObj[t].canvas.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:fe["a"].carvingObj[t].canvas.height,n=this,r=fe["a"].textUrl?fe["a"].textUrl:fe["a"].photoUrl,o=r+e+"-OUT.png",s=r+e+"-IN.png";n.photoLoad=!0,a!=fe["a"].carvingObj[t].canvas.width&&(fe["a"].carvingObj[t].canvas.setWidth(a),fe["a"].carvingObj[t].canvas.requestRenderAll()),i!=fe["a"].carvingObj[t].canvas.height&&(fe["a"].carvingObj[t].canvas.setHeight(i),fe["a"].carvingObj[t].canvas.requestRenderAll()),fabric.Image.fromURL(s+"?"+Math.random(),function(e){e.scaleX=fe["a"].carvingObj[t].canvas.width/e.width,e.scaleY=fe["a"].carvingObj[t].canvas.height/e.height,fe["a"].carvingObj[t].canvas.setBackgroundImage(e),fe["a"].carvingObj[t].canvas.requestRenderAll(),n.photoLoad=!1},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(o+"?"+Math.random(),function(e){e.scaleX=fe["a"].carvingObj[t].canvas.width/e.width,e.scaleY=fe["a"].carvingObj[t].canvas.height/e.height,fe["a"].carvingObj[t].canvas.setOverlayImage(e),fe["a"].carvingObj[t].canvas.requestRenderAll(),n.photoLoad=!1},{crossOrigin:"Anonymous"})},changeCarving:function(){var e=this;fe["a"].carvingObj[this.param.index]=new Fe["a"]({canvasid:this.carvingCanvasId,type:2,sku:fe["a"].carving[this.param.index].sku,in:inImage,out:outImage,checkLimitAreaNew:e.checkLimitAreaNew,custom:{coors:fe["a"].carving[this.param.index].coors},cWidth:e.cWidth,cHeight:e.cHeight,baseWidth:e.baseWidth,fixWidth:e.fixWidth,textHasControls:e.textHasControls,centeredScaling:e.centeredScaling,originX:e.originX,originY:e.originY,customIcons:e.customIcons,fontColor:e.fontColor,isBigCarving:e.isBigCarving})},setText:function(e,t){this.coors[e].text=t,this.changeText(e,t)},setFontColor:function(e){this.fontColor=e}},mounted:function(){var e=this,t=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[this.param.index].in,a=Ce["a"].util.awcdn+Ce["a"].util.cdir+fe["a"].carving[this.param.index].out;if(fe["a"].textUrl&&(t=fe["a"].textUrl+fe["a"].carving[this.param.index].in,a=fe["a"].textUrl+fe["a"].carving[this.param.index].out),e.hasPhoto||e.bigBaseImg||e.isBigCarving>0){var i="";if(e.isBigCarving>0&&(i=a),e.carvingBigObj=new Fe["a"]({canvasid:"canvasBig",type:2,sku:fe["a"].carving[this.param.index].sku,in:t,out:i,checkLimitAreaNew:e.checkLimitAreaNew,custom:{coors:fe["a"].carving[this.param.index].coors},cWidth:e.cWidth,cHeight:e.cHeight,baseWidth:e.baseWidth,fixWidth:e.fixWidth,textHasControls:e.textHasControls,centeredScaling:e.centeredScaling,originX:e.originX,originY:e.originY,fontColor:e.fontColor,isDrag:fe["a"].carving[this.param.index].isDrag,path:e.path,isBigCarving:e.isBigCarving}),e.bigCanvasWidth=e.carvingBigObj.canvas.width,e.bigCanvasHeight=e.carvingBigObj.canvas.height,e.baseAiImg){var n=new Image;n.src=e.baseAiImg,n.onload=function(){e.bigCanvas.width=n.width,e.bigCanvas.height=n.height}}if(e.isBigCarving>0){var r=new Image;r.src=t,r.onload=function(){e.bigCanvas.width=r.width,e.bigCanvas.height=r.height}}e.bigBaseImg||0!=e.isBigCarving||(t=Ce["a"].util.awcdn+Ce["a"].util.pdir+fe["a"].carving[this.param.index].in,a=Ce["a"].util.awcdn+Ce["a"].util.pdir+fe["a"].carving[this.param.index].out)}window.changeCarvingSku=e.changeCarvingSku,window.changeCoord=e.changeCoord,window.setText=e.setText,window.setFontColor=e.setFontColor,window.changeCarvingMarkup=e.changeCarvingMarkup,fe["a"].carvingObj[this.param.index]=new Fe["a"]({canvasid:this.carvingCanvasId,type:2,sku:fe["a"].carving[this.param.index].sku,in:t,out:a,checkLimitAreaNew:e.checkLimitAreaNew,custom:{coors:fe["a"].carving[this.param.index].coors},cWidth:e.cWidth,cHeight:e.cHeight,baseWidth:e.baseWidth,fixWidth:e.fixWidth,textHasControls:e.textHasControls,centeredScaling:e.centeredScaling,originX:e.originX,originY:e.originY,customIcons:e.customIcons,fontColor:e.fontColor,time:e.time,path:e.path,imageSrc:e.templateImages?e.templateImages[0].url:e.templateImages,templateCoord:e.templateCoord,templateOut:e.templateOut,isBigCarving:e.isBigCarving,callback:function(){e.bgLoad=!1}}),e.templateImages&&(e.templateUrl=e.templateImages[0].url,e.templateLabel=e.templateImages[0].label,e.templateImages.forEach(function(t,a){a>0?e.templateSelect.push(!1):e.templateSelect.push(!0)}));var o=window.innerWidth,s=e.cWidth;o<=414?e.cWidth=o-70:o>768&&o<=1024&&(e.cWidth=240),e.cHeight=e.cWidth*e.cHeight/s,this.engravingSize[this.param.index]=fe["a"].carving[this.param.index].engravingSizeOptions[0].value?fe["a"].carving[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=fe["a"].carving[this.param.index].engravingFontOptions[0].value?fe["a"].carving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman";var l={};e.$store.getters.getCustomInfo&&(l=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(l.engraving)||(l.engraving=[]),l.engraving[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",engravingCoord:"",templateUrl:e.templateUrl,templateLabel:e.templateLabel},e.$store.dispatch("setCustomInfo",JSON.stringify(l)),e.coors&&(e.coors.forEach(function(t,a){e.isEmpty.push(!1),e.nameLeftNum[a]=t.limit,e.carvingEmojiError.push(!1),e.carvingLimitError.push(!1),"undefined"!=typeof t.fontList?e.coorsFont.push(t.fontList[0].value):"emoji"!=t.type&&e.coorsFont.push(t.font),"undefined"!=typeof t.sizeList?e.coorsSize.push(t.sizeList[0].value):"emoji"!=t.type&&e.coorsSize.push(t.size),"undefined"!=typeof e.limitErrorField&&e.limitErrorField.indexOf("*")>-1&&(e.limitErrorField=e.limitErrorField.replace(/\*/g,t.minLimit)),"undefined"!=typeof t.spaceFlag&&"undefined"!=typeof t.spaceFlag.flag?e.textMaxlength.push(parseInt(t.limit)+t.spaceFlag.flag.length):e.textMaxlength.push(t.limit);var i=t.placeHolder?t.placeHolder:e.textPlaceHolder;e.textPlaceHolderList.push(i)}),e.engravingFont[e.param.index]=e.coorsFont.join("|"),e.engravingSize[e.param.index]=e.coorsSize.join("|")),e.path&&e.path.forEach(function(t,a){e.isCurveEmpty.push(!1),e.curveLeftNum[a]=t.limit,e.curveEmojiError.push(!1);var i=t.placeHolder?t.placeHolder:e.textPlaceHolder;e.curvePlaceholderText.push(i)}),e.hasPhoto&&(e.carvingAble=!1,window.addEventListener("EVENT_PHOTO_SAVE_AFTER",function(t){t.detail.index;var a=t.detail.data,i=a.photo[0].crop;if(i)if(e.carvingAble=!1,fabric.Image.fromURL(i,function(t){t.scaleX=fe["a"].carvingObj[e.param.index].canvas.width/t.width,t.scaleY=fe["a"].carvingObj[e.param.index].canvas.height/t.height,fe["a"].carvingObj[e.param.index].canvas.setBackgroundImage(t),fe["a"].carvingObj[e.param.index].canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),e.isBigCarving>0){var n=fe["a"].carvingObj[e.param.index].canvas.getContext("2d"),r=fe["a"].carvingObj[e.param.index].canvas.width,o=fe["a"].carvingObj[e.param.index].canvas.height,s=n.getImageData(0,0,r,o),l=e.getRectCoor(s),c=e.carvingBigObj.canvas.width-l.left-l.right,d=e.carvingBigObj.canvas.height-l.top-l.buttom;fabric.Image.fromURL(a.photo[0].ai,function(t){t.scaleX=c/t.width,t.scaleY=d/t.height,t.left=l.left,t.top=l.top,e.carvingBigObj.canvas.setBackgroundImage(t),e.carvingAble=!0,e.carvingBigObj.canvas.requestRenderAll()},{crossOrigin:"Anonymous"})}else fabric.Image.fromURL(a.photo[0].ai,function(t){t.scaleX=e.cWidth/e.bigCanvas.width,t.scaleY=e.cHeight/e.bigCanvas.height,t.left=(e.cWidth-t.width*t.scaleX)/2,t.top=(e.cHeight-t.height*t.scaleY)/2,e.carvingBigObj.canvas.setBackgroundImage(t),e.carvingBigObj.canvas.requestRenderAll(),e.carvingAble=!0},{crossOrigin:"Anonymous"})}))},watch:{cropSource:function(){0!=Object.keys(this.$refs).length?(this.useOpen=!1,this.$refs.cropper.replace(this.cropSource)):this.useOpen=!0},fontColor:function(e){var t=this;t.coors.forEach(function(a,i){fe["a"].carvingObj[t.param.index].changeColor(e,i)})},centerDialogVisible:function(e){!0===e?fe["a"].dispatchCustomEvent("EVENT_CARVING_DIALOG",{index:this.param.index}):fe["a"].dispatchCustomEvent("EVENT_CARVING_DIALOG_CLOSE",{index:this.param.index})}}},De=Pe,Be=(a("641e"),Object(Se["a"])(De,Le,Ae,!1,null,null,null)),ze=Be.exports,$e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{class:e.areaCropUploadClass},[a("div",{staticClass:"area-crop-upload-flex"},[e.cropImg?a("img",{staticClass:"preview-thumbnail",attrs:{src:e.cropImg},on:{click:e.openimage}}):a("span",{staticClass:"area-crop-upload-text"},[e._v(e._s(e.uploadLabel)),e.requireVal?a("font",{attrs:{color:"red"}},[e._v("*")]):e._e()],1)]),a("div",{staticClass:"area-crop-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload,accept:e.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open crop-btn-upload-open",attrs:{type:"button"}},[e._v(e._s(this.btnUploadText))])])],1)]),a("el-dialog",{attrs:{title:"",width:e.dialogWidth,visible:e.centerDialogVisible,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened,close:e.cancelCanvas}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showOption,expression:"showOption"}]},[a("div",{staticClass:"options-choose-tpl"},[e._v(e._s(e.templateLabel)+"*")]),a("vue-select-image",{attrs:{dataImages:e.dataImages,h:e.textureH,w:e.textureW,selectedImages:e.selectedImages},on:{onselectimage:e.changeStyle}}),a("div",{staticClass:"options-tpl-next"},[a("el-button",{on:{click:e.openCrop}},[e._v(e._s(e.optionsNextText))])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showCrop,expression:"showCrop"}],staticStyle:{"text-align":"center"}},[a("div",{staticStyle:{"text-align":"center"}},[a("div",{style:e.subDialogWidth},[a("vue-cropper",{ref:"cropper",staticClass:"custom-cropper",attrs:{"view-mode":1,"drag-mode":"move",background:!0,rotatable:!0,src:e.imgSrc,"min-container-width":300,"min-container-height":240,aspectRatio:e.aspectRatio,"img-style":e.imgStyle}})],1)]),a("div",{staticClass:"design-tool-bar"},[a("i",{staticClass:"el-icon-thirdrotate-left design-tool-bar-icon",on:{click:function(t){return e.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdsync design-tool-bar-icon",on:{click:function(t){return e.doAction("reset")}}}),a("i",{staticClass:"el-icon-thirdrotate-right design-tool-bar-icon",on:{click:function(t){return e.doAction("right")}}})]),a("div",{staticClass:"crop-prompt",domProps:{innerHTML:e._s(e.cropPrompt)}},[e._v(e._s(e.cropPrompt))]),e.hasPhoto?e._e():a("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1),a("span",{staticClass:"dialog-footer edit-tpl-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:0==e.percentage&&!e.uploadLoadingImage},on:{click:e.cancelCanvas}},[e._v(e._s(e.cropCancelText))]),a("el-button",{attrs:{type:"primary",loading:e.isLoading},on:{click:e.saveCanvas}},[e._v(e._s(e.cropConfirmText))])],1)])]),e.isLoading&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.uploadLoadingImage}})])]):e._e()],1)},Me=[],We=a("95c3"),Ue=a.n(We),Re=a("f36a"),qe=a.n(Re);a("6ea1");var Ve={name:"CropDialog",props:["param"],components:{VueCropper:Ue.a,VueSelectImage:qe.a},data:function(){return{areaCropUploadClass:"area-crop-upload area-crop-upload-"+this.param.index,uploadLabel:fe["a"].crop[this.param.index].uploadLabel?fe["a"].crop[this.param.index].uploadLabel:"Upload your Photo",btnUploadText:fe["a"].crop[this.param.index].btnUploadText?fe["a"].crop[this.param.index].btnUploadText:"Upload",crop:[],group:0,title:fe["a"].title?fe["a"].title:{},items:"",labels:"",info:"",params:"",cropBase64:"",cropPrompt:!1===fe["a"].cropPrompt?"":fe["a"].cropPrompt,requireVal:!1!==fe["a"].crop[this.param.index].require,cropCancelText:fe["a"].cropCancelText?fe["a"].cropCancelText:"Cancel",cropConfirmText:fe["a"].cropConfirmText?fe["a"].cropConfirmText:"Confirm",msgboxStyle:this.$device.mobile?"width: 95%; height: 95%;":"width: 500px; height: 400px;",centerDialogVisible:!1,percentage:0,cropQiniuObj:"",isLoading:!1,imgSrc:"",base64:"",dialogWidth:this.$device.mobile?"100%":"40%",subDialogWidth:this.$device.mobile?"width: 100%; border: 1px solid gray; display: inline-block;":"width: 500px; height:400px; border: 1px solid gray; display: inline-block;",imgStyle:this.$device.mobile?{}:{width:"500px",height:"400px"},isFullscreen:!!this.$device.mobile,hasPhoto:!0===fe["a"].crop[this.param.index].hasPhoto,showCrop:!0,showOption:!1,textureH:fe["a"].crop[this.param.index].textureH?fe["a"].crop[this.param.index].textureH:"50px",textureW:fe["a"].crop[this.param.index].textureW?fe["a"].crop[this.param.index].textureW:"50px",dataImages:fe["a"].crop[this.param.index].tplOptions?fe["a"].crop[this.param.index].tplOptions:[],optionsNextText:fe["a"].crop[this.param.index].optionsNextText?fe["a"].crop[this.param.index].optionsNextText:"Next",selectStyle:fe["a"].crop[this.param.index].tplOptions?fe["a"].crop[this.param.index].tplOptions[0].value:"",selectedImages:fe["a"].crop[this.param.index].tplOptions?[fe["a"].crop[this.param.index].tplOptions[0]]:[],templateLabel:fe["a"].crop[this.param.index].templateLabel?fe["a"].crop[this.param.index].templateLabel:"Choose Template",aspectRatio:fe["a"].crop[this.param.index].aspectRatio?fe["a"].crop[this.param.index].aspectRatio:0,uploadClear:!0===fe["a"].uploadClear,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,bgOpacity:fe["a"].bgOpacity?fe["a"].bgOpacity:.5,wrapperBackgroudColor:fe["a"].wrapperBackgroudColor?fe["a"].wrapperBackgroudColor:"#ffffff",uploadLoadingImage:fe["a"].uploadLoadingImage?fe["a"].uploadLoadingImage:"",hasSelect:!0===this.param.data.hasSelect,uploadAccept:fe["a"].uploadAccept?fe["a"].uploadAccept:"",compressSize:fe["a"].crop[this.param.index].compressSize?fe["a"].crop[this.param.index].compressSize:5e3,quality:fe["a"].crop[this.param.index].quality?fe["a"].crop[this.param.index].quality:.7,cropSizeWidth:!!fe["a"].crop[this.param.index].cropSizeWidth&&fe["a"].crop[this.param.index].cropSizeWidth,cropSizeHeight:!!fe["a"].crop[this.param.index].cropSizeHeight&&fe["a"].crop[this.param.index].cropSizeHeight,imageType:fe["a"].crop[this.param.index].imageType?fe["a"].crop[this.param.index].imageType:"png"}},computed:{cropImg:{get:function(){return this.hasPhoto?this.$store.getters.getCropPhoto(this.param.index):this.crop[this.param.index]},set:function(e){this.hasPhoto?this.$store.dispatch("setCropPhoto",e):this.crop[this.param.index]=e}}},methods:{openimage:function(){this.$parent.openimage(this.cropImg)},getItems:function(){var e=[];return fe["a"].items.forEach(function(t,a){var i=[];t.data.forEach(function(e,t){i.push(e)}),e.push(i)}),e||{}},getLabels:function(){var e=[];return fe["a"].items.forEach(function(t,a){t.label&&e.push(t.label)}),e||[]},open:function(e){this.centerDialogVisible=!0,this.isLoading=!1},onOpened:function(){var e=this;console.log(e.aspectRatio),this.$refs.cropper.setAspectRatio(e.aspectRatio),this.used||(this.$refs.cropper.replace(this.cropBase64),this.used=!0)},doAction:function(e){"reset"==e?this.$refs.cropper.reset():"left"==e?this.$refs.cropper.rotate(-45):"right"==e&&this.$refs.cropper.rotate(45)},getBgImg:function(e){return fe["a"].awcdn+"js/zen-crop-bobbleheads/img/"+e+"?"+Math.random()},avatarUpload:function(e){var t=this,a=this;a.params=e.data,a.hasPhoto&&(a.showOption=!0,a.showCrop=!1,a.$store.dispatch("setTemplateErrorMsg",""));var i=new FileReader;i.onload=function(a){t.open(e),t.cropBase64=a.target.result,t.used&&t.$refs.cropper.replace(t.cropBase64)},i.readAsDataURL(e.file)},rotate:function(){this.$refs.cropper.rotate(90)},_neat:function(){var e=this;e.$store.dispatch("setCustomInfo",JSON.stringify(fe["a"].neatenCustomInfo(e.$store.getters.getCustomInfo,e.items))),e.$parent.$refs.additionalOption.enable&&(e.$parent.$refs.additionalOption.status=!0),e.isLoading=!1,e.centerDialogVisible=!1,e.items[e.params.index1][e.params.index].hasCarving&&(e.items[e.params.index1][e.params.index].noSelect?e.$parent.$refs.carvingDialog.open(e.params):e.$parent.$refs.selectDialog.open(e.params)),e.percentage=0,fe["a"].dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:e.param.index,data:e.$store.getters.getCustomInfo})},changeAspectRatio:function(e){var t=this;t.aspectRatio=e},cancelCanvas:function(){var e=this;e.uploadLoadingImage||e.cropQiniuObj.unsubscribe(),e.percentage=0,e.centerDialogVisible=!1},saveCanvas:function(){var e=this;if(e.base64=this.$refs.cropper.getCroppedCanvas().toDataURL({format:e.imageType,quality:.8}),e.hasPhoto){e.$store.dispatch("setFusionPreview",""),e.$store.dispatch("setPhotoDialogVisibleNormal",!0),e.centerDialogVisible=!1,this.$store.dispatch("setIfChangeImage",!1);var t=new Image;t.src=e.base64,t.onload=function(){var a=1e3,i=.7,n=document.createElement("canvas"),r=n.getContext("2d"),o=Math.min(Math.min(a,t.width)/t.width,Math.min(a,t.height)/t.height);n.width=t.width*o,n.height=t.height*o,r.fillStyle="#fff",r.fillRect(0,0,n.width,n.height),r.drawImage(t,0,0,n.width,n.height);var s=n.toDataURL("image/jpeg",i);fe["a"].asyncFusion(fe["a"].crop[e.param.index].sku,e.selectStyle,s).then(function(t){0==t.data.error?(e.$store.dispatch("setTemplateErrorMsg",""),e.$store.dispatch("setFusionPreview",t.data.base64),_zenConfig.photoObj[e.param.index].change(_zenConfig.photoObj[e.param.index],t.data.base64),fe["a"].dispatchCustomEvent("EVENT_FUSION_COMFIRM",{data:t.data.base64})):(e.$store.dispatch("setTemplateErrorMsg",t.data.message),e.$store.dispatch("setIfChangeImage",!0),fe["a"].dispatchCustomEvent("EVENT_FUSION_ERROR",{data:t.data.message}))})}}else{e.uploadLoadingImage&&(e.centerDialogVisible=!1),e.isLoading=!0;var a={};if(e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.crop)||(console.log("_json.crop is not Array "),a.crop=[]),e.uploadClear){var i={crop:[]};i.crop[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",cropOrigin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(i))}if(fe["a"].crop[e.param.index].hasCropOrigin){t=new Image;t.src=e.base64,t.crossOrigin="Anonymous",t.onload=function(){var i=e.compressSize,n=e.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,t.width)/t.width,Math.min(i,t.height)/t.height);r.width=e.cropSizeWidth?e.cropSizeWidth:t.width*s,r.height=e.cropSizeHeight?e.cropSizeHeight:t.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(t,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n),c={base64:l,key:fe["a"].getFilename(12)+"."+e.imageType};fe["a"].cdnUploadNew(c,function(t){console.log(t),e.crop[e.param.index]=t.picture,a.crop[e.param.index].crop=t.picture,e.$store.dispatch("setCustomInfo",JSON.stringify(a)),fe["a"].dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:e.param.index,data:e.$store.getters.getCustomInfo});var i=new Image;i.src=e.cropBase64,i.crossOrigin="Anonymous",i.onload=function(){var t=e.compressSize,n=e.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(t,i.width)/i.width,Math.min(t,i.height)/i.height);r.width=i.width*s,r.height=i.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(i,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n),c={base64:l,key:fe["a"].getFilename(12)+"."+e.imageType};fe["a"].cdnUploadNew(c,function(t){a.crop[e.param.index].cropOrigin=t.picture,e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.isLoading=!1,e.centerDialogVisible=!1,e.percentage=0,e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param),fe["a"].dispatchCustomEvent("EVENT_CROPORIGIN_SAVE_AFTER",{index:e.param.index,data:e.$store.getters.getCustomInfo})},e)}},e)}}else{console.log("not hasCropOrigin");t=new Image;t.src=e.base64,t.crossOrigin="Anonymous",t.onload=function(){var i=e.compressSize,n=e.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,t.width)/t.width,Math.min(i,t.height)/t.height);r.width=e.cropSizeWidth?e.cropSizeWidth:t.width*s,r.height=e.cropSizeHeight?e.cropSizeHeight:t.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(t,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n);"png"==e.imageType&&(l=l.replace("jpeg","png"));var c={base64:l,key:fe["a"].getFilename(12)+"."+e.imageType};fe["a"].cdnUploadNew(c,function(t){e.crop[e.param.index]=t.picture,a.crop[e.param.index].crop=t.picture,e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.isLoading=!1,e.centerDialogVisible=!1,e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param),fe["a"].dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:e.param.index,data:e.$store.getters.getCustomInfo})},e)}}console.log("string:",a)}},clearCrop:function(){var e=this;e.crop[e.param.index]="";var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.crop)||(t.crop=[]),t.crop[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",cropOrigin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t))},changeStyle:function(e){this.selectStyle=e.value,fe["a"].dispatchCustomEvent("EVENT_ETHNICITY_CHANGE",{style:e.value})},openCrop:function(){var e=this;e.showOption=!1,e.showCrop=!0,e.used&&e.$refs.cropper.replace(e.cropBase64)}},mounted:function(){var e=this;if(e.hasPhoto)e.showOption=!0,e.showCrop=!1;else{var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.crop)||(t.crop=[]),t.crop[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",cropOrigin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t))}window.changeAspectRatio=this.changeAspectRatio,window.clearCrop=this.clearCrop},watch:{cropSource:function(){}}},He=Ve,Ye=(a("0891"),Object(Se["a"])(He,$e,Me,!1,null,"7e0c9bcc",null)),Xe=Ye.exports,Je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{class:e.crystalClass},[a("div",{staticClass:"crystal-preview-img"},[this.engravingCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[e.param.index],width:"50",height:"40"},on:{click:e.openImage}}):e._e()]),a("div",{staticClass:"crystal-preview-box",on:{click:e.open}},[a("div",{staticClass:"area-carving-preview-text crystal-preview-flex"},[this.engravingCrop[e.param.index]?e._e():a("span",[e._v(e._s(e.previewText))])]),a("div",{staticClass:"crystal-preview-flex"},[a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:e.open}},[e._v(e._s(e.btnText))])])]),a("el-dialog",{class:{loadingDialog:2==e.inLoading},attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,height:"600px",fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[1!=e.inLoading&&e.uploadLoadingImage?e._e():a("el-container",[a("el-aside",{attrs:{width:"50%"}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"})]),a("el-main",{attrs:{width:"50%"}},["CrystalName"==e.type||"CrystalCurveName"==e.type||"NameCarving"==e.type||"CurveName"==e.type?a("div",{staticClass:"namenecklace-photo"},[a("div",{staticClass:"view-name"},[a("span",[e._v(e._s(e.preview)+":")]),a("div",{staticClass:"showtext",style:"font-family:"+e.fontFamily,attrs:{id:"showtext"}},[e._l(e.lines,function(t){return a("span",{key:t,class:"showtext-in "+e.nameClass,style:e.style,attrs:{id:"showtext_"+t}},[e._v(e._s(e.showText[t]))])}),e._v("    \n                            ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),a("div",{staticClass:"carvingcanvas-content",class:{first:1==e.lines}},e._l(e.lines,function(t){return a("div",{key:t,staticClass:"pr"},[a("div",{staticClass:"curve-textarea",class:{crystalError:e.nameTextEmpty[t-1]&&e.errorBorderShow}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.nameText[t],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+t,type:"text","data-prefix":"ctext","data-index":t,id:"ctext"+t,maxlength:e.nameTextMaxLength[t],placeholder:e.enterName},domProps:{value:e.nameText[t]},on:{input:[function(a){a.target.composing||e.$set(e.nameText,t,a.target.value)},function(a){return e.changeAlphaText(t,e.nameText[t])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+t}},[e._v(e._s(e.nameLeftNum[t]))]),e._v(" "+e._s(e.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextEmpty[t-1]&&e.errorWordShow,expression:"nameTextEmpty[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextLimit[t-1]&&e.errorWordShow,expression:"nameTextLimit[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.atLeastField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameEmojiError[t-1]&&e.errorWordShow,expression:"nameEmojiError[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.emojiErrorField))])])}),0)]):e._e(),e.crystalHeaderShow?a("el-collapse",{attrs:{accordion:""},model:{value:e.crystalHeaderDisplay,callback:function(t){e.crystalHeaderDisplay=t},expression:"crystalHeaderDisplay"}},["NameCarving"!=e.type&&"CurveName"!=e.type?a("el-collapse-item",{attrs:{name:"crystalTitleName"}},[a("template",{staticClass:"crystal-header",slot:"title"},[a("div",{staticClass:"crystal-header-title-box"},[a("div",{staticClass:"crystal-header-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondHeaderDefaultImg}}),a("span",[e._v(e._s(e.crystalHeader))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[e._v(e._s(e.freeText))])])]),a("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.diamond,function(t,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondDefaultImg[i]}}),a("span",[e._v(e._s(e.crystalTitle)+e._s(i+1))])])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},e._l(t,function(t,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+e.picUrl+t.sku+".png?456);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":e.crystalColor[i],"data-index":i,"data-color":t.color,name:"color"+i,type:"radio"},domProps:{value:t.sku},on:{click:function(a){return e.changeColor(i,t.color,t.sku)}}}),a("div",{staticClass:"name"},[e._v(e._s(e.month[n]))])])}),0)])])])],2)}),1)],2):e._e(),"CrystalCurve"==e.type||"CrystalCarving"==e.type||"CrystalCurveName"==e.type||"NameCarving"==e.type||"CurveName"==e.type?a("el-collapse-item",{attrs:{name:"crystal-input-collapse"}},[a("template",{slot:"title"},[a("div",{staticClass:"engraving-title-box"},[a("div",{staticClass:"engraving-title"},[a("i",{staticClass:"header-icon el-icon-edit"}),a("span",[e._v(e._s(e.textTile))])]),e.isMarkup>0?a("span",{staticClass:"crystal-free",attrs:{"data-price":e.isMarkup}},[e._v(e._s(e.addPrice))]):a("div",{staticClass:"crystal-free"},[e._v(e._s(e.freeText))])])]),a("div",{staticClass:"card-body"},[e._l(e.coors,function(t,i){return a("div",{key:i},[a("div",{staticClass:"engravings"},[a("span",[e._v(e._s(e.textInputName)),e.coors.length>1?a("span",[e._v(e._s(i+1))]):e._e()]),e.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[i]"}],class:{crystalError:e.isEmpty[i]&&e.errorBorderShow},style:"font-family:"+e.engravingFont[e.param.index],attrs:{maxlength:t.textNum,id:"textInput"+i,"data-index":i,placeholder:e.textWords},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},function(t){return e.changeTextInput(i,e.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[i]"}],class:{crystalError:e.isEmpty[i]&&e.errorBorderShow},style:"font-family:"+e.engravingFont[e.param.index],attrs:{maxlength:t.textNum,id:"textInput"+i,"data-index":i,placeholder:e.textWords},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},function(t){return e.changeTextInput(i,e.textList[i])}]}}),a("span",{class:"num textNum"+i},[e._v(e._s(e.limitNum[i])+" "+e._s(e.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isEmpty[i]&&e.errorWordShow,expression:"isEmpty[i] && errorWordShow"}],staticClass:"errorWord"},[e._v(e._s(e.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isEmojiError[i]&&e.errorWordShow,expression:"isEmojiError[i] && errorWordShow"}],staticClass:"errorWord"},[e._v(e._s(e.emojiErrorField))])])}),e.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size crystal-font-size",attrs:{size:"large"},on:{change:e.changeSize},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),e.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[e._v(e._s(e.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},on:{change:e.changeFont},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},[a("el-col",e._l(e.engravingFontOptions,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1):e._e()],2)],2):e._e()],1):e._e(),e.crystalHeaderShow?e._e():a("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},["NameCarving"!=e.type&&"CurveName"!=e.type?a("div",e._l(e.diamond,function(t,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondDefaultImg[i]}}),a("span",[e._v(e._s(e.crystalTitle)+e._s(i+1))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[e._v(e._s(e.freeText))])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},e._l(t,function(t,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+e.picUrl+t.sku+".png?123);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":e.crystalColor[i],"data-index":i,"data-color":t.color,name:"color"+i,type:"radio"},domProps:{value:t.sku},on:{click:function(a){return e.changeColor(i,t.color,t.sku)}}}),a("div",{staticClass:"name"},[e._v(e._s(e.month[n]))])])}),0)])])])],2)}),1):e._e(),"CrystalCurve"==e.type||"CrystalCarving"==e.type||"CrystalCurveName"==e.type||"NameCarving"==e.type||"CurveName"==e.type?a("el-collapse-item",{attrs:{name:"crystal-input-collapse"}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("i",{staticClass:"header-icon el-icon-edit"}),a("span",[e._v(e._s(e.textTile))])]),e.isMarkup>0?a("span",{staticClass:"crystal-free",attrs:{"data-price":e.isMarkup}},[e._v(e._s(e.addPrice))]):a("div",{staticClass:"crystal-free"},[e._v(e._s(e.freeText))])])]),a("div",{staticClass:"card-body"},[e._l(e.coors,function(t,i){return a("div",{key:i,staticClass:"engravings"},[a("span",[e._v(e._s(e.textInputName)),e.coors.length>1?a("span",[e._v(e._s(i+1))]):e._e()]),e.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[i]"}],class:{crystalError:e.isEmpty[i]},attrs:{maxlength:t.textNum,id:"textInput"+i,"data-index":i,placeholder:e.textWords},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},function(t){return e.changeTextInput(i,e.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[i]"}],class:{crystalError:e.isEmpty[i]},attrs:{maxlength:t.textNum,id:"textInput"+i,"data-index":i,placeholder:e.textWords},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},e.changeTextInput]}}),a("span",{class:"num textNum"+i},[e._v(e._s(e.limitNum[i]))]),e._v(" "+e._s(e.leftText)+"\n                                ")])}),e.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:e.changeSize},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),e.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[e._v(e._s(e.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},on:{change:e.changeFont},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},[a("el-col",e._l(e.engravingFontOptions,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1):e._e()],2)],2):e._e()],1),a("div",[a("el-button",{staticClass:"btn-crystal-confirm",attrs:{type:"primary",disabled:e.photosLoad||e.bgLoad||e.photoLoad},on:{click:function(t){return e.saveCrystal(1)}}},[e._v(e._s(e.confirmText)),e.isMarkup>0?a("span",{staticClass:"is-markup",attrs:{"data-price":e.isMarkup}},[e._v(e._s(e.addPrice))]):e._e()]),e.isMarkup>0?a("el-button",{staticClass:"btn-crystal-cancel",on:{click:function(t){return e.saveCrystal(0)}}},[e._v("Without Engraving")]):e._e()],1)],1)],1),2==e.inLoading&&!e.loadingFullScreen&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:e.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1)]):e._e()],1),2==e.inLoading&&e.loadingFullScreen?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.uploadLoadingImage}})])]):e._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:e.crystalCanvasId}})])],1),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:"3000",height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}})])},Ge=[],Ke=a("362d"),Qe=a.n(Ke),Ze=a("0342"),et=function(){function e(e){this.init(e)}return e.prototype=Object.assign(new Ce["a"],{init:function(e){this.config=e,this.canvas=new fabric.Canvas(e["canvasid"]),this.cWidth=e["cWidth"]||"",this.cHeight=e["cHeight"]||"",this.baseWidth=e["baseWidth"]||"",this.path=e["path"]||"",this.textBorderColor=e["textBorderColor"]||"#9FBDF7",this.text=[],this.textpath=[],this.custom=e["custom"]||"",this.defaultFont=e["defaultFont"]||"holyunion",this.lineHeight=e["lineHeight"]||1,this.isSinglelineInput=e["isSinglelineInput"],this.type=e["type"],this.canvas.selection=!1,this.setCanvaSize(),this.setBackground(),e["overLay"]&&this.setOverlay(),this.setBgAndObj(),this.canvas.renderAll()},setOverlay:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.canvas.setOverlayImage(e.config["overLay"],e.canvas.renderAll.bind(e.canvas),{scaleX:e.scale,scaleY:e.scale,crossOrigin:"anonymous"})},setBackground:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.canvas.setBackgroundImage(e.config["bg"],e.canvas.renderAll.bind(e.canvas),{scaleX:e.scale,scaleY:e.scale,crossOrigin:"anonymous"})},setBgAndObj:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if("NameCarving"==e.type||"CurveName"==e.type)e.config.callback(e);else{var t=0;this.config["diamond"][t]&&this.setDiamond(t)}},setDiamond:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;fabric.Image.fromURL(t.config["diamond"][e],function(a){a.lockMovementX=!0,a.lockMovementY=!0,a.selectable=!1,a.scaleX=t.scale,a.scaleY=t.scale,t.canvas.add(a),e++,t.config["diamond"][e]?t.setDiamond(e):t.config.callback(t)}.bind(this),{crossOrigin:"anonymous"})},getColor:function(e){var t={pomegranate:["#4d0875","0.011618","-0.235405","0.713477","-1.59"],hyacinth:["#4d0875","-0.0981","-0.0471","0.474296","-0.086"],bodegablue:["#006291","-0.000145","0.101801","-0.000145","0"],whitezirconium:["#4d0875","-0.01975","0.011618","-1","-0.524"],greenzirconium:["#4d0875","-0.086407","-0.160906","0.180221","-0.85"],pink:["#4d0875","-0.133459","0.172379","-0.039355","-1.604"],redsteel:["#4d0875","-0.204037","-0.243247","0.99971","-1.654"],olive:["#4d0875","-0.192274","-0.015829","-0.05896","-1.148"],bluezirconium:["#4d0875","-0.243247","-0.231484","0.368429","-0.322"],rosered:["#4d0875","-0.078565","-0.05896","0.733082","0.198"],champagne:["#4d0875","-0.141301","0.062591","0.733082","0.662"],spinel:["#4d0875","-0.035434","-0.086407","0.611531","1.646"],alexred:["#4d0875","0.023381","-0.211879","0.301772","-1.62"],alexpinkishpurple:["#130141","-0.031513","-0.031513","-0.337351","0"],alexseablue:["#4d0875","0.023381","-0.055039","-0.721609","-0.414"],alexwhite:["#4d0875","0.023381","-0.055039","-1","-0.414"],alexgreen:["#4d0875","-0.070723","-0.376561","0.552716","1.234"],alexlightpurple:["#4d0875","-0.011908","-0.149143","-0.478507","1.776"],alexrosepink:["#4d0875","0.101801","-0.086407","-0.160906","-1.66"],alexolive:["#4d0875","-0.000145","-0.13738","0.082196","-1.148"],alexblue:["#4d0875","-0.125617"," -0.125617"," 0.152774","1.582"],alexpink:["#4d0875","0.117485","0.015539","-0.68632","-1.52"],alexamber:["#4d0875","0.074354","-0.145222","0.168458","0.554"],alexlightblue:["#4d0875","0.074354","-0.047197","-0.109933","1.428"],originalwhite:["#707070","0.37235","0.117485","-0.000145","0"],originalcolorwhite:["#13e8ff","0.168458","0.13709","0.391955","0.136"],originalcolorblue:["#0b7477","0.270404","-0.000145","0.168458","0.034"],originallightyellow:["#7d6504","0.050828","0.035144","0.662504","0.034"],originalolive:["#4d0875","0.007697","-0.05896","-0.317746","-1.094"],originalperidot:["#4d0875","0.007697","-0.05896","-0.705925","-1.094"],originalaquamarine:["#016f7a","0.37235","0.117485","-0.000145","0"],originalblack:["#000000","0.13709","-0.031513","0.391955","-0.066"],originalblackdiamond:["#4d0875","-0.004066","-0.25501","-1","0.444"],originalred:["#750000","0.015539","-0.102091","-0.000145","0"],originalcitrine:["#b47501","-0.015829","-0.133459","-0.000145","0"],originalgold:["#4d0875","-0.207958","0.13709","0.517427","0.7"],originalstarlite:["#005757","0.050828","0.035144","0.662504","0.034"],originalblue:["#070093","0.37235","0.035144","0.391955","-0.066"],originalgreen:["#003939","-0.000145","0.066512","0.188063","-0.1"],originalrosered:["#4d0875","-0.188353","0.011618","0.41156"," 0.244"],originalcymbidium:["#4d0875","-0.188353","-0.325588","0.05867","1.606"],originalpinkishpurple:["#400080","-0.000145","0.050828","-0.000145","-0.1"],originallightred:["#750000","0.37235","0.117485","-0.000145","0"],originallightrosered:["#e37bbc","0.37235","0.117485","-0.000145","0"],originallightpurple:["#4d0875","-0.125617","0.070433","-0.404008","-2"],originalpink:["#70384b","-0.082486","0.117485","-0.423613","0"],originalpurplishred:["#930453","0.25472","0.101801","-0.000145","0"],originalviolet:["#4d0875","-0.102091","0.109643","-0.494191","-1.946"],originalpurple:["#6206d2","0.37235","0.035144","0.391955","0.034"],brightred:["#ff0000","-0.01975","0.104644","-0.031513","0"],purplevelvet:["#99004d","0.046907","-0.05896","-0.000145","0"],shallowbluejade:["#3d5ccb","-0.000145","0.101801","-0.000145","0"],newwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],emerald:["#0b5334","0.102091","-0.153064","-0.37264","0.096"],greyviolet:["#b02d68","-0.007987","0.090038","-0.129538","0.122"],darkred:["#6c0000","0.184142","-0.074644","-0.031513","-0.012"],fruitgreen:["#0c6d0c","-0.153064","0.082196","-0.37264","0.014"],cobaltblue:["#0c419a","0.046907","-0.05896","-0.000145","0"],softred:["#840042","-0.031513","-0.01975","-0.37264","0.096"],yellow:["#4d0875","-0.141301","0.062591","0.733082","0.662"],jadeblue:["#4f84aa","-0.007987","-0.074644","-0.007987","0"],janred:["#ff0000","-0.000145","0.101801","-0.000145","0"],febrose:["#b00058","-0.000145","0.101801","-0.000145","0"],marblue:["#1ab5ff","-0.000145","0.101801","-0.000145","0"],aprwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],maygreen:["#006834","-0.000145","0.101801","-0.000145","0"],junpurple:["#600048","-0.000145","0.101801","-0.000145","0"],jultangerine:["#d24400","-0.000145","0.101801","-0.000145","0"],auggreen:["#647640","0.231194","0.101801","-0.000145","0"],sepblue:["#5F8BBB","0.172379","-0.051118","-0.000145","0"],octpurple:["#c95891","-0.000145","0.101801","-0.000145","0"],novorange:["#fb7700","-0.000145","0.101801","-0.000145","0"],decblue:["#0020a2","-0.000145","0.101801","-0.000145","0"],garnet:["#ff0000","-0.000145","0.101801","-0.000145","0"],purpleblue:["#7642BC","-0.000145","0.101801","-0.000145","0"],shallowblue:["#8ef3ff","-0.000145","0.001801","-0.000145","0"],cerkonier:["#8B8387","-0.01975","0.011618","-1","-0.524"],greencerkonier:["#004529","-0.000145","0.101801","-0.000145","0"],pinkred:["#c67589","-0.000145","0.101801","-0.000145","0"],redsteelnew:["#4d0875","-0.204037","-0.143247","0.99971","-1.654"],middleolive:["#9E8847","0.231194","0.001801","-0.000145","0"],bluecerkonier:["#002C74","0.172379","-0.051118","-0.000145","0"],roseredsteel:["#c95891","-0.000145","0.101801","-0.000145","0"],champ:["#fec0ab","-0.000145","0.001801","-0.000145","0"],sharpcrystal:["#4D95CE","-0.000145","0.101801","-0.000145","0"],shallowviolet:["#817c9d","-0.109933","0.027302","-0.051118","0"],lightred:["#b41967","0.066512","-0.188353","-0.051118","0"],citrine:["#718b19","-0.000145","0.101801","-0.000145","0"],lightgreen:["#417d3d","-0.000145","0.101801","-0.000145","0"],seablue:["#6590A1","-0.000145","0.101801","-0.000145","0"],lilac:["#581D67","-0.000145","0.101801","-0.000145","0"],rubine:["#7E0830","-0.000145","0.101801","-0.000145","0"],olivecolour:["#395800","-0.000145","0.101801","-0.000145","0"]};return t[e]},setColor:function(e,t){var a=this.getColor(t);e.filters=[];var i=new fabric.Image.filters.BlendColor({color:a[0],mode:"add",alpha:1}),n=new fabric.Image.filters.Contrast({contrast:a[1]}),r=new fabric.Image.filters.Brightness({brightness:a[2]}),o=new fabric.Image.filters.Saturation({saturation:a[3]}),s=new fabric.Image.filters.HueRotation({rotation:a[4]});e.filters.push(i),e.applyFilters(),this.canvas.renderAll(),e.filters.push(n),e.applyFilters(),this.canvas.renderAll(),e.filters.push(r),e.applyFilters(),this.canvas.renderAll(),e.filters.push(o),e.applyFilters(),this.canvas.renderAll(),e.filters.push(s),e.applyFilters(),this.canvas.renderAll()},initPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.stage=new Qe.a.Stage({container:"container",width:e.cWidth,height:e.cHeight}),e.layer=new Qe.a.Layer,e.path.forEach(function(t,a){e.textpath[a]=new Qe.a.TextPath({x:0,y:0,align:"center",fill:"#000",fontSize:t.textFontSize,fontFamily:e.defaultFont,text:"",data:t.path}),e.layer.add(e.textpath[a])}),e.stage.add(e.layer),e.img=new Image,e.imgObj=new fabric.Image(e.img),e.imgObj.lockMovementX=!0,e.imgObj.lockMovementY=!0,e.imgObj.selectable=!1,e.canvas.add(e.imgObj),e.img.onload=function(){e.imgObj.setElement(e.img),e.imgObj.set({left:0,top:0,scaleX:e.scale,scaleY:e.scale}),e.canvas.renderAll(!0)}},initCarvingPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.custom.coors.forEach(function(t,a){var i=t.angle||0,n=parseFloat(t.lineHeight)||1;e.text[a]=new fabric.Text("",{originX:"center",originY:"center",left:t.left*e.scale,top:t.top*e.scale,angle:i,hasBorders:!0,hasControls:!1,borderColor:e.textBorderColor,fontSize:t.textFontSize*e.scale,lineHeight:n,textAlign:"center",fill:t.textColor||"black"}),t.defaultFont&&e.changeCarvingFont(t.defaultFont,a),e.canvas.add(e.text[a]),e.canvas.renderAll(!0)})},textToVertical:function(e){for(var t="",a=0;a<e.length;a++){if(a==e.length-1)var i="";else i="\n";t+=e[a]+i}return t},changeText:function(e,t){this.textpath[t].setText(e),this.layer.draw();var a=this.stage.toDataURL();this.img.src=a},changeCarvingText:function(e,t){var a=this,i=this.text[t];i&&("vertical"==this.custom.coors[t].direction&&(e=this.textToVertical(e)),this.isSinglelineInput||(e=this.wrapCanvasText(e,this.canvas,i.fontFamily,i.fontSize,this.custom.coors[t].limitArea.width*this.scale,this.custom.coors[t].limitArea.height*this.scale)),i.set("text",e),this.canvas.on("object:moving",function(){a.checkLimitArea(i,t)}),this.checkLimitArea(i,t,e),this.canvas._activeObject=i,this.canvas.renderAll())},changeSize:function(e,t){var a=this.textpath[e];if(a){a.setFontSize(t),this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}},changeCarvingSize:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=this.text[e];i&&(i.set("fontSize",t),"vertical"==this.custom.coors[e].direction&&(a=this.textToVertical(a)),i.set("text",a),this.checkLimitArea(i,e,a),this.canvas.renderAll())},loadAndUse:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=new Ze(t);i.load().then(function(){var i=a.textpath[e];i&&(i.setFontFamily(t),a.layer.draw(),a.img.src=a.stage.toDataURL())}).catch(function(e){console.log(e)})},loadAndUseCarving:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=new Ze(t);i.load().then(function(){var i=a.text[e];i&&(i.set("fontFamily",t),a.canvas.renderAll())}).catch(function(e){console.log(e)})},changeFont:function(e,t){this.loadAndUse(t,e)},changeCarvingFont:function(e,t){this.loadAndUseCarving(t,e)},checkQuantity:function(e,t,a){var i=0;return""==e?1:e.length<t?1:e.length>a?1:i},checkLimitArea:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("undefined"!==typeof this.custom.coors[t].limitArea){var i=this.custom.coors[t].limitArea,n=0;if(a){if(e.height>i.height*this.scale){var r=a.split(/[(\r\n)\r\n]+/);if(r.length>1){n=Math.ceil((e.height-i.height*this.scale)/(e.height/r.length)),a="";for(var o=0;o<r.length-n;o++)a+=o>0?"\n"+r[o]:r[o]}}e.set("text",a),this.canvas.renderAll(),e.width>i.width*this.scale&&(n=Math.ceil((e.width-i.width*this.scale)/(e.width/a.length)),a=a.substr(0,a.length-n)),e.set("text",a),this.canvas.renderAll()}var s=e.top,l=e.left,c=l,d=s,h=e.width/2,p=e.height/2;l-h<i.left*this.scale?c=i.left*this.scale+h:l+h>i.left*this.scale+i.width*this.scale&&(c=i.left*this.scale+i.width*this.scale-h),s-p<i.top*this.scale?d=i.top*this.scale+p:s+p>i.top*this.scale+i.height*this.scale&&(d=i.top*this.scale+i.height*this.scale-p),e.set({left:c,top:d}),this.canvas.renderAll()}},wrapCanvasText:function(e,t,a,i,n,r){"undefined"===typeof r&&(r=0);var o=e.split(" "),s="",l=(e.replace(/(\r\n|\n|\r)/gm,""),new fabric.Text("sdfsdf",{fontFamily:a,fontSize:25}).height),c=r>0?r-l:0,d=t.getContext("2d");d.font=i+"px "+a;for(var h="",p=0,g=0;g<o.length;g++){var m=""==h,u=h+" "+o[g],v=d.measureText(u).width;if(v<n)h+=o[g]+" ",s+=o[g]+=" ";else{if(m)for(var f="",x=0;x<o[g].length;++x){f+=o[g].charAt(x);var b=f+"-";if(d.measureText(b).width>=n){b=f.substr(0,f.length-1)+"",o[g]=o[g].substr(f.length-1,o[g].length),s+=b;break}}g--,s+="\n",p++,h=""}if(c>0&&p*l>c){s=s.substr(0,s.length-3)+"...\n";break}}return s=s.substr(0,s.length-1),s}}),e.prototype.constructor=e,e}(),tt=et,at=function(){function e(e){this.init(e)}return e.prototype=Object.assign(new Ce["a"],{init:function(e){this.tertiusType=e.json.tertiusType||"",this.secondType=e.json.secondtype||"",this.lines=e.json.lines||"",this.specialSymbol=e.json.specialSymbol||"",this.symbolPosition=e.json.symbolPosition||"",this.symbolSave=0===e.json.symbolSave?0:1,this.textType=e.json.textType||"",this.supportLanguage=e.json.supportLanguage||"",this.ischange=e.json.ischange||"",this.fontfamily=e.fontfamily||"BrushScriptStd",this.class=e.json.class||"silver",this.textInfo=e.json.text||[],this.isrometime=e.json.isrometime||"",this.iscenterchange=e.json.iscenterchange||"",this.text=[],this.setObject()},setObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.textInfo.forEach(function(t,a){e.text[a]={},e.text[a].config=t})},process:function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e=this.text[t].text=this.checkTextType(e),"MonogramsThree"==this.secondType?this.text[t].showText=this.text[t].text=this.convertMonogram(e):"MonogramsFive"==this.secondType?(this.text[t].showText=this.convertMonogramFive(e),this.text[t].text=((e[0]||"")+(e[1]||"")).toLowerCase()+(e[2].toUpperCase()||"")+((e[3]||"")+(e[4]||"")).toLowerCase()):"CircleThree"==this.secondType?(this.text[t].showText=this.convertCircleThree(e),this.text[t].text=(e[0]?e[0].toLowerCase():"")+(e[1]?e[1].toUpperCase():"")+(e[2]?e[2].toLowerCase():"")):"CircleTwo"==this.secondType?this.text[t].showText=this.text[t].text=this.convertCircleTwo(e):"HollowOut"==this.secondType?this.text[t].showText=this.text[t].text=e.toUpperCase():"Any"==this.secondType?(this.text[t].showText=this.text[t].text=this.tertiustypeSetval(e),a&&(this.text[t].showText=this.text[t].text=(e.charAt(0)?e.charAt(0).toUpperCase():"")+(e.substr(1)?e.substr(1):""))):(this.text[t].showText=this.text[t].text=this.tertiustypeSetval(this.text[t].text),a&&(this.text[t].showText=this.text[t].text=(e.charAt(0)?e.charAt(0).toUpperCase():"")+(e.substr(1)?e.substr(1):""))),this.text[t].showText=this.replaceShowtext(this.text[t].showText),this.text[t].showText=this.lastVariationTransformEn(this.text[t].showText),this.text[t].showText=this.showtextSpecialSymbol(this.text[t].showText,t)},tertiustypeSetval:function(e){return"initialUpper"==this.tertiusType?this.initialUpper(e):"upperCase"==this.tertiusType?e.toUpperCase():e},checkTextType:function(e){if(1==this.isrometime){if(e=e.replace(/[^0-9\/-]/g,""),""!=e.replace(/(^\s*)|(\s*$)/g,"")){var t=e.split("-");console.log("datetimeArr",t),e=this.convertToRome(t[0])+"  "+this.convertToRome(t[1])+"  "+this.convertToRome(t[2])}}else 1==this.textType?e=e.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZÀàÇÊËçêëáÁãÃàÀâÂçÇéÉêÊíÍóÓõÕòÒôÔúÚùÙûÛäÄöÖüÜßßñÑèÈëËïÏîÎœŒ]/g,""):2==this.textType?e=e.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZàÀâÂçÇéÉèÈêÊëËïÏîÎôÔùÙûÛœŒ]/g,""):3==this.textType?e=e.replace(/[^a-zA-Z]/g,""):4==this.textType?e=e.replace(/[^ؠءآأؤإئابةتثجحخدذرزسشصضطظعغػؼؽؾؿـفقكلمنهوىيپٿڀځڂڃڄڅچڇڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙښڛڜڝڞڟڠڡڢڣڤڥڦڧڨکڪګڬڭڮگڰڱڲڳڴڵڶڷڸڹںڻڼڽھڿۀہۂۃۄۅۆۇۈۉۊۋیۍێۏېۑےۓۮۯ]/g,""):5==this.textType?e=e.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZؠءآأؤإئابةتثجحخدذرزسشصضطظعغػؼؽؾؿـفقكلمنهوىيپٿڀځڂڃڄڅچڇڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙښڛڜڝڞڟڠڡڢڣڤڥڦڧڨکڪګڬڭڮگڰڱڲڳڴڵڶڷڸڹںڻڼڽھڿۀہۂۃۄۅۆۇۈۉۊۋیۍێۏېۑےۓۮۯ]/g,""):6==this.textType?e=e.replace(/[^0-9,]/g,""):7==this.guq.textType&&(text=text.replace(/[^0-9a-zA-Z.]/g,""));return e},convertToRome:function(e){for(var t="",a=Math.floor(e/1e3),i=Math.floor(e%1e3/100),n=Math.floor(e%100/10),r=e%10,o=["I","II","III","IV","V","VI","VII","VIII","IX"],s=["X","XX","XXX","XL","L","LX","LXX","LXXX","XC"],l=["C","CC","CCC","CD","D","DC","DCC","DCCC","CM"],c="M",d=0;d<a;d++)t+=c;return i&&(t+=l[i-1]),n&&(t+=s[n-1]),r&&(t+=o[r-1]),t},replaceShowtext:function(e){var t,a=(t={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ve["a"])(t,"ß","ss"),Object(ve["a"])(t,"ñ","n"),Object(ve["a"])(t,"Ñ","N"),Object(ve["a"])(t,"ö","o"),Object(ve["a"])(t,"Ö","O"),t);if(""==this.supportLanguage||1==this.supportLanguage||3==this.supportLanguage||4==this.supportLanguage){a={};4==this.supportLanguage&&(e=e.replace(/[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]/g,""))}else if(0==this.supportLanguage){var i;a=(i={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ve["a"])(i,"ß","ss"),Object(ve["a"])(i,"ñ","n"),Object(ve["a"])(i,"Ñ","N"),Object(ve["a"])(i,"ö","o"),Object(ve["a"])(i,"Ö","O"),i)}else if(2==this.supportLanguage)a={"á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};for(var n="",r=0;r<e.length;r++)"undefined"==typeof a[e.charAt(r)]?n+=e.charAt(r):n+=a[e.charAt(r)];return""!=n.trim()&&(e=n),e},showtextSpecialSymbol:function(e,t){return this.symbolPosition?1==this.symbolPosition?e=this.specialSymbol+e:e+=this.specialSymbol:("<"!=this.specialSymbol&&"."!=this.specialSymbol&&","!=this.specialSymbol&&"/"!=this.specialSymbol||(e="."==this.specialSymbol&&0==t?e:this.specialSymbol+e),"()"!=this.specialSymbol&&"[]"!=this.specialSymbol&&"{}"!=this.specialSymbol&&"-+"!=this.specialSymbol||(e=""==e.replace(/(^\s*)|(\s*$)/g,"")?"":this.specialSymbol[0]+e+this.specialSymbol[1])),e},lastVariationTransformEn:function(e){var t,a=(t={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ve["a"])(t,"ß","ss"),Object(ve["a"])(t,"ñ","n"),Object(ve["a"])(t,"Ñ","N"),Object(ve["a"])(t,"ö","o"),Object(ve["a"])(t,"Ö","O"),t);if(e.length>1){var i=e.charAt(e.length-1),n={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"};if(void 0!=a[i])return e=e.substr(0,e.length-1)+a[i],e;if(1==this.iscenterchange&&e.length>=3){var r=e.length/2;r=this.isInteger(r)?r-1:r-.5,e=e.substr(0,r)+(void 0==n[e.substr(r,1)]?e.substr(r,1):n[e.substr(r,1)])+e.substr(r+1)}if(1==this.ischange&&"undefined"!=typeof n[i])return e=e.substr(0,e.length-1)+n[i],e}return e},isInteger:function(e){return parseInt(e)==parseFloat(e)},convertCircleTwo:function(e){return(e[0]?e[0].toLowerCase():"")+(e[1]?e[1].toUpperCase():"")},convertCircleThree:function(e){return(e[0]?e[0].toLowerCase():"")+(e[1]?e[1].toUpperCase():"")+(e[2]?this.convertChar(e[2]):"")},convertMonogram:function(e){return(e[0]?e[0].toLowerCase():"")+(e[1]?e[1].toUpperCase():"")+(e[2]?e[2].toLowerCase():"")},initialUpper:function(e){return(e.substr(0,1)?e.substr(0,1).toUpperCase():"")+(e.substr(1)?e.substr(1).toLowerCase():"")},convertChar:function(e){var t={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};void 0!=t[e]&&(e=t[e]);var a={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"0",K:"!",L:"@",M:"#",N:"$",O:"%",P:"^",Q:"&",R:"*",S:"(",T:")",U:"-",V:"+",W:"[",X:"]",Y:"?",Z:";"};return a[e.toUpperCase()]},convertMonogramFive:function(e){var t={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"\\",z:";"};return(e[0]?t[e[0]]:"")+(e[1]?e[1].toLowerCase():"")+(e[2]?e[2].toUpperCase():"")+(e[3]?e[3].toLowerCase():"")+(e[4]?t[e[4]]:"")},setInputVal:function(e){var t=this.specialSymbol,a=this.symbolSave,i=this.symbolPosition,n="";if(1==e){var r=this.text[0].text;if(t&&1==a&&(i?1==i?r=t+r:r+=t:"="==t?r+=t:r="()"==t||"[]"==t||"{}"==t||"-+"==t?""==r.replace(/(^\s*)|(\s*$)/g,"")?"":t[0]+r+t[1]:t+r),this.ischange){var o={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};if(r.length>1){var s=r.charAt(r.length-1);void 0!=o[s]&&(r=r.substr(0,r.length-1)+o[s])}}if(1==this.iscenterchange&&r.length>=3){var l={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"},c=r.length/2;c=this.isInteger(c)?c-1:c-.5,r=r.substr(0,c)+(void 0==l[r.substr(c,1)]?r.substr(c,1):l[r.substr(c,1)])+r.substr(c+1)}n=r}else if(2==e){var d=[this.text[0].text,this.text[1].text];if(t&&1==a)if(i)n=1==i?t+d[0]+"|"+t+d[1]:d[0]+t+"|"+d[1]+t;else{if("/"==t){d=this.text[1].text.length>this.text[0].text.length?[this.text[1].text,this.text[0].text]:d;var h=d[0].length/2;d[0].length%2==1&&(h=(d[0].length-1)/2);var p=d[1].length/2;d[1].length%2==1&&(p=(d[1].length-1)/2),d[0]=d[0].substr(0,h)+"/"+d[0].substr(h),d[1]=d[1].substr(0,p)+"/"+d[1].substr(p),t="|"}n=d[0]+t+d[1]}else n=d[0]+"|"+d[1]}else if(e>2)for(var g=0;g<e;g++)n+=g>0?"|"+this.text[g].text:this.text[g].text;return n},checkQuantity:function(e,t,a){var i=0;return""==e?(console.log("empty"),1):e.length<t?(console.log("str_min"),1):e.length>a?(console.log("str_max"),1):i}}),e}(),it=at,nt={name:"CrystalDialog",props:["param"],components:{},data:function(){return{activeName:"crystal0",crystalHeaderDisplay:"crystalTitleName",dialogWidth:this.param.data.dialogWidth?this.param.data.dialogWidth:"60%",inLoading:1,diamondHeaderDefaultImg:"",previewText:this.param.data.previewText?this.param.data.previewText:"Design Your Own",btnText:this.param.data.btnText?this.param.data.btnText:"Design",crystalHeaderShow:!!this.param.data.crystalHeaderShow&&this.param.data.crystalHeaderShow,crystalClass:"area-carving area-carving-"+this.param.index,crystalCanvasId:"crystalcanvas"+this.param.index,cWidth:this.param.data.cWidth,cHeight:this.param.data.cHeight,baseWidth:this.param.data.baseWidth,crystalTitle:this.param.data.crystalTitle?this.param.data.crystalTitle:"Select",crystalHeader:this.param.data.crystalHeader,diamond:this.param.data.diamond?this.param.data.diamond:"",textTile:this.param.data.textTile,textInputName:this.param.data.textInputName,isMarkup:this.param.data.isMarkup,freeText:this.param.data.freeText,month:this.param.data.month,isSinglelineInput:this.param.data.isSinglelineInput,textWords:this.param.data.textWords,leftText:this.param.data.leftText,productItem:this.param.data.productItem,uploadLoadingImage:this.param.data.uploadLoadingImage,confirmText:this.param.data.confirmText?this.param.data.confirmText:"Add Engravings",lineHeight:this.param.data.lineHeight?this.param.data.lineHeight:1,cancelText:this.param.data.cancelText,addPrice:this.param.data.addPrice,markupId:this.param.data.markupId,type:this.param.data.type,preview:this.param.data.preview,fontFamily:this.param.data.fontFamily,fontFamilyNew:this.param.data.fontFamily,lines:this.param.data.lines,enterName:this.param.data.enterName,requiredField:this.param.data.requiredField,emojiErrorField:this.param.data.emojiErrorField,atLeastText:this.param.data.atLeastText,charactersText:this.param.data.charactersText,changeText:this.param.data.changeText,fontText:this.param.data.fontText?this.param.data.fontText:"Font",nameText:[],showText:[],nameTextMaxLength:[],nameLeftNum:[],text:this.param.data.text,style:this.param.data.style,nameClass:this.param.data.class,code:this.param.data.code,picUrl:this.param.data.picUrl,loadingFullScreen:this.param.data.loadingFullScreen,bgOpacity:this.param.data.bgOpacity,wrapperBackgroudColor:this.param.data.wrapperBackgroudColor,errorWordShow:this.param.data.errorWordShow,errorBorderShow:this.param.data.errorBorderShow,firstUpperCase:this.param.data.firstUpperCase,clearNumberName:this.param.data.clearNumberName,nameTextEmpty:[],nameTextLimit:[],nameEmojiError:[],centerDialogVisible:!1,engravingCrop:[],engravingText:[],diamondColor:[],engravingSize:[],engravingFont:[],fontCode:[],alphaText:[],crystalColor:[],diamondDefaultImg:[],diamondDefaultColor:[],limitNum:[],textList:[],isEmpty:[],isEmojiError:[],percentage:0,base64:"",atLeastField:"",coors:this.param.data.coors,textBorderColor:this.param.data.textBorderColor?this.param.data.textBorderColor:"",isFullscreen:!!this.$device.mobile,engravingSizeOptions:fe["a"].crystal[this.param.index].engravingSizeOptions?fe["a"].crystal[this.param.index].engravingSizeOptions:{},engravingFontOptions:fe["a"].crystal[this.param.index].engravingFontOptions?fe["a"].crystal[this.param.index].engravingFontOptions:{},showSize:!0===fe["a"].crystal[this.param.index].showSize,showFont:!1!==fe["a"].crystal[this.param.index].showFont,imgRequire:!0===fe["a"].crystal[this.param.index].imgRequire,imgRequireNotice:fe["a"].crystal[this.param.index].imgRequireNotice,photosLoad:!0,bgLoad:!1,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,photoLoad:!1}},methods:{open:function(){var e=this,t=JSON.parse(e.$store.getters.getCustomInfo),a=!!t.photo&&t.photo[0].crop;a?(e.centerDialogVisible=!0,fabric.Image.fromURL(a+"?"+Math.random(),function(t){t.scaleX=fe["a"].crystalObj[e.param.index].canvas.width/t.width,t.scaleY=fe["a"].crystalObj[e.param.index].canvas.height/t.height,fe["a"].crystalObj[e.param.index].canvas.setBackgroundImage(t),fe["a"].crystalObj[e.param.index].canvas.requestRenderAll()},{crossOrigin:"Anonymous"})):e.imgRequire?alert(e.imgRequireNotice):e.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openImage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeFont:function(e){var t=this;t.coors.forEach(function(a,i){"CrystalCurve"==fe["a"].crystal[t.param.index].type||"CrystalCurveName"==fe["a"].crystal[t.param.index].type||"CurveName"==fe["a"].crystal[t.param.index].type?fe["a"].crystalObj[t.param.index].changeFont(e,i):"CrystalCarving"!=fe["a"].crystal[t.param.index].type&&"NameCarving"!=fe["a"].crystal[t.param.index].type||fe["a"].crystalObj[t.param.index].changeCarvingFont(e,i)})},changeSize:function(e){var t=this;t.coors.forEach(function(a,i){"CrystalCurve"==fe["a"].crystal[t.param.index].type||"CrystalCurveName"==fe["a"].crystal[t.param.index].type||"CurveName"==fe["a"].crystal[t.param.index].type?fe["a"].crystalObj[t.param.index].changeSize(i,e):"CrystalCarving"==fe["a"].crystal[t.param.index].type&&fe["a"].crystalObj[t.param.index].changeCarvingSize(i,e,t.textList[i])})},getFontFamily:function(e){return"font-family:"+e+";"},changeColor:function(e,t,a){var i=fe["a"].crystalObj[this.param.index].canvas.item(e);this.crystalColor[e]=a,this.$set(this.diamondDefaultImg,e,this.picUrl+a+".png?"+Math.random()),this.$set(this.diamondDefaultColor,e,t),fe["a"].crystalObj[this.param.index].setColor(i,t)},changeTextInput:function(e,t){var a=this;if(1==fe["a"].getLen(t))return!1;if("CrystalCurve"==fe["a"].crystal[this.param.index].type||"CrystalCurveName"==fe["a"].crystal[this.param.index].type||"CurveName"==fe["a"].crystal[this.param.index].type){if("monogram"==fe["a"].crystalObj[this.param.index].path[e].fontFamily){for(var i=t.toUpperCase(),n=[],r=0;r<i.length;r++)" "!=i[r]&&n.push(i[r]);this.textList[e]=n.join(" ")}t=a.formatText(e,t),fe["a"].crystalObj[this.param.index].changeText(t,e)}else"CrystalCarving"!=fe["a"].crystal[this.param.index].type&&"NameCarving"!=fe["a"].crystal[this.param.index].type||fe["a"].crystalObj[this.param.index].changeCarvingText(t,e);this.limitNum[e]=parseInt(this.coors[e].textNum)-t.length},formatText:function(e,t){var a=this;return t.indexOf("❤️")>-1&&(t=t.replace(/❤️/g,"❤"),a.textList[e]=t),t},changeAlphaText:function(e,t){if(1==fe["a"].getLen(t))return!1;var a=e-1;fe["a"].nameObj[this.param.index].process(t,a,this.firstUpperCase),this.nameText[e]=fe["a"].nameObj[this.param.index].text[a].text,this.showText[e]=fe["a"].nameObj[this.param.index].text[a].showText,this.nameLeftNum[e]=parseInt(this.nameTextMaxLength[e])-this.nameText[e].length},checkNametoBase64:function(){var e=this,t=0;if(e.text.forEach(function(a,i){t=1==fe["a"].nameObj[e.param.index].checkQuantity(e.nameText[i+1],a.limit.split("-")[0],a.limit.split("-")[1])}),1==t)return!1;var a=fe["a"].nameObj[e.param.index].setInputVal(e.lines);return a},getCtx:function(){var e=this,t="";e.showText.forEach(function(e,a){t+=" |"+e}),t=t.substring(2);var a=document.getElementById("myCanvas"),i=a.getContext("2d");i.fillStyle="rgba(255,255,255,1)",i.fillRect(0,0,3e3,100);var n=e.nameClass.trim();"silver"==n?(i.fillStyle="#808080",i.font="80px "+e.fontFamilyNew):"gold"==n?(i.fillStyle="#eac855",i.font="80px "+e.fontFamilyNew):"rosegold"==n&&(i.fillStyle="#c8977b",i.font="80px "+e.fontFamilyNew);var r=i.measureText(t).width,o=r+70;i.fillText(t,40,80);var s=document.getElementById("myCanvas2");s.width=o,s.height=100;var l=s.getContext("2d");l.drawImage(a,0,0,o,170,0,0,o,170);var c=s.toDataURL("image/png",.8),d=fe["a"].getFilename(6,!0)+".png";return{base64:c,key:d}},saveCrystal:function(e){var t=this,a=[],i=!0;if(("CrystalName"==t.type||"CrystalCurveName"==t.type||"NameCarving"==t.type||"CurveName"==t.type)&&(t.text.forEach(function(e,a){t.$set(t.nameEmojiError,a,!1),t.$set(t.nameTextLimit,a,!1),t.$set(t.nameTextEmpty,a,!1),t.nameText[a+1]?1==fe["a"].getLen(t.nameText[a+1])?(t.$set(t.nameEmojiError,a,!0),i=!1):t.nameText[a+1].length<parseInt(e.limit.split("-")[0])&&(t.atLeastField=t.atLeastText+e.limit.split("-")[0]+t.charactersText,t.$set(t.nameTextLimit,a,!0),i=!1):(t.$set(t.nameTextEmpty,a,!0),i=!1)}),i)){var n=t.checkNametoBase64();n?(t.alphaText[t.param.index]=n,t.fontCode[t.param.index]=t.code):i=!1}if("CrystalName"!=t.type&&"Crystal"!=t.type||(e=0),this.coors.forEach(function(n,r){e>0?(t.$set(t.isEmojiError,r,!1),t.$set(t.isEmpty,r,!1),t.textList[r]?1==fe["a"].getLen(t.textList[r])&&(t.$set(t.isEmojiError,r,!0),i=!1):(i=!1,t.$set(t.isEmpty,r,!0),t.crystalHeaderShow?t.crystalHeaderDisplay="crystal-input-collapse":t.activeName="crystal-input-collapse"),a.push(t.textList[r])):(t.textList[r]="",fe["a"].crystalObj[t.param.index].changeText("",r))}),t.engravingText[t.param.index]=a.join("|"),!i)return!1;if(t.loadingFullScreen&&(t.centerDialogVisible=!1),t.inLoading=2,t.crystalColor){var r=[];t.crystalColor.forEach(function(e,t){r.push(e)}),t.diamondColor[t.param.index]=r.join("|")}t.base64=fe["a"].crystalObj[this.param.index].canvas.toDataURL({format:"png",quality:.8});var o=fe["a"].getFilename(12),s=o+"-"+this.productItem+".png",l="";l=s?{base64:t.base64,key:s}:t.base64,fe["a"].cdnUpload(l,function(a){t.btnText=t.changeText,t.engravingCrop[t.param.index]=a.picture;var i={};if(t.$store.getters.getCustomInfo&&(i=JSON.parse(t.$store.getters.getCustomInfo)),"NameCarving"==t.type||"CurveName"==t.type){Array.isArray(i.nameCarving)||(i.nameCarving=[]),i.nameCarving[t.param.index]={carvingImage:a.picture,engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],fontCode:t.fontCode[t.param.index],alphaText:t.alphaText[t.param.index]},t.$store.dispatch("setCustomInfo",JSON.stringify(i));var n=t.getCtx();fe["a"].cdnUpload(n,function(e){i.nameCarving[t.param.index].nameCrop=e.picture,t.$store.dispatch("setCustomInfo",JSON.stringify(i))})}else{for(var r in Array.isArray(i.diamond)||(i.diamond=[]),i.diamond[t.param.index]={diamondImage:a.picture,engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],diamondCustom:t.diamondColor[t.param.index],fontCode:t.fontCode[t.param.index],alphaText:t.alphaText[t.param.index]},i.diamond[t.param.index])""==i.diamond[t.param.index][r]&&(delete i.diamond[t.param.index][r],"engravingText"==r&&(delete i.diamond[t.param.index]["engravingSize"],delete i.diamond[t.param.index]["engravingFont"]));if(t.$store.dispatch("setCustomInfo",JSON.stringify(i)),"CrystalName"==t.type){n=t.getCtx();fe["a"].cdnUpload(n,function(a){if(i.diamond[t.param.index].nameCrop=a.picture,t.$store.dispatch("setCustomInfo",JSON.stringify(i)),t.previewText=t.engravingText,t.percentage=0,t.inLoading=1,t.centerDialogVisible=!1,t.markupId){var n=document.getElementById(t.markupId);n.value=e>0?1:0;var r=new Event("change");n.dispatchEvent(r)}e>0?fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:i}):fe["a"].dispatchCustomEvent("EVENT_NO_ENGRAVING",{index:t.param.index,data:i}),"function"===typeof window.carvingCallback&&window.carvingCallback()})}else{if(t.previewText=t.engravingText,t.percentage=0,t.inLoading=1,t.centerDialogVisible=!1,t.markupId){var o=document.getElementById(t.markupId);o.value=e>0?1:0;var s=new Event("change");o.dispatchEvent(s)}e>0?fe["a"].dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:i}):fe["a"].dispatchCustomEvent("EVENT_NO_ENGRAVING",{index:t.param.index,data:i}),"function"===typeof window.carvingCallback&&window.carvingCallback()}}},t)},changeCrystalBg:function(e){var t=this;t.bgLoad=!0,fabric.Image.fromURL(e+"?"+Math.random(),function(e){e.scaleX=fe["a"].crystalObj[t.param.index].canvas.width/e.width,e.scaleY=fe["a"].crystalObj[t.param.index].canvas.height/e.height,fe["a"].crystalObj[t.param.index].canvas.setBackgroundImage(e),fe["a"].crystalObj[t.param.index].canvas.requestRenderAll(),t.bgLoad=!1},{crossOrigin:"Anonymous"})},changeCrystalSku:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=this,i=fe["a"].crystalUrl?fe["a"].crystalUrl:fe["a"].photoUrl,n=i+e+"-OUT.png",r=i+e+"-IN.png";a.photoLoad=!0,fabric.Image.fromURL(r+"?"+Math.random(),function(e){e.scaleX=fe["a"].crystalObj[t].canvas.width/e.width,e.scaleY=fe["a"].crystalObj[t].canvas.height/e.height,fe["a"].crystalObj[t].canvas.setBackgroundImage(e),fe["a"].crystalObj[t].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(n+"?"+Math.random(),function(e){e.scaleX=fe["a"].crystalObj[t].canvas.width/e.width,e.scaleY=fe["a"].crystalObj[t].canvas.height/e.height,fe["a"].crystalObj[t].canvas.setOverlayImage(e),fe["a"].crystalObj[t].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"})},clearCrystal:function(){var e=this;e.engravingCrop[e.param.index]="";var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),"NameCarving"==e.type||"CurveName"==e.type?(Array.isArray(t.nameCarving)||(t.nameCarving=[]),t.nameCarving[e.param.index]={carvingImage:"",engravingText:"",engravingSize:"",engravingFont:"",fontCode:"",alphaText:""}):(Array.isArray(t.diamond)||(t.diamond=[]),t.diamond[e.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:"",fontCode:"",alphaText:""}),e.$store.dispatch("setCustomInfo",JSON.stringify(t)),e.previewText=e.param.data.previewText?e.param.data.previewText:"Design Your Own"}},mounted:function(){var e=this;window.changeCrystalBg=e.changeCrystalBg,window.changeCrystalSku=e.changeCrystalSku,window.clearCrystal=e.clearCrystal,e.diamond&&(e.diamond.forEach(function(t,a){e.crystalColor[a]=t[0].sku}),e.diamond.forEach(function(t,a){e.diamondDefaultImg.push(e.picUrl+t[0].sku+".png?"+Math.random()),e.diamondDefaultColor.push(t[0].color)}),e.diamondHeaderDefaultImg=e.picUrl+e.diamond[0][0].sku+".png?"+Math.random()),e.coors&&(e.coors.forEach(function(t,a){e.limitNum.push(parseInt(t.textNum))}),e.coors.forEach(function(t,a){e.isEmpty.push(!1),e.isEmojiError.push(!1)})),e.text&&e.text.forEach(function(t,a){e.nameTextEmpty.push(!1),e.nameTextLimit.push(!1),e.nameEmojiError.push(!1)}),fe["a"].crystalObj[this.param.index]=new tt({bg:fe["a"].crystal[this.param.index].baseImg,overLay:fe["a"].crystal[this.param.index].overlayImg,cWidth:e.cWidth,cHeight:e.cHeight,baseWidth:e.baseWidth,canvasid:this.crystalCanvasId,defaultFont:fe["a"].crystal[this.param.index].engravingFontOptions[0].value,diamond:fe["a"].crystal[this.param.index].diamondImg,custom:fe["a"].crystal[this.param.index],path:fe["a"].crystal[this.param.index].coors,textBorderColor:e.textBorderColor,lineHeight:e.lineHeight,isSinglelineInput:e.isSinglelineInput,type:e.type,callback:function(t){"NameCarving"==e.type?t.custom["coors"].forEach(function(e,a){t.initCarvingPath()}):"CurveName"==e.type?t.initPath():(t.config["diamond"].forEach(function(a,i){"CrystalCurve"==t.custom.type||"Crystal"==t.custom.type||"CrystalCurveName"==t.custom.type?t.initPath():"CrystalCarving"==t.custom.type&&t.initCarvingPath(),t.setColor(t.canvas.item(i),e.diamondDefaultColor[i])}),e.photosLoad=!1)}}),this.engravingSize[this.param.index]=fe["a"].crystal[this.param.index].engravingSizeOptions[0].value?fe["a"].crystal[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=fe["a"].crystal[this.param.index].engravingFontOptions[0].value?fe["a"].crystal[this.param.index].engravingFontOptions[0].value:"TimesNewRoman","CrystalName"!=e.type&&"CrystalCurveName"!=e.type&&"NameCarving"!=e.type&&"CurveName"!=e.type||(fe["a"].nameObj[this.param.index]=new it({json:this.param.data}),e.text.forEach(function(t,a){e.nameTextMaxLength[a+1]=t.limit.split("-")[1],e.nameLeftNum[a+1]=t.limit.split("-")[1]}));var t={};"NameCarving"==e.type||"CurveName"==e.type?(Array.isArray(t.nameCarving)||(t.nameCarving=[]),t.nameCarving[e.param.index]={carvingImage:"",engravingText:"",engravingSize:"",engravingFont:"",fontCode:"",alphaText:""}):(e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.diamond)||(t.diamond=[]),t.diamond[e.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:"",fontCode:"",alphaText:""}),e.$store.dispatch("setCustomInfo",JSON.stringify(t))}},rt=nt,ot=(a("e24f"),Object(Se["a"])(rt,Je,Ge,!1,null,"2675e031",null)),st=ot.exports,lt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{class:e.curveCarvingClass},[a("div",{staticClass:"area-carving-preview-text"},[this.engravingCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[e.param.index],width:"50"},on:{click:e.openimage}}):a("span",[a("span",{staticClass:"curve-pre-text"},[e._v(e._s(e.previewText))]),a("font",{attrs:{color:"red"}},[e._v("*")])],1)]),a("div",{staticClass:"btn-box",on:{click:e.open}},[e.inputMark?a("span",{staticClass:"input-mark"},[e._v(e._s(e.inputMark))]):e._e(),a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:e.open}},[e._v(e._s(e.btnText))])])]),a("div",{class:e.requireCurveTextClass},[e._v(e._s(e.requirePrompt))]),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}}),a("el-dialog",{class:{loadingDialog:2==e.inLoading},attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[1!=e.inLoading&&e.uploadLoadingImage?e._e():a("div",[a("el-container",[a("el-aside",{attrs:{width:"50%"}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),e.isBig?a("canvas",{staticStyle:{display:"none",position:"absolute",top:"0",left:"0","z-index":"0"},attrs:{id:"bigCurveCarvingCanvasId"}}):e._e()]),a("el-main",{attrs:{width:"50%"}},[a("div",{staticClass:"custom-carving-container"},[a("div",{staticClass:"label-input-text"},[e._v(e._s(e.inputTextLabel))]),e._l(e.coors,function(t,i){return a("div",{key:t.value,staticClass:"textarea-text"},[e.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[index]"}],class:{curveError:e.isEmpty[i]},attrs:{type:"text",placeholder:e.textPlaceHolder,maxlength:t.limit},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},function(t){return e.changeText(i,e.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.textList[i],expression:"textList[index]"}],class:{curveError:e.isEmpty[i]},attrs:{rows:e.rows,resize:e.resize,placeholder:e.textPlaceHolder,maxlength:t.limit},domProps:{value:e.textList[i]},on:{input:[function(t){t.target.composing||e.$set(e.textList,i,t.target.value)},function(t){return e.changeText(i,e.textList[i])}]}}),e.leftText?a("div",{staticClass:"leftnum"},[a("span",{class:"num textNum"+i},[e._v(e._s(e.textNum[i]))]),e._v(" "+e._s(e.leftText))]):e._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:e.curveEmojiError[i]&&e.errorWordShow,expression:"curveEmojiError[index] && errorWordShow"}],staticClass:"curveErrorWord"},[e._v(e._s(e.emojiErrorField))])])}),e.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:e.changeSize},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.showChooseFont,expression:"showChooseFont"}],staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[e._v(e._s(e.fontFamilyLabel))]),a("el-radio-group",{staticClass:"font-radio-group",on:{change:e.changeFont},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},[a("el-col",e._l(e.engravingFontOptions,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1),a("div",[a("el-button",{staticClass:"btn-curve-confirm btn-carving",attrs:{type:"primary",disabled:e.photoLoad||e.bgLoad,loading:e.isLoading},on:{click:e.saveCanvas}},[e._v(e._s(e.confirmText)),e.isMarkup>0?a("span",{staticClass:"is-markup",attrs:{"data-price":e.isMarkup}},[e._v(e._s(e.addPrice))]):e._e()]),e.isMarkup>0?a("el-button",{staticClass:"btn-curve-cancel btn-carving",on:{click:e.cancelCanvas}},[e._v(e._s(e.cancelText))]):e._e()],1),e.please_note?a("div",[a("p",{staticClass:"product-reminder"},[e._v("\n                                    "+e._s(e.please_note)+"\n                                ")]),e.otherNote?a("p",{staticClass:"other-note",domProps:{innerHTML:e._s(e.otherNote)}},[e._v(e._s(e.otherNote))]):e._e()]):e._e()],2)])],1),a("div",{staticClass:"curve-carving-info-container carving-info"},[a("div",{staticClass:"carving-notice"},[e.actionInfo?a("div",{staticClass:"action-info"},[e._v(e._s(e.actionInfo))]):e._e(),e.noteInfo?a("div",{staticClass:"note-info"},[e._v(e._s(e.noteInfo))]):e._e()]),e.handcraftInfo?a("div",{staticClass:"handcraft-info"},[e._v(e._s(e.handcraftInfo))]):e._e()])],1),2==e.inLoading&&!e.soufeelLoadingImage&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:e.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1)]):e._e()]),2==e.inLoading&&e.soufeelLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.soufeelLoadingImage}})])]):e._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:e.curveCarvingCanvasId}})])],1)},ct=[],dt=a("0342"),ht=function(){function e(e){this.picurl=e.picurl,this.cdir="img/textdesign/",this.init(e)}return e.prototype=Object.assign(new Ce["a"],{init:function(e){this.canvas=new fabric.Canvas(e["canvasid"]),this.config=e,this.cWidth=e["cWidth"]||"",this.cHeight=e["cHeight"]||"",this.baseWidth=e["baseWidth"]||"",this.sku=e["sku"]||"",this.type=e["type"]||"",this.baseImg=e["baseImg"]||"",this.path=e["path"]||"",this.scaleNew=e["scaleNew"]||1,this.textpath=[],this.defaultFont=e["font"]||"holyunion",this.defaultFontSize=e["size"]||30,this.pathNum=this.path.length,this.setCanvaSize(),this.setObject(),this.canvas.selection=!1,this.initPath()},setObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;fabric.Image.fromURL(e.baseImg+"?"+Math.random(),function(t){e.canvas.setBackgroundImage(t),"undefined"!==typeof e.config.callbacknew&&t.width>0&&e.config.callbacknew(),e.canvas.requestRenderAll()},{originX:"left",originY:"top",scaleX:e.scale,scaleY:e.scale,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous"})},setTextSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.textpath.forEach(function(t,a){var i=e.path[a].size?e.path[a].size:30;t.setFontSize(i)})},initPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.stage=new Qe.a.Stage({container:"container",width:e.cWidth,height:e.cHeight}),e.layer=new Qe.a.Layer,e.path.forEach(function(t,a){var i=t.path,n=t.size;e.scaleNew>1&&(i=t.bigPath,n=t.size*e.scaleNew);var r=e.defaultFont;"undefined"!=typeof t.family&&t.family&&(r=t.family);var o="undefined"!=typeof t.shadowEnabled&&t.shadowEnabled,s="undefined"!=typeof t.shadowColor?t.shadowColor:"#ffffff",l="undefined"!=typeof t.shadowOffsetX?t.shadowOffsetX:1.5,c="undefined"!=typeof t.shadowOffsetY?t.shadowOffsetY:1.5,d="undefined"!=typeof t.shadowBlur?t.shadowBlur:-10,h="undefined"!=typeof t.shadowOpacity?t.shadowOpacity:1,p="undefined"!=typeof t.fontStyle?t.fontStyle:"normal";if(e.textpath[a]=new Qe.a.TextPath({x:0,y:0,align:"center",fill:t.textColor||"#000",fontSize:n||50,fontFamily:r,text:"",data:i,shadowEnabled:o,shadowColor:s,shadowOffsetX:l,shadowOffsetY:c,shadowBlur:d,shadowOpacity:h,fontStyle:p}),e.layer.add(e.textpath[a]),"undefined"!=typeof t.initialCarving){var g=e.pathNum+a;t.initialCarving.forEach(function(t,a){var i="undefined"!=typeof t.shadowEnabled&&t.shadowEnabled,n="undefined"!=typeof t.shadowColor?t.shadowColor:"#ffffff",r="undefined"!=typeof t.shadowOffsetX?t.shadowOffsetX:1.5,o="undefined"!=typeof t.shadowOffsetY?t.shadowOffsetY:1.5,s="undefined"!=typeof t.shadowBlur?t.shadowBlur:-10,l="undefined"!=typeof t.shadowOpacity?t.shadowOpacity:1,c="undefined"!=typeof t.fontStyle?t.fontStyle:"normal";e.textpath[g+a]=new Qe.a.TextPath({x:0,y:0,align:"center",fill:t.textColor||"#000",fontSize:t.size||50,fontFamily:t.family,text:"",data:t.path,shadowEnabled:i,shadowColor:n,shadowOffsetX:r,shadowOffsetY:o,shadowBlur:s,shadowOpacity:l,fontStyle:c}),e.layer.add(e.textpath[g+a])})}}),e.stage.add(e.layer),e.img=new Image,e.imgObj=new fabric.Image(e.img),e.imgObj.lockMovementX=!0,e.imgObj.lockMovementY=!0,e.imgObj.selectable=!1,e.canvas.add(e.imgObj),e.img.onload=function(){e.imgObj.setElement(e.img),e.imgObj.set({left:0,top:0,scaleX:e.scale,scaleY:e.scale}),e.canvas.renderAll(!0),"undefined"!==typeof e.config.callback&&e.config.callback(e)}},loadAndUse:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0,n=new dt(t);n.load().then(function(){var n=a.textpath[e];n&&(n.setFontFamily(t),a.layer.draw(),a.img.src=a.stage.toDataURL(),e==a.textpath.length-1&&i())}).catch(function(n){console.log(n);var r=a.textpath[e];r&&(r.setFontFamily(t),a.layer.draw(),a.img.src=a.stage.toDataURL(),e==a.textpath.length-1&&i())})},changeFont:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){console.log("ok")};this.loadAndUse(e,t,this,a)},changeSize:function(e,t){var a=this.textpath[e];if(a){a.setFontSize(t),this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}},changeText:function(e,t){if(this.textpath[t].setText(e),"undefined"!=typeof this.path[t].initialCarving){var a=this;this.path[t].initialCarving.forEach(function(i,n){a.textpath[a.pathNum+t+n].setText(e)})}this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}}),e.prototype.constructor=e,e}(),pt=ht,gt={name:"CropDialog",props:["param"],components:{},data:function(){return{inLoading:1,dialogWidth:this.param.data.dialogWidth?this.param.data.dialogWidth:"60%",previewText:this.param.data.previewText?this.param.data.previewText:"Add Engraving",sku:this.param.data.sku,cWidth:this.param.data.cWidth,cHeight:this.param.data.cHeight,baseWidth:this.param.data.baseWidth,uploadLoadingImage:this.param.data.uploadLoadingImage,soufeelLoadingImage:fe["a"].uploadLoadingImage,bgOpacity:fe["a"].bgOpacity?fe["a"].bgOpacity:.5,wrapperBackgroudColor:fe["a"].wrapperBackgroudColor?fe["a"].wrapperBackgroudColor:"#ffffff",isSinglelineInput:this.param.data.isSinglelineInput,leftText:this.param.data.leftText,btnText:this.param.data.btnText?this.param.data.btnText:"Add",btnChangeText:this.param.data.btnChangeText?this.param.data.btnChangeText:"Change",inputMark:this.param.data.inputMark?this.param.data.inputMark:"",inputTextLabel:this.param.data.inputTextLabel?this.param.data.inputTextLabel:"",curveCarvingConfirmText:this.param.data.curveCarvingConfirmText?this.param.data.curveCarvingConfirmText:"Confirm Your Design ",textPlaceHolder:this.param.data.textPlaceHolder?this.param.data.textPlaceHolder:"Type words here... ",fontFamilyLabel:this.param.data.fontFamilyLabel?this.param.data.fontFamilyLabel:"FONT:",curveCarvingClass:"curve-area-carving curve-area-carving-"+this.param.index,curveCarvingCanvasId:"curvecanvas"+this.param.index,isMarkup:this.param.data.isMarkup,addPrice:this.param.data.addPrice,markupId:this.param.data.markupId,please_note:this.param.data.please_note?this.param.data.please_note:"Please Note: No colors or emoji can be used. e.g. A red heart icon will show a heart in color black.",otherNote:this.param.data.otherNote?this.param.data.otherNote:"",rows:this.param.data.rows?this.param.data.rows:1,resize:this.param.data.resize?this.param.data.resize:"none",confirmText:this.param.data.confirmText?this.param.data.confirmText:"Confirm",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",showChooseFont:this.param.data.showChooseFont,dialogVisible:!1,centerDialogVisible:!1,info:"",w:"50px",h:"50px",percentage:0,isLoading:!1,base64:"",blob:"",filename:"",isBig:!1!==fe["a"].curveCarving[this.param.index].isBig,isBigImage:!0===fe["a"].curveCarving[this.param.index].isBigImage,bigBackgroundColor:fe["a"].curveCarving[this.param.index].bigBackgroundColor?fe["a"].curveCarving[this.param.index].bigBackgroundColor:"white",bigParam:!!fe["a"].curveCarving[this.param.index].bigParam&&fe["a"].curveCarving[this.param.index].bigParam,coors:fe["a"].curveCarving[this.param.index].coors,isFullscreen:!!this.$device.mobile,showSize:!0===fe["a"].curveCarving[this.param.index].showSize,showFont:!1!==fe["a"].curveCarving[this.param.index].showFont,engravingCrop:[],engravingBig:[],engravingText:[],engravingSize:[],engravingFont:[],engravingSizeOptions:fe["a"].curveCarving[this.param.index].engravingSizeOptions?fe["a"].curveCarving[this.param.index].engravingSizeOptions:{},engravingFontOptions:fe["a"].curveCarving[this.param.index].engravingFontOptions?fe["a"].curveCarving[this.param.index].engravingFontOptions:{},textNum:[],textList:[],isEmpty:[],bigCurveObj:"",imgRequire:fe["a"].curveCarving[this.param.index].imgRequire,imgRequireNotice:fe["a"].curveCarving[this.param.index].imgRequireNotice,requireCurveTextClass:"require-curve-text require-curve-text-"+this.param.index,requirePrompt:fe["a"].requirePrompt,require:!1!==this.param.data.require,actionInfo:fe["a"].actionInfo?fe["a"].actionInfo:"",noteInfo:fe["a"].noteInfo?fe["a"].noteInfo:"",handcraftInfo:fe["a"].handcraftInfo?fe["a"].handcraftInfo:"",photoLoad:!1,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,emojiErrorField:this.param.data.emojiErrorField,errorWordShow:!0===this.param.data.errorWordShow,curveEmojiError:[],codeArray:fe["a"].codeArray?fe["a"].codeArray:[],bgLoad:!0,oneSide:!1!==this.param.data.oneSide,hasSelect:!0===fe["a"].curveCarving[this.param.index].hasSelect}},methods:{open:function(){var e=this;if(e.oneSide){var t=JSON.parse(e.$store.getters.getCustomInfo),a=!!t.photo&&t.photo[0].crop;a?(e.photoLoad=!0,e.centerDialogVisible=!0,ye["fabric"].Image.fromURL(a+"?"+Math.random(),function(t){t.scaleX=fe["a"].curveCarvingObj[e.param.index].canvas.width/t.width,t.scaleY=fe["a"].curveCarvingObj[e.param.index].canvas.height/t.height,fe["a"].curveCarvingObj[e.param.index].canvas.setBackgroundImage(t),fe["a"].curveCarvingObj[e.param.index].canvas.requestRenderAll(),e.photoLoad=!1},{crossOrigin:"Anonymous"})):e.imgRequire?alert(e.imgRequireNotice):e.centerDialogVisible=!0}else e.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openimage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeText:function(e,t){this.coors[e].isUppercase&&(this.textList[e]=this.textList[e].toUpperCase()),fe["a"].curveCarvingObj[this.param.index].changeText(this.textList[e],e),this.textNum[e]=parseInt(this.coors[e].limit)-this.textList[e].length},changeSize:function(e){var t=this;t.coors.forEach(function(a,i){fe["a"].curveCarvingObj[t.param.index].changeSize(i,e)})},changeFont:function(e){var t=this;t.bgLoad=!0,t.coors.forEach(function(a,i){fe["a"].curveCarvingObj[t.param.index].changeFont(i,e,function(){t.bgLoad=!1})})},getFontFamily:function(e){return"font-family:"+e+";"},saveCanvas:function(){var e=this,t=[],a=!0;if(this.coors.forEach(function(i,n){e.$set(e.curveEmojiError,n,!1),e.textList[n]?1==fe["a"].getLen(e.textList[n],e.codeArray)?(e.$set(e.curveEmojiError,n,!0),a=!1):e.$set(e.isEmpty,n,!1):(a=!1,e.$set(e.isEmpty,n,!0)),t.push(e.textList[n])}),!a)return!1;if(e.engravingText[e.param.index]=t.join("|"),e.soufeelLoadingImage&&(e.centerDialogVisible=!1),e.inLoading=2,e.isBig){var i=JSON.parse(e.$store.getters.getCustomInfo),n=e.bigCurveObj.canvas.width/e.bigParam.width,r=e.bigCurveObj.canvas.height/e.bigParam.height;"undefined"!=typeof i.photo&&e.bigCurveObj.canvas.setBackgroundImage(i.photo[0].ai,e.bigCurveObj.canvas.renderAll.bind(e.bigCurveObj.canvas),{originX:"left",originY:"top",scaleX:n,scaleY:r,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous",callback:function(){e.textList.forEach(function(t,a){e.bigCurveObj.changeText(e.textList[a],a)})}})}else if(e.isBigImage){e.filename=fe["a"].getFilename(6);var o=e.filename+"-"+e.sku+".png",s=new ye["fabric"].Canvas,l=e.filename+"-"+e.sku+"-1.png",c=e.bigParam.width?e.bigParam.width:800;e.bigParam.height&&e.bigParam.height,e.bigParam.fontWeight&&e.bigParam.fontWeight,e.bigParam.fontSize&&e.bigParam.fontSize;s.setWidth(fe["a"].curveCarvingObj[e.param.index].canvas.width),s.setHeight(fe["a"].curveCarvingObj[e.param.index].canvas.height);var d=c/fe["a"].curveCarvingObj[e.param.index].canvas.width;s.loadFromJSON(JSON.stringify(fe["a"].curveCarvingObj[e.param.index].canvas),function(){var t=s.getObjects();t.forEach(function(e){e&&"text"===e.type&&(e.set({left:e.left,top:e.top}),s.renderAll())}),s.setBackgroundImage(null,s.renderAll.bind(s)),s.backgroundColor=e.bigBackgroundColor,s.setOverlayImage(null,s.renderAll.bind(s)),s.renderAll();var a=s.toDataURL({format:"png",multiplier:d,quality:.8}),i=fe["a"].asyncCdnUpload(a,l,null);Promise.all([i]).then(function(t){e.engravingBig[e.param.index]=t[0],console.log(e.engravingBig[e.param.index]),e.base64=fe["a"].curveCarvingObj[e.param.index].canvas.toDataURL({format:"png",quality:.8,multiplier:500/fe["a"].curveCarvingObj[e.param.index].width}),e.blob=fe["a"].curveCarvingObj[e.param.index].convertBase64ToBlob(e.base64);var a="";a=o?{base64:e.base64,key:o}:e.base64,fe["a"].cdnUpload(a,function(t){e.btnText=e.btnChangeText,e.engravingCrop[e.param.index]=t.picture;var a={};if(e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[e.param.index]={engravingCrop:t.picture,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],require:e.param.data.require?e.param.data.require:""},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.percentage=0,e.inLoading=1,e.centerDialogVisible=!1,e.markupId){var i=document.getElementById(e.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}e.hasSelect&&e.$parent.$refs.selectDialog.open(e.param),fe["a"].dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},e)})})}else{e.base64=fe["a"].curveCarvingObj[e.param.index].canvas.toDataURL({format:"png",quality:.8,multiplier:500/fe["a"].curveCarvingObj[e.param.index].width}),e.blob=fe["a"].curveCarvingObj[e.param.index].convertBase64ToBlob(e.base64),e.filename=fe["a"].getFilename(6);o=e.filename+"-"+e.sku+".png";var h="";h=o?{base64:e.base64,key:o}:e.base64,fe["a"].cdnUpload(h,function(t){e.btnText=e.btnChangeText,e.engravingCrop[e.param.index]=t.picture;var a={};if(e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[e.param.index]={engravingCrop:t.picture,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],require:e.param.data.require?e.param.data.require:""},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.percentage=0,e.inLoading=1,e.centerDialogVisible=!1,e.markupId){var i=document.getElementById(e.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}console.log(e.hasSelect),e.hasSelect&&(console.log("--------------"),e.$parent.$refs.selectDialog.open(e.param)),fe["a"].dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},e)}},cancelCanvas:function(){var e=this;this.coors.forEach(function(t,a){e.textList[a]&&(e.textList[a]="",e.changeText(a,""))}),e.previewText=e.param.data.previewText,e.$set(e.engravingCrop,e.param.index,""),e.$set(e.engravingText,e.param.index,"");var t={};if(e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),t.engraving&&delete t.engraving,e.$store.dispatch("setCustomInfo",JSON.stringify(t)),e.markupId){var a=document.getElementById(e.markupId);a.value=0;var i=new Event("change");a.dispatchEvent(i)}e.centerDialogVisible=!1,fe["a"].dispatchCustomEvent("EVENT_CURVE_ENGRAVING_CANCEL_AFTER",{index:e.param.index})},changeBaseImg:function(e,t){var a=this;a.photoLoad=!0,ye["fabric"].Image.fromURL(e,function(e){e.scaleX=fe["a"].curveCarvingObj[a.param.index].canvas.width/e.width,e.scaleY=fe["a"].curveCarvingObj[a.param.index].canvas.height/e.height,fe["a"].curveCarvingObj[a.param.index].canvas.setBackgroundImage(e),fe["a"].curveCarvingObj[a.param.index].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"}),a.$set(a,"sku",t),a.$set(fe["a"].curveCarving[this.param.index],"sku",t)},clearText:function(e,t){fe["a"].curveCarvingObj[this.param.index].changeText(t,e),this.$set(this.textList,e,t)},updateCoors:function(e){var t=this;t.coors.forEach(function(e,a){fe["a"].curveCarvingObj[t.param.index].changeText("",a)}),t.$set(t,"coors",e),fe["a"].curveCarvingObj[t.param.index].path=e,fe["a"].curveCarvingObj[t.param.index].initPath(),e.forEach(function(e,a){fe["a"].curveCarvingObj[t.param.index].changeText(t.textList[a],a)})},clearCurve:function(){var e=this;e.engravingCrop[e.param.index]="";var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.curve_engraving)||(t.curve_engraving=[]),t.curve_engraving[e.param.index]={engravingCrop:"",engravingText:"",engravingSize:"",engravingFont:"",require:e.param.data.require?e.param.data.require:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t)),e.previewText=e.param.data.previewText?e.param.data.previewText:"Add Engraving"}},mounted:function(){var e=this;if(e.coors&&e.coors.forEach(function(t,a){e.textNum.push(parseInt(t.limit)),e.isEmpty.push(!1),e.textList.push(""),e.curveEmojiError.push(!1)}),fe["a"].curveCarvingObj[this.param.index]=new pt({canvasid:this.curveCarvingCanvasId,type:2,sku:fe["a"].curveCarving[this.param.index].sku,baseImg:fe["a"].curveCarving[this.param.index].baseImg,path:fe["a"].curveCarving[this.param.index].coors,cWidth:e.cWidth,cHeight:e.cHeight,baseWidth:e.baseWidth,font:fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value?fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",callbacknew:function(){e.bgLoad=!1}}),e.isBig){var t=e.bigParam.width/e.baseWidth;e.bigCurveObj=new pt({canvasid:"bigCurveCarvingCanvasId",type:2,sku:fe["a"].curveCarving[this.param.index].sku,baseImg:e.baseImg,path:fe["a"].curveCarving[this.param.index].coors,cWidth:e.bigParam.width,cHeight:e.bigParam.height,baseWidth:e.bigParam.width,scaleNew:t,textList:e.textList,font:fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value?fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",callback:function(t){e.base64=t.canvas.toDataURL({format:"png",quality:.8,multiplier:t.canvas.width/e.bigParam.width}),e.blob=t.convertBase64ToBlob(e.base64),e.filename=fe["a"].getFilename(6);var a=e.filename+"-"+e.sku+".png",i="";i=a?{base64:e.base64,key:a}:e.base64,fe["a"].cdnUpload(i,function(t){e.btnText="Change",e.engravingCrop[e.param.index]=t.picture;var a={};if(e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[e.param.index]={engravingCrop:t.picture,engravingBig:e.engravingBig[e.param.index],engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],require:e.param.data.require?e.param.data.require:""},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.previewText=e.engravingText,e.isLoading=!1,e.percentage=0,e.inLoading=1,e.centerDialogVisible=!1,e.markupId){var i=document.getElementById(e.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}console.log(e.hasSelect),e.hasSelect&&(console.log("================="),e.$parent.$refs.selectDialog.open(e.param)),fe["a"].dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},e)}})}this.engravingSize[this.param.index]=fe["a"].curveCarving[this.param.index].engravingSizeOptions[0].value?fe["a"].curveCarving[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value?fe["a"].curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",window.changeBaseImg=e.changeBaseImg,window.clearText=e.clearText,window.updateCoors=e.updateCoors,window.clearCurve=e.clearCurve;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[e.param.index]={engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",require:e.param.data.require?e.param.data.require:""},e.$store.dispatch("setCustomInfo",JSON.stringify(a))},watch:{centerDialogVisible:function(e){!0===e?fe["a"].dispatchCustomEvent("EVENT_CURVE_DIALOG",{index:this.param.index}):fe["a"].dispatchCustomEvent("EVENT_CURVE_DIALOG_CLOSE",{index:this.param.index})}}},mt=gt,ut=(a("72fe"),Object(Se["a"])(mt,lt,ct,!1,null,"7f9cf875",null)),vt=ut.exports,ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.linesArr,function(t,i){return a("div",{key:i},[e.isCrystal?a("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"crystal-list-collapse"+t}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondDefaultImg[t]}}),a("span",[e._v(e._s(e.crystalTitle)+e._s(t+1))])])])]),a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+t},[a("div",{staticClass:"crystal"},e._l(e.diamond[t],function(i,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+e.picUrl+i.sku+".png?123);"}),a("input",{class:"colorful color-"+t,attrs:{"v-model":e.crystalColor[t],"data-index":t,"data-color":i.color,name:"color"+t,type:"radio"},domProps:{value:i.sku},on:{click:function(a){return e.changeColor(t,i.color,i.sku)}}}),a("div",{staticClass:"name"},[e._v(e._s(e.month[n]))])])}),0)])])],2)],1):e._e(),e.isCarving?a("div",[a("div",[a("div",{staticClass:"engravings"},[a("span",[e._v(e._s(e.textInputName)+e._s(t+1))]),e.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:e.textList[t],expression:"textList[c]"}],class:{crystalError:e.isEmpty[t]&&e.errorBorderShow},style:"font-family:"+e.engravingFont[e.param.index],attrs:{maxlength:e.textNum[t],id:"textInput"+t,"data-index":t,placeholder:e.textWords},domProps:{value:e.textList[t]},on:{input:[function(a){a.target.composing||e.$set(e.textList,t,a.target.value)},function(a){return e.changeTextInput(t,e.textList[t])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.textList[t],expression:"textList[c]"}],class:{crystalError:e.isEmpty[t]&&e.errorBorderShow},style:"font-family:"+e.engravingFont[e.param.index],attrs:{maxlength:e.textNum[t],id:"textInput"+t,"data-index":t,placeholder:e.textWords},domProps:{value:e.textList[t]},on:{input:[function(a){a.target.composing||e.$set(e.textList,t,a.target.value)},function(a){return e.changeTextInput(t,e.textList[t])}]}}),a("span",{class:"num textNum"+t},[e._v(e._s(e.limitNum[t])+" "+e._s(e.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isEmpty[t]&&e.errorWordShow,expression:"isEmpty[c] && errorWordShow"}],staticClass:"errorWord"},[e._v(e._s(e.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.isEmojiError[t]&&e.errorWordShow,expression:"isEmojiError[c] && errorWordShow"}],staticClass:"errorWord"},[e._v(e._s(e.emojiErrorField))])])]):e._e()],1)}),e._m(0),e.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size crystal-font-size",attrs:{size:"large"},model:{value:e.engravingSize[e.param.index],callback:function(t){e.$set(e.engravingSize,e.param.index,t)},expression:"engravingSize[param.index]"}},e._l(e.engravingSizeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),e.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[e._v(e._s(e.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},model:{value:e.engravingFont[e.param.index],callback:function(t){e.$set(e.engravingFont,e.param.index,t)},expression:"engravingFont[param.index]"}},[a("el-col",e._l(e.engravingFontOptions,function(t){return a("el-radio",{key:t.value,style:e.getFontFamily(t.value),attrs:{label:t.value,border:""}},[e._v(e._s(t.demo?t.demo:"ABC"))])}),1)],1)],1):e._e(),e.isName?a("div",[a("div",{staticClass:"view-name"},[a("span",[e._v(e._s(e.namePreview)+":")]),a("div",{staticClass:"showtext",attrs:{id:"showtext"}},[e._l(e.linesArr,function(t,i){return a("span",{key:i,class:"showtext-in "+e.nameClass,style:"font-family:"+e.fontFamily[t],attrs:{id:"showtext_"+t}},[e._v(e._s(e.showText[t]))])}),e._v("    \n                ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),e._l(e.linesArr,function(t,i){return a("div",{key:i,staticClass:"carvingcanvas-content"},[a("div",{staticClass:"curve-textarea",class:{crystalError:e.nameTextEmpty[t]&&e.errorBorderShow}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.nameText[t],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+t,type:"text","data-prefix":"ctext","data-index":t,id:"ctext"+t,maxlength:e.nameTextMaxLength[t],placeholder:e.enterName},domProps:{value:e.nameText[t]},on:{input:[function(a){a.target.composing||e.$set(e.nameText,t,a.target.value)},function(a){return e.changeAlphaText(t,e.nameText[t])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+t}},[e._v(e._s(e.nameLeftNum[t]))]),e._v(" "+e._s(e.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextEmpty[t]&&e.errorWordShow,expression:"nameTextEmpty[m] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextLimit[t]&&e.errorWordShow,expression:"nameTextLimit[m] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.atLeastField))])])}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:"3000",height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}})],2):e._e()],2)},xt=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"0px"}},[a("canvas",{staticStyle:{border:"1px solid #ff0000",display:"none"},attrs:{id:"crystalcanvas"}})])}],bt=(a("96cf"),a("3b8d")),Ct={name:"CrystalText",props:["param"],components:{},data:function(){return{activeName:"",crystalHeaderDisplay:"crystalTitleName",isEmpty:[],diamond:this.param.data.diamond?this.param.data.diamond:[],crystalTitle:this.param.data.crystalTitle?this.param.data.crystalTitle:"Select",picUrl:this.param.data.picUrl?this.param.data.picUrl:"https://pic.stylelab.com/img/textdesign/diamond/",month:this.param.data.month?this.param.data.month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],textInputName:this.param.data.textInputName?this.param.data.textInputName:"Name",isSinglelineInput:!1!==this.param.data.isSinglelineInput,leftText:this.param.data.leftText?this.param.data.leftText:"Left",fontText:this.param.data.fontText?this.param.data.fontText:"Font",freeText:this.param.data.freeText?this.param.data.freeText:"free",requiredField:this.param.data.requiredField?this.param.data.requiredField:"This is a required field.",showSize:!0===this.param.data.showSize,showFont:!0===this.param.data.showFont,errorBorderShow:!1!==this.param.data.errorBorderShow,errorWordShow:!0===this.param.data.errorWordShow,engravingSizeOptions:this.param.data.engravingSizeOptions?this.param.data.engravingSizeOptions:[],engravingFontOptions:this.param.data.engravingFontOptions?this.param.data.engravingFontOptions:[],textWords:this.param.data.textWords?this.param.data.textWords:"Type words here...",fontFamily:[],namePreview:this.param.data.namePreview?this.param.data.namePreview:"Preview",isCarving:!0===this.param.data.isCarving,isName:!0===this.param.data.isName,isCrystal:!0===this.param.data.isCrystal,nameClass:this.param.data.class?this.param.data.class:"",text:this.param.data.text?this.param.data.text:[],enterName:this.param.data.enterName?this.param.data.enterName:"Enter Name or text here...",style:this.param.data.style?this.param.data.style:"",atLeastField:"",atLeastText:this.param.data.atLeastText?this.param.data.atLeastText:"At least ",charactersText:this.param.data.charactersText?this.param.data.charactersText:"characters.",textNum:[],diamondDefaultImg:[],crystalColor:[],engravingFont:[],engravingSize:[],engravingText:[],engravingCrop:[],textList:[],limitNum:[],diamondDefaultColor:[],nameTextEmpty:[],nameText:[],nameLeftNum:[],nameTextLimit:[],showText:[],nameTextMaxLength:[],code:[],isEmojiError:[],linesArr:this.param.data.linesArr?this.param.data.linesArr:[0],coors:this.param.data.coors?this.param.data.coors:[],productItem:this.param.data.productItem,emojiErrorField:this.param.data.emojiErrorField,crystalCanvas:""}},methods:{changeColor:function(e,t,a){this.crystalColor[e]=a,this.$set(this.diamondDefaultImg,e,this.picUrl+a+".png"),this.$set(this.diamondDefaultColor,e,t),this.setDiamond()},getFontFamily:function(e){return"font-family:"+e+";"},changeTextInput:function(e,t){if(1==fe["a"].getLen(t))return!1;this.limitNum[e]=parseInt(this.textNum[e])-t.length},changeAlphaText:function(e,t){fe["a"].nameObj[this.param.index].process(t,e,this.firstUpperCase),this.nameText[e]=fe["a"].nameObj[this.param.index].text[e].text,this.showText[e]=fe["a"].nameObj[this.param.index].text[e].showText,this.nameLeftNum[e]=parseInt(this.nameTextMaxLength[e])-this.nameText[e].length},getNameCtx:function(){var e=this,t=new fabric.StaticCanvas("myCanvas");t.setBackgroundColor("#ffffff"),t.selection=!1;var a=[],i=0,n="#808080",r=e.nameClass.trim();"gold"==r?n="#eac855":"rosegold"==r?n="#c8977b":"black"==r&&(n="#000000"),e.showText.forEach(function(t,r){r>0&&(t=" | "+t,i+=a[r-1].width),a[r]=new fabric.Text(t,{left:i,top:10,fontFamily:e.fontFamily[r],fill:n})});var o=new fabric.Group(a,{fontSize:80});t.add(o),t.setHeight(100),t.setWidth(o.width),t.renderAll();var s=fe["a"].convertBase64ToBlob(t.toDataURL({format:"png",quality:.8})),l=fe["a"].getFilename(6,!0)+".png";return{blob:s,filename:l}},checkNameToBase64:function(){var e=this,t=0;if(e.linesArr.forEach(function(a,i){if(!e.nameText[i])return t=1,void e.$set(e.nameTextEmpty,i,!0);(t=1==fe["a"].nameObj[e.param.index].checkQuantity(e.nameText[i],e.text[i].limit.split("-")[0],e.text[i].limit.split("-")[1]))?e.$set(e.nameTextEmpty,i,!0):e.$set(e.nameTextEmpty,i,!1)}),1==t)return!1;var a=fe["a"].nameObj[e.param.index].setInputVal(e.showText.length);return a},checkCode:function(){return this.code.join("|")},checkCarvingText:function(){var e=this,t=0;return e.linesArr.forEach(function(a,i){e.$set(e.isEmpty,i,!1),e.$set(e.isEmojiError,i,!1),e.textList[i]?1==fe["a"].getLen(e.textList[i])&&(e.$set(e.isEmojiError,i,!0),t=1):(t=1,e.$set(e.isEmpty,i,!0))}),1!=t&&(e.engravingText[e.param.index]=e.textList.join("|"),e.engravingText[e.param.index])},setDiamond:function(){var e=this,t=e.diamondDefaultImg.length;e.crystalCanvas.clear(),e.crystalCanvas.setWidth(73*t),e.diamondDefaultImg.forEach(function(t,a){fabric.Image.fromURL(t,function(t){t.lockMovementX=!0,t.lockMovementY=!0,t.selectable=!1,t.scaleX=1,t.scaleY=1,t.left=73*a,t.top=0,e.crystalCanvas.add(t)}.bind(this),{crossOrigin:"anonymous"})})},uploadDiamondImage:function(){var e=Object(bt["a"])(regeneratorRuntime.mark(function e(){var t,a,i,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this,a=t.crystalCanvas.toDataURL({format:"png",quality:.8}),i=fe["a"].convertBase64ToBlob(a),n=fe["a"].getFilename(12),r=new Ce["a"],e.next=7,r.cdnAsyncUpload(function(e,a){var r=n+"-"+t.productItem+".png",o={next:function(e){console.log("ok")},error:function(e){console.log("Upload Error, Please refresh now")},complete:function(e){t.engravingCrop[t.param.index]=fe["a"].qncdn+e.key;var i={};return t.$store.getters.getCustomInfo&&(i=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(i.diamond)||(i.diamond=[]),i.diamond[t.param.index]={diamondImage:fe["a"].qncdn+e.key,engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],diamondCustom:t.crystalColor.join("|")},t.$store.dispatch("setCustomInfo",JSON.stringify(i)),fe["a"].dispatchCustomEvent("EVENT_CRYSTAL_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:i}),a(),!0}},s={region:Ne["region"].na0,concurrentRequestLimit:3},l={fname:"",params:{},mimeType:null},c=Ne["upload"](i,r,e,l,s);c.subscribe(o)});case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),changeNumber:function(e){if(console.log(e),e>0){var t=this,a=t.linesArr.length,i=e-a;if(i>0)for(var n=0;n<i;n++){var r=a+n;t.linesArr.push(r),t.isName&&(t.$set(t.nameTextMaxLength,r,t.text[r].limit.split("-")[1]),t.$set(t.nameLeftNum,r,t.text[r].limit.split("-")[1]),t.$set(t.fontFamily,r,t.text[r].fontFamily),t.$set(t.code,r,t.text[r].code)),t.isCarving&&(t.$set(t.limitNum,r,t.coors[r].textNum),t.$set(t.textNum,r,t.coors[r].textNum)),t.isCrystal&&(t.$set(t.diamondDefaultImg,r,this.picUrl+t.diamond[r][0].sku+".png"),t.$set(t.crystalColor,r,t.diamond[r][0].sku))}else if(i<0)for(var o=a;o>e;o--)t.linesArr.splice(o-1,1),t.isName&&(t.nameText.splice(o-1,1),t.showText.splice(o-1,1),t.code.splice(o-1,1)),t.isCarving&&t.textList.splice(o-1,1),t.isCrystal&&(t.crystalColor.splice(o-1,1),t.diamondDefaultImg.splice(o-1,1));t.isCrystal&&t.setDiamond()}},changeClass:function(e){this.nameClass=e}},mounted:function(){var e=this;if(e.isCrystal){e.linesArr.forEach(function(t,a){e.diamondDefaultImg[t]=e.picUrl+e.diamond[t][0].sku+".png",e.diamondDefaultColor[t]=e.diamond[t][0].color,e.crystalColor[t]=e.diamond[t][0].sku}),e.crystalCanvas=new fabric.Canvas("crystalcanvas"),e.crystalCanvas.setHeight(73),e.crystalCanvas.selection=!1,e.crystalCanvas.renderAll(),e.setDiamond(),window.uploadDiamondImage=this.uploadDiamondImage;var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.diamond)||(t.diamond=[]),t.diamond[e.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t))}e.isCarving&&(e.linesArr.forEach(function(t,a){e.limitNum[t]=e.coors[t].textNum,e.textNum[t]=e.coors[t].textNum,e.isEmpty[t]=!1,e.isEmojiError[t]=!1,e.textList[t]=""}),e.engravingSize[e.param.index]=fe["a"].crystalText[this.param.index].engravingSizeOptions[0].value?fe["a"].crystalText[this.param.index].engravingSizeOptions[0].value:"20",e.engravingFont[e.param.index]=fe["a"].crystalText[this.param.index].engravingFontOptions[0].value?fe["a"].crystalText[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",window.checkCarvingText=this.checkCarvingText),e.isName&&(fe["a"].nameObj[e.param.index]=new it({json:e.param.data}),e.linesArr.forEach(function(t,a){e.$set(e.nameTextMaxLength,t,e.text[t].limit.split("-")[1]),e.$set(e.nameLeftNum,t,e.text[t].limit.split("-")[1]),e.$set(e.fontFamily,t,e.text[t].fontFamily),e.$set(e.code,t,e.text[t].code),e.nameTextEmpty[t]=!1,e.nameTextLimit[t]=!1}),window.getNameCtx=this.getNameCtx,window.checkNameToBase64=this.checkNameToBase64,window.changeClass=this.changeClass,window.checkCode=this.checkCode),window.changeNumber=this.changeNumber}},yt=Ct,wt=(a("4689"),Object(Se["a"])(yt,ft,xt,!1,null,"688800fc",null)),_t=wt.exports,Tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"",width:e.dialogWidth,visible:e.centerDialogVisible,"close-on-click-modal":e.closeOnClickModal,"modal-append-to-body":e.isModalAppendToBody,fullscreen:e.isFullscreen},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("div",{staticClass:"custom-select-container"},[a("div",{staticStyle:{"margin-bottom":"20px","text-align":"center"}},[e.previewPicture?a("div",[a("div",{staticClass:"previewPicture-container"},[a("img",{staticStyle:{width:"247px"},attrs:{src:e.previewPicture}})])]):a("div",[a("div",{staticClass:"lds-ring"},[a("div"),a("div"),a("div"),a("div")]),a("div",{domProps:{innerHTML:e._s(e.renderingText)}})]),e.ifSelectExample?a("div",[a("div",{staticClass:"carving-exaple-text"},[e._v(e._s(e.carvingExampleText))]),a("div",{staticClass:"carving-exaple-img"},e._l(e.carvingExampleImg,function(e,t){return a("img",{key:t,staticClass:"carving-exaple-img-item",attrs:{src:e}})}),0),a("div",{staticClass:"carving-prompt"},[e._v(e._s(e.carvingPrompt))])]):e._e()]),a("div",[a("el-button",{staticClass:"select-open-carving",staticStyle:{background:"#f14b59","border-color":"#f14b59"},attrs:{type:"danger"},on:{click:e.openCarving}},[e._v(e._s(e.selectBtnText))])],1),a("div",{staticStyle:{margin:"5px"}},[e._v(e._s(e.selectOrText))]),a("div",[a("el-button",{staticClass:"select-cancel-carving",staticStyle:{background:"#2f6dd1","border-color":"#2f6dd1"},attrs:{type:"primary"},on:{click:e.cancelCanvas}},[e._v(e._s(e.withoutBtnText))])],1),a("div",{staticClass:"notice-info"},[e._v(e._s(e.noticeInfo))])])])},Ot=[],It={name:"CropDialog",props:["crop-source"],data:function(){return{centerDialogVisible:!1,closeOnClickModal:!0===fe["a"].cropPrompt,params:"",selectOrText:fe["a"].selectOrText?fe["a"].selectOrText:"OR",selectBtnText:fe["a"].selectBtnText?fe["a"].selectBtnText:"Custom text on the bottom +$4.99",withoutBtnText:fe["a"].withoutBtnText?fe["a"].withoutBtnText:"Without text",previewPicture:"",dialogWidth:this.$device.mobile?"100%":"40%",subDialogWidth:this.$device.mobile?"width: 100%; border: 1px solid gray; display: inline-block;":"width: 500px; height:400px; border: 1px solid gray; display: inline-block;",imgStyle:this.$device.mobile?{}:{width:"500px",height:"400px"},isFullscreen:!!this.$device.mobile,renderingText:fe["a"].renderingText?fe["a"].renderingText:"",_json:{},carvingExampleText:fe["a"].carvingExampleText?fe["a"].carvingExampleText:"",carvingExampleImg:fe["a"].carvingExampleImg?fe["a"].carvingExampleImg:"",carvingPrompt:fe["a"].carvingPrompt?fe["a"].carvingPrompt:"",isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,ifSelectExample:!0===fe["a"].ifSelectExample,carvingIndex:0,noticeInfo:fe["a"].carvingNoticeInfo?fe["a"].carvingNoticeInfo:""}},methods:{open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.params=e,this.carvingIndex=t,this.$store.getters.getCustomInfo&&(this._json=JSON.parse(this.$store.getters.getCustomInfo)),this.centerDialogVisible=!0,0!=Object.keys(this._json).length?(console.log(this._json),"undefined"!=typeof this._json.photo?this.previewPicture=this._json.photo[e.index]["crop"]:"undefined"!=typeof this._json.crop?this.previewPicture=this._json.crop[e.index]["crop"]:"undefined"!=typeof this._json.curve_engraving?this.previewPicture=this._json.curve_engraving[e.index]["engravingCrop"]:"undefined"!=typeof this._json.engraving&&(this.previewPicture=this._json.engraving[e.index]["engravingCrop"]),this.centerDialogVisible=!0):console.log("_json object is null")},clearPreviewPicture:function(){this.previewPicture="",this.renderingErroText=""},openCarving:function(){this.centerDialogVisible=!1,this.$parent.$refs.CarvingDialog[this.carvingIndex].open(),fe["a"].dispatchCustomEvent("SELECT_CARVING_AFTER",{data:1})},cancelCanvas:function(){this.centerDialogVisible=!1,fe["a"].dispatchCustomEvent("SELECT_CARVING_AFTER",{data:0})}},mounted:function(){}},Et=It,St=(a("b36f"),Object(Se["a"])(Et,Tt,Ot,!1,null,"475d19a0",null)),kt=St.exports,jt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[0==e.photoStyle?a("div",{class:e.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[e.photoCrop[e.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:e.photoCrop[e.param.index],width:"50",height:"40"},on:{click:e.openimage}}):a("span",{staticClass:"area-photo-upload-text"},[e._v(e._s(e.uploadLabel)),a("font",{attrs:{color:"red"}},[e._v("*")])],1)]),a("div",{staticClass:"area-photo-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[e._v(e._s(this.btnUploadText))])])],1)]):e._e(),1==e.photoStyle?a("div",{staticClass:"area-photo-upload-rect"},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload}},[this.photoCrop[this.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai"},[a("img",{staticClass:"avatar",attrs:{src:this.photoCrop[this.param.index]}})]):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1):e._e(),a("div",{class:e.requirePromptTextClass},[e._v(e._s(e.requirePrompt))]),a("el-dialog",{attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt"},[e._v(e._s(e.cropPrompt))]),a("div",[a("el-collapse",{attrs:{accordion:""},model:{value:e.crystalHeaderDisplay,callback:function(t){e.crystalHeaderDisplay=t},expression:"crystalHeaderDisplay"}},[a("el-collapse-item",{attrs:{name:"crystalTitleName"}},[a("template",{staticClass:"crystal-header",slot:"title"},[a("div",{staticClass:"crystal-header-title-box"},[a("div",{staticClass:"crystal-header-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondHeaderDefaultImg}}),a("span",[e._v(e._s(e.crystalHeader))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[e._v(e._s(e.freeText))])])]),a("el-collapse",{attrs:{accordion:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.diamond,function(t,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:e.diamondDefaultImg[i]}}),a("span",[e._v(e._s(e.crystalTitle)+e._s(i+1))])])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},e._l(t,function(t,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+e.picUrl+t.sku+".png?456);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":e.crystalColor[i],"data-index":i,"data-color":t.color,name:"color"+i,type:"radio"},domProps:{value:t.sku},on:{click:function(a){return e.changeColor(i,t.color,t.sku)}}}),a("div",{staticClass:"name"},[e._v(e._s(e.month[n]))])])}),0)])])])],2)}),1)],2)],1)],1),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1),a("div",{staticClass:"fuzzyMsg"},[e._v(e._s(e.fuzzyMsg))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:function(t){e.centerDialogVisible=!1}}},[e._v(e._s(e.photoCancelText))]),a("el-button",{staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:e.isLoading},on:{click:e.photoImage}},[e._v(e._s(e.photoConfirmText))])],1)]),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:e.photoCanvasId}})])],1)},Lt=[],At=function(){function e(e){this.init(e)}return e.prototype=Object.assign(new Ce["a"],{request:{},init:function(e){this.canvas=new fabric.Canvas(e["canvasid"]),this.cWidth=e.cWidth,this.cHeight=e.cHeight,this.baseImg=!!e.baseImg&&e.baseImg,this.type=e.type,this.sku=e.sku,this.bgcolor=e.bgcolor?e.bgcolor:"",this.ainame=e.ainame?e.ainame:"",this.isAiLucid=e.isAiLucid?e.isAiLucid:0,this.hasCropImg=!0===e.hasCropImg,this.diamond=e.diamond,this.config=e,this.setCanvaSize(),this.setObject(this,this.baseImg),this.setBindMethod(this)},setObject:function(e,t){this.setCanvaSize(),e.canvas.setOverlayImage(t,e.canvas.renderAll.bind(e.canvas),{originX:"left",originY:"top",scaleX:e.scale,scaleY:e.scale,crossOrigin:"anonymous"});var a=0;e.diamond[a]&&e.setDiamond(a),e.canvas.on("object:selected",function(t){e.canvas.set("preserveObjectStacking",!1),e.canvas.renderAll()}),e.canvas.on("object:modified",function(t){var a=t.target;e.canvas.set("preserveObjectStacking",!0),e.canvas.sendToBack(a),e.canvas.renderAll(),e.setCoor()})},getMouseCoords:function(e){var t=this.canvas.getPointer(e.e),a=t.x,i=t.y;console.log(a+", "+i)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},adjuster:function(e){var t=this.getBs();if(t){switch(e){case"move-left":t.set({left:t.left-5});break;case"move-right":t.set({left:t.left+5});break;case"move-up":t.set({top:t.top-5});break;case"move-down":t.set({top:t.top+5});break;case"zoom-big":t.set({scaleX:t.scaleX+.01,scaleY:t.scaleY+.01});break;case"zoom-small":t.set({scaleX:t.scaleX-.01,scaleY:t.scaleY-.01});break;case"rotate-left":t.set({angle:t.angle-45}).setCoords();break;case"rotate-right":t.set({angle:t.angle+45}).setCoords();break;case"reset":t.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords();break}this.setCoor()}},rotate:function(e){var t=this.getBs();if(t){var a="rotate_left"==e?-45:45;t.set({angle:t.angle+a}).setCoords(),this.setCoor()}},reset:function(){var e=this.getBs();e&&(e.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords(),this.setCoor())},setBindMethod:function(e){this.listenWheel(this,!0)},compress:function(e,t){var a=new Image;a.src=t,a.onload=function(){var a=.5,i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height),t=i.toDataURL("image/png",a),e.request.originImage=t}},change:function(e,t){if(e.compress(e,t),e.canvas.getObjects().length>0)var a=this.getBs();console.log("obj.filters====="+a.filters),!a||"image"!==a.type||"undefined"!=typeof a.filters&&""!=a.filters?fabric.Image.fromURL(t,function(t){t.hasControls=!1,t.hasBorders=!1,t.set({originX:"center",originY:"center"}),e.scale=e.height>t.height?1:e.height/t.height,t.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale}),e.canvas.add(t),e.canvas.sendToBack(t),e.canvas.renderAll(),e.setCoor()}.bind(this),{crossOrigin:"anonymous"}):a.setSrc(t,function(){e.scale=e.height>a.height?1:e.height/a.height,a.set({left:e.width/2,top:e.height/2,scaleX:e.scale,scaleY:e.scale}),e.canvas.renderAll(!0),e.setCoor()})},setCoor:function(){var e=this.getBs();e&&(this.request.scaleX=e.scaleX,this.request.scaleY=e.scaleY,this.request.left=e.left,this.request.top=e.top,this.request.angle=e.angle,this.canvas.renderAll())},addObject:function(e,t){fabric.Image.fromURL(t[0],function(a){a.set({originX:"center",originY:"center"}),1==e.isMobile?a.set({left:e.width/2,top:e.height/2,scaleX:150/a.width,scaleY:150/a.width}):a.set({left:e.cWidth/2,top:e.cHeight/2,scaleX:300/a.width,scaleY:300/a.width});var i=t[1],n=e.canvas.item(i);a.opacity=t[2],a.selectable=t[3],a.hasBorders=t[4],a.hasControls=t[5],e.canvas.remove(n).add(a).moveTo(a,i).renderAll(),e.setCoor()})},listenWheel:function(e,t){var a=e.canvas.wrapperEl;if(void 0!=a){var i=function(t){var a=0;t=window.event||t,a=t.detail?-t.detail/3:t.wheelDelta/120;t.preventDefault&&t.preventDefault();var i=e.getBs();if(i){a=a/200;return i.width*i.scaleX>=50||a>0?(i.scaleX+=a,i.scaleY+=a):(i.scaleX=.01,i.scaleY=.01),i.setCoords(),e.setCoor(),!1}},n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.attachEvent?a.attachEvent("on"+n,i,t):a.addEventListener&&a.addEventListener(n,i,t)}},setDiamond:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;fabric.Image.fromURL(t.diamond[e],function(a){a.lockMovementX=!0,a.lockMovementY=!0,a.selectable=!1,a.scaleX=t.scale,a.scaleY=t.scale,t.canvas.add(a),e++,t.diamond[e]?t.setDiamond(e):t.config.callback(t)}.bind(this),{crossOrigin:"anonymous"})},getColor:function(e){var t={pomegranate:["#4d0875","0.011618","-0.235405","0.713477","-1.59"],hyacinth:["#4d0875","-0.0981","-0.0471","0.474296","-0.086"],bodegablue:["#006291","-0.000145","0.101801","-0.000145","0"],whitezirconium:["#4d0875","-0.01975","0.011618","-1","-0.524"],greenzirconium:["#4d0875","-0.086407","-0.160906","0.180221","-0.85"],pink:["#4d0875","-0.133459","0.172379","-0.039355","-1.604"],redsteel:["#4d0875","-0.204037","-0.243247","0.99971","-1.654"],olive:["#4d0875","-0.192274","-0.015829","-0.05896","-1.148"],bluezirconium:["#4d0875","-0.243247","-0.231484","0.368429","-0.322"],rosered:["#4d0875","-0.078565","-0.05896","0.733082","0.198"],champagne:["#4d0875","-0.141301","0.062591","0.733082","0.662"],spinel:["#4d0875","-0.035434","-0.086407","0.611531","1.646"],alexred:["#4d0875","0.023381","-0.211879","0.301772","-1.62"],alexpinkishpurple:["#130141","-0.031513","-0.031513","-0.337351","0"],alexseablue:["#4d0875","0.023381","-0.055039","-0.721609","-0.414"],alexwhite:["#4d0875","0.023381","-0.055039","-1","-0.414"],alexgreen:["#4d0875","-0.070723","-0.376561","0.552716","1.234"],alexlightpurple:["#4d0875","-0.011908","-0.149143","-0.478507","1.776"],alexrosepink:["#4d0875","0.101801","-0.086407","-0.160906","-1.66"],alexolive:["#4d0875","-0.000145","-0.13738","0.082196","-1.148"],alexblue:["#4d0875","-0.125617"," -0.125617"," 0.152774","1.582"],alexpink:["#4d0875","0.117485","0.015539","-0.68632","-1.52"],alexamber:["#4d0875","0.074354","-0.145222","0.168458","0.554"],alexlightblue:["#4d0875","0.074354","-0.047197","-0.109933","1.428"],originalwhite:["#707070","0.37235","0.117485","-0.000145","0"],originalcolorwhite:["#13e8ff","0.168458","0.13709","0.391955","0.136"],originalcolorblue:["#0b7477","0.270404","-0.000145","0.168458","0.034"],originallightyellow:["#7d6504","0.050828","0.035144","0.662504","0.034"],originalolive:["#4d0875","0.007697","-0.05896","-0.317746","-1.094"],originalperidot:["#4d0875","0.007697","-0.05896","-0.705925","-1.094"],originalaquamarine:["#016f7a","0.37235","0.117485","-0.000145","0"],originalblack:["#000000","0.13709","-0.031513","0.391955","-0.066"],originalblackdiamond:["#4d0875","-0.004066","-0.25501","-1","0.444"],originalred:["#750000","0.015539","-0.102091","-0.000145","0"],originalcitrine:["#b47501","-0.015829","-0.133459","-0.000145","0"],originalgold:["#4d0875","-0.207958","0.13709","0.517427","0.7"],originalstarlite:["#005757","0.050828","0.035144","0.662504","0.034"],originalblue:["#070093","0.37235","0.035144","0.391955","-0.066"],originalgreen:["#003939","-0.000145","0.066512","0.188063","-0.1"],originalrosered:["#4d0875","-0.188353","0.011618","0.41156"," 0.244"],originalcymbidium:["#4d0875","-0.188353","-0.325588","0.05867","1.606"],originalpinkishpurple:["#400080","-0.000145","0.050828","-0.000145","-0.1"],originallightred:["#750000","0.37235","0.117485","-0.000145","0"],originallightrosered:["#e37bbc","0.37235","0.117485","-0.000145","0"],originallightpurple:["#4d0875","-0.125617","0.070433","-0.404008","-2"],originalpink:["#70384b","-0.082486","0.117485","-0.423613","0"],originalpurplishred:["#930453","0.25472","0.101801","-0.000145","0"],originalviolet:["#4d0875","-0.102091","0.109643","-0.494191","-1.946"],originalpurple:["#6206d2","0.37235","0.035144","0.391955","0.034"],brightred:["#ff0000","-0.01975","0.104644","-0.031513","0"],purplevelvet:["#99004d","0.046907","-0.05896","-0.000145","0"],shallowbluejade:["#3d5ccb","-0.000145","0.101801","-0.000145","0"],newwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],emerald:["#0b5334","0.102091","-0.153064","-0.37264","0.096"],greyviolet:["#b02d68","-0.007987","0.090038","-0.129538","0.122"],darkred:["#6c0000","0.184142","-0.074644","-0.031513","-0.012"],fruitgreen:["#0c6d0c","-0.153064","0.082196","-0.37264","0.014"],cobaltblue:["#0c419a","0.046907","-0.05896","-0.000145","0"],softred:["#840042","-0.031513","-0.01975","-0.37264","0.096"],yellow:["#4d0875","-0.141301","0.062591","0.733082","0.662"],jadeblue:["#4f84aa","-0.007987","-0.074644","-0.007987","0"]};return t[e]},setColor:function(e,t){var a=this.getColor(t);e.filters=[];var i=new fabric.Image.filters.BlendColor({color:a[0],mode:"add",alpha:1}),n=new fabric.Image.filters.Contrast({contrast:a[1]}),r=new fabric.Image.filters.Brightness({brightness:a[2]}),o=new fabric.Image.filters.Saturation({saturation:a[3]}),s=new fabric.Image.filters.HueRotation({rotation:a[4]});e.filters.push(i),e.applyFilters(),this.canvas.renderAll(),e.filters.push(n),e.applyFilters(),this.canvas.renderAll(),e.filters.push(r),e.applyFilters(),this.canvas.renderAll(),e.filters.push(o),e.applyFilters(),this.canvas.renderAll(),e.filters.push(s),e.applyFilters(),this.canvas.renderAll()}}),e.prototype.constructor=e,e}(),Ft=At,Nt={name:"CropDialog",props:["param"],data:function(){var e;return e={uploadLabel:fe["a"].uploadLabel?fe["a"].uploadLabel:"Upload your Photo",btnUploadText:fe["a"].btnUploadText?fe["a"].btnUploadText:"Upload",photoCancelText:fe["a"].photoCancelText?fe["a"].photoCancelText:"Cancel",photoConfirmText:fe["a"].photoConfirmText?fe["a"].photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,requirePromptTextClass:"require-prompt-text require-prompt-text-"+this.param.index,photoStyle:fe["a"].photoCrystal[this.param.index].style?fe["a"].photoCrystal[this.param.index].style:0,checkFuzzy:!!fe["a"].photoCrystal[this.param.index].checkFuzzy&&fe["a"].photoCrystal[this.param.index].checkFuzzy,currentLanguage:fe["a"].photoCrystal[this.param.index].currentLanguage?fe["a"].photoCrystal[this.param.index].currentLanguage:"en",isUpload:0,isLoading:!1,photoBase64:"",cropPrompt:!1===fe["a"].cropPrompt?"":fe["a"].cropPrompt,requirePrompt:!1===fe["a"].requirePrompt?"":fe["a"].requirePrompt,imgSrc:"",photoCrop:[],photoAi:[],photoOrigin:[],diamondColor:[],photoCanvasId:"photo-canvas-"+this.param.index},Object(ve["a"])(e,"isLoading",!1),Object(ve["a"])(e,"dialogWidth",this.$device.mobile?"100%":"40%"),Object(ve["a"])(e,"isFullscreen",!!this.$device.mobile),Object(ve["a"])(e,"centerDialogVisible",!1),Object(ve["a"])(e,"percentage",0),Object(ve["a"])(e,"fuzzyMsg",""),Object(ve["a"])(e,"picUrl",this.param.data.picUrl),Object(ve["a"])(e,"activeName","crystal0"),Object(ve["a"])(e,"crystalHeaderDisplay","crystalTitleName"),Object(ve["a"])(e,"diamond",this.param.data.diamond?this.param.data.diamond:""),Object(ve["a"])(e,"diamondHeaderDefaultImg",""),Object(ve["a"])(e,"crystalTitle",this.param.data.crystalTitle?this.param.data.crystalTitle:"Select"),Object(ve["a"])(e,"crystalHeader",this.param.data.crystalHeader),Object(ve["a"])(e,"freeText",this.param.data.freeText),Object(ve["a"])(e,"month",this.param.data.month),Object(ve["a"])(e,"diamondDefaultImg",[]),Object(ve["a"])(e,"diamondDefaultColor",[]),Object(ve["a"])(e,"crystalColor",[]),Object(ve["a"])(e,"isCloseOnClickModal",!1!==fe["a"].isCloseOnClickModal),e},mounted:function(){var e=this;e.diamond&&(e.diamond.forEach(function(t,a){e.crystalColor[a]=t[0].sku,e.diamondDefaultImg.push(e.picUrl+t[0].sku+".png?"+Math.random()),e.diamondDefaultColor.push(t[0].color)}),e.diamondHeaderDefaultImg=e.picUrl+e.diamond[0][0].sku+".png?"+Math.random()),fe["a"].photoCrystalObj[this.param.index]=new Ft({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",cWidth:500,cHeight:400,diamond:this.param.data.diamondImg,callback:function(t){t.diamond.forEach(function(a,i){t.setColor(t.canvas.item(i),e.diamondDefaultColor[i])})}});var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.photoCrystal)||(t.photoCrystal=[]),t.photoCrystal[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",ai:"",origin:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t))},methods:{avatarUpload:function(e){var t=this,a=this,i=new FileReader;i.onload=function(e){t.centerDialogVisible=!0,t.photoBase64=e.target.result,t.checkFuzzy&&t.checkImageFuzzy(t.photoBase64),_zenConfig.photoCrystalObj[a.param.index].change(_zenConfig.photoCrystalObj[a.param.index],t.photoBase64)},i.readAsDataURL(e.file)},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openimage:function(){this.$parent.openimage(this.photoCrop[this.param.index])},doAction:function(e){"reset"==e?this.getBs().set({left:fe["a"].photoCrystalObj[this.param.index].canvas.width/2,top:fe["a"].photoCrystalObj[this.param.index].canvas.height/2,angle:0}).setCoords():"left"==e?this.getBs().set({angle:this.getBs().angle-45}).setCoords():"right"==e?this.getBs().set({angle:this.getBs().angle+45}).setCoords():"sub"==e?this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords():"add"==e&&this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),fe["a"].photoCrystalObj[this.param.index].canvas.renderAll()},getBs:function(){return fe["a"].photoCrystalObj[this.param.index].canvas.item(0)},photoImage:function(){var e=this;this.isLoading=!0;var t=fe["a"].photoCrystalObj[e.param.index].getBs();e.sendImgBack(),fe["a"].awUpload({width:fe["a"].photoCrystalObj[e.param.index].cWidth,height:fe["a"].photoCrystalObj[e.param.index].cHeight,scaleX:t.scaleX*fe["a"].photoCrystalObj[e.param.index].cWidth/fe["a"].photoCrystalObj[e.param.index].width,scaleY:t.scaleY*fe["a"].photoCrystalObj[e.param.index].cWidth/fe["a"].photoCrystalObj[e.param.index].width,left:t.left*fe["a"].photoCrystalObj[e.param.index].cWidth/fe["a"].photoCrystalObj[e.param.index].width,top:t.top*fe["a"].photoCrystalObj[e.param.index].cWidth/fe["a"].photoCrystalObj[e.param.index].width,angle:t.angle,type:fe["a"].photoCrystalObj[e.param.index].type,sku:fe["a"].photoCrystalObj[e.param.index].sku,ainame:fe["a"].photoCrystalObj[e.param.index].ainame||"",isAiLucid:fe["a"].photoCrystalObj[e.param.index].isAiLucid||0,bgcolor:fe["a"].photoCrystalObj[e.param.index].bgcolor||"",origin_data:fe["a"].photoCrystalObj[e.param.index].request.originImage},function(t){if(e.photoAi[e.param.index]=fe["a"].awcdn+t.ai,e.photoOrigin[e.param.index]=fe["a"].awcdn+t.origin,e.crystalColor){var a=[];e.crystalColor.forEach(function(e,t){a.push(e)}),e.diamondColor[e.param.index]=a.join("|")}e.base64=fe["a"].photoCrystalObj[e.param.index].canvas.toDataURL({format:"png",quality:.8});var i=fe["a"].getFilename(12),n=i+"-"+e.param.data.sku+".png",r="";r=n?{base64:e.base64,key:n}:e.base64,fe["a"].cdnUpload(r,function(t){e.photoCrop[e.param.index]=t.picture;var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.photoCrystal)||(a.photoCrystal=[]),a.photoCrystal[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:e.photoCrop[e.param.index],ai:e.photoAi[e.param.index],origin:e.photoOrigin[e.param.index],diamondCustom:e.diamondColor[e.param.index],item:e.param.data.sku},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),e.centerDialogVisible=!1,e.isLoading=!1,e.percentage=0,fe["a"].dispatchCustomEvent("EVENT_PHOTO_CRYSTAL_SAVE_AFTER",{index:e.param.index,data:a})},e)},e)},sendImgBack:function(){var e=this,t=fe["a"].photoCrystalObj[e.param.index].getBs();fe["a"].photoCrystalObj[e.param.index].canvas.set("preserveObjectStacking",!0),fe["a"].photoCrystalObj[e.param.index].canvas.sendToBack(t),fe["a"].photoCrystalObj[e.param.index].canvas.renderAll()},checkImageFuzzy:function(e){var t=this;this.fuzzyMsg&&gtag("event","Fuzzy_Photo_Change",{event_category:"website"}),this.fuzzyMsg="",this.$ajax({method:"post",async:!1,url:"https://ai.soufeel.com/tencent/fuzzy?_language="+this.currentLanguage,data:{image:e}}).then(function(e){e.data.fuzzy&&(t.fuzzyMsg=e.data.msg,gtag("event","Fuzzy_Photo_Show",{event_category:"website"}))}).catch(function(e){console.log(e)})},changeColor:function(e,t,a){this.sendImgBack();var i=parseInt(e)+1,n=fe["a"].photoCrystalObj[this.param.index].canvas.item(i);this.crystalColor[e]=a,this.$set(this.diamondDefaultImg,e,this.picUrl+a+".png?"+Math.random()),this.$set(this.diamondDefaultColor,e,t),fe["a"].photoCrystalObj[this.param.index].setColor(n,t)}}},Pt=Nt,Dt=(a("1bbc"),Object(Se["a"])(Pt,jt,Lt,!1,null,"677fe106",null)),Bt=Dt.exports,zt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"name-carving-container"},[a("div",{staticClass:"view-name"},[a("span",[e._v(e._s(e.preview)+":")]),a("div",{staticClass:"showtext",style:"font-family:"+e.fontFamily,attrs:{id:"showtext"}},[e._l(e.lines,function(t){return a("span",{key:t,class:"showtext-in "+e.nameClass,style:e.style,attrs:{id:"showtext_"+t}},[e._v(e._s(e.showText[t]))])}),e._v("    \n        ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),a("div",{staticClass:"namecanvas-content",class:{first:1==e.lines}},e._l(e.lines,function(t){return a("div",{key:t,staticClass:"pr"},[a("div",{staticClass:"name-textarea",class:{nameError:(e.nameTextEmpty[t-1]||e.nameTextLimit[t-1]||e.nameEmojiError[t-1])&&e.errorBorderShow}},[e.isrometime?a("input",{directives:[{name:"model",rawName:"v-model",value:e.nameText[t],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+t,type:"text","data-prefix":"ctext","data-index":t,id:"ctext"+t,maxlength:e.nameTextMaxLength[t],placeholder:e.placeHolder[t-1]},domProps:{value:e.nameText[t]},on:{input:function(a){a.target.composing||e.$set(e.nameText,t,a.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:e.nameText[t],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+t,type:"text","data-prefix":"ctext","data-index":t,id:"ctext"+t,maxlength:e.nameTextMaxLength[t],placeholder:e.placeHolder[t-1]},domProps:{value:e.nameText[t]},on:{input:[function(a){a.target.composing||e.$set(e.nameText,t,a.target.value)},function(a){return e.changeAlphaText(t,e.nameText[t])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+t}},[e._v(e._s(e.nameLeftNum[t]))]),e._v(" "+e._s(e.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextEmpty[t-1]&&e.errorWordShow,expression:"nameTextEmpty[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameTextLimit[t-1]&&e.errorWordShow,expression:"nameTextLimit[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.atLeastField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.nameEmojiError[t-1]&&e.errorWordShow,expression:"nameEmojiError[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[e._v(e._s(e.emojiErrorField))])])}),0),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:e.nameFillrectWidth,height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}})])},$t=[];a("b9c1"),a("4e8c"),a("2b78"),a("ad94");var Mt={name:"CrystalDialog",props:["param"],components:{},data:function(){return{showText:[],nameText:[],nameTextMaxLength:[],nameLeftNum:[],nameTextEmpty:[],nameTextLimit:[],nameEmojiError:[],fontCode:[],alphaText:[],preview:this.param.data.preview,fontFamily:this.param.data.fontFamily,fontFamilyNew:this.param.data.fontFamily,nameClass:this.param.data.class,lines:this.param.data.lines,errorBorderShow:this.param.data.errorBorderShow,enterName:this.param.data.enterName,requiredField:this.param.data.requiredField,emojiErrorField:this.param.data.emojiErrorField,atLeastField:"",atLeastText:this.param.data.atLeastText,charactersText:this.param.data.charactersText,errorWordShow:this.param.data.errorWordShow,firstUpperCase:this.param.data.firstUpperCase,code:this.param.data.code,productItem:this.param.data.productItem,text:this.param.data.text,leftText:this.param.data.leftText,style:this.param.data.style,isrometime:!0===this.param.data.isrometime,placeHolder:this.param.data.placeHolder?this.param.data.placeHolder:[],nowText:this.param.data.nowText?this.param.data.nowText:"Now",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",setText:this.param.data.setText?this.param.data.setText:"Set",dayText:this.param.data.dayText?this.param.data.dayText:"Day",monthText:this.param.data.monthText?this.param.data.monthText:"Day",yearText:this.param.data.yearText?this.param.data.yearText:"Day",dateLang:this.param.data.dateLang?this.param.data.dateLang:"en",nameCtxWidth:this.param.data.nameCtxWidth?this.param.data.nameCtxWidth:100,nameCtxHeight:this.param.data.nameCtxHeight?this.param.data.nameCtxHeight:120,nameFillrectWidth:this.param.data.nameFillrectWidth?this.param.data.nameFillrectWidth:1e4}},methods:{changeAlphaText:function(e,t){if(1==fe["a"].getLen(t))return!1;var a=e-1;fe["a"].nameObj[this.param.index].process(t,a,this.firstUpperCase),this.nameText[e]=fe["a"].nameObj[this.param.index].text[a].text,this.showText[e]=fe["a"].nameObj[this.param.index].text[a].showText,this.nameLeftNum[e]=parseInt(this.nameTextMaxLength[e])-this.nameText[e].length},checkNametoBase64:function(){var e=this,t=0;if(e.text.forEach(function(a,i){t=1==fe["a"].nameObj[e.param.index].checkQuantity(e.nameText[i+1],a.limit.split("-")[0],a.limit.split("-")[1])}),1==t)return!1;var a=fe["a"].nameObj[e.param.index].setInputVal(e.lines);return a},getCtx:function(e){var t=this,a="";t.showText.forEach(function(e,t){a+=" |"+e}),a=a.substring(2);var i=document.getElementById("myCanvas"),n=i.getContext("2d");n.fillStyle="rgba(255,255,255,1)",n.fillRect(0,0,t.nameFillrectWidth,t.nameCtxHeight),console.log("nameClassVal===",e);var r=e.trim();""==r&&(r=t.nameClass),"silver"==r?(n.fillStyle="#808080",n.font="80px "+t.fontFamilyNew):"gold"==r?(n.fillStyle="#eac855",n.font="80px "+t.fontFamilyNew):"rosegold"==r&&(n.fillStyle="#c8977b",n.font="80px "+t.fontFamilyNew);var o=n.measureText(a).width;console.log("txtWidth============",o);var s=o+t.nameCtxWidth;n.fillText(a,40,80);var l=document.getElementById("myCanvas2");l.width=s,l.height=t.nameCtxHeight;var c=l.getContext("2d");c.drawImage(i,0,0,s,170,0,0,s,170);var d=l.toDataURL("image/png",.8);return d},saveNameCanvas:function(){var e=Object(bt["a"])(regeneratorRuntime.mark(function e(){var t,a,i,n,r,o,s,l=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:this.nameClass,a=this,i=!0,a.text.forEach(function(e,t){a.$set(a.nameEmojiError,t,!1),a.$set(a.nameTextLimit,t,!1),a.$set(a.nameTextEmpty,t,!1),a.nameText[t+1]?1==fe["a"].getLen(a.nameText[t+1])?(a.$set(a.nameEmojiError,t,!0),i=!1):a.nameText[t+1].length<parseInt(e.limit.split("-")[0])&&(a.atLeastField=a.atLeastText+e.limit.split("-")[0]+a.charactersText,a.$set(a.nameTextLimit,t,!0),i=!1):(a.$set(a.nameTextEmpty,t,!0),i=!1)}),i&&(n=a.checkNametoBase64(),n?(a.alphaText[a.param.index]=n,a.fontCode[a.param.index]=a.code):i=!1),i){e.next=7;break}return e.abrupt("return",!1);case 7:return r=a.getCtx(t),o=fe["a"].convertBase64ToBlob(r),s=new Ce["a"],e.next=12,s.cdnAsyncUpload(function(e,t){var i=fe["a"].getFilename(12)+".png",n={next:function(e){console.log("ok")},error:function(e){console.log("Upload Error, Please refresh now")},complete:function(e){var i={};a.$store.getters.getCustomInfo&&(i=JSON.parse(a.$store.getters.getCustomInfo)),Array.isArray(i.nameCarving)||(i.nameCarving=[]),i.nameCarving[a.param.index]={nameCrop:fe["a"].qncdn+e.key,fontCode:a.fontCode[a.param.index],alphaText:a.alphaText[a.param.index]},a.$store.dispatch("setCustomInfo",JSON.stringify(i)),fe["a"].dispatchCustomEvent("EVENT_NAME_CARVING_SAVE_AFTER",{index:a.param.index,data:i}),t()}},r={region:Ne["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l=Ne["upload"](o,i,e,s,r);l.subscribe(n)});case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){var e=this,t=!1;e.placeHolder.length<1&&(t=!0),e.text.forEach(function(a,i){e.nameTextEmpty.push(!1),e.nameTextLimit.push(!1),e.nameEmojiError.push(!1),e.nameTextMaxLength[i+1]=a.limit.split("-")[1],e.nameLeftNum[i+1]=a.limit.split("-")[1],t&&e.placeHolder.push(e.enterName)}),fe["a"].nameObj[this.param.index]=new it({json:this.param.data});var a={};e.$store.getters.getCustomInfo&&(a=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(a.nameCarving)||(a.nameCarving=[]),a.nameCarving[e.param.index]={nameCrop:"",fontCode:e.fontCode[e.param.index],alphaText:e.alphaText[e.param.index]},e.$store.dispatch("setCustomInfo",JSON.stringify(a)),window.saveNameCanvas=e.saveNameCanvas,e.isrometime&&($(".alpha_text").each(function(t,a){var i=t+1,n=(new Date).getFullYear(),r={date:{preset:"date"},datetime:{preset:"datetime"},time:{preset:"time"}};r.default={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"dd-mm-yyyy",lang:e.dateLang,showNow:!0,headerText:!1,startYear:n-50,endYear:n+10,yearText:e.yearText,monthText:e.monthText,dayText:e.dayText,setText:e.setText,cancelText:e.cancelText,nowText:e.nowText,onSelect:function(t,a){fe["a"].dispatchCustomEvent("EVENT_TIME_SELECT_AFTER",{index:e.param.index,data:t})}},jQuery("#ctext"+i).mobiscroll(jQuery.extend(r["date"],r["default"]))}),$(".alpha_text").bind("change",function(){var t=$(this).data("index"),a=parseInt(t)-1;fe["a"].nameObj[e.param.index].process($(this).val(),a,e.firstUpperCase),e.nameText[t]=fe["a"].nameObj[e.param.index].text[a].text,e.showText[t]=fe["a"].nameObj[e.param.index].text[a].showText,e.nameLeftNum[t]=parseInt(e.nameTextMaxLength[t])-e.nameText[t].length,$(this).val(fe["a"].nameObj[e.param.index].text[a].text),$("#showtext_"+t).html(0==fe["a"].nameObj[e.param.index].text[a].showText.indexOf("<")?fe["a"].nameObj[e.param.index].text[a].showText.replace(/</,"&lt;"):fe["a"].nameObj[e.param.index].text[a].showText),$("#leftnum"+t).html($(this).attr("maxlength")-fe["a"].nameObj[e.param.index].text[a].text.length<0?0:$(this).attr("maxlength")-fe["a"].nameObj[e.param.index].text[a].text.length)}))}},Wt=Mt,Ut=(a("3a11"),Object(Se["a"])(Wt,zt,$t,!1,null,"b4c913a6",null)),Rt=Ut.exports,qt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"photo-box"},[a("div",{class:e.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[this.flipCrop?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.flipCrop,width:"50",height:"40"},on:{click:function(t){return e.openimage()}}}):e._e(),this.flipCrop?a("i",{staticClass:"show-img-icon",on:{click:function(t){return e.openimage()}}}):e._e(),this.flipCrop?e._e():a("span",{staticClass:"area-photo-upload-text"},[e._v(e._s(e.uploadLabel)),a("font",{attrs:{color:"red"}},[e._v("*")])],1)]),a("div",{staticClass:"area-photo-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.avatarUpload,accept:e.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[e._v(e._s(this.btnUploadText))])])],1)]),a("el-dialog",{attrs:{title:"",visible:e.centerDialogVisible,width:e.dialogWidth,fullscreen:e.isFullscreen,"close-on-click-modal":e.isCloseOnClickModal,"modal-append-to-body":e.isModalAppendToBody,center:""},on:{"update:visible":function(t){e.centerDialogVisible=t},opened:e.onOpened}},[e.titleText?a("div",{staticClass:"title-box"},[e._v(e._s(e.titleText))]):e._e(),a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{directives:[{name:"show",rawName:"v-show",value:e.toolShow,expression:"toolShow"}],staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(t){return e.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt photo-prompt",domProps:{innerHTML:e._s(e.cropPrompt)}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:e.percentage}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:e.cancelCanvas}},[e._v(e._s(e.photoCancelText))]),a("el-button",{staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:e.inLoading,disabled:e.photoLoad},on:{click:e.photoImage}},[e._v(e._s(e.photoConfirmText))])],1)]),e.inLoading&&e.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+e.wrapperBackgroudColor+";opacity:"+e.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:e.uploadLoadingImage}})])]):e._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("div",{staticClass:"flip-canvas-container"},[a("canvas",{attrs:{id:e.photoCanvasId}}),a("canvas",{attrs:{id:e.flipPhotoCanvasId}})])])],1)},Vt=[],Ht={name:"FlipphotoDialog",props:["param"],data:function(){return{photoCanvasId:"photo-flip-canvas-"+this.param.index,flipPhotoCanvasId:"flip-photo-canvas-"+this.param.index,uploadLabel:fe["a"].flipPhoto[this.param.index].uploadLabel?fe["a"].flipPhoto[this.param.index].uploadLabel:fe["a"].uploadLabel?fe["a"].uploadLabel:"Upload your Photo",btnUploadText:fe["a"].btnUploadText?fe["a"].btnUploadText:"Upload",changeText:fe["a"].changeText?fe["a"].changeText:"Change",photoCancelText:fe["a"].photoCancelText?fe["a"].photoCancelText:"Cancel",photoConfirmText:fe["a"].photoConfirmText?fe["a"].photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,titleText:this.param.data.titleText?this.param.data.titleText:"",inLoading:!1,photoBase64:"",cropPrompt:fe["a"].cropPrompt?fe["a"].cropPrompt:"",flipCrop:"",photoCrop:[],photoAi:[],photoOrigin:[],flipPhotoObj1:"",flipPhotoObj2:"",dialogWidth:this.$device.mobile?"100%":"40%",centerDialogVisible:!1,percentage:0,isFullscreen:!!this.$device.mobile,bgOpacity:fe["a"].bgOpacity?fe["a"].bgOpacity:.5,wrapperBackgroudColor:fe["a"].wrapperBackgroudColor?fe["a"].wrapperBackgroudColor:"#ffffff",uploadLoadingImage:fe["a"].uploadLoadingImage?fe["a"].uploadLoadingImage:"",require:!1!==this.param.data.require,photoLoad:!1,isCloseOnClickModal:!1!==fe["a"].isCloseOnClickModal,isModalAppendToBody:!1!==fe["a"].isModalAppendToBody,uploadAccept:fe["a"].uploadAccept?fe["a"].uploadAccept:"",dpi:this.param.data.dpi?this.param.data.dpi:72,coverPhoto:!0===fe["a"].coverPhoto,isLockRotate:!0===this.param.data.isLockRotate,toolShow:!1!==this.param.data.toolShow}},mounted:function(){var e=this;e.flipPhotoObj1=new _e({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:e.coverPhoto,isLockRotate:e.isLockRotate}),e.flipPhotoObj2=new _e({canvasid:this.flipPhotoCanvasId,type:1,baseImg:this.param.data.flipBasePhotoImg,sku:this.param.data.flipSku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:e.coverPhoto,isLockRotate:e.isLockRotate,flipX:!0,selectable:!1});var t={};e.$store.getters.getCustomInfo&&(t=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(t.flipPhoto)||(t.flipPhoto=[]),t.flipPhoto[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",crop:"",origin:"",ai:"",flipAi:"",item:""},e.$store.dispatch("setCustomInfo",JSON.stringify(t)),window.changeFlipPhotoSku=this.changeFlipPhotoSku},methods:{cancelCanvas:function(){var e=this;e.centerDialogVisible=!1,fe["a"].dispatchCustomEvent("EVENT_FLIP_PHOTO_CANCEL_AFTER",{index:e.param.index})},avatarUpload:function(e){var t=this,a=this,i=new FileReader;i.onload=function(e){a.centerDialogVisible=!0,t.photoBase64=e.target.result;var i=t.photoBase64;a.flipPhotoObj1.change(a.flipPhotoObj1,i),a.flipPhotoObj2.change(a.flipPhotoObj2,i)},i.readAsDataURL(e.file)},onOpened:function(){var e=this;this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody),e.flipPhotoObj1.canvas.on("mouse:wheel",function(t){var a=t.target;a&&(e.getBs2().set({scaleX:a.scaleX,scaleY:a.scaleY}).setCoords(),e.flipPhotoObj2.canvas.renderAll())});var t=e.getBs().left;e.flipPhotoObj1.canvas.on("object:moving",function(a){var i=a.target;i&&(e.getBs2().set({left:t-(i.left-t),top:i.top}).setCoords(),e.flipPhotoObj2.canvas.renderAll())}),e.flipPhotoObj1.canvas.on("touch:gesture",function(t){var a=t.target;a&&(e.getBs2().set({scaleX:a.scaleX,scaleY:a.scaleY,angle:0-a.angle}).setCoords(),e.flipPhotoObj2.canvas.renderAll())})},openimage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.flipCrop;this.$parent.openimage(e)},doAction:function(e){var t=this;"reset"==e?(this.getBs().set({left:t.flipPhotoObj1.canvas.width/2,top:t.flipPhotoObj1.canvas.height/2,angle:0,scaleX:t.flipPhotoObj1.scale,scaleY:t.flipPhotoObj1.scale}).setCoords(),this.getBs2().set({left:t.flipPhotoObj2.canvas.width/2,top:t.flipPhotoObj2.canvas.height/2,angle:0,scaleX:t.flipPhotoObj2.scale,scaleY:t.flipPhotoObj2.scale}).setCoords()):"left"==e?(this.getBs().set({angle:this.getBs().angle-45}).setCoords(),this.getBs2().set({angle:this.getBs2().angle+45}).setCoords()):"right"==e?(this.getBs().set({angle:this.getBs().angle+45}).setCoords(),this.getBs2().set({angle:this.getBs2().angle-45}).setCoords()):"sub"==e?(this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords(),this.getBs2().set({scaleX:this.getBs2().scaleX-.01,scaleY:this.getBs2().scaleY-.01}).setCoords()):"add"==e&&(this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),this.getBs2().set({scaleX:this.getBs2().scaleX+.01,scaleY:this.getBs2().scaleY+.01}).setCoords()),t.flipPhotoObj1.canvas.renderAll(),t.flipPhotoObj2.canvas.renderAll()},getBs:function(){return this.flipPhotoObj1.canvas.item(0)},getBs2:function(){return this.flipPhotoObj2.canvas.item(0)},photoImage:function(){var e=this;e.uploadLoadingImage&&(e.centerDialogVisible=!1),e.inLoading=!0;var t=e.flipPhotoObj1.request.originImage,a=e.getBs(),i=e.getBs2();fe["a"].awUpload({width:e.flipPhotoObj1.cWidth,height:e.flipPhotoObj1.cHeight,scaleX:a.scaleX*e.flipPhotoObj1.cWidth/e.flipPhotoObj1.width/e.flipPhotoObj1.request.scale,scaleY:a.scaleY*e.flipPhotoObj1.cWidth/e.flipPhotoObj1.width/e.flipPhotoObj1.request.scale,left:a.left*e.flipPhotoObj1.cWidth/e.flipPhotoObj1.width,top:a.top*e.flipPhotoObj1.cWidth/e.flipPhotoObj1.width,angle:a.angle,type:e.flipPhotoObj1.type,sku:e.flipPhotoObj1.sku,ainame:e.flipPhotoObj1.ainame||"",isAiLucid:e.flipPhotoObj1.isAiLucid||0,bgcolor:e.flipPhotoObj1.bgcolor||"",origin_data:t,isAiColor:e.flipPhotoObj1.isAiColor||"",isBgImg:e.isBgImg,dpi:e.dpi},function(a){void 0==a.crop?e.photoCrop[e.param.index]="":e.photoCrop.push(fe["a"].awcdn+a.crop),void 0==a.ai?e.photoAi[e.param.index]="":e.photoAi[e.param.index]=fe["a"].awcdn+a.ai,void 0==a.origin?e.photoOrigin[e.param.index]="":e.photoOrigin[e.param.index]=fe["a"].awcdn+a.origin;var n={};e.$store.getters.getCustomInfo&&(n=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(n.flipPhoto)||(n.flipPhoto=[]),n.flipPhoto[e.param.index]={type:e.param.data.type?e.param.data.type:"",require:e.param.data.require?e.param.data.require:"",ai:e.photoAi[e.param.index],origin:e.photoOrigin[e.param.index]},fe["a"].awUpload({width:e.flipPhotoObj2.cWidth,height:e.flipPhotoObj2.cHeight,scaleX:i.scaleX*e.flipPhotoObj2.cWidth/e.flipPhotoObj2.width/e.flipPhotoObj2.request.scale,scaleY:i.scaleY*e.flipPhotoObj2.cWidth/e.flipPhotoObj2.width/e.flipPhotoObj2.request.scale,left:i.left*e.flipPhotoObj2.cWidth/e.flipPhotoObj2.width,top:i.top*e.flipPhotoObj2.cWidth/e.flipPhotoObj2.width,angle:i.angle,type:e.flipPhotoObj2.type,sku:e.flipPhotoObj2.sku,ainame:e.flipPhotoObj2.ainame||"",isAiLucid:e.flipPhotoObj2.isAiLucid||0,bgcolor:e.flipPhotoObj2.bgcolor||"",origin_data:t,isAiColor:e.flipPhotoObj2.isAiColor||"",isBgImg:e.isBgImg,dpi:e.dpi,flip:"x"},function(t){void 0==t.crop?e.photoCrop[e.param.index]="":e.photoCrop.push(fe["a"].awcdn+t.crop),void 0==t.ai?n.flipPhoto[e.param.index].flipAi="":n.flipPhoto[e.param.index].flipAi=fe["a"].awcdn+t.ai;var a=new fabric.Canvas,i=2*e.flipPhotoObj2.cWidth,r=[],o=0,s=e.flipPhotoObj2.cWidth,l=e.flipPhotoObj2.cHeight;a.setWidth(i).setHeight(l),e.photoCrop.forEach(function(e,t){var i=new Promise(function(t,i){fabric.Image.fromURL(e,function(e){e.scaleToHeight(l),a.add(e),a.renderAll(),t()}.bind(this),{crossOrigin:"anonymous",left:o})});r.push(i),o+=s});var c=new Ce["a"];Promise.all(r).then(function(){var t=Object(bt["a"])(regeneratorRuntime.mark(function t(i){var r,o,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:console.log(i,"1111"),r=a.toDataURL({format:"png",quality:.8}),o=fe["a"].convertBase64ToBlob(r),s="scrop/"+(new Date).Format("yyyyMMdd")+"/"+fe["a"].randomString(6),c.cdnAsyncUpload(function(t,a){var i=s+"-"+e.flipPhotoObj1.sku+".png",r={next:function(e){console.log("ok")},error:function(e){console.log(e.message)},complete:function(t){a(),e.flipCrop=fe["a"].qncdn+t.key,n.flipPhoto[e.param.index].crop=e.flipCrop,e.$store.dispatch("setCustomInfo",JSON.stringify(n)),e.centerDialogVisible=!1,e.inLoading=!1,e.percentage=0,e.btnUploadText=e.changeText,fe["a"].dispatchCustomEvent("EVENT_FLIP_PHOTO_SAVE_AFTER",{index:e.param.index,data:n})}},l=Ne["upload"](o,i,t,Ce["a"].util.putExtra,Ce["a"].util.config);l.subscribe(r)});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},e)},e)}},watch:{centerDialogVisible:function(e){!0===e?fe["a"].dispatchCustomEvent("EVENT_FLIP_PHOTO_DIALOG",{index:this.param.index}):fe["a"].dispatchCustomEvent("EVENT_FLIP_PHOTO_DIALOG_CLOSE",{index:this.param.index})}}},Yt=Ht,Xt=(a("fcc6"),Object(Se["a"])(Yt,qt,Vt,!1,null,null,null)),Jt=Xt.exports,Gt={name:"PhotoCarving",components:{PhotoDialog:je,CarvingDialog:ze,CropDialog:Xe,CrystalDialog:st,CurveCarvingDialog:vt,CrystalText:_t,SelectDialog:kt,PhotoCrystalDialog:Bt,NameCarvingDialog:Rt,FlipPhotoDialog:Jt},data:function(){return Object(ve["a"])({photoItems:fe["a"].photo,carvingItems:fe["a"].carving,cropItems:fe["a"].crop,crystalItems:fe["a"].crystal,curveCarvingItems:fe["a"].curveCarving,crystalTextItems:fe["a"].crystalText,photoCrystalItems:fe["a"].photoCrystal,nameCarvingItems:fe["a"].nameCarving,flipPhotoItems:fe["a"].flipPhoto,photoStyle:fe["a"].photo.style?fe["a"].photo.style:0,isLoading:!1,btnUploadText:"Upload",photoBase64:"",imgSrc:"",photoCrop:this.$store.getters.getPhotoCrop,photoAi:this.$store.getters.getPhotoAi,photoOrigin:this.$store.getters.getPhotoOrigin,cropType:1,previewText:"Add Engraving",dialogVisible:!1,centerDialogVisible:!1,info:"",w:"50px",h:"50px"},"btnUploadText","Add")},methods:{openimage:function(e){var t=this.$createElement;this.$msgbox({title:"",message:t("p",null,[t("img",{attrs:{src:e},style:"width: 95%; height: 95%;"})]),showConfirmButton:!1,center:!0,callback:function(){fe["a"].dispatchCustomEvent("EVENT_PREVIEW_DIALOG_CLOSE",{})}}),fe["a"].dispatchCustomEvent("EVENT_PREVIEW_DIALOG",{})}}},Kt=Gt,Qt=(a("a03d"),Object(Se["a"])(Kt,me,ue,!1,null,null,null)),Zt=Qt.exports,ea={name:"app",components:{PhotoCarving:Zt}},ta=ea,aa=Object(Se["a"])(ta,pe,ge,!1,null,null,null),ia=aa.exports;i["default"].use(n["a"]),ce.a.use(se.a),i["default"].use(re),i["default"].use(he.a),i["default"].config.productionTip=!1,i["default"].prototype.$ajax=Oe.a,new i["default"]({store:d,render:function(e){return e(ia)}}).$mount("#zen-photocarving")},"5bd0":function(e,t,a){"use strict";var i=a("673e"),n=a.n(i);n.a},"641e":function(e,t,a){"use strict";var i=a("bdb0"),n=a.n(i);n.a},"673e":function(e,t,a){},"69e3":function(e,t,a){},"6c3a":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("a481"),core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es6_regexp_replace__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("28a5"),core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es6_regexp_split__WEBPACK_IMPORTED_MODULE_1__),F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("bd86"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ac6a"),core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_web_dom_iterable__WEBPACK_IMPORTED_MODULE_3__),konva__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("362d"),konva__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(konva__WEBPACK_IMPORTED_MODULE_4__),_zen_base_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("3996"),FontFaceObserver=__webpack_require__("0342"),ucarving=function(){function _uqcarving(e){this.init(e)}return _uqcarving.prototype=Object.assign(new _zen_base_js__WEBPACK_IMPORTED_MODULE_5__["a"],{init:function(e){this.canvas=new fabric.Canvas(e["canvasid"],{enableRetinaScaling:!1}),this.cWidth=e.cWidth||500,this.cHeight=e.cHeight||400,this.fixWidth=e.fixWidth||"",this.coors=e.custom.coors||150,this.imgIn=!!e.in&&e.in,this.imgOut=!!e.out&&e.out,this.sku=e.sku||"",this.textHasControls=e.textHasControls,this.centeredScaling=e.centeredScaling,this.originX=e.originX,this.originY=e.originY,this.fontColor=e.fontColor,this.type=e.type||"",this.isOption=e.custom.isOption||"0",this.checkLimitAreaNewFlag=e.checkLimitAreaNew,this.customIcons=e.customIcons,this.baseWidth=e.baseWidth||"",this.fixWidth=e.fixWidth||"",this.path=e.path,this.textpath=[],this.imageSrc=e.imageSrc,this.templateOut=e.templateOut,this.templateCoord=e.templateCoord,this.isBigCarving=e.isBigCarving||0,this.callback=e.callback||!1,this.coorsNum=this.coors.length,this.text=[],this.setCanvaSize(),this.setObject(this,this.imgIn,this.imgOut),this.canvas.selection=!1,this.path.length>0&&this.initPath(this)},setObject:function(e,t,a){e.templateOut&&e.imageSrc&&(a=e.imageSrc),e.isBigCarving>0?(fabric.Image.fromURL(a+"?"+Math.random(),function(t){t.scaleX=e.canvas.width/t.width,t.scaleY=e.canvas.height/t.height,e.canvas.setOverlayImage(t),e.canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(t+"?"+Math.random(),function(t){t.scaleX=e.canvas.width/t.width,t.scaleY=e.canvas.height/t.height,e.canvas.setBackgroundImage(t),1==e.isBigCarving&&(t.hasControls=!1,t.hasBorders=!1,t.set({left:0,top:0,lockMovementX:!0,lockMovementY:!0,selectable:!1}),e.canvas.add(t),e.canvas.sendToBack(t)),e.callback&&t.width>0&&e.callback(),e.canvas.requestRenderAll()},{crossOrigin:"Anonymous"})):(fabric.Image.fromURL(a+"?"+Math.random(),function(t){t.scaleX=e.cWidth/t.width*e.scale,t.scaleY=e.cHeight/t.height*e.scale,e.canvas.setOverlayImage(t),e.canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(t+"?"+Math.random(),function(t){t.scaleX=e.cWidth/t.width*e.scale,t.scaleY=e.cHeight/t.height*e.scale,e.canvas.setBackgroundImage(t),e.callback&&t.width>0&&e.callback(),e.canvas.requestRenderAll()},{backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"Anonymous"})),e.coors.forEach(function(t,a){var i=t.angle||0,n=t.size*e.scale||20,r=t.font||"TimesNewRoman",o=!1;e.textHasControls&&(o=!0);var s=!1;e.centeredScaling&&(s=!0);var l="center";e.originX&&(l=e.originX);var c="center";e.originY&&(c=e.originY),e.customIcons&&(fabric.Object.prototype.drawControls=function(t,a){a=a||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,o=a.cornerSize||this.cornerSize,s=-(n+o)/2,l=-(r+o)/2,c=("undefined"!==typeof a.transparentCorners?a.transparentCorners:this.transparentCorners,"undefined"!==typeof a.hasRotatingPoint?a.hasRotatingPoint:this.hasRotatingPoint);t.save(),t.strokeStyle=t.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,a.cornerDashArray||this.cornerDashArray,null);var d=new Image;d.src=e.customIcons[0],t.drawImage(d,s,l,this.cornerSize,this.cornerSize);var h=new Image;h.src=e.customIcons[1],t.drawImage(h,s+n,l,this.cornerSize,this.cornerSize);var p=new Image;p.src=e.customIcons[2],t.drawImage(p,s,l+r,this.cornerSize,this.cornerSize);var g=new Image;if(g.src=e.customIcons[3],t.drawImage(g,s+n,l+r,this.cornerSize,this.cornerSize),!this.get("lockUniScaling")){var m=new Image;m.src=e.customIcons[4],t.drawImage(m,s+n/2,l,this.cornerSize,this.cornerSize);var u=new Image;u.src=e.customIcons[5],t.drawImage(u,s+n/2,l+r,this.cornerSize,this.cornerSize);var v=new Image;v.src=e.customIcons[6],t.drawImage(v,s+n,l+r/2,this.cornerSize,this.cornerSize);var f=new Image;f.src=e.customIcons[7],t.drawImage(f,s,l+r/2,this.cornerSize,this.cornerSize)}if(c){var x=new Image;x.src=e.customIcons[8],t.drawImage(x,s+n/2,l-this.rotatingPointOffset,this.cornerSize,this.cornerSize)}return t.restore(),this});var d=0;"undefined"!=typeof t.bigFlag&&(d=t.bigFlag);var h="undefined"!=typeof t.lineHeight?t.lineHeight:1,p="undefined"!=typeof t.fontWeight?t.fontWeight:"normal";if(e.coors[a].isWrap?e.text[a]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,left:t.left*e.scale,top:t.top*e.scale,angle:i,hasControls:o,borderColor:"#EEE",borderDashArray:[5,10],fontSize:n,fill:t.textColor||e.fontColor,limitArea:t.limitArea,lineHeight:h,fontWeight:p}):e.text[a]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:l,originY:c,centeredScaling:s,left:t.left*e.scale,top:t.top*e.scale,angle:i,hasControls:o,borderColor:"#EEE",borderDashArray:[5,10],fontSize:n,fill:t.textColor||e.fontColor,limitArea:t.limitArea,bigFlag:d,lineHeight:h,fontWeight:p}),console.log(e.text[a]),"undefined"!=typeof e.coors[a].initialCarving&&e.coors[a].initialCarving){var g=e.coorsNum+a,m="normal";"undefined"!=typeof e.coors[a].initialCarving.fontWeight&&(m=e.coors[a].initialCarving.fontWeight),e.text[g]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center",centeredScaling:!1,left:e.coors[a].initialCarving.left*e.scale,top:e.coors[a].initialCarving.top*e.scale,angle:e.coors[a].initialCarving.angle||0,hasControls:!1,borderColor:"#EEE",borderDashArray:[5,10],fontSize:e.coors[a].initialCarving.size*e.scale,fill:e.coors[a].initialCarving.color||e.fontColor,fontWeight:m}),1==e.coors[a].initialCarving.banDrag&&(e.text[g].lockMovementX=!0,e.text[g].lockMovementY=!0,e.text[g].set("borderScaleFactor",0));var u=e.coors[a].initialCarving.font||"TimesNewRoman";e.changeFont(u,g),e.canvas.add(e.text[g])}if(e.canvas.on("object:moving",function(t){var i=t.target;e.checkLimitAreaNewFlag?e.checkLimitAreaNew(i,a):e.checkLimitArea(i,i.limitArea)}),e.changeFont(r,a),t.shadowColor&&e.text[a].setShadow({color:t.shadowColor,blur:-10,offsetX:1.5,offsetY:1.5}),"undefined"!=typeof t.stroke){var v=1;"undefined"!=typeof t.strokeWidth&&(v=t.strokeWidth),e.text[a].set({stroke:t.stroke,strokeWidth:v}),"undefined"!=typeof t.strokeDashArray&&e.text[a].set({strokeDashArray:t.strokeDashArray})}1==t.banDrag&&(e.text[a].lockMovementX=!0,e.text[a].lockMovementY=!0,e.text[a].set("borderScaleFactor",0)),e.canvas.add(e.text[a]),e.canvas.renderAll()}),e.imageSrc&&!e.templateOut&&e.changeTemplate(e,e.imageSrc)},changeImage:function(e,t){if(e.canvas.getObjects().length>0)var a=e.getBs();a&&"image"===a.type&&(e.canvas.remove(a),console.log("------------------")),fabric.Image.fromURL(t,function(t){t.hasControls=!1,t.hasBorders=!1,t.set({originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0}),console.log(e.scale),t.set({left:e.templateCoord.left*e.scale,top:e.templateCoord.top*e.scale,width:e.templateCoord.width*e.scale,height:e.templateCoord.height*e.scale}),e.canvas.add(t),e.canvas.sendToBack(t),e.canvas.renderAll()}.bind(e),{crossOrigin:"anonymous"})},textToVertical:function(e){for(var t="",a=0;a<e.length;a++){if(a==e.length-1)var i="";else i="\n";t+=e[a]+i}return t},loadAndUse:function(e,t,a,i){var n=new FontFaceObserver(a);n.load().then(function(){var n=e.text[t];n&&(n.set("fontFamily",a),e.canvas.renderAll(),t==e.text.length-1&&i())}).catch(function(n){console.log("error: ",n);var r=e.text[t];r&&(r.set("fontFamily",a),e.canvas.renderAll(),t==e.text.length-1&&i())})},changeFont:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){console.log("ok")};this.loadAndUse(this,t,e,a)},changeSize:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=this.text[t];a&&(a.set("fontSize",e*this.scale),this.checkLimitAreaNewFlag&&this.checkLimitAreaNew(a,t),this.canvas.renderAll())},changeCoord:function(e,t){var a=this.text[t];"undefined"!=typeof e.left&&(e.left=e.left*this.scale),"undefined"!=typeof e.top&&(e.top=e.top*this.scale),"undefined"!=typeof e.fontSize&&(e.fontSize=e.fontSize*this.scale),a&&(a.set(e),this.canvas.renderAll())},changeColor:function(e,t){var a=this.text[t];a&&(a.set("fill",e),this.canvas.renderAll())},changeText:function changeText(text,i){var obj=this.text[i];if(obj){if("vertical"==this.coors[i].direction&&(text=this.textToVertical(text)),1==this.coors[i].isChange&&(text=this.lastVariationTransformEn(this.coors[i].isChange,text)),"undefined"!=typeof this.coors[i].cutNumber&&text.length>parseInt(this.coors[i].cutNumber)&&(text=text.substr(0,this.coors[i].cutNumber)),this.coors[i].isWrap){var formatted1="";this.coors[i].isWrapCanvasText_?(formatted1=this.wrapCanvasText_(text,this.canvas,obj.fontFamily,obj.fontSize,this.coors[i].limitArea.width*this.scale,500),text=formatted1):formatted1=this.wrapCanvasText(text,this.canvas,obj.fontFamily,obj.fontSize,this.coors[i].limitArea.width*this.scale,500),obj.set("text",formatted1)}else obj.set("text",text);if("undefined"!=typeof this.coors[i].initialCarving&&this.coors[i].initialCarving){var t=this.coorsNum+i,initialObj=this.text[t],initialText=text.substr(0,1);if("undefined"!=typeof this.coors[i].initialCarving.value){var nVal=this.coors[i].initialCarving.value;if("undefined"!=typeof this.coors[i].initialCarving.operator){var operator=this.coors[i].initialCarving.operator;if(text){var fun=parseInt(text)+operator+parseInt(nVal);initialText=eval(fun)}else initialText=""}else initialText=nVal}else"undefined"!=typeof this.coors[i].initialCarving.isFull?initialText=text:"undefined"!=typeof this.coors[i].initialCarving.value&&(initialText=this.coors[i].initialCarving.value);initialText+="",initialObj.set("text",initialText)}if(this.checkLimitAreaNewFlag?this.checkLimitAreaNew(obj,i):this.checkLimitArea(obj,this.coors[i].limitArea),this.canvas.renderAll(),this.coors[i].isWrapCanvasText_)return text}},lastVariationTransformEn:function(e,t){var a,i=(a={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(a,"ß","ss"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(a,"ñ","n"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(a,"Ñ","N"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(a,"ö","o"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(a,"Ö","O"),a);if(t.length>1){var n=t.charAt(t.length-1);if(void 0!=i[n])return t=t.substr(0,t.length-1)+i[n],t;if(1==e){var r={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"};if("undefined"!=typeof r[n])return t=t.substr(0,t.length-1)+r[n],t}}return t},convertChar:function(e){var t,a=(t={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(t,"ß","ss"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(t,"ñ","n"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(t,"Ñ","N"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(t,"ö","o"),Object(F_vue_subject_vue_photocarving_node_modules_babel_runtime_corejs2_helpers_esm_defineProperty__WEBPACK_IMPORTED_MODULE_2__["a"])(t,"Ö","O"),t);void 0!=a[e]&&(e=a[e]);var i=new Array;return i["A"]="1",i["B"]="2",i["C"]="3",i["D"]="4",i["E"]="5",i["F"]="6",i["G"]="7",i["H"]="8",i["I"]="9",i["J"]="0",i["K"]="!",i["L"]="@",i["M"]="#",i["N"]="$",i["O"]="%",i["P"]="^",i["Q"]="&",i["R"]="*",i["S"]="(",i["T"]=")",i["U"]="-",i["V"]="=",i["W"]="[",i["X"]="]",i["Y"]="|",i["Z"]=":",i[e.toUpperCase()]},wrapCanvasText:function(e,t,a,i,n,r){"undefined"===typeof r&&(r=0);var o=e.split(" "),s="",l=(e.replace(/(\r\n|\n|\r)/gm,""),new fabric.Text("sdfsdf",{fontFamily:a,fontSize:25}).height),c=r>0?r-l:0,d=t.getContext("2d");d.font=i+"px "+a;for(var h="",p=0,g=0;g<o.length;g++){var m=""==h,u=h+" "+o[g],v=d.measureText(u).width;if(v<n)h+=o[g]+" ",s+=o[g]+=" ";else{if(m)for(var f="",x=0;x<o[g].length;++x){f+=o[g].charAt(x);var b=f+"-";if(d.measureText(b).width>=n){b=f.substr(0,f.length-2)+"",o[g]=o[g].substr(f.length-1,o[g].length),s+=b;break}}g--,s+="\n",p++,h=""}if(c>0&&p*l>c){s=s.substr(0,s.length-3)+"...\n";break}}return s=s.substr(0,s.length-1),s},wrapCanvasText_:function(e,t,a,i,n,r){var o=e.replace(/(\r\n|\n|\r)/gm,"-*)(*-").split("-*)(*-"),s=t.getContext("2d");s.font=i+"px "+a;for(var l=[],c=0;c<o.length;c++){var d=s.measureText(o[c]).width;if(d<n)l.push(o[c]);else{for(var h="",p=0;p<o[c].length;p++){h+=o[c].charAt(p);d=s.measureText(h+"-").width;d>n&&(l.push(h),h="")}""!=h&&l.push(h)}}var g="",m="",u=new fabric.Text("sdfsdf",{fontFamily:a,fontSize:i}).height+4;for(c=0;c<l.length;c++){if(m=g+=l[c],u*(c+2)>r)break;g+="\n"}return m},checkLimitArea:function(e,t){if(t){this.canvas.renderAll();var a=t.left*this.scale,i=t.top*this.scale,n=a+t.width*this.scale,r=i+t.height*this.scale,o=e.left,s=e.top;e.left-e.width/2<a&&(o=a+e.width/2),e.top-e.height/2<i&&(s=i+e.height/2),e.left+e.width/2>n&&(o=n-e.width/2),e.top+e.height/2>r&&(s=r-e.height/2),e.set({left:o,top:s}),this.canvas.renderAll()}},checkLimitAreaNew:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("undefined"!==typeof e.limitArea){var i=e.limitArea,n=0;if(a){if(e.height>i.height*this.scale){var r=a.split(/[(\r\n)\r\n]+/);if(r.length>1){n=Math.ceil((e.height-i.height*this.scale)/(e.height/r.length)),a="";for(var o=0;o<r.length-n;o++)a+=o>0?"\n"+r[o]:r[o]}}e.set("text",a),this.canvas.renderAll(),e.width>i.width*this.scale&&(n=Math.ceil((e.width-i.width*this.scale)/(e.width/a.length)),a=a.substr(0,a.length-n)),e.set("text",a),this.canvas.renderAll()}var s=e.top,l=e.left,c=l,d=s,h=e.width/2,p=e.height/2;l-h<i.left*this.scale?c=i.left*this.scale+h:l+h>i.left*this.scale+i.width*this.scale&&(c=i.left*this.scale+i.width*this.scale-h),s-p<i.top*this.scale?d=i.top*this.scale+p:s+p>i.top*this.scale+i.height*this.scale&&(d=i.top*this.scale+i.height*this.scale-p),e.set({left:c,top:d}),this.canvas.renderAll()}},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},changeBigText:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=this.getBs();i&&"text"==i.type&&this.canvas.remove(i),_zen_base_js__WEBPACK_IMPORTED_MODULE_5__["a"].util.carvingTextObj.clone(function(e){a.canvas.discardActiveObject(),e.set({hasControls:!1,hasBorders:!1,evented:!0}),"activeSelection"===e.type?(e.canvas=a.canvas,e.forEachObject(function(e){a.canvas.add(e)}),e.setCoords()):a.canvas.add(e),a.canvas.setActiveObject(e),a.canvas.requestRenderAll()})},addMultiBigText:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=e.canvas.getObjects();for(var a in t)"text"==t[a].type&&e.canvas.remove(t[a]);_zen_base_js__WEBPACK_IMPORTED_MODULE_5__["a"].util.bigCarvingTexObj.forEach(function(t,a){t.clone(function(t){e.canvas.discardActiveObject(),t.set({hasControls:!1,hasBorders:!1,evented:!0}),"activeSelection"===t.type?(t.canvas=e.canvas,t.forEachObject(function(t){e.canvas.add(t)}),t.setCoords()):e.canvas.add(t),e.canvas.setActiveObject(t),e.canvas.requestRenderAll()})})},changeCurveText:function(e,t){this.textpath[t].setText(e),this.layer.draw();var a=this.stage.toDataURL();this.img.src=a},initPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;e.stage=new konva__WEBPACK_IMPORTED_MODULE_4___default.a.Stage({container:"container",width:e.cWidth,height:e.cHeight}),e.layer=new konva__WEBPACK_IMPORTED_MODULE_4___default.a.Layer,e.path.forEach(function(t,a){e.textpath[a]=new konva__WEBPACK_IMPORTED_MODULE_4___default.a.TextPath({x:0,y:0,align:"center",fill:t.textColor,fontSize:t.size,fontFamily:t.family,text:"",data:t.path}),e.layer.add(e.textpath[a])}),e.stage.add(e.layer),e.img=new Image,e.imgObj=new fabric.Image(e.img),e.imgObj.lockMovementX=!0,e.imgObj.lockMovementY=!0,e.imgObj.selectable=!1,e.canvas.add(e.imgObj),e.img.onload=function(){e.imgObj.setElement(e.img),e.imgObj.set({left:0,top:0,scaleX:e.scale,scaleY:e.scale}),e.canvas.renderAll(!0)}}}),_uqcarving.prototype.constructor=_uqcarving,_uqcarving}();__webpack_exports__["a"]=ucarving},"72fe":function(e,t,a){"use strict";var i=a("b507"),n=a.n(i);n.a},"79f8":function(e,t,a){},"8d2a":function(e,t,a){},a03d:function(e,t,a){"use strict";var i=a("21b5"),n=a.n(i);n.a},ad94:function(e,t,a){"use strict";a.r(t);a("6b54");var i=a("7618");a("ac6a"),a("28a5"),a("a481"),a("55dd"),a("3b2b"),a("386d"),a("4917");(function(e){var t=e.mobiscroll,a=new Date,n={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:a.getFullYear()-100,endYear:a.getFullYear()+1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",nowText:"Now",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},r=function(a){var i,r=e(this),o={};if(r.is("input")){switch(r.attr("type")){case"date":i="yy-mm-dd";break;case"datetime":i="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":i="yy-mm-ddTHH:ii:ss";break;case"month":i="yy-mm",o.dateOrder="mmyy";break;case"time":i="HH:ii:ss";break}var s=r.attr("min"),l=r.attr("max");s&&(o.minDate=t.parseDate(i,s)),l&&(o.maxDate=t.parseDate(i,l))}var c,d,h=e.extend({},n,o,a.settings),p=0,g=[],m=[],u={},v={y:"getFullYear",m:"getMonth",d:"getDate",h:B,i:z,s:$,a:M},f=h.preset,x=h.dateOrder,b=h.timeWheels,C=x.match(/D/),y=b.match(/a/i),w=b.match(/h/),_="datetime"==f?h.dateFormat+h.separator+h.timeFormat:"time"==f?h.timeFormat:h.dateFormat,T=new Date,O=h.stepHour,I=h.stepMinute,E=h.stepSecond,S=h.minDate||new Date(h.startYear,0,1),k=h.maxDate||new Date(h.endYear,11,31,23,59,59);if(a.settings=h,i=i||_,f.match(/date/i)){e.each(["y","m","d"],function(e,t){c=x.search(new RegExp(t,"i")),c>-1&&m.push({o:c,v:t})}),m.sort(function(e,t){return e.o>t.o?1:-1}),e.each(m,function(e,t){u[t.v]=e});var j={};for(d=0;d<3;d++)if(d==u.y){p++,j[h.yearText]={};var L=S.getFullYear(),A=k.getFullYear();for(c=L;c<=A;c++)j[h.yearText][c]=x.match(/yy/i)?c:(c+"").substr(2,2)}else if(d==u.m)for(p++,j[h.monthText]={},c=0;c<12;c++){var F=x.replace(/[dy]/gi,"").replace(/mm/,c<9?"0"+(c+1):c+1).replace(/m/,c+1);j[h.monthText][c]=F.match(/MM/)?F.replace(/MM/,'<span class="dw-mon">'+h.monthNames[c]+"</span>"):F.replace(/M/,'<span class="dw-mon">'+h.monthNamesShort[c]+"</span>")}else if(d==u.d)for(p++,j[h.dayText]={},c=1;c<32;c++)j[h.dayText][c]=x.match(/dd/i)&&c<10?"0"+c:c;g.push(j)}if(f.match(/time/i)){for(m=[],e.each(["h","i","s","a"],function(e,t){e=b.search(new RegExp(t,"i")),e>-1&&m.push({o:e,v:t})}),m.sort(function(e,t){return e.o>t.o?1:-1}),e.each(m,function(e,t){u[t.v]=p+e}),j={},d=p;d<p+4;d++)if(d==u.h)for(p++,j[h.hourText]={},c=0;c<(w?12:24);c+=O)j[h.hourText][c]=w&&0==c?12:b.match(/hh/i)&&c<10?"0"+c:c;else if(d==u.i)for(p++,j[h.minuteText]={},c=0;c<60;c+=I)j[h.minuteText][c]=b.match(/ii/)&&c<10?"0"+c:c;else if(d==u.s)for(p++,j[h.secText]={},c=0;c<60;c+=E)j[h.secText][c]=b.match(/ss/)&&c<10?"0"+c:c;else if(d==u.a){p++;var N=b.match(/A/);j[h.ampmText]={0:N?"AM":"am",1:N?"PM":"pm"}}g.push(j)}function P(e,t,a){return void 0!==u[t]?+e[u[t]]:void 0!==a?a:T[v[t]]?T[v[t]]():v[t](T)}function D(e,t){return Math.floor(e/t)*t}function B(e){var t=e.getHours();return t=w&&t>=12?t-12:t,D(t,O)}function z(e){return D(e.getMinutes(),I)}function $(e){return D(e.getSeconds(),E)}function M(e){return y&&e.getHours()>11?1:0}function W(e){var t=P(e,"h",0);return new Date(P(e,"y"),P(e,"m"),P(e,"d",1),P(e,"a")?t+12:t,P(e,"i",0),P(e,"s",0))}return a.setDate=function(e,t,a,i){var n;for(n in u)this.temp[u[n]]=e[v[n]]?e[v[n]]():v[n](e);this.setValue(!0,t,a,i)},a.getDate=function(e){return W(e)},{button3Text:h.showNow?h.nowText:void 0,button3:h.showNow?function(){a.setDate(new Date,!1,.3,!0)}:void 0,wheels:g,headerText:function(e){return t.formatDate(_,W(a.temp),h)},formatResult:function(e){return t.formatDate(i,W(e),h)},parseValue:function(e){var a,n=new Date,r=[];try{n=t.parseDate(i,e,h)}catch(o){}for(a in u)r[u[a]]=n[v[a]]?n[v[a]]():v[a](n);return r},validate:function(t,i){var n=a.temp,r={y:S.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},o={y:k.getFullYear(),m:11,d:31,h:D(w?11:23,O),i:D(59,I),s:D(59,E),a:1},s=!0,l=!0;e.each(["y","m","d","a","h","i","s"],function(a,i){if(void 0!==u[i]){var c,d,p=r[i],g=o[i],m=31,f=P(n,i),b=e(".dw-ul",t).eq(u[i]);if("d"==i&&(c=P(n,"y"),d=P(n,"m"),m=32-new Date(c,d,32).getDate(),g=m,C&&e(".dw-li",b).each(function(){var t=e(this),a=t.data("val"),i=new Date(c,d,a).getDay(),n=x.replace(/[my]/gi,"").replace(/dd/,a<10?"0"+a:a).replace(/d/,a);e(".dw-i",t).html(n.match(/DD/)?n.replace(/DD/,'<span class="dw-day">'+h.dayNames[i]+"</span>"):n.replace(/D/,'<span class="dw-day">'+h.dayNamesShort[i]+"</span>"))})),s&&S&&(p=S[v[i]]?S[v[i]]():v[i](S)),l&&k&&(g=k[v[i]]?k[v[i]]():v[i](k)),"y"!=i){var y=e(".dw-li",b).index(e('.dw-li[data-val="'+p+'"]',b)),w=e(".dw-li",b).index(e('.dw-li[data-val="'+g+'"]',b));e(".dw-li",b).removeClass("dw-v").slice(y,w+1).addClass("dw-v"),"d"==i&&e(".dw-li",b).removeClass("dw-h").slice(m).addClass("dw-h")}if(f<p&&(f=p),f>g&&(f=g),s&&(s=f==p),l&&(l=f==g),h.invalid&&"d"==i){var _=[];if(h.invalid.dates&&e.each(h.invalid.dates,function(e,t){t.getFullYear()==c&&t.getMonth()==d&&_.push(t.getDate()-1)}),h.invalid.daysOfWeek){var T,O=new Date(c,d,1).getDay();e.each(h.invalid.daysOfWeek,function(e,t){for(T=t-O;T<m;T+=7)T>=0&&_.push(T)})}h.invalid.daysOfMonth&&e.each(h.invalid.daysOfMonth,function(e,t){t=(t+"").split("/"),t[1]?t[0]-1==d&&_.push(t[1]-1):_.push(t[0]-1)}),e.each(_,function(t,a){e(".dw-li",b).eq(a).removeClass("dw-v")})}n[u[i]]=f}})},methods:{getDate:function(t){var a=e(this).mobiscroll("getInst");if(a)return a.getDate(t?a.temp:a.values)},setDate:function(t,a,i,n){return void 0==a&&(a=!1),this.each(function(){var r=e(this).mobiscroll("getInst");r&&r.setDate(t,a,i,n)})}}}};e.each(["date","time","datetime"],function(e,a){t.presets[a]=r,t.presetShort(a)}),t.formatDate=function(t,a,i){if(!a)return null;var r,o=e.extend({},n,i),s=function(e){var a=0;while(r+1<t.length&&t.charAt(r+1)==e)a++,r++;return a},l=function(e,t,a){var i=""+t;if(s(e))while(i.length<a)i="0"+i;return i},c=function(e,t,a,i){return s(e)?i[t]:a[t]},d="",h=!1;for(r=0;r<t.length;r++)if(h)"'"!=t.charAt(r)||s("'")?d+=t.charAt(r):h=!1;else switch(t.charAt(r)){case"d":d+=l("d",a.getDate(),2);break;case"D":d+=c("D",a.getDay(),o.dayNamesShort,o.dayNames);break;case"o":d+=l("o",(a.getTime()-new Date(a.getFullYear(),0,0).getTime())/864e5,3);break;case"m":d+=l("m",a.getMonth()+1,2);break;case"M":d+=c("M",a.getMonth(),o.monthNamesShort,o.monthNames);break;case"y":d+=s("y")?a.getFullYear():(a.getYear()%100<10?"0":"")+a.getYear()%100;break;case"h":var p=a.getHours();d+=l("h",p>12?p-12:0==p?12:p,2);break;case"H":d+=l("H",a.getHours(),2);break;case"i":d+=l("i",a.getMinutes(),2);break;case"s":d+=l("s",a.getSeconds(),2);break;case"a":d+=a.getHours()>11?"pm":"am";break;case"A":d+=a.getHours()>11?"PM":"AM";break;case"'":s("'")?d+="'":h=!0;break;default:d+=t.charAt(r)}return d},t.parseDate=function(t,a,r){var o=new Date;if(!t||!a)return o;a="object"==Object(i["a"])(a)?a.toString():a+"";var s,l=e.extend({},n,r),c=l.shortYearCutoff,d=o.getFullYear(),h=o.getMonth()+1,p=o.getDate(),g=-1,m=o.getHours(),u=o.getMinutes(),v=0,f=-1,x=!1,b=function(e){var a=s+1<t.length&&t.charAt(s+1)==e;return a&&s++,a},C=function(e){b(e);var t="@"==e?14:"!"==e?20:"y"==e?4:"o"==e?3:2,i=new RegExp("^\\d{1,"+t+"}"),n=a.substr(_).match(i);return n?(_+=n[0].length,parseInt(n[0],10)):0},y=function(e,t,i){var n,r=b(e)?i:t;for(n=0;n<r.length;n++)if(a.substr(_,r[n].length).toLowerCase()==r[n].toLowerCase())return _+=r[n].length,n+1;return 0},w=function(){_++},_=0;for(s=0;s<t.length;s++)if(x)"'"!=t.charAt(s)||b("'")?w():x=!1;else switch(t.charAt(s)){case"d":p=C("d");break;case"D":y("D",l.dayNamesShort,l.dayNames);break;case"o":g=C("o");break;case"m":h=C("m");break;case"M":h=y("M",l.monthNamesShort,l.monthNames);break;case"y":d=C("y");break;case"H":m=C("H");break;case"h":m=C("h");break;case"i":u=C("i");break;case"s":v=C("s");break;case"a":f=y("a",["am","pm"],["am","pm"])-1;break;case"A":f=y("A",["am","pm"],["am","pm"])-1;break;case"'":b("'")?w():x=!0;break;default:w()}if(d<100&&(d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d<=("string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10))?0:-100)),g>-1){h=1,p=g;do{var T=32-new Date(d,h-1,32).getDate();if(p<=T)break;h++,p-=T}while(1)}m=-1==f?m:f&&m<12?m+12:f||12!=m?m:0;var O=new Date(d,h-1,p,m,u,v);if(O.getFullYear()!=d||O.getMonth()+1!=h||O.getDate()!=p)throw"Invalid date";return O}})(jQuery)},b36f:function(e,t,a){"use strict";var i=a("8d2a"),n=a.n(i);n.a},b507:function(e,t,a){},b9c1:function(e,t,a){},bdb0:function(e,t,a){},c82c:function(e,t,a){},e24f:function(e,t,a){"use strict";var i=a("54d7"),n=a.n(i);n.a},ed2c:function(e,t,a){},f49c:function(e,t,a){},fcc6:function(e,t,a){"use strict";var i=a("69e3"),n=a.n(i);n.a}});