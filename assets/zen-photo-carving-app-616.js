(function(t){function e(e){for(var i,o,s=e[0],l=e[1],c=e[2],h=0,p=[];h<s.length;h++)o=s[h],n[o]&&p.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);d&&d(e);while(p.length)p.shift()();return r.push.apply(r,c||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(i=!1)}i&&(r.splice(e--,1),t=o(o.s=a[0]))}return t}var i={},n={app:0},r=[];function o(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=i,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(a,i,function(e){return t[e]}.bind(null,i));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var d=l;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"0580":function(t,e,a){"use strict";var i=a("c19d"),n=a.n(i);n.a},"0891":function(t,e,a){"use strict";var i=a("1363"),n=a.n(i);n.a},1:function(t,e){},1363:function(t,e,a){},"1bbc":function(t,e,a){"use strict";var i=a("79f8"),n=a.n(i);n.a},2:function(t,e){},"21b5":function(t,e,a){},"2b78":function(t,e,a){"use strict";a.r(e);a("28a5");var i=a("7618");a("7514"),a("7f7f"),a("8449"),a("ac6a"),a("a481");
/*!
 * jQuery MobiScroll v2.5.1
 * http://mobiscroll.com
 *
 * Copyright 2010-2013, Acid Media
 * Licensed under the MIT license.
 *
 */
(function(t){function e(e,a){var i,n,r,l,d,k,j,L,A,z,U,R,q,V=this,H=t.mobiscroll,Y=e,X=t(Y),J=B({},M),G={},Q=[],Z={},K={},tt=X.is("input"),et=!1;function at(e){if(t.isArray(J.readonly)){var a=t(".dwwl",l).index(e);return J.readonly[a]}return J.readonly}function it(t){var e,a='<div class="dw-bf">',i=1;for(e in Q[t])i%20==0&&(a+='</div><div class="dw-bf">'),a+='<div class="dw-li dw-v" data-val="'+e+'" style="height:'+n+"px;line-height:"+n+'px;"><div class="dw-i">'+Q[t][e]+"</div></div>",i++;return a+="</div>",a}function nt(e){g=t(".dw-li",e).index(t(".dw-v",e).eq(0)),m=t(".dw-li",e).index(t(".dw-v",e).eq(-1)),b=t(".dw-ul",l).index(e),p=n,u=V}function rt(t){var e=J.headerText;return e?"function"===typeof e?e.call(Y,t):e.replace(/\{value\}/i,t):""}function ot(){V.temp=tt&&null!==V.val&&V.val!=X.val()||null===V.values?J.parseValue(X.val()||"",V):V.values.slice(0),V.setValue(!0)}function st(e,a,i,n,r){!1!==dt("validate",[l,a,e])&&(t(".dw-ul",l).each(function(i){var o=t(this),s=t('.dw-li[data-val="'+V.temp[i]+'"]',o),l=t(".dw-li",o),c=l.index(s),d=l.length,h=i==a||void 0===a;if(!s.hasClass("dw-v")){var p=s,g=s,m=0,u=0;while(c-m>=0&&!p.hasClass("dw-v"))m++,p=l.eq(c-m);while(c+u<d&&!g.hasClass("dw-v"))u++,g=l.eq(c+u);(u<m&&u&&2!==n||!m||c-m<0||1==n)&&g.hasClass("dw-v")?(s=g,c+=u):(s=p,c-=m)}s.hasClass("dw-sel")&&!h||(V.temp[i]=s.attr("data-val"),t(".dw-sel",o).removeClass("dw-sel"),s.addClass("dw-sel"),V.scroll(o,i,c,h?e:.1,h?r:void 0))}),V.change(i))}function lt(e){if(!("inline"==J.display||d===t(window).width()&&j===t(window).height()&&e)){var a,i,n,r,o,s,c,h,p,g,m,u,v=0,f=0,x=t(window).scrollTop(),b=t(".dwwr",l),C=t(".dw",l),y={},w=void 0===J.anchor?X:J.anchor;d=t(window).width(),j=t(window).height(),k=window.innerHeight,k=k||j,/modal|bubble/.test(J.display)&&(t(".dwc",l).each(function(){a=t(this).outerWidth(!0),v+=a,f=a>f?a:f}),a=v>d?f:v,b.width(a)),L=C.outerWidth(),A=C.outerHeight(!0),"modal"==J.display?(i=(d-L)/2,n=x+(k-A)/2):"bubble"==J.display?(u=!0,p=t(".dw-arrw-i",l),s=w.offset(),c=s.top,h=s.left,r=w.outerWidth(),o=w.outerHeight(),i=h-(C.outerWidth(!0)-r)/2,i=i>d-L?d-(L+20):i,i=i>=0?i:20,n=c-A,n<x||c>x+k?(C.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),n=c+o):C.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),g=p.outerWidth(),m=h+r/2-(i+(L-g)/2),t(".dw-arr",l).css({left:m>g?g:m})):(y.width="100%","top"==J.display?n=x:"bottom"==J.display&&(n=x+k-A)),y.top=n<0?0:n,y.left=i,C.css(y),t(".dw-persp",l).height(0).height(n+A>t(document).height()?n+A:t(document).height()),u&&(n+A>x+k||c>x+k)&&t(window).scrollTop(n+A-k)}}function ct(t){if("touchstart"===t.type)_=!0,setTimeout(function(){_=!1},500);else if(_)return _=!1,!1;return!0}function dt(e,i){var n;return i.push(V),t.each([R.defaults,G,a],function(t,a){a[e]&&(n=a[e].apply(Y,i))}),n}function ht(t){var e=+t.data("pos"),a=e+1;c(t,a>m?g:a,1,!0)}function pt(t){var e=+t.data("pos"),a=e-1;c(t,a<g?m:a,2,!0)}V.enable=function(){J.disabled=!1,tt&&X.prop("disabled",!1)},V.disable=function(){J.disabled=!0,tt&&X.prop("disabled",!0)},V.scroll=function(t,e,a,r,o){function s(t,e,a,i){return a*Math.sin(t/i*(Math.PI/2))+e}function c(){clearInterval(Z[e]),delete Z[e],t.data("pos",a).closest(".dwwl").removeClass("dwa")}var d,h=(i-a)*n;h==K[e]&&Z[e]||(r&&h!=K[e]&&dt("onAnimStart",[l,e,r]),K[e]=h,t.attr("style",F+"-transition:all "+(r?r.toFixed(3):0)+"s ease-out;"+(N?F+"-transform:translate3d(0,"+h+"px,0);":"top:"+h+"px;")),Z[e]&&c(),r&&void 0!==o?(d=0,t.closest(".dwwl").addClass("dwa"),Z[e]=setInterval(function(){d+=.1,t.data("pos",Math.round(s(d,o,a-o,r))),d>=r&&c()},100)):t.data("pos",a))},V.setValue=function(e,a,i,n){t.isArray(V.temp)||(V.temp=J.parseValue(V.temp+"",V)),et&&e&&st(i),r=J.formatResult(V.temp),n||(V.values=V.temp.slice(0),V.val=r),a&&tt&&X.val(r).trigger("change")},V.getValues=function(){var t,e=[];for(t in V._selectedValues)e.push(V._selectedValues[t]);return e},V.validate=function(t,e,a,i){st(a,t,!0,e,i)},V.change=function(e){r=J.formatResult(V.temp),"inline"==J.display?V.setValue(!1,e):t(".dwv",l).html(rt(r)),e&&dt("onChange",[r])},V.changeWheel=function(e,a){if(l){var i,n,r=0,o=e.length;for(i in J.wheels)for(n in J.wheels[i]){if(t.inArray(r,e)>-1&&(Q[r]=J.wheels[i][n],t(".dw-ul",l).eq(r).html(it(r)),o--,!o))return lt(),void st(a,void 0,!0);r++}}},V.isVisible=function(){return et},V.tap=function(t,e){var a,i;J.tap&&t.bind("touchstart",function(t){t.preventDefault(),a=o(t,"X"),i=o(t,"Y")}).bind("touchend",function(t){Math.abs(o(t,"X")-a)<20&&Math.abs(o(t,"Y")-i)<20&&e.call(this,t),S=!0,setTimeout(function(){S=!1},300)}),t.bind("click",function(t){S||e.call(this,t)})},V.show=function(e){if(J.disabled||et)return!1;"top"==J.display&&(z="slidedown"),"bottom"==J.display&&(z="slideup"),ot(),dt("onBeforeShow",[l]);var a,i,s=0,p="";z&&!e&&(p="dw-"+z+" dw-in");var g='<div class="dw-trans '+J.theme+" dw-"+J.display+'">'+("inline"==J.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+p+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(J.headerText?'<div class="dwv"></div>':""));for(a=0;a<J.wheels.length;a++){for(i in g+='<div class="dwc'+("scroller"!=J.mode?" dwpm":" dwsc")+(J.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>',J.wheels[a])Q[s]=J.wheels[a][i],g+='<td><div class="dwwl dwrc dwwl'+s+'">'+("scroller"!=J.mode?'<div class="dwwb dwwbp" style="height:'+n+"px;line-height:"+n+'px;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+n+"px;line-height:"+n+'px;"><span>&ndash;</span></div>':"")+'<div class="dwl">'+i+'</div><div class="dww" style="height:'+J.rows*n+"px;min-width:"+J.width+'px;"><div class="dw-ul">',g+=it(s),g+='</div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',s++;g+="</tr></table></div></div>"}g+=("inline"!=J.display?'<div class="dwbc'+(J.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb">'+J.setText+"</span></span>"+(J.button3?'<span class="dwbw dwb-n"><span class="dwb">'+J.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb">'+J.cancelText+"</span></span></div></div>":'<div class="dwcc"></div>')+"</div></div></div>",l=t(g),st(),dt("onMarkupReady",[l]),"inline"!=J.display?(l.appendTo("body"),setTimeout(function(){l.removeClass("dw-trans").find(".dw").removeClass(p)},350)):X.is("div")?X.html(l):l.insertAfter(X),dt("onMarkupInserted",[l]),et=!0,R.init(l,V),"inline"!=J.display&&(V.tap(t(".dwb-s span",l),function(){!1!==V.hide(!1,"set")&&(V.setValue(!1,!0),dt("onSelect",[V.val]))}),V.tap(t(".dwb-c span",l),function(){V.cancel()}),J.button3&&V.tap(t(".dwb-n span",l),J.button3),J.scrollLock&&l.bind("touchmove",function(t){A<=k&&L<=d&&t.preventDefault()}),t("input,select,button").each(function(){t(this).prop("disabled")||t(this).addClass("dwtd").prop("disabled",!0)}),lt(),t(window).bind("resize.dw",function(){clearTimeout(U),U=setTimeout(function(){lt(!0)},100)})),l.delegate(".dwwl","DOMMouseScroll mousewheel",function(e){if(!at(this)){e.preventDefault(),e=e.originalEvent;var a=e.wheelDelta?e.wheelDelta/120:e.detail?-e.detail/3:0,i=t(".dw-ul",this),n=+i.data("pos"),r=Math.round(n-a);nt(i),c(i,r,a<0?1:2)}}).delegate(".dwb, .dwwb",P,function(e){t(this).addClass("dwb-a")}).delegate(".dwwb",P,function(e){e.stopPropagation(),e.preventDefault();var a=t(this).closest(".dwwl");if(ct(e)&&!at(a)&&!a.hasClass("dwa")){f=!0;var i=a.find(".dw-ul"),n=t(this).hasClass("dwwbp")?ht:pt;nt(i),clearInterval(h),h=setInterval(function(){n(i)},J.delay),n(i)}}).delegate(".dwwl",P,function(e){e.preventDefault(),!ct(e)||v||at(this)||f||(v=!0,t(document).bind(D,$),x=t(".dw-ul",this),I="clickpick"!=J.mode,T=+x.data("pos"),nt(x),O=void 0!==Z[b],C=o(e,"Y"),w=new Date,y=C,V.scroll(x,b,T,.001),I&&x.closest(".dwwl").addClass("dwa"))}),dt("onShow",[l,r])},V.hide=function(e,a){if(!et||!1===dt("onClose",[r,a]))return!1;t(".dwtd").prop("disabled",!1).removeClass("dwtd"),X.blur(),l&&("inline"!=J.display&&z&&!e?(l.addClass("dw-trans").find(".dw").addClass("dw-"+z+" dw-out"),setTimeout(function(){l.remove(),l=null},350)):(l.remove(),l=null),et=!1,K={},t(window).unbind(".dw"))},V.cancel=function(){!1!==V.hide(!1,"cancel")&&dt("onCancel",[V.val])},V.init=function(t){R=B({defaults:{},init:E},H.themes[t.theme||J.theme]),q=H.i18n[t.lang||J.lang],B(a,t),B(J,R.defaults,q,a),V.settings=J,X.unbind(".dw");var e=H.presets[J.preset];e&&(G=e.call(Y,V),B(J,G,a),B(W,G.methods)),i=Math.floor(J.rows/2),n=J.height,z=J.animate,void 0!==X.data("dwro")&&(Y.readOnly=s(X.data("dwro"))),et&&V.hide(),"inline"==J.display?V.show():(ot(),tt&&J.showOnFocus&&(X.data("dwro",Y.readOnly),Y.readOnly=!0,X.bind("focus.dw",function(){V.show()})))},V.trigger=function(t,e){return dt(t,e)},V.values=null,V.val=null,V.temp=null,V._selectedValues={},V.init(a)}function a(t){var e;for(e in t)if(void 0!==A[t[e]])return!0;return!1}function n(){var t,e=["Webkit","Moz","O","ms"];for(t in e)if(a([e[t]+"Transform"]))return"-"+e[t].toLowerCase();return""}function r(t){return k[t.id]}function o(t,e){var a=t.originalEvent,i=t.changedTouches;return i||a&&a.changedTouches?a?a.changedTouches[0]["page"+e]:i[0]["page"+e]:t["page"+e]}function s(t){return!0===t||"true"==t}function l(t,e,a){return t=t>a?a:t,t=t<e?e:t,t}function c(e,a,i,n,r){a=l(a,g,m);var o=t(".dw-li",e).eq(a),s=void 0===r?a:r,c=b,d=n?a==s?.1:Math.abs(.1*(a-s)):0;u.temp[c]=o.attr("data-val"),u.scroll(e,c,a,d,r),setTimeout(function(){u.validate(c,i,d,r)},10)}function d(t,e,a){return W[e]?W[e].apply(t,Array.prototype.slice.call(a,1)):"object"===Object(i["a"])(e)?W.init.call(t,e):t}var h,p,g,m,u,v,f,x,b,C,y,w,T,O,I,S,_,k={},E=function(){},j=new Date,L=j.getTime(),A=document.createElement("modernizr").style,N=a(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),F=n(),B=t.extend,P="touchstart mousedown",D="touchmove mousemove",z="touchend mouseup",$=function(t){I&&(t.preventDefault(),y=o(t,"Y"),u.scroll(x,b,l(T+(C-y)/p,g-1,m+1))),O=!0},M={width:70,height:40,rows:3,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,tap:!0,formatResult:function(t){return t.join(" ")},parseValue:function(t,e){var a,i,n,r=e.settings.wheels,o=t.split(" "),s=[],l=0;for(a=0;a<r.length;a++)for(i in r[a]){if(void 0!==r[a][i][o[l]])s.push(o[l]);else for(n in r[a][i]){s.push(n);break}l++}return s}},W={init:function(t){return void 0===t&&(t={}),this.each(function(){this.id||(L+=1,this.id="scoller"+L),k[this.id]=new e(this,t)})},enable:function(){return this.each(function(){var t=r(this);t&&t.enable()})},disable:function(){return this.each(function(){var t=r(this);t&&t.disable()})},isDisabled:function(){var t=r(this[0]);if(t)return t.settings.disabled},isVisible:function(){var t=r(this[0]);if(t)return t.isVisible()},option:function(t,e){return this.each(function(){var a=r(this);if(a){var n={};"object"===Object(i["a"])(t)?n=t:n[t]=e,a.init(n)}})},setValue:function(t,e,a,i){return this.each(function(){var n=r(this);n&&(n.temp=t,n.setValue(!0,e,a,i))})},getInst:function(){return r(this[0])},getValue:function(){var t=r(this[0]);if(t)return t.values},getValues:function(){var t=r(this[0]);if(t)return t.getValues()},show:function(){var t=r(this[0]);if(t)return t.show()},hide:function(){return this.each(function(){var t=r(this);t&&t.hide()})},destroy:function(){return this.each(function(){var e=r(this);e&&(e.hide(),t(this).unbind(".dw"),delete k[this.id],t(this).is("input")&&(this.readOnly=s(t(this).data("dwro"))))})}};t(document).bind(z,function(e){if(v){var a,i,n,r=new Date-w,o=l(T+(C-y)/p,g-1,m+1),s=x.offset().top;if(r<300?(a=(y-C)/r,i=a*a/.0012,y-C<0&&(i=-i)):i=y-C,n=Math.round(T-i/p),!i&&!O){var d=Math.floor((y-s)/p),b=t(".dw-li",x).eq(d),S=I;!1!==u.trigger("onValueTap",[b])?n=d:S=!0,S&&(b.addClass("dw-hl"),setTimeout(function(){b.removeClass("dw-hl")},200))}I&&c(x,n,0,!0,Math.round(o)),v=!1,x=null,t(document).unbind(D,$)}f&&(clearInterval(h),f=!1),t(".dwb-a").removeClass("dwb-a")}).bind("mouseover mouseup mousedown click",function(t){if(S)return t.stopPropagation(),t.preventDefault(),!1}),t.fn.mobiscroll=function(e){return B(this,t.mobiscroll.shorts),d(this,e,arguments)},t.mobiscroll=t.mobiscroll||{setDefaults:function(t){B(M,t)},presetShort:function(t){this.shorts[t]=function(e){return d(this,B(e,{preset:t}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}},t.scroller=t.scroller||t.mobiscroll,t.fn.scroller=t.fn.scroller||t.fn.mobiscroll,t.mobiscroll.i18n.zh=t.extend(t.mobiscroll.i18n.zh,{dateFormat:"yyyy-mm-dd",dateOrder:"yymmdd",dayNames:["����","��һ;","�ܶ�;","����","����","����","����"],dayNamesShort:["��","һ","��","��","��","��","��"],dayText:"��",hourText:"ʱ",minuteText:"��",monthNames:["һ��","����","����","����","����","����","����","����","����","ʮ��","ʮһ��","ʮ����"],monthNamesShort:["1��","2��","3��","4��","5��","6��","7��","8��","9��","10��","11��","12��"],monthText:"��",secText:"��",timeFormat:"HH:ii",timeWheels:"HHii",yearText:"��"}),t.mobiscroll.i18n.zh=t.extend(t.mobiscroll.i18n.zh,{setText:"ȷ��",cancelText:"ȡ��"});var U={defaults:{dateOrder:"ddmmyy",mode:"mixed",rows:5,width:70,height:36,showLabel:!0,useShortLabels:!0}};t.mobiscroll.themes["android-ics"]=U,t.mobiscroll.themes["android-ics light"]=U})(jQuery)},3:function(t,e){},3394:function(t,e,a){},"445d":function(t,e,a){"use strict";var i=a("4c6d"),n=a.n(i);n.a},4689:function(t,e,a){"use strict";var i=a("f49c"),n=a.n(i);n.a},"4c6d":function(t,e,a){},"4e8c":function(t,e,a){},"54d7":function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);a("cadf"),a("551c"),a("f751"),a("097d");var n=a("2b0e"),r=a("2f62");a("7514");n["default"].use(r["a"]);var o={customInfo:"",photoCrop:"",photoAi:"",photoOrigin:"",engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",carvingInfo:"",photoDialogVisible:[{id:0,value:!1},{id:1,value:!1}],anotherImg:[{id:0,value:""},{id:1,value:""}],cropPhoto:[],photoDialogImg:[],cropImgShow:[],carvingDialogVisibleNew:!1,ifChangeImage:!1,dialogCount:0,showFooter:!0,changableNum:0,test:123123,fusionPreview:"",photoDialogVisibleNormal:!1,templateErrorMsg:""},s={getCustomInfo:function(t){return t.customInfo},getDialogCount:function(t){return t.dialogCount},getPhotoDialogVisible:function(t){return function(e){return t.photoDialogVisible.find(function(t){return t.id===e})}},getAnotherImg:function(t){return function(e){return t.anotherImg.find(function(t){return t.id===e})}},getPhotoCrop:function(t){return t.photoCrop},getPhotoAi:function(t){return t.photoAi},getPhotoOrigin:function(t){return t.photoOrigin},getEngravingCrop:function(t){return t.engravingCrop},isShow:function(t){return t.showFooter},getChangedNum:function(){return o.changableNum},showTest:function(t){return t.test},getFusionPreview:function(t){return t.fusionPreview},getPhotoDialogVisibleNormal:function(){return o.photoDialogVisibleNormal},getCropPhoto:function(t){return function(e){return t.cropPhoto[e]}},getPhotoDialogImg:function(t){return function(e){return t.photoDialogImg[e]}},getCropImgShow:function(t){return function(e){return t.cropImgShow[e]}},getTemplateErrorMsg:function(){return o.templateErrorMsg},getIfChangeImage:function(){return o.ifChangeImage},getCarvingDialogVisibleNew:function(){return o.carvingDialogVisibleNew}},l={setCustomInfo:function(t,e){return t.customInfo=e},setDialogCount:function(t,e){return t.dialogCount+=e},setPhotoDialogVisible:function(t,e){var a=t.photoDialogVisible.find(function(t){return t.id===e.id});Object.assign(a,e)},setAnotherImg:function(t,e){var a=t.anotherImg.find(function(t){return t.id===e.id});Object.assign(a,e)},setPhotoCrop:function(t,e){t.photoCrop=e},setPhotoAi:function(t,e){t.photoAi=e},setPhotoOrigin:function(t,e){t.photoOrigin=e},setEngravingCrop:function(t,e){t.engravingCrop=e},show:function(t){t.showFooter=!0},hide:function(t){t.showFooter=!1},newNum:function(t,e){t.changableNum+=e},changetest:function(){o.test="fffffffffffffff"},setFusionPreview:function(t,e){t.fusionPreview=e},setPhotoDialogVisibleNormal:function(t,e){return t.photoDialogVisibleNormal=e},setCropPhoto:function(t,e){return t.cropPhoto[e.index]=e.value},setPhotoDialogImg:function(t,e){return t.photoDialogImg[e.index]=e.value},setCropImgShow:function(t,e){return t.cropImgShow[e.index]=e.value},setTemplateErrorMsg:function(t,e){t.templateErrorMsg=e},setIfChangeImage:function(t,e){t.ifChangeImage=e},setCarvingDialogVisibleNew:function(t,e){return t.carvingDialogVisibleNew=e}},c={setCustomInfo:function(t,e){t.commit("setCustomInfo",e)},setDialogCount:function(t,e){t.commit("setDialogCount",e)},setPhotoDialogVisible:function(t,e){t.commit("setPhotoDialogVisible",e)},setAnotherImg:function(t,e){t.commit("setAnotherImg",e)},setPhotoCrop:function(t,e){t.commit("setPhotoCrop",e)},setPhotoAi:function(t,e){t.commit("setPhotoAi",e)},setPhotoOrigin:function(t,e){t.commit("setPhotoOrigin",e)},setEngravingCrop:function(t,e){t.commit("setEngravingCrop",e)},hideFooter:function(t){t.commit("hide")},showFooter:function(t){t.commit("show")},getNewNum:function(t,e){t.commit("newNum",e)},actionschangetest:function(t){t.commit("changetest")},setFusionPreview:function(t,e){t.commit("setFusionPreview",e)},setPhotoDialogVisibleNormal:function(t,e){t.commit("setPhotoDialogVisibleNormal",e)},setCropPhoto:function(t,e){t.commit("setCropPhoto",e)},setPhotoDialogImg:function(t,e){t.commit("setPhotoDialogImg",e)},setCropImgShow:function(t,e){t.commit("setCropImgShow",e)},setTemplateErrorMsg:function(t,e){t.commit("setTemplateErrorMsg",e)},setIfChangeImage:function(t,e){t.commit("setIfChangeImage",e)},setCarvingDialogVisibleNew:function(t,e){t.commit("setCarvingDialogVisibleNew",e)}},d=new r["a"].Store({state:o,getters:s,mutations:l,actions:c}),h=d,p=(a("0fae"),a("9e1f"),a("450d"),a("6ed5")),g=a.n(p),m=(a("0c67"),a("299c")),u=a.n(m),v=(a("826b"),a("c263")),f=a.n(v),x=(a("4ffc"),a("946e")),b=a.n(x),C=(a("a586"),a("7464")),y=a.n(C),w=(a("b0ee"),a("d180")),T=a.n(w),O=(a("a335"),a("c0bb")),I=a.n(O),S=(a("de31"),a("c69e")),_=a.n(S),k=(a("a769"),a("5cc3")),E=a.n(k),j=(a("adec"),a("3d2d")),L=a.n(j),A=(a("aaa5"),a("a578")),N=a.n(A),F=(a("6b30"),a("c284")),B=a.n(F),P=(a("f225"),a("89a9")),D=a.n(P),z=(a("f4f9"),a("c2cc")),M=a.n(z),W=(a("7a0f"),a("0f6c")),U=a.n(W),R=(a("1951"),a("eedf")),q=a.n(R),V=(a("6611"),a("e772")),H=a.n(V),Y=(a("1f1a"),a("4e4b")),X=a.n(Y),J=(a("560b"),a("dcdc")),G=a.n(J),Q=(a("fe07"),a("6ac5")),Z=a.n(Q),K=(a("b5d8"),a("f494")),tt=a.n(K),et=(a("10cb"),a("f3ad")),at=a.n(et),it=(a("a7cc"),a("df33")),nt=a.n(it),rt={install:function(t){t.use(nt.a),t.use(at.a),t.use(tt.a),t.use(Z.a),t.use(G.a),t.use(X.a),t.use(H.a),t.use(q.a),t.use(U.a),t.use(M.a),t.use(D.a),t.use(B.a),t.use(N.a),t.use(L.a),t.use(E.a),t.use(_.a),t.use(I.a),t.use(T.a),t.use(y.a),t.use(b.a),t.use(f.a),t.use(u.a),t.prototype.$msgbox=g.a}},ot=rt,st=a("b2d6"),lt=a.n(st),ct=a("4897"),dt=a.n(ct),ht=(a("6107"),a("ed2c"),a("3394"),a("9541")),pt=a.n(ht),gt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("PhotoCarving")],1)},mt=[],ut=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"zen-photo-carving"},[t._l(t.cropItems,function(t,e){return a("div",{key:t.id,staticClass:"crop-container"},[a("CropDialog",{ref:"cropDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.photoItems,function(t,e){return a("div",{key:t.id,staticClass:"photo-container",attrs:{id:"photo-container-"+e}},[a("PhotoDialog",{ref:"PhotoDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.crystalItems,function(t,e){return a("div",{key:t.id,staticClass:"crystal-container"},[a("CrystalDialog",{ref:"CrystalDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.photoCrystalItems,function(t,e){return a("div",{key:t.id},[a("PhotoCrystalDialog",{ref:"PhotoCrystalDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.nameCarvingItems,function(t,e){return a("div",{key:t.id,staticClass:"name-container"},[a("NameCarvingDialog",{ref:"NameCarvingDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.curveCarvingItems,function(t,e){return a("div",{key:t.id,staticClass:"curve-container"},[a("CurveCarvingDialog",{ref:"CurveCarvingDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.carvingItems,function(t,e){return a("div",{key:t.id,staticClass:"carving-container"},[a("CarvingDialog",{ref:"CarvingDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.crystalTextItems,function(t,e){return a("div",{key:t.id,staticClass:"crystal-text-container"},[a("CrystalText",{ref:"CrystalText",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),t._l(t.flipPhotoItems,function(t,e){return a("div",{key:t.id,staticClass:"flip-photo-container",attrs:{id:"flip-photo-container-"+e}},[a("FlipPhotoDialog",{ref:"FlipPhotoDialog",refInFor:!0,attrs:{param:{data:t,index:e}}})],1)}),a("SelectDialog",{ref:"selectDialog"}),a("div",{staticClass:"hidden-input"},[a("input",{staticClass:"zen-require",attrs:{type:"text",name:"properties[customInfo]",required:"required"},domProps:{value:this.$store.getters.getCustomInfo}})])],2)},vt=[],ft=a("bd86"),xt=(a("3b2b"),a("a481"),a("a032"),a("6b54"),a("7618")),bt=(a("34ef"),a("28a5"),a("bc3a")),Ct=a.n(bt),yt=a("cea2"),wt=window;void 0==wt._zenConfig?(console.log("not defined"),wt._zenConfig={}):console.log("has defined");var Tt=wt._zenConfig;Tt.qncdn=Tt.qncdn?Tt.qncdn:"https://spic.qn.cdn.imaiyuan.com/",Tt.awcdn=Tt.awcdn?Tt.awcdn:"https://pic.stylelab.com/",Tt.tokencdn=Tt.awcdn+"assist/uptoken",Tt.qiniuObj="",Tt.qiniuObjOrigin="",Tt.randomString=function(t){t=t||32;for(var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=e.length,i="",n=0;n<t;n++)i+=e.charAt(Math.floor(Math.random()*a));return i},Tt.convertBase64ToBlob=function(t){var e=t.split(","),a="",i="";e.length>1&&(i=e[1],a=e[0].substring(e[0].indexOf(":")+1,e[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},Tt.awUpload=function(t,e,a){Ct()({method:"post",url:Tt.awcdn+"pictured/capture",responseType:"json",headers:{"Content-Type":"text/plain;charset=utf-8"},onUploadProgress:function(t){t.lengthComputable&&(a.percentage=parseInt(t.loaded/t.total*100))},data:t}).then(function(t){e(t.data)}).catch(function(t){console.log(t)})},Tt.cdnUpload=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i="",n="";"object"==Object(xt["a"])(t)?(n=t.base64,i=t.key):(n=t,i=Tt.randomString(12)+".png"),Ct.a.get(Tt.tokencdn).then(function(t){var r=t.data.token,o={region:yt["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l={next:function(t){a&&(a.percentage=parseInt(t.total.percent))},error:function(t){console.log(t.code),console.log(t.message),console.log(t.isRequestError),console.log(t.reqId)},complete:function(t){e({picture:Tt.qncdn+t.key})}},c=Tt.convertBase64ToBlob(n),d=yt["upload"](c,i,r,s,o);d.subscribe(l)}).catch(function(t){console.log(t)})},Tt.cdnUploadNew=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i="",n="";"object"==Object(xt["a"])(t)?(n=t.base64,i=t.key):(n=t,i=Tt.randomString(12)+".png"),Ct.a.get(Tt.tokencdn).then(function(t){var r=t.data.token,o={region:yt["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l={next:function(t){a&&(a.percentage=parseInt(t.total.percent))},error:function(t){console.log(t.code),console.log(t.message),console.log(t.isRequestError),console.log(t.reqId)},complete:function(t){e({picture:Tt.qncdn+t.key})}},c=Tt.convertBase64ToBlob(n),d=yt["upload"](c,i,r,s,o);a.cropQiniuObj=d.subscribe(l)}).catch(function(t){console.log(t)})},Tt.cdnUploadNewOrigin=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i="",n="";"object"==Object(xt["a"])(t)?(n=t.base64,i=t.key):(n=t,i=Tt.randomString(12)+".png"),Ct.a.get(Tt.tokencdn).then(function(t){var r=t.data.token,o={region:yt["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l={next:function(t){a&&(a.percentage=parseInt(t.total.percent))},error:function(t){console.log(t.code),console.log(t.message),console.log(t.isRequestError),console.log(t.reqId)},complete:function(t){e({picture:Tt.qncdn+t.key})}},c=Tt.convertBase64ToBlob(n),d=yt["upload"](c,i,r,s,o);Tt.qiniuObjOrigin=d.subscribe(l)}).catch(function(t){console.log(t)})},Tt.asyncCdnUpload=function(t,e,a){return new Promise(function(i,n){Ct.a.get(Tt.tokencdn).then(function(n){var r=n.data.token,o={region:yt["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l={next:function(t){a&&(a.percentage=parseInt(t.total.percent))},error:function(t){console.log(t.code),console.log(t.message),console.log(t.isRequestError),console.log(t.reqId)},complete:function(t){i(Tt.qncdn+t.key)}},c=Tt.convertBase64ToBlob(t),d=yt["upload"](c,e,r,s,o);d.subscribe(l)}).catch(function(t){console.log(t)})})},Tt.defaultFunction=function(){return new Promise(function(t,e){t()})},Tt.convertBase64ToBlob=function(t){var e=t.split(","),a="",i="";e.length>1&&(i=e[1],a=e[0].substring(e[0].indexOf(":")+1,e[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},Tt.getLen=function(t,e){var a=-1,i=t.length,n=0;while(++a<i){var r="0x"+t[a].codePointAt(0).toString(16);if(r>=55296&&r<=56319){n=1;break}if(this.isEmojiCharacter(r)&&e.length>0&&e.indexOf(r)<0){n=1;break}}return n},Tt.isEmojiCharacter=function(t){return 8448<=t&&t<=10239||(11013<=t&&t<=11015||(10548<=t&&t<=10549||(12951<=t&&t<=12953||(169==t||174==t||12349==t||12336==t||11093==t||11036==t||11035==t||11088==t||void 0))))},Tt.dispatchCustomEvent=function(t,e){var a=new CustomEvent(t,{detail:e});window.dispatchEvent(a)},Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},Tt.getFilename=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?"scrop/"+(new Date).Format("yyyyMMdd")+"/"+(new Date).Format("yyyyMMddhhmmss")+this.randomString(t):"scrop/"+(new Date).Format("yyyyMMdd")+"/"+this.randomString(t)},Tt.asyncFusion=function(t,e,a){return new Promise(function(i,n){var r={sku:t,tpl:e,image_base64:a,rspType:"base64"};Ct.a.post("https://ai.soufeel.com/reflect/faceFuse/template",r).then(function(t){if(console.log("res1=>",t),0==t.data.error){var e="data:image/png;base64,"+t.data.base64,a=new Image;a.src=e,a.onload=function(){var e=1e3,n=.7,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(e,a.width)/a.width,Math.min(e,a.height)/a.height);r.width=a.width*s,r.height=a.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),t.data.base64=r.toDataURL("image/jpeg",n),i(t)}}else i(t)})})},Tt.trimCanvas=function(t){var e=t.getContext("2d"),a=document.createElement("canvas").getContext("2d"),i=t.width,n=t.height,r=e.canvas.width/t.width;r>1&&(e.scale(1/r,1/r),Tt.zoomIt(t,1/r),e=t.getContext("2d"));var o,s,l,c=e.getImageData(0,0,i,n),d=c.data.length,h={top:null,left:null,right:null,bottom:null};for(o=0;o<d;o+=4)0!==c.data[o+3]&&(s=o/4%i,l=~~(o/4/i),null===h.top&&(h.top=l),null===h.left?h.left=s:s<h.left&&(h.left=s),null===h.right?h.right=s:h.right<s&&(h.right=s),null===h.bottom?h.bottom=l:h.bottom<l&&(h.bottom=l));var p=h.bottom-h.top,g=h.right-h.left,m=e.getImageData(h.left,h.top,g,p);return a.canvas.width=g,a.canvas.height=p,a.putImageData(m,0,0),a.canvas},Tt.zoomIt=function(t,e){if(t.setHeight(t.getHeight()*e),t.setWidth(t.getWidth()*e),t.backgroundImage){var a=t.backgroundImage;a.width=a.width*e,a.height=a.height*e,a.left=a.left*e,a.top=a.top*e}if(t.overlayImage){var i=t.overlayImage;i.width=i.width*e,i.height=i.height*e,i.left=i.left*e,i.top=i.top*e}var n=t.getObjects();for(var r in n){var o=n[r].scaleX,s=n[r].scaleY,l=n[r].left,c=n[r].top,d=o*e,h=s*e,p=l*e,g=c*e;n[r].scaleX=d,n[r].scaleY=h,n[r].left=p,n[r].top=g,n[r].setCoords()}t.renderAll(),t.calcOffset()};var Ot=Tt,It=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"photo-box"},[0==t.photoStyle?a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow>1,expression:"isShow > 1"}],class:t.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[this.photoCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.photoCrop[t.param.index],width:"50",height:"40"},on:{click:function(e){return t.openimage()}}}):t._e(),t.cutDialogText&&t.anotherImg?a("img",{staticClass:"preview-thumbnail",attrs:{src:t.anotherImg,width:"50",height:"40"},on:{click:function(e){return t.openimage(t.anotherImg)}}}):t._e(),t.engravingCrop?a("img",{staticClass:"preview-thumbnail carving-preview-img",attrs:{src:t.engravingCrop,width:"50",height:"40"},on:{click:function(e){return t.openimage(t.engravingCrop)}}}):t._e(),this.photoCrop[t.param.index]?a("i",{staticClass:"show-img-icon",on:{click:function(e){return t.openimage()}}}):t._e(),this.photoCrop[t.param.index]?t._e():a("span",{staticClass:"area-photo-upload-text"},[t._v(t._s(t.uploadLabel)),t.hasNo?a("span",[t._v(" "+t._s(t.param.index+1))]):t._e(),t.photoRemark?a("span",[t._v(t._s(t.photoRemark))]):t._e(),t.requireVal?a("font",{attrs:{color:"red"}},[t._v("*")]):t._e()],1)]),a("div",{staticClass:"area-photo-upload-flex"},[t.isZuploader?a("button",{staticClass:"btn-upload-open",attrs:{type:"button"},on:{click:function(e){return t.zupload()}}},[t._v(t._s(t.btnUploadText))]):t.photoTemplateImages?a("button",{staticClass:"btn-upload-open",attrs:{type:"button"},on:{click:function(e){t.centerDialogVisible=!0}}},[t._v(t._s(t.btnUploadText))]):a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload,accept:t.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[t._v(t._s(this.btnUploadText))])])],1)]):t._e(),1==t.photoStyle&&this.photoCrop[t.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai",staticStyle:{height:"0px !important"}},[a("img",{staticClass:"avatar",staticStyle:{height:"0px !important"},attrs:{src:this.photoCrop[t.param.index]}})]):t._e(),1==t.photoStyle?a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow>1,expression:"isShow > 1"}],staticClass:"area-photo-upload-rect"},[a("el-upload",{staticClass:"avatar-uploader photo-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload,accept:t.uploadAccept}},[this.photoCrop[t.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai"},[a("img",{staticClass:"avatar",attrs:{src:this.photoCrop[t.param.index]}})]):t._e(),this.photoCrop[t.param.index]?t._e():a("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),this.photoCrop[t.param.index]?t._e():a("span",{staticClass:"upload-label"},[t._v(t._s(t.uploadLabel)),t.hasNo?a("span",[t._v(" "+t._s(t.param.index+1))]):t._e()])]),t.cutDialogText&&this.photoCrop[t.param.index]?a("img",{staticClass:"avatar-new",attrs:{src:this.photoCrop[t.param.index]}}):t._e(),t.cutDialogText&&t.anotherImg?a("img",{staticClass:"another-img",attrs:{src:t.anotherImg}}):t._e()],1):t._e(),a("div",{class:t.requirePromptTextClass},[t._v(t._s(t.requirePrompt))]),a("el-dialog",{staticClass:"select-carving-dialog",attrs:{title:"",visible:t.carvingVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.carvingVisible=e}}},[a("div",{staticClass:"carving-crop-img"},[this.photoCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.photoCrop[t.param.index],width:"250"}}):t._e()]),a("div",{staticClass:"tc mt20"},[a("button",{staticClass:"el-button el-button--danger",on:{click:function(e){return t.addCarving(1)}}},[t._v(t._s(t.addCarvingText))])]),a("div",{staticClass:"select-or-text tc"},[t._v(t._s(t.selectOrText))]),a("div",{staticClass:"tc"},[a("button",{staticClass:"el-button el-button--primary",on:{click:function(e){return t.addCarving(0)}}},[t._v(t._s(t.noCarvingText))])])]),a("el-dialog",{attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[""!==t.cutDialogText?a("div",{staticClass:"cutDialogBox"},[a("a",{attrs:{href:"javascript: void(0)"},on:{click:t.cutDialog}},[t._v(t._s(t.cutDialogText))])]):t._e(),a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),t.hasCropImg?t._e():a("div",{directives:[{name:"show",rawName:"v-show",value:t.toolShow,expression:"toolShow"}],staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt photo-prompt",domProps:{innerHTML:t._s(t.cropPrompt)}}),t.noteText?a("div",{staticClass:"crop-note"},[t._v(t._s(t.noteText))]):t._e(),t.hasCropImg?a("div",{directives:[{name:"show",rawName:"v-show",value:t.templateErrorMsg,expression:"templateErrorMsg"}],staticClass:"template-error"},[t._v(t._s(t.templateErrorMsg))]):t._e(),t.photoTemplateImages?a("div",{staticClass:"template-images-container"},[a("div",{staticClass:"template-title"},[t._v(t._s(t.photoTemplateTitle))]),a("ul",t._l(t.photoTemplateImages,function(e,i){return a("li",{key:i,class:{templateBorder:t.photoTemplateSelect[i],pointerEvent:t.photoLoad},on:{click:function(a){return t.changePhotoTemplate(e,i)}}},[a("img",{attrs:{src:e}})])}),0)]):t._e(),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1),a("div",{staticClass:"fuzzyMsg"},[t._v(t._s(t.fuzzyMsg))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:t.cancelCanvas}},[t._v(t._s(t.photoCancelText))]),t.photoTemplateImages?a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.ifChangeImage,expression:"!ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:t.isLoading,disabled:t.photoLoad},on:{click:t.templateImage}},[t._v(t._s(t.photoConfirmText))]):a("el-button",{directives:[{name:"show",rawName:"v-show",value:!t.ifChangeImage,expression:"!ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:t.isLoading,disabled:t.hasCropImg&&!t.previewImg||t.photoLoad},on:{click:t.photoImage}},[t._v(t._s(t.photoConfirmText))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.ifChangeImage,expression:"ifChangeImage"}],staticClass:"photo-confirm-btn",attrs:{type:"primary"},on:{click:t.changeImage}},[t._v(t._s(t.changeImgText))])],1)]),t.inLoading&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.uploadLoadingImage}})])]):t._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{directives:[{name:"show",rawName:"v-show",value:t.previewImg||!t.hasCropImg,expression:"previewImg || !hasCropImg"}],attrs:{id:t.photoCanvasId}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.previewImg&&!t.templateErrorMsg&&t.hasCropImg,expression:"!previewImg && !templateErrorMsg && hasCropImg"}],staticClass:"lds-ring-box"},[t._m(0)]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.templateErrorMsg&&t.hasCropImg,expression:"templateErrorMsg && hasCropImg"}],staticClass:"lds-ring-box"},[a("svg",{staticClass:"icon",staticStyle:{width:"64px",height:"64px","vertical-align":"middle",fill:"currentColor",overflow:"hidden",color:"#000"},attrs:{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1031"}},[a("path",{attrs:{d:"M593.8176 168.5504l356.00384 595.21024c26.15296 43.74528 10.73152 99.7376-34.44736 125.05088-14.39744 8.06912-30.72 12.30848-47.37024 12.30848H155.97568C103.75168 901.12 61.44 860.16 61.44 809.61536c0-16.09728 4.38272-31.92832 12.71808-45.8752L430.16192 168.5504c26.17344-43.7248 84.00896-58.65472 129.20832-33.34144a93.0816 93.0816 0 0 1 34.44736 33.34144zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88z m0-512a72.31488 72.31488 0 0 0-71.76192 81.3056l25.72288 205.7216a46.40768 46.40768 0 0 0 92.07808 0l25.72288-205.74208A72.31488 72.31488 0 0 0 512 307.2z","p-id":"1032"}})])])])],1)},St=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lds-ring"},[a("div"),a("div"),a("div"),a("div")])}],_t=(a("ac6a"),function(){var t=function(t){this.canvas="",this.cWidth="",this.cHeight="",this.isMobile="",this.baseWidth="",this.fixWidth=""};return t.prototype={setCanvaSize:function(){var t=window.innerWidth;this.fixWidth?this.width=this.fixWidth:t<=414?(this.width=t-70,this.isMobile=1):t>768&&t<=1024?(this.width=240,this.isPad=1):(this.isPc=1,this.width=this.baseWidth?this.baseWidth:500),this.height=this.width*this.cHeight/this.cWidth,this.scale=this.width/this.cWidth,this.canvas.setWidth(this.width),this.canvas.setHeight(this.height)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},serverUpload:function(t,e,a,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this;$.ajax({type:"POST",url:n.picurl+"pictured/capture",dataType:"json",data:{width:n.cWidth,height:n.cHeight,scaleX:n.request.scaleX*n.cWidth/n.width,scaleY:n.request.scaleY*n.cWidth/n.width,left:n.request.left*n.cWidth/n.width,top:n.request.top*n.cWidth/n.width,angle:n.request.angle,type:n.type,sku:n.sku,bgcolor:n.request.bgcolor||"",origin_data:n.request.originImage},beforeSend:function(){e()},xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){a(t)},!1),t},success:function(t){200==t.state?i(t):500==t.state&&console.log(500)}})},cdnAsyncUpload:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(e,a){Ct()({method:"post",url:Ot.tokencdn,dataType:"json"}).then(function(a){t(a.data.token,e)}).catch(function(t){console.log(t)})})},cdnUpload:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];$.ajax({type:"POST",async:!1,url:this.picurl+"assist/uptoken",dataType:"json",success:function(e){t(e.token)}})},convertBase64ToBlob:function(t){var e=t.split(","),a="",i="";e.length>1&&(i=e[1],a=e[0].substring(e[0].indexOf(":")+1,e[0].indexOf(";")));for(var n=atob(i),r=new ArrayBuffer(n.length),o=new Uint8Array(r),s=0;s<n.length;s++)o[s]=n.charCodeAt(s);return new Blob([r],{type:a})},randomString:function(t){t=t||32;var e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",a=e.length,n="";for(i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*a));return n}},t}());_t.util={awcdn:window._zenConfig.awcdn?window._zenConfig.awcdn:"https://pic.stylelab.com/",qncdn:window._zenConfig.qncdn?window._zenConfig.qncdn:"https://spic.qn.cdn.imaiyuan.com/",pdir:"img/photo/",cdir:"img/textdesign/",testConsole:function(){console.log("123")},getBasePhotoImg:function(t){return this.picurl+this.pdir+t+".png"},carvingTextObj:{},bigCarvingTexObj:[]};var kt=_t,Et=a("09b8"),jt=function(){function t(t){this.init(t)}return t.prototype=Object.assign(new kt,{request:{},init:function(t){this.canvas=new Et["fabric"].Canvas(t["canvasid"]),this.cWidth=t.cWidth,this.cHeight=t.cHeight,this.baseImg=!!t.baseImg&&t.baseImg,this.type=t.type,this.sku=t.sku,this.bgcolor=t.bgcolor?t.bgcolor:"",this.isAiColor=t.isAiColor?t.isAiColor:"",this.ainame=t.ainame?t.ainame:"",this.isAiLucid=t.isAiLucid?t.isAiLucid:0,this.hasCropImg=!0===t.hasCropImg,this.quality=t.quality?t.quality:.5,this.compressSize=t.compressSize?t.compressSize:2500,this.coverPhoto=t.coverPhoto,this.bgImg=t.bgImg,this.isBgImg=t.isBgImg,this.isLockRotate=!0===t.isLockRotate,this.grayscale=!0===t.grayscale,this.photoTemplateCoord=t.photoTemplateCoord,this.photoTemplateImages=t.photoTemplateImages,this.flipX=!0===t.flipX,this.selectable=!1!==t.selectable,this.canvasScale=1,this.setCanvaSize(),this.setObject(this,this.baseImg),this.hasCropImg||this.photoTemplateImages||this.flipX||this.setBindMethod(this)},setObject:function(t,e){if(this.setCanvaSize(),t.canvasScale=t.scale,console.log(t.canvasScale),1==t.isBgImg){var a=t.bgImg;a||(a=kt.util.awcdn+kt.util.pdir+t.sku+"-bg.png"),t.canvas.setBackgroundImage(a+"?"+Math.random(),t.canvas.renderAll.bind(t.canvas),{scaleX:t.scale,scaleY:t.scale,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous"})}t.canvas.setOverlayImage(e,t.canvas.renderAll.bind(t.canvas),{originX:"left",originY:"top",scaleX:t.scale,scaleY:t.scale,crossOrigin:"anonymous"}),console.log(this.canvas)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},adjuster:function(t){var e=this.getBs();if(e){switch(t){case"move-left":e.set({left:e.left-5});break;case"move-right":e.set({left:e.left+5});break;case"move-up":e.set({top:e.top-5});break;case"move-down":e.set({top:e.top+5});break;case"zoom-big":e.set({scaleX:e.scaleX+.01,scaleY:e.scaleY+.01});break;case"zoom-small":e.set({scaleX:e.scaleX-.01,scaleY:e.scaleY-.01});break;case"rotate-left":e.set({angle:e.angle-45}).setCoords();break;case"rotate-right":e.set({angle:e.angle+45}).setCoords();break;case"reset":e.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords();break}this.setCoor()}},rotate:function(t){var e=this.getBs();if(e){var a="rotate_left"==t?-45:45;e.set({angle:e.angle+a}).setCoords(),this.setCoor()}},reset:function(){var t=this.getBs();t&&(t.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords(),this.setCoor())},setScale:function(t,e){var a=1;return t.width>e.width||t.height>e.height*a?(t.width>e.width&&(a=t.width/e.width),t.height>e.height*a&&(a*=t.height/(e.height*a))):a=e.height>e.width?t.width/e.width:t.height/e.height,a},setBindMethod:function(t){this.listenWheel(this,!0)},compressOld:function(t,e){var a=new Image;a.src=e,a.onload=function(){var a=.5,i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height),e=i.toDataURL("image/png",a),t.request.originImage=e}},compress:function(t,e){var a=new Image;a.src=e,a.onload=function(){var i=t.compressSize,n=t.quality,r=document.createElement("canvas"),o=r.getContext("2d");if(t.request.scale=Math.min(Math.min(i,a.width)/a.width,Math.min(i,a.height)/a.height),r.width=a.width*t.request.scale,r.height=a.height*t.request.scale,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),t.grayscale){for(var s=o.getImageData(0,0,this.width,this.height),l=0;l<s.height;l++)for(var c=0;c<s.width;c++){var d=4*l*s.width+4*c,h=(s.data[d]+s.data[d+1]+s.data[d+2])/3;s.data[d]=h,s.data[d+1]=h,s.data[d+2]=h}o.putImageData(s,0,0,0,0,s.width,s.height)}e=r.toDataURL("image/jpeg",n),t.request.originImage=e}},changeTemplate:function(t,e,a){if(console.log(this.scale),t.canvas.getObjects().length>0)var i=t.getBs();i&&"image"===i.type&&t.canvas.remove(i),Et["fabric"].Image.fromURL(e,function(e){e.hasControls=!1,e.hasBorders=!1;var i=t.photoTemplateCoord.width/e.width*this.scale,n=t.photoTemplateCoord.height/e.height*this.scale;e.set({scaleX:i,scaleY:n,left:t.photoTemplateCoord.left*t.scale,top:t.photoTemplateCoord.top*t.scale,lockMovementX:!0,lockMovementY:!0}),t.canvas.add(e),t.canvas.renderAll(),a()}.bind(t),{crossOrigin:"anonymous"})},change:function(t,e){if(t.compress(t,e),t.canvas.getObjects().length>0)var a=this.getBs();if(t.grayscale){var i=new Image;i.src=e,i.onload=function(){var i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height);for(var s=n.getImageData(0,0,this.width,this.height),l=0;l<s.height;l++)for(var c=0;c<s.width;c++){var d=4*l*s.width+4*c,h=(s.data[d]+s.data[d+1]+s.data[d+2])/3;s.data[d]=h,s.data[d+1]=h,s.data[d+2]=h}n.putImageData(s,0,0,0,0,s.width,s.height),e=i.toDataURL("image/png"),a&&"image"===a.type?a.setSrc(e,function(){t.coverPhoto?t.scale=t.setScale(t,a):t.scale=t.height>a.height?1:t.height/a.height,a.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale}),t.canvas.renderAll(!0),t.setCoor()}):Et["fabric"].Image.fromURL(e,function(e){e.hasControls=!1,e.hasBorders=!1,t.isLockRotate&&(e.lockRotation=!0),e.set({originX:"center",originY:"center"}),t.coverPhoto?t.scale=t.setScale(t,e):t.scale=t.height>e.height?1:t.height/e.height,e.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale}),t.canvas.add(e),t.canvas.sendToBack(e),t.canvas.renderAll(),t.setCoor()})}}else a&&"image"===a.type?a.setSrc(e,function(){t.coverPhoto?t.scale=t.setScale(t,a):t.scale=t.height>a.height?1:t.height/a.height,a.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale,flipX:t.flipX,selectable:t.selectable}),t.canvas.renderAll(!0),t.setCoor()}):Et["fabric"].Image.fromURL(e,function(e){e.hasControls=!1,e.hasBorders=!1,t.isLockRotate&&(e.lockRotation=!0),e.set({originX:"center",originY:"center"}),t.coverPhoto?t.scale=t.setScale(t,e):t.scale=t.height>e.height?1:t.height/e.height,e.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale,flipX:t.flipX,selectable:t.selectable}),t.canvas.add(e),t.canvas.sendToBack(e),t.canvas.renderAll(),t.setCoor()})},setCoor:function(){var t=this.getBs();t&&(this.request.scaleX=t.scaleX,this.request.scaleY=t.scaleY,this.request.left=t.left,this.request.top=t.top,this.request.angle=t.angle,this.canvas.renderAll())},addObject:function(t,e){Et["fabric"].Image.fromURL(e[0],function(a){a.set({originX:"center",originY:"center"}),1==t.isMobile?a.set({left:t.width/2,top:t.height/2,scaleX:150/a.width,scaleY:150/a.width}):a.set({left:t.cWidth/2,top:t.cHeight/2,scaleX:300/a.width,scaleY:300/a.width});var i=e[1],n=t.canvas.item(i);a.opacity=e[2],a.selectable=e[3],a.hasBorders=e[4],a.hasControls=e[5],t.canvas.remove(n).add(a).moveTo(a,i).renderAll(),t.setCoor()})},listenWheel:function(t,e){var a=t.canvas.wrapperEl;if(void 0!=a){var i=function(e){var a=0;e=window.event||e,a=e.detail?-e.detail/3:e.wheelDelta/120;e.preventDefault&&e.preventDefault();var i=t.canvas.findTarget(e);if(i){a=a/200;return i.width*i.scaleX>=50||a>0?(i.scaleX+=a,i.scaleY+=a):(i.scaleX=.01,i.scaleY=.01),i.setCoords(),t.setCoor(),!1}},n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.attachEvent?a.attachEvent("on"+n,i,e):a.addEventListener&&a.addEventListener(n,i,e)}}}),t.prototype.constructor=t,t}(),Lt=jt,At={name:"CropDialog",props:["param"],data:function(){return{uploadLabel:Ot.photo[this.param.index].uploadLabel?Ot.photo[this.param.index].uploadLabel:Ot.uploadLabel?Ot.uploadLabel:"Upload your Photo",btnUploadText:Ot.btnUploadText?Ot.btnUploadText:"Upload",changeText:Ot.changeText?Ot.changeText:"Change",photoCancelText:Ot.photoCancelText?Ot.photoCancelText:"Cancel",photoConfirmText:Ot.photoConfirmText?Ot.photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,requirePromptTextClass:"require-prompt-text require-prompt-text-"+this.param.index,photoStyle:Ot.photo[this.param.index].style?Ot.photo[this.param.index].style:0,checkFuzzy:!!Ot.photo[this.param.index].checkFuzzy&&Ot.photo[this.param.index].checkFuzzy,currentLanguage:Ot.photo[this.param.index].currentLanguage?Ot.photo[this.param.index].currentLanguage:"en",isShow:Ot.photo[this.param.index].isShow?Ot.photo[this.param.index].isShow:2,cutDialogText:Ot.photo[this.param.index].cutDialogText?Ot.photo[this.param.index].cutDialogText:"",dialogIndex:Ot.photo[this.param.index].dialogIndex,getVisible:Ot.photo[this.param.index].getVisible,isUpload:0,isLoading:!1,photoBase64:"",cropPrompt:!1===Ot.cropPrompt?"":Ot.cropPrompt,requirePrompt:!1===Ot.requirePrompt?"":Ot.requirePrompt,imgSrc:"",photoCrop:[],photoAi:[],photoOrigin:[],photoCanvasId:"photo-canvas-"+this.param.index,qncdn:Ot.qncdn.qncdn,awcdn:Ot.qncdn.awcdn,dialogWidth:this.$device.mobile?"100%":"40%",isFullscreen:!!this.$device.mobile,centerDialogVisibleVal:!1,percentage:0,fuzzyMsg:"",bgOpacity:Ot.bgOpacity?Ot.bgOpacity:.5,wrapperBackgroudColor:Ot.wrapperBackgroudColor?Ot.wrapperBackgroudColor:"#ffffff",uploadLoadingImage:Ot.uploadLoadingImage?Ot.uploadLoadingImage:"",noteText:Ot.noteText?Ot.noteText:"",fuzzyAsync:!1!==this.param.data.fuzzyAsync,require:!1!==this.param.data.require,requireVal:!1!==this.param.data.require,inLoading:!1,hasCropImg:!0===this.param.data.hasCropImg,changeImgText:this.param.data.changeImgText?this.param.data.changeImgText:"Change Image",addCarvingText:this.param.data.addCarvingText?this.param.data.addCarvingText:"Add Text",noCarvingText:this.param.data.noCarvingText?this.param.data.noCarvingText:"Without Text",selectOrText:this.param.data.selectOrText?this.param.data.selectOrText:"OR",hasCarving:!0===this.param.data.hasCarving,hasSelect:!0===this.param.data.hasSelect,carvingVisible:!1,engravingCrop:"",hasNo:!0===Ot.hasNo,photoLoad:!1,coverPhoto:!0===Ot.coverPhoto,isLockRotate:!0===this.param.data.isLockRotate,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,isModalAppendToBody:!1!==Ot.isModalAppendToBody,uploadAccept:Ot.uploadAccept?Ot.uploadAccept:"",processText:Ot.processText?Ot.processText:"Processing",photoRemark:this.param.data.photoRemark?this.param.data.photoRemark:"",bgImg:this.param.data.bgImg?this.param.data.bgImg:"",isBgImg:this.param.data.isBgImg?this.param.data.isBgImg:0,isZuploader:!0===this.param.data.isZuploader,zuploaderObj:this.param.data.zuploaderObj?this.param.data.zuploaderObj:{},zuploaderSource:"",objData:!0===this.param.data.objData,grayscale:!0===this.param.data.grayscale,dpi:this.param.data.dpi?this.param.data.dpi:72,photoTemplateImages:!!this.param.data.photoTemplateImages&&this.param.data.photoTemplateImages,photoTemplateCoord:this.param.data.photoTemplateCoord?this.param.data.photoTemplateCoord:{},photoTemplateUrl:"",photoTemplateSelect:[],photoTemplateTitle:this.param.data.photoTemplateTitle,toolShow:!1!==this.param.data.toolShow,photoBg:this.param.data.photoBg>-1?this.param.data.photoBg:-1}},computed:{centerDialogVisible:{get:function(){if(this.cutDialogText){var t=this.$store.getters.getPhotoDialogVisible(this.param.index);return t.value}return this.hasCropImg?this.$store.getters.getPhotoDialogVisibleNormal:this.centerDialogVisibleVal},set:function(t){if(this.cutDialogText){var e={id:this.param.index,value:t};this.$store.dispatch("setPhotoDialogVisible",e)}else this.hasCropImg?this.$store.dispatch("setPhotoDialogVisibleNormal",t):this.centerDialogVisibleVal=t}},anotherImg:{get:function(){var t=this.$store.getters.getAnotherImg(this.param.index);return t.value},set:function(t){var e={id:this.param.index,value:t};this.$store.dispatch("setAnotherImg",e)}},previewImg:{get:function(){return this.$store.getters.getFusionPreview},set:function(t){this.$store.dispatch("setFusionPreview",t)}},templateErrorMsg:{get:function(){return this.$store.getters.getTemplateErrorMsg},set:function(t){this.$store.dispatch("setTemplateErrorMsg",t)}},ifChangeImage:{get:function(){return this.$store.getters.getIfChangeImage},set:function(t){this.$store.dispatch("setIfChangeImage",t)}}},mounted:function(){var t=this;Ot.photoObj[this.param.index]=new Lt({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,hasCropImg:t.hasCropImg,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:t.coverPhoto,bgImg:t.bgImg,isBgImg:t.isBgImg,isLockRotate:t.isLockRotate,grayscale:t.grayscale,photoTemplateCoord:t.photoTemplateCoord,photoTemplateImages:t.photoTemplateImages}),t.photoTemplateImages&&(t.photoTemplateUrl=t.photoTemplateImages[0],t.photoTemplateImages.forEach(function(e,a){a>0?t.photoTemplateSelect.push(!1):t.photoTemplateSelect.push(!0)}),t.photoLoad=!0,_zenConfig.photoObj[t.param.index].changeTemplate(_zenConfig.photoObj[t.param.index],t.photoTemplateUrl,function(){t.photoLoad=!1}));var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.photo)||(e.photo=[]),e.photo[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",ai:"",origin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e)),window.changePhotoSku=this.changePhotoSku,window.clearPhoto=this.clearPhoto},methods:{zupload:function(){var t=this;t.zuploaderObj.onConfirm=function(e){var a=new Image;a.src=e[0].objectURL,a.onload=function(){var i=document.createElement("canvas"),n=i.getContext("2d");i.width=a.width,i.height=a.height,n.drawImage(a,0,0,a.width,a.height);var r="jpeg";"undefined"!=typeof e[0].url&&(r=e[0].url.substring(e[0].url.lastIndexOf(".")+1,e[0].url.indexOf("?")).toLowerCase());var o=i.toDataURL("image/"+r);t.photoBase64=o,t.zuploaderSource=e[0].source,_zenConfig.photoObj[t.param.index].change(_zenConfig.photoObj[t.param.index],o),t.centerDialogVisible=!0}},Zuploader.render(t.zuploaderObj)},cancelCanvas:function(){var t=this;t.centerDialogVisible=!1,Ot.dispatchCustomEvent("EVENT_PHOTO_CANCEL_AFTER",{index:t.param.index})},avatarUpload:function(t){var e=this,a=this,i=new FileReader;i.onload=function(t){a.centerDialogVisible=!0,e.photoBase64=t.target.result,e.checkFuzzy&&(a.photoLoad=!0,a.photoConfirmText=a.processText,a.isLoading=!0,e.checkImageFuzzy(e.photoBase64));var i=e.photoBase64;a.cutDialogText?_zenConfig.photoObj.forEach(function(t,e){_zenConfig.photoObj[e].change(_zenConfig.photoObj[e],i)}):_zenConfig.photoObj[a.param.index].change(_zenConfig.photoObj[a.param.index],i)},i.readAsDataURL(t.file)},changePhotoTemplate:function(t,e){var a=this;a.photoLoad=!0,_zenConfig.photoObj[a.param.index].changeTemplate(_zenConfig.photoObj[a.param.index],t,function(){a.photoLoad=!1}),a.photoTemplateUrl=t,a.photoTemplateSelect.forEach(function(t,e){a.$set(a.photoTemplateSelect,e,!1)}),a.$set(a.photoTemplateSelect,e,!0)},onOpened:function(){var t=this;if(this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody),t.photoBg>-1){t.photoLoad=!0;var e="",a=JSON.parse(t.$store.getters.getCustomInfo);"undefined"!=typeof a.photo&&(e=a.photo[t.photoBg].crop),e&&fabric.Image.fromURL(e+"?"+Math.random(),function(e){e.scaleX=Ot.photoObj[t.param.index].canvas.width/e.width,e.scaleY=Ot.photoObj[t.param.index].canvas.height/e.height,Ot.photoObj[t.param.index].canvas.setBackgroundImage(e),Ot.photoObj[t.param.index].canvas.requestRenderAll(),t.photoLoad=!1},{crossOrigin:"Anonymous"})}},openimage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.photoCrop[this.param.index];this.$parent.openimage(t)},doAction:function(t){"reset"==t?this.getBs().set({left:Ot.photoObj[this.param.index].canvas.width/2,top:Ot.photoObj[this.param.index].canvas.height/2,angle:0,scaleX:Ot.photoObj[this.param.index].scale,scaleY:Ot.photoObj[this.param.index].scale}).setCoords():"left"==t?this.getBs().set({angle:this.getBs().angle-45}).setCoords():"right"==t?this.getBs().set({angle:this.getBs().angle+45}).setCoords():"sub"==t?this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords():"add"==t&&this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),Ot.photoObj[this.param.index].canvas.renderAll()},getBs:function(){return Ot.photoObj[this.param.index].canvas.item(0)},templateImage:function(){var t=this;t.uploadLoadingImage&&(t.centerDialogVisible=!1,t.inLoading=!0),this.isLoading=!0;var e=Ot.photoObj[t.param.index].canvas.toDataURL({format:"png",quality:.8});Ot.cdnUpload({base64:e,key:Ot.getFilename(12)+".png"},function(e){t.photoCrop[t.param.index]=e.picture;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.photo)||(a.photo=[]),a.photo[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:e.picture,ai:t.photoTemplateUrl,origin:t.photoTemplateUrl,item:Ot.photoObj[t.param.index].sku},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.centerDialogVisible=!1,t.isLoading=!1,t.inLoading=!1,t.percentage=0,t.btnUploadText=t.changeText,Ot.dispatchCustomEvent("EVENT_PHOTO_SAVE_AFTER",{index:t.param.index,data:a})})},photoImage:function(){var t=this;t.uploadLoadingImage&&(t.centerDialogVisible=!1,t.inLoading=!0),this.isLoading=!0;var e=Ot.photoObj[t.param.index].getBs(),a=Ot.photoObj[t.param.index].request.originImage;t.hasCropImg&&(a=t.previewImg),Ot.awUpload({width:Ot.photoObj[t.param.index].cWidth,height:Ot.photoObj[t.param.index].cHeight,scaleX:e.scaleX*Ot.photoObj[t.param.index].cWidth/Ot.photoObj[t.param.index].width/Ot.photoObj[t.param.index].request.scale,scaleY:e.scaleY*Ot.photoObj[t.param.index].cWidth/Ot.photoObj[t.param.index].width/Ot.photoObj[t.param.index].request.scale,left:e.left*Ot.photoObj[t.param.index].cWidth/Ot.photoObj[t.param.index].width,top:e.top*Ot.photoObj[t.param.index].cWidth/Ot.photoObj[t.param.index].width,angle:e.angle,type:Ot.photoObj[t.param.index].type,sku:Ot.photoObj[t.param.index].sku,ainame:Ot.photoObj[t.param.index].ainame||"",isAiLucid:Ot.photoObj[t.param.index].isAiLucid||0,bgcolor:Ot.photoObj[t.param.index].bgcolor||"",origin_data:a,isAiColor:Ot.photoObj[t.param.index].isAiColor||"",isBgImg:t.isBgImg,dpi:t.dpi},function(a){if(void 0==a.crop?t.photoCrop[t.param.index]="":(t.$set(t.photoCrop,t.param.index,Ot.awcdn+a.crop),console.log("self.photoCrop[self.param.index] *********  "+t.photoCrop[t.param.index])),t.cutDialogText&&t.$store.dispatch("setAnotherImg",{id:t.dialogIndex,value:Ot.awcdn+a.crop}),t.hasCropImg){var i={index:t.param.index,value:Ot.awcdn+a.crop};t.$store.dispatch("setCropPhoto",i)}void 0==a.ai?t.photoAi[t.param.index]="":t.photoAi[t.param.index]=Ot.awcdn+a.ai,void 0==a.origin?t.photoOrigin[t.param.index]="":t.photoOrigin[t.param.index]=Ot.awcdn+a.origin;var n={};if(t.$store.getters.getCustomInfo&&(n=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(n.photo)||(n.photo=[]),n.photo[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:t.photoCrop[t.param.index],ai:t.photoAi[t.param.index],origin:t.photoOrigin[t.param.index],item:Ot.photoObj[t.param.index].sku},t.zuploaderSource&&(n.photo[t.param.index].source=t.zuploaderSource),t.objData){var r=Ot.photoObj[t.param.index].canvasScale,o={};o["width"]=Ot.photoObj[t.param.index].canvas.width,o["height"]=Ot.photoObj[t.param.index].canvas.height;var s={};s["width"]=e.width*e.scaleX,s["height"]=e.height*e.scaleX,s["angle"]=e.angle,s["center_x"]=e.left,s["center_y"]=e.top,n.photo[t.param.index].view_box=o,n.photo[t.param.index].cfgs=s,n.photo[t.param.index].scale=r}t.$store.dispatch("setCustomInfo",JSON.stringify(n)),t.cutDialogText&&0==t.param.index?t.cutDialog():t.centerDialogVisible=!1,t.isLoading=!1,t.inLoading=!1,t.percentage=0,t.btnUploadText=t.changeText,t.hasCarving&&(t.carvingVisible=!0),t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param),Ot.dispatchCustomEvent("EVENT_PHOTO_SAVE_AFTER",{index:t.param.index,data:n})},t)},checkImageFuzzy:function(t){var e=this;e.fuzzyMsg&&gtag("event","Fuzzy_Photo_Change",{event_category:"website"}),e.fuzzyMsg="";var a=new Image;a.src=t,a.onload=function(){var i=Ot.sizeFuzzy?Ot.sizeFuzzy:1e3,n=Ot.qualityFuzzy?Ot.qualityFuzzy:1,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,a.width)/a.width,Math.min(i,a.height)/a.height);r.width=a.width*s,r.height=a.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(a,0,0,r.width,r.height),t=r.toDataURL("image/jpeg",n),e.$ajax({method:"post",async:e.fuzzyAsync,url:"https://ai.soufeel.com/tencent/fuzzy?_language="+this.currentLanguage,data:{image:t}}).then(function(t){t.data.fuzzy&&(e.fuzzyMsg=t.data.msg,gtag("event","Fuzzy_Photo_Show",{event_category:Ot.fuzzyWebsite?Ot.fuzzyWebsite:"website"})),e.checkFuzzy&&(e.photoLoad=!1,e.photoConfirmText=Ot.photoConfirmText?Ot.photoConfirmText:"Confirm",e.isLoading=!1)}).catch(function(t){console.log(t),e.checkFuzzy&&(e.photoLoad=!1,e.photoConfirmText=Ot.photoConfirmText?Ot.photoConfirmText:"Confirm",e.isLoading=!1)})}},cutDialog:function(){this.centerDialogVisible=!1;var t={id:this.dialogIndex,value:!0};this.$store.dispatch("setPhotoDialogVisible",t)},clearPhoto:function(){var t=this;t.photoCrop[t.param.index]="";var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.photo)||(e.photo=[]),e.photo[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",ai:"",origin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e))},changePhotoSku:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ot.photoObj[e].canvas.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ot.photoObj[e].canvas.height,n=this;Ot.photoObj[e].sku=t;var r=Ot.photoUrl+t+".png";n.photoLoad=!0,a!=Ot.photoObj[e].canvas.width&&(Ot.photoObj[e].canvas.setWidth(a),Ot.photoObj[e].canvas.requestRenderAll()),i!=Ot.photoObj[e].canvas.height&&(Ot.photoObj[e].canvas.setHeight(i),Ot.photoObj[e].canvas.requestRenderAll()),fabric.Image.fromURL(r+"?"+Math.random(),function(t){t.scaleX=Ot.photoObj[e].canvas.width/t.width,t.scaleY=Ot.photoObj[e].canvas.height/t.height,Ot.photoObj[e].canvas.setOverlayImage(t),Ot.photoObj[e].canvas.requestRenderAll(),n.photoLoad=!1,console.log(n.photoLoad)},{crossOrigin:"Anonymous"})},changeImage:function(){this.centerDialogVisible=!1;var t=document.getElementsByClassName("crop-btn-upload-open")[0];t.click()},addCarving:function(t){this.carvingVisible=!1,t>0&&this.$parent.$refs.CarvingDialog[this.param.index].open(),Ot.dispatchCustomEvent("SELECT_CARVING_AFTER",{index:this.param.index,data:t})}},watch:{centerDialogVisible:function(t){!0===t?Ot.dispatchCustomEvent("EVENT_PHOTO_DIALOG",{index:this.param.index}):Ot.dispatchCustomEvent("EVENT_PHOTO_DIALOG_CLOSE",{index:this.param.index})}}},Nt=At,Ft=(a("0580"),a("2877")),Bt=Object(Ft["a"])(Nt,It,St,!1,null,"4e882cc0",null),Pt=Bt.exports,Dt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"carving-box"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShow,expression:"isShow"}],class:t.areaCarvingClass},[a("div",{staticClass:"area-carving-preview-text"},[this.engravingCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[t.param.index],width:"50",height:"40"},on:{click:t.openimage}}):a("span",[a("span",{staticClass:"carving-pre-text"},[t._v(t._s(t.previewText))]),t.requireVal?a("font",{attrs:{color:"red"}},[t._v("*")]):t._e()],1)]),a("div",{staticClass:"btn-box",on:{click:t.open}},[t.inputMark?a("span",{staticClass:"input-mark"},[t._v(t._s(t.inputMark))]):t._e(),a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:t.open}},[t._v(t._s(t.btnText))])])]),a("div",{class:t.requireCarvingTextClass},[t._v(t._s(t.requirePrompt))]),a("el-dialog",{staticClass:"carving-dialog",class:{loadingDialog:t.isLoading},attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[t.isLoading&&t.uploadLoadingImage?t._e():a("div",[a("div",{staticClass:"custom-carving-container",staticStyle:{position:"relative"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCanvas,expression:"showCanvas"}],ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{staticClass:"operation-part"},[t.templateImages?a("div",{staticClass:"template-images-container"},[a("div",{staticClass:"template-title"},[t._v(t._s(t.templateTitle))]),a("ul",t._l(t.templateImages,function(e,i){return a("li",{key:e.label,class:{templateBorder:t.templateSelect[i],pointerEvent:t.photoLoad},on:{click:function(a){return t.changeTemplate(e.url,e.label,i)}}},[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.label,placement:"top"}},[a("img",{attrs:{src:e.icon}})]),a("p",{staticClass:"template-label"},[t._v(t._s(e.label))])],1)}),0)]):t._e(),t.isSelectStyle?a("el-row",[t.showFont?a("el-col",{attrs:{span:t.fontSpanNum}},[a("div",[t._v(t._s(t.fontFamilyLabel))]),a("el-select",{staticClass:"slt-font-size",on:{change:t.changeFont},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},t._l(t.engravingFontOptions,function(e){return a("el-option",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,value:e.value}},[t._v("\n                          "+t._s(e.value?e.label:"ABC")+"\n                      ")])}),1)],1):t._e(),t.showSize?a("el-col",{class:{tr:t.isSelectStyle},attrs:{span:t.fontSpanNum}},[a("div",{staticClass:"font-label tl"},[a("span",[t._v(t._s(t.fontSizeLabel))])]),a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:t.changeSize},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1):t._e()],1):t._e(),t.showColor?a("div",{staticClass:"block carving-color-list"},[a("span",{staticClass:"demonstration"},[t._v(t._s(t.fontColorLabel))]),a("el-color-picker",{attrs:{predefine:t.predefineColors},model:{value:t.fontColor,callback:function(e){t.fontColor=e},expression:"fontColor"}})],1):t._e(),a("div",{staticClass:"label-input-text"},[t._v(t._s(t.inputTextLabel))]),t._l(t.coors,function(e,i){return a("div",{key:e.value},[e.title?a("div",{staticClass:"item-title"},[t._v(t._s(e.title))]):t._e(),e.info?a("div",{staticClass:"item-info"},[t._v(t._s(e.info))]):t._e(),"emoji"==e.type?a("el-row",{staticClass:"emoji-container"},[a("el-radio-group",{staticClass:"emoji-part",on:{change:function(a){return t.changeText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}},[e.emojiList?a("el-col",t._l(e.emojiList,function(e){return a("el-radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])}),1):a("el-col",t._l(t.emojiDefaultList,function(e){return a("el-radio",{key:e,attrs:{label:e}},[t._v(t._s(e))])}),1)],1)],1):a("div",{staticClass:"textarea-text carving-textarea-box",class:{carvingError:t.isEmpty[i]}},["date"==e.type?a("el-date-picker",{attrs:{format:t.dateFormat,"value-format":t.dateValueFormat,clearable:t.clearableValue,placeholder:t.datePlaceholder,readonly:t.dateReadonly},on:{change:function(a){return t.changeText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}):"time"==e.type?a("el-time-picker",{attrs:{format:t.timeFormat,"value-format":t.timeValueFormat,clearable:t.clearableValue,"arrow-control":t.arrowControl,placeholder:t.timePlaceholder,readonly:t.dateReadonly},on:{change:function(a){return t.changeText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}):e.isSinglelineInput?a("el-input",{staticClass:"carving-textarea",attrs:{type:"text",placeholder:t.textPlaceHolderList[i],maxlength:t.textMaxlength[i]},on:{input:function(a){return t.changeText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}):a("el-input",{staticClass:"carving-textarea",attrs:{type:"textarea",rows:e.rows,resize:e.resize,placeholder:t.textPlaceHolderList[i],maxlength:t.textMaxlength[i]},on:{input:function(a){return t.changeText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}),t.leftText?a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+i}},[t._v(t._s(t.nameLeftNum[i]))]),t._v(" "+t._s(t.leftText))]):t._e()],1),a("span",{directives:[{name:"show",rawName:"v-show",value:t.carvingEmojiError[i]&&t.errorWordShow,expression:"carvingEmojiError[index] && errorWordShow"}],staticClass:"carvingErrorWord"},[t._v(t._s(t.emojiErrorField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.carvingLimitError[i],expression:"carvingLimitError[index]"}],staticClass:"carvingErrorWord"},[t._v(t._s(t.limitErrorField))]),!e.isSelectStyle&&e.fontList?a("el-row",{staticClass:"rad-font coors-font-list"},[e.fontLabel?a("div",{staticClass:"font-radio-label"},[t._v(t._s(e.fontLabel))]):t._e(),a("el-radio-group",{staticClass:"font-radio-part",on:{change:function(e){return t.changeCoorsFont(i,t.coorsFont[i])}},model:{value:t.coorsFont[i],callback:function(e){t.$set(t.coorsFont,i,e)},expression:"coorsFont[index]"}},[a("el-col",t._l(e.fontList,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1):t._e(),!e.isSelectStyle&&e.sizeList?a("el-row",{staticClass:"size-box"},[e.sizeLabel?a("el-col",{staticClass:"size-label-part"},[t._v(t._s(e.sizeLabel))]):t._e(),a("el-col",{staticClass:"size-select-part",attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:function(a){return t.changeCoorsSize(i,t.coorsSize[i],e.text)}},model:{value:t.coorsSize[i],callback:function(e){t.$set(t.coorsSize,i,e)},expression:"coorsSize[index]"}},t._l(e.sizeList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e()],1)}),a("span",{directives:[{name:"show",rawName:"v-show",value:t.carvingNumoptionErrorWord,expression:"carvingNumoptionErrorWord"}],staticClass:"carvingErrorWord"},[t._v(t._s(t.carvingNumoptionErrorField))]),t._l(t.path,function(e,i){return a("div",{key:e.value},[e.title?a("div",{staticClass:"item-title"},[t._v(t._s(e.title))]):t._e(),e.info?a("div",{staticClass:"item-info"},[t._v(t._s(e.info))]):t._e(),a("div",{staticClass:"textarea-text carving-textarea-box",class:{carvingError:t.isCurveEmpty[i]}},[e.isSinglelineInput?a("el-input",{staticClass:"carving-textarea",attrs:{type:"text",placeholder:t.curvePlaceholderText[i],maxlength:e.limit},on:{input:function(a){return t.changeCurveText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}):a("el-input",{staticClass:"carving-textarea",attrs:{type:"textarea",rows:e.rows,resize:e.resize,placeholder:t.curvePlaceholderText[i],maxlength:e.limit},on:{input:function(a){return t.changeCurveText(i,e.text)}},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}),t.leftText?a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+i}},[t._v(t._s(t.curveLeftNum[i]))]),t._v(" "+t._s(t.leftText))]):t._e()],1),a("span",{directives:[{name:"show",rawName:"v-show",value:t.curveEmojiError[i]&&t.errorWordShow,expression:"curveEmojiError[index] && errorWordShow"}],staticClass:"carvingErrorWord"},[t._v(t._s(t.emojiErrorField))])])}),t.showSize?a("el-row",{staticClass:"size-box"},[t.fontSizeSelectLabel?a("el-col",{staticClass:"size-label-part"},[t._v(t._s(t.fontSizeSelectLabel))]):t._e(),a("el-col",{staticClass:"size-select-part",attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:t.changeSize},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),!t.isSelectStyle&&t.showFont?a("el-row",{staticClass:"rad-font"},[t.fontRadioLabel?a("div",{staticClass:"font-radio-label"},[t._v(t._s(t.fontRadioLabel))]):t._e(),a("el-radio-group",{staticClass:"font-radio-part",on:{change:t.changeFont},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},[a("el-col",t._l(t.engravingFontOptions,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1):t._e(),t.uploadLoadingImage?t._e():a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1),a("div",{staticClass:"carving-prompt"},[t._v(t._s(t.cropPrompt))]),t.ifCarvingHorizontal?a("div",{staticClass:"dialog-footer-carving"},[a("el-button",{staticClass:"btn-carving btn-carving-cancel",on:{click:t.cancelCanvas}},[t._v(t._s(t.cancelText))]),a("el-button",{staticClass:"btn-carving btn-carving-confirm",attrs:{type:"primary",loading:t.isLoading,disabled:t.hasPhoto&&!t.carvingAble||t.oneSide&&!t.carvingAble||t.photoLoad||t.bgLoad},on:{click:t.saveCanvas}},[t._v(t._s(t.confirmText)),t.carvingMarkup?a("span",{staticClass:"carving-markup",domProps:{innerHTML:t._s(t.carvingMarkup)}}):t._e()])],1):t._e()],2)]),t.ifCarvingHorizontal?t._e():a("div",{staticClass:"dialog-footer-carving",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"btn-carving",on:{click:t.cancelCanvas}},[t._v(t._s(t.cancelText))]),a("el-button",{staticClass:"btn-carving",attrs:{type:"primary",loading:t.isLoading,disabled:t.hasPhoto&&!t.carvingAble||t.oneSide&&!t.carvingAble||t.photoLoad},on:{click:t.saveCanvas}},[t._v(t._s(t.confirmText))])],1),a("div",{staticClass:"carving-info"},[a("div",{staticClass:"carving-notice"},[t.actionInfo?a("div",{staticClass:"action-info"},[t._v(t._s(t.actionInfo))]):t._e(),t.noteInfo?a("div",{staticClass:"note-info"},[t._v(t._s(t.noteInfo))]):t._e()]),t.handcraftInfo?a("div",{staticClass:"handcraft-info"},[t._v(t._s(t.handcraftInfo))]):t._e()])]),t.isLoading&&!t.loadingFullScreen&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:t.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1)]):t._e()]),t.isLoading&&t.loadingFullScreen?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.uploadLoadingImage}})])]):t._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:t.carvingCanvasId}})]),t.isTrim||t.isMarginLucency?a("div",{staticStyle:{display:"none"}},[a("canvas",{attrs:{id:"newtrimcanvas"}}),a("img",{attrs:{src:"",id:"my-image"}})]):t._e(),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}}),t.hasPhoto||t.bigBaseImg||t.isBigCarving>0?a("div",{staticClass:"big-canvas-box"},[a("canvas",{attrs:{id:"canvasBig"}}),a("canvas",{attrs:{id:"newbigtrimcanvas"}})]):t._e()],1)},zt=[],$t=(a("456d"),a("5df3"),a("362d")),Mt=a.n($t),Wt=a("0342"),Ut=function(){function t(t){this.init(t)}return t.prototype=Object.assign(new kt,{init:function(t){this.canvas=new fabric.Canvas(t["canvasid"],{enableRetinaScaling:!1}),this.cWidth=t.cWidth||500,this.cHeight=t.cHeight||400,this.fixWidth=t.fixWidth||"",this.coors=t.custom.coors||150,this.imgIn=!!t.in&&t.in,this.imgOut=!!t.out&&t.out,this.sku=t.sku||"",this.textHasControls=t.textHasControls,this.centeredScaling=t.centeredScaling,this.originX=t.originX,this.originY=t.originY,this.fontColor=t.fontColor,this.type=t.type||"",this.isOption=t.custom.isOption||"0",this.checkLimitAreaNewFlag=t.checkLimitAreaNew,this.customIcons=t.customIcons,this.baseWidth=t.baseWidth||"",this.fixWidth=t.fixWidth||"",this.path=t.path,this.textpath=[],this.imageSrc=t.imageSrc,this.templateOut=t.templateOut,this.templateCoord=t.templateCoord,this.isBigCarving=t.isBigCarving||0,this.callback=t.callback||!1,this.coorsNum=this.coors.length,this.text=[],this.setCanvaSize(),this.setObject(this,this.imgIn,this.imgOut),this.canvas.selection=!1,this.path.length>0&&this.initPath(this)},setObject:function(t,e,a){t.templateOut&&t.imageSrc&&(a=t.imageSrc),t.isBigCarving>0?(fabric.Image.fromURL(a+"?"+Math.random(),function(e){e.scaleX=t.canvas.width/e.width,e.scaleY=t.canvas.height/e.height,t.canvas.setOverlayImage(e),t.canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(e+"?"+Math.random(),function(e){e.scaleX=t.canvas.width/e.width,e.scaleY=t.canvas.height/e.height,t.canvas.setBackgroundImage(e),1==t.isBigCarving&&(e.hasControls=!1,e.hasBorders=!1,e.set({left:0,top:0,lockMovementX:!0,lockMovementY:!0,selectable:!1}),t.canvas.add(e),t.canvas.sendToBack(e)),t.callback&&e.width>0&&t.callback(),t.canvas.requestRenderAll()},{crossOrigin:"Anonymous"})):(fabric.Image.fromURL(a+"?"+Math.random(),function(e){e.scaleX=t.cWidth/e.width*t.scale,e.scaleY=t.cHeight/e.height*t.scale,t.canvas.setOverlayImage(e),t.canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(e+"?"+Math.random(),function(e){e.scaleX=t.cWidth/e.width*t.scale,e.scaleY=t.cHeight/e.height*t.scale,t.canvas.setBackgroundImage(e),t.callback&&e.width>0&&t.callback(),t.canvas.requestRenderAll()},{backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"Anonymous"})),t.coors.forEach(function(e,a){var i=e.angle||0,n=e.size*t.scale||20,r=e.font||"TimesNewRoman",o=!1;t.textHasControls&&(o=!0);var s=!1;t.centeredScaling&&(s=!0);var l="center";t.originX&&(l=t.originX);var c="center";t.originY&&(c=t.originY),t.customIcons&&(fabric.Object.prototype.drawControls=function(e,a){a=a||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,o=a.cornerSize||this.cornerSize,s=-(n+o)/2,l=-(r+o)/2,c=("undefined"!==typeof a.transparentCorners?a.transparentCorners:this.transparentCorners,"undefined"!==typeof a.hasRotatingPoint?a.hasRotatingPoint:this.hasRotatingPoint);e.save(),e.strokeStyle=e.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(e.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(e,a.cornerDashArray||this.cornerDashArray,null);var d=new Image;d.src=t.customIcons[0],e.drawImage(d,s,l,this.cornerSize,this.cornerSize);var h=new Image;h.src=t.customIcons[1],e.drawImage(h,s+n,l,this.cornerSize,this.cornerSize);var p=new Image;p.src=t.customIcons[2],e.drawImage(p,s,l+r,this.cornerSize,this.cornerSize);var g=new Image;if(g.src=t.customIcons[3],e.drawImage(g,s+n,l+r,this.cornerSize,this.cornerSize),!this.get("lockUniScaling")){var m=new Image;m.src=t.customIcons[4],e.drawImage(m,s+n/2,l,this.cornerSize,this.cornerSize);var u=new Image;u.src=t.customIcons[5],e.drawImage(u,s+n/2,l+r,this.cornerSize,this.cornerSize);var v=new Image;v.src=t.customIcons[6],e.drawImage(v,s+n,l+r/2,this.cornerSize,this.cornerSize);var f=new Image;f.src=t.customIcons[7],e.drawImage(f,s,l+r/2,this.cornerSize,this.cornerSize)}if(c){var x=new Image;x.src=t.customIcons[8],e.drawImage(x,s+n/2,l-this.rotatingPointOffset,this.cornerSize,this.cornerSize)}return e.restore(),this});var d=0;if("undefined"!=typeof e.bigFlag&&(d=e.bigFlag),t.coors[a].isWrap?t.text[a]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,left:e.left*t.scale,top:e.top*t.scale,angle:i,hasControls:o,borderColor:"#EEE",borderDashArray:[5,10],fontSize:n,fill:e.textColor||t.fontColor,limitArea:e.limitArea}):t.text[a]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:l,originY:c,centeredScaling:s,left:e.left*t.scale,top:e.top*t.scale,angle:i,hasControls:o,borderColor:"#EEE",borderDashArray:[5,10],fontSize:n,fill:e.textColor||t.fontColor,limitArea:e.limitArea,bigFlag:d}),console.log(t.text[a]),"undefined"!=typeof t.coors[a].initialCarving&&t.coors[a].initialCarving){var h=t.coorsNum+a,p="normal";"undefined"!=typeof t.coors[a].initialCarving.fontWeight&&(p=t.coors[a].initialCarving.fontWeight),t.text[h]=new fabric.Text("",{lockRotation:!0,lockScalingX:!0,lockScalingY:!0,originX:"center",originY:"center",centeredScaling:!1,left:t.coors[a].initialCarving.left*t.scale,top:t.coors[a].initialCarving.top*t.scale,angle:t.coors[a].initialCarving.angle||0,hasControls:!1,borderColor:"#EEE",borderDashArray:[5,10],fontSize:t.coors[a].initialCarving.size*t.scale,fill:t.coors[a].initialCarving.color||t.fontColor,fontWeight:p}),1==t.coors[a].initialCarving.banDrag&&(t.text[h].lockMovementX=!0,t.text[h].lockMovementY=!0,t.text[h].set("borderScaleFactor",0));var g=t.coors[a].initialCarving.font||"TimesNewRoman";t.changeFont(g,h),t.canvas.add(t.text[h])}if(t.canvas.on("object:moving",function(e){var i=e.target;t.checkLimitAreaNewFlag?t.checkLimitAreaNew(i,a):t.checkLimitArea(i,i.limitArea)}),t.changeFont(r,a),e.shadowColor&&t.text[a].setShadow({color:e.shadowColor,blur:-10,offsetX:1.5,offsetY:1.5}),"undefined"!=typeof e.stroke){var m=1;"undefined"!=typeof e.strokeWidth&&(m=e.strokeWidth),t.text[a].set({stroke:e.stroke,strokeWidth:m}),"undefined"!=typeof e.strokeDashArray&&t.text[a].set({strokeDashArray:e.strokeDashArray})}1==e.banDrag&&(t.text[a].lockMovementX=!0,t.text[a].lockMovementY=!0,t.text[a].set("borderScaleFactor",0)),t.canvas.add(t.text[a]),t.canvas.renderAll()}),t.imageSrc&&!t.templateOut&&t.changeTemplate(t,t.imageSrc)},changeImage:function(t,e){if(t.canvas.getObjects().length>0)var a=t.getBs();a&&"image"===a.type&&(t.canvas.remove(a),console.log("------------------")),fabric.Image.fromURL(e,function(e){e.hasControls=!1,e.hasBorders=!1,e.set({originX:"center",originY:"center",lockMovementX:!0,lockMovementY:!0}),console.log(t.scale),e.set({left:t.templateCoord.left*t.scale,top:t.templateCoord.top*t.scale,width:t.templateCoord.width*t.scale,height:t.templateCoord.height*t.scale}),t.canvas.add(e),t.canvas.sendToBack(e),t.canvas.renderAll()}.bind(t),{crossOrigin:"anonymous"})},textToVertical:function(t){for(var e="",a=0;a<t.length;a++){if(a==t.length-1)var i="";else i="\n";e+=t[a]+i}return e},loadAndUse:function(t,e,a,i){var n=new Wt(a);n.load().then(function(){var n=t.text[e];n&&(n.set("fontFamily",a),t.canvas.renderAll(),e==t.text.length-1&&i())}).catch(function(a){console.log("error: ",a),e==t.text.length-1&&i()})},changeFont:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){console.log("ok")};this.loadAndUse(this,e,t,a)},changeSize:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a=this.text[e];a&&(a.set("fontSize",t*this.scale),this.checkLimitAreaNewFlag&&this.checkLimitAreaNew(a,e),this.canvas.renderAll())},changeCoord:function(t,e){var a=this.text[e];"undefined"!=typeof t.left&&(t.left=t.left*this.scale),"undefined"!=typeof t.top&&(t.top=t.top*this.scale),"undefined"!=typeof t.fontSize&&(t.fontSize=t.fontSize*this.scale),a&&(a.set(t),this.canvas.renderAll())},changeColor:function(t,e){var a=this.text[e];a&&(a.set("fill",t),this.canvas.renderAll())},changeText:function(t,e){var a=this.text[e];if(a){if("vertical"==this.coors[e].direction&&(t=this.textToVertical(t)),1==this.coors[e].isChange&&(t=this.lastVariationTransformEn(this.coors[e].isChange,t)),"undefined"!=typeof this.coors[e].cutNumber&&t.length>parseInt(this.coors[e].cutNumber)&&(t=t.substr(0,this.coors[e].cutNumber)),this.coors[e].isWrap){var i="";this.coors[e].isWrapCanvasText_?(i=this.wrapCanvasText_(t,this.canvas,a.fontFamily,a.fontSize,this.coors[e].limitArea.width*this.scale,500),t=i):i=this.wrapCanvasText(t,this.canvas,a.fontFamily,a.fontSize,this.coors[e].limitArea.width*this.scale,500),a.set("text",i)}else a.set("text",t);if("undefined"!=typeof this.coors[e].initialCarving&&this.coors[e].initialCarving){var n=this.coorsNum+e,r=this.text[n],o=t.substr(0,1);"undefined"!=typeof this.coors[e].initialCarving.isFull?o=t:"undefined"!=typeof this.coors[e].initialCarving.value&&(o=this.coors[e].initialCarving.value),r.set("text",o)}if(this.checkLimitAreaNewFlag?this.checkLimitAreaNew(a,e):this.checkLimitArea(a,this.coors[e].limitArea),this.canvas.renderAll(),this.coors[e].isWrapCanvasText_)return t}},lastVariationTransformEn:function(t,e){var a,i=(a={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ft["a"])(a,"ß","ss"),Object(ft["a"])(a,"ñ","n"),Object(ft["a"])(a,"Ñ","N"),Object(ft["a"])(a,"ö","o"),Object(ft["a"])(a,"Ö","O"),a);if(e.length>1){var n=e.charAt(e.length-1);if(void 0!=i[n])return e=e.substr(0,e.length-1)+i[n],e;if(1==t){var r={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"};if("undefined"!=typeof r[n])return e=e.substr(0,e.length-1)+r[n],e}}return e},convertChar:function(t){var e,a=(e={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ft["a"])(e,"ß","ss"),Object(ft["a"])(e,"ñ","n"),Object(ft["a"])(e,"Ñ","N"),Object(ft["a"])(e,"ö","o"),Object(ft["a"])(e,"Ö","O"),e);void 0!=a[t]&&(t=a[t]);var i=new Array;return i["A"]="1",i["B"]="2",i["C"]="3",i["D"]="4",i["E"]="5",i["F"]="6",i["G"]="7",i["H"]="8",i["I"]="9",i["J"]="0",i["K"]="!",i["L"]="@",i["M"]="#",i["N"]="$",i["O"]="%",i["P"]="^",i["Q"]="&",i["R"]="*",i["S"]="(",i["T"]=")",i["U"]="-",i["V"]="=",i["W"]="[",i["X"]="]",i["Y"]="|",i["Z"]=":",i[t.toUpperCase()]},wrapCanvasText:function(t,e,a,i,n,r){"undefined"===typeof r&&(r=0);var o=t.split(" "),s="",l=(t.replace(/(\r\n|\n|\r)/gm,""),new fabric.Text("sdfsdf",{fontFamily:a,fontSize:25}).height),c=r>0?r-l:0,d=e.getContext("2d");d.font=i+"px "+a;for(var h="",p=0,g=0;g<o.length;g++){var m=""==h,u=h+" "+o[g],v=d.measureText(u).width;if(v<n)h+=o[g]+" ",s+=o[g]+=" ";else{if(m)for(var f="",x=0;x<o[g].length;++x){f+=o[g].charAt(x);var b=f+"-";if(d.measureText(b).width>=n){b=f.substr(0,f.length-2)+"",o[g]=o[g].substr(f.length-1,o[g].length),s+=b;break}}g--,s+="\n",p++,h=""}if(c>0&&p*l>c){s=s.substr(0,s.length-3)+"...\n";break}}return s=s.substr(0,s.length-1),s},wrapCanvasText_:function(t,e,a,i,n,r){var o=t.replace(/(\r\n|\n|\r)/gm,"-*)(*-").split("-*)(*-"),s=e.getContext("2d");s.font=i+"px "+a;for(var l=[],c=0;c<o.length;c++){var d=s.measureText(o[c]).width;if(d<n)l.push(o[c]);else{for(var h="",p=0;p<o[c].length;p++){h+=o[c].charAt(p);d=s.measureText(h+"-").width;d>n&&(l.push(h),h="")}""!=h&&l.push(h)}}var g="",m="",u=new fabric.Text("sdfsdf",{fontFamily:a,fontSize:i}).height+4;for(c=0;c<l.length;c++){if(m=g+=l[c],u*(c+2)>r)break;g+="\n"}return m},checkLimitArea:function(t,e){if(e){this.canvas.renderAll();var a=e.left*this.scale,i=e.top*this.scale,n=a+e.width*this.scale,r=i+e.height*this.scale,o=t.left,s=t.top;t.left-t.width/2<a&&(o=a+t.width/2),t.top-t.height/2<i&&(s=i+t.height/2),t.left+t.width/2>n&&(o=n-t.width/2),t.top+t.height/2>r&&(s=r-t.height/2),t.set({left:o,top:s}),this.canvas.renderAll()}},checkLimitAreaNew:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("undefined"!==typeof t.limitArea){var i=t.limitArea,n=0;if(a){if(t.height>i.height*this.scale){var r=a.split(/[(\r\n)\r\n]+/);if(r.length>1){n=Math.ceil((t.height-i.height*this.scale)/(t.height/r.length)),a="";for(var o=0;o<r.length-n;o++)a+=o>0?"\n"+r[o]:r[o]}}t.set("text",a),this.canvas.renderAll(),t.width>i.width*this.scale&&(n=Math.ceil((t.width-i.width*this.scale)/(t.width/a.length)),a=a.substr(0,a.length-n)),t.set("text",a),this.canvas.renderAll()}var s=t.top,l=t.left,c=l,d=s,h=t.width/2,p=t.height/2;l-h<i.left*this.scale?c=i.left*this.scale+h:l+h>i.left*this.scale+i.width*this.scale&&(c=i.left*this.scale+i.width*this.scale-h),s-p<i.top*this.scale?d=i.top*this.scale+p:s+p>i.top*this.scale+i.height*this.scale&&(d=i.top*this.scale+i.height*this.scale-p),t.set({left:c,top:d}),this.canvas.renderAll()}},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},changeBigText:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=this.getBs();i&&"text"==i.type&&this.canvas.remove(i),kt.util.carvingTextObj.clone(function(t){a.canvas.discardActiveObject(),t.set({hasControls:!1,hasBorders:!1,evented:!0}),"activeSelection"===t.type?(t.canvas=a.canvas,t.forEachObject(function(t){a.canvas.add(t)}),t.setCoords()):a.canvas.add(t),a.canvas.setActiveObject(t),a.canvas.requestRenderAll()})},addMultiBigText:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,e=t.canvas.getObjects();for(var a in e)"text"==e[a].type&&t.canvas.remove(e[a]);kt.util.bigCarvingTexObj.forEach(function(e,a){e.clone(function(e){t.canvas.discardActiveObject(),e.set({hasControls:!1,hasBorders:!1,evented:!0}),"activeSelection"===e.type?(e.canvas=t.canvas,e.forEachObject(function(e){t.canvas.add(e)}),e.setCoords()):t.canvas.add(e),t.canvas.setActiveObject(e),t.canvas.requestRenderAll()})})},changeCurveText:function(t,e){this.textpath[e].setText(t),this.layer.draw();var a=this.stage.toDataURL();this.img.src=a},initPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.stage=new Mt.a.Stage({container:"container",width:t.cWidth,height:t.cHeight}),t.layer=new Mt.a.Layer,t.path.forEach(function(e,a){t.textpath[a]=new Mt.a.TextPath({x:0,y:0,align:"center",fill:e.textColor,fontSize:e.size,fontFamily:e.family,text:"",data:e.path}),t.layer.add(t.textpath[a])}),t.stage.add(t.layer),t.img=new Image,t.imgObj=new fabric.Image(t.img),t.imgObj.lockMovementX=!0,t.imgObj.lockMovementY=!0,t.imgObj.selectable=!1,t.canvas.add(t.imgObj),t.img.onload=function(){t.imgObj.setElement(t.img),t.imgObj.set({left:0,top:0,scaleX:t.scale,scaleY:t.scale}),t.canvas.renderAll(!0)}}}),t.prototype.constructor=t,t}(),Rt=Ut,qt={name:"CropDialog",props:["param"],components:{},data:function(){return{confirmText:this.param.data.confirmText?this.param.data.confirmText:"Confirm",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",previewText:this.param.data.previewText?this.param.data.previewText:"Add Engraving",btnText:this.param.data.btnText?this.param.data.btnText:"Add",btnChangeText:this.param.data.btnChangeText?this.param.data.btnChangeText:"Change",inputTextLabel:this.param.data.inputTextLabel?this.param.data.inputTextLabel:"",carvingCancelText:this.param.data.carvingCancelText?this.param.data.carvingCancelText:"Cancel",carvingConfirmText:this.param.data.carvingConfirmText?this.param.data.carvingConfirmText:"Confirm",inputMark:this.param.data.inputMark?this.param.data.inputMark:"",areaCarvingClass:"area-carving area-carving-"+this.param.index,carvingCanvasId:"carving-canvas-"+this.param.index,dialogVisible:!1,centerDialogVisibleNormal:!1,info:"",w:"50px",h:"50px",percentage:0,isLoading:!1,base64:"",isBig:!1!==Ot.carving[this.param.index].isBig,isBigBG:!0===Ot.carving[this.param.index].isBigBG,isSelectStyle:!0===Ot.carving[this.param.index].isSelectStyle,fontSpanNum:Ot.carving[this.param.index].fontSpanNum?Ot.carving[this.param.index].fontSpanNum:12,fontSizeLabel:Ot.carving[this.param.index].fontSizeLabel?Ot.carving[this.param.index].fontSizeLabel:"Size:",fontFamilyLabel:Ot.carving[this.param.index].fontFamilyLabel?Ot.carving[this.param.index].fontFamilyLabel:"Font:",fontRadioLabel:Ot.fontRadioLabel?Ot.fontRadioLabel:"",fontSizeSelectLabel:Ot.fontSizeSelectLabel?Ot.fontSizeSelectLabel:"",fontColorLabel:Ot.carving[this.param.index].fontColorLabel?Ot.carving[this.param.index].fontColorLabel:"Color:",textPlaceHolder:Ot.carving[this.param.index].textPlaceHolder?Ot.carving[this.param.index].textPlaceHolder:"Type words here...",cropPrompt:Ot.carving[this.param.index].cropPrompt?Ot.carving[this.param.index].cropPrompt:"",bigParam:!!Ot.carving[this.param.index].bigParam&&Ot.carving[this.param.index].bigParam,coors:Ot.carving[this.param.index].coors,dialogWidth:this.$device.mobile?"100%":"40%",isFullscreen:!!this.$device.mobile,showSize:!1!==Ot.carving[this.param.index].showSize,showFont:!1!==Ot.carving[this.param.index].showFont,checkLimitAreaNew:!0===Ot.carving[this.param.index].checkLimitAreaNew,engravingCrop:[],engravingBig:[],engravingText:[],engravingSize:[],engravingFont:[],coorsFont:[],coorsSize:[],engravingSizeOptions:Ot.carving[this.param.index].engravingSizeOptions?Ot.carving[this.param.index].engravingSizeOptions:{},engravingFontOptions:Ot.carving[this.param.index].engravingFontOptions?Ot.carving[this.param.index].engravingFontOptions:{},hasPhoto:!0===Ot.carving[this.param.index].hasPhoto,oneSide:!0===Ot.carving[this.param.index].oneSide,textHasControls:!0===Ot.carving[this.param.index].textHasControls,centeredScaling:!0===Ot.carving[this.param.index].centeredScaling,originX:Ot.carving[this.param.index].originX?Ot.carving[this.param.index].originX:"",originY:Ot.carving[this.param.index].originY?Ot.carving[this.param.index].originY:"",customIcons:!!Ot.carving[this.param.index].customIcons&&Ot.carving[this.param.index].customIcons,showColor:!0===Ot.carving[this.param.index].showColor,isShow:!1!==Ot.carving[this.param.index].isShow,showPhoto:!0===Ot.carving[this.param.index].showPhoto,bigCanvas:this.param.data.bigCanvas?this.param.data.bigCanvas:{width:2500,height:2e3},baseAiImg:Ot.carving[this.param.index].baseAiImg?Ot.carving[this.param.index].baseAiImg:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,baseWidth:Ot.carving[this.param.index].baseWidth?Ot.carving[this.param.index].baseWidth:500,fixWidth:Ot.carving[this.param.index].fixWidth?Ot.carving[this.param.index].fixWidth:"",bigCanvasWidth:500,bigCanvasHeight:400,carvingBigObj:[],fontColor:Ot.carving[this.param.index].defaultFontColor?Ot.carving[this.param.index].defaultFontColor:"#000000",isEmpty:[],carvingAble:!1,bgLoad:!0,uploadLoadingImage:Ot.uploadLoadingImage?Ot.uploadLoadingImage:"",bgOpacity:Ot.bgOpacity?Ot.bgOpacity:.5,wrapperBackgroudColor:Ot.wrapperBackgroudColor?Ot.wrapperBackgroudColor:"#ffffff",nameLeftNum:[],leftText:Ot.leftText?Ot.leftText:"",actionInfo:Ot.actionInfo?Ot.actionInfo:"",noteInfo:Ot.noteInfo?Ot.noteInfo:"",handcraftInfo:Ot.handcraftInfo?Ot.handcraftInfo:"",ifCarvingHorizontal:!0===Ot.ifCarvingHorizontal,requireCarvingTextClass:"require-carving-text require-carving-text-"+this.param.index,requirePrompt:Ot.requirePrompt,require:!1!==this.param.data.require,requireVal:!1!==this.param.data.require,photoLoad:!1,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,isModalAppendToBody:!1!==Ot.isModalAppendToBody,showCanvas:!1!==Ot.carving[this.param.index].showCanvas,emojiErrorField:Ot.carving[this.param.index].emojiErrorField,limitErrorField:Ot.carving[this.param.index].limitErrorField,errorWordShow:!0===Ot.carving[this.param.index].errorWordShow,carvingEmojiError:[],carvingLimitError:[],textMaxlength:[],coorSymbol:Ot.carving[this.param.index].coorSymbol?Ot.carving[this.param.index].coorSymbol:" ",textPlaceHolderList:[],codeArray:Ot.codeArray?Ot.codeArray:[],bigBaseImg:this.param.data.bigBaseImg?this.param.data.bigBaseImg:"",clearableValue:!0===Ot.carving[this.param.index].clearableValue,arrowControl:!1!==Ot.carving[this.param.index].arrowControl,dateFormat:Ot.carving[this.param.index].dateFormat?Ot.carving[this.param.index].dateFormat:"MM-dd-yy",dateValueFormat:Ot.carving[this.param.index].dateValueFormat?Ot.carving[this.param.index].dateValueFormat:"MM-dd-yy",timeFormat:Ot.carving[this.param.index].timeFormat?Ot.carving[this.param.index].timeFormat:"h:mm",timeValueFormat:Ot.carving[this.param.index].timeValueFormat?Ot.carving[this.param.index].timeValueFormat:"h:mm a",datePlaceholder:Ot.carving[this.param.index].datePlaceholder?Ot.carving[this.param.index].datePlaceholder:"Date of Birth",timePlaceholder:Ot.carving[this.param.index].timePlaceholder?Ot.carving[this.param.index].timePlaceholder:"Time of Birth",dateReadonly:!0===Ot.carving[this.param.index].dateReadonly,loadingFullScreen:this.param.data.loadingFullScreen,path:Ot.carving[this.param.index].path?Ot.carving[this.param.index].path:[],isCurveEmpty:[],curvePlaceholderText:[],curveLeftNum:[],curveEmojiError:[],templateImages:!!Ot.carving[this.param.index].templateImages&&Ot.carving[this.param.index].templateImages,templateCoord:Ot.carving[this.param.index].templateCoord?Ot.carving[this.param.index].templateCoord:{},templateUrl:"",templateLabel:"",templateSelect:[],templateOut:!0===Ot.carving[this.param.index].templateOut,templateTitle:Ot.carving[this.param.index].templateTitle,bigBgColor:Ot.carving[this.param.index].bigBgColor?Ot.carving[this.param.index].bigBgColor:"white",isAllowInput:!!Ot.carving[this.param.index].isAllowInput&&Ot.carving[this.param.index].isAllowInput,marginLucencyColor:Ot.carving[this.param.index].marginLucencyColor?Ot.carving[this.param.index].marginLucencyColor:[247,248,249],isTrim:!0===Ot.carving[this.param.index].isTrim,isMarginLucency:!0===Ot.carving[this.param.index].isMarginLucency,aiEnlarge:Ot.carving[this.param.index].aiEnlarge?Ot.carving[this.param.index].aiEnlarge:1,carvingMarkup:"",isBigCarving:Ot.carving[this.param.index].isBigCarving?Ot.carving[this.param.index].isBigCarving:0,carvingNumoption:!0===Ot.carving[this.param.index].carvingNumoption,carvingNumoptionErrorWord:!1,carvingNumoptionErrorField:Ot.carving[this.param.index].carvingNumoptionErrorField?Ot.carving[this.param.index].carvingNumoptionErrorField:"",bigBackgroundColor:Ot.carving[this.param.index].bigBackgroundColor?Ot.carving[this.param.index].bigBackgroundColor:"white",isOtherImg:!0===Ot.carving[this.param.index].isOtherImg,oneSideCheckPhoto:!1!==Ot.carving[this.param.index].oneSideCheckPhoto,hasSelect:!0===Ot.carving[this.param.index].hasSelect,isCheckFont:!1!==Ot.carving[this.param.index].isCheckFont,emojiDefaultList:Ot.carving[this.param.index].emojiDefaultList?Ot.carving[this.param.index].emojiDefaultList:["✿","❀","❤","➹","➷","℡","✚","☆","★","✟"],predefineColors:Ot.carving[this.param.index].predefineColors?Ot.carving[this.param.index].predefineColors:[]}},computed:{centerDialogVisible:{get:function(){return this.hasPhoto?this.$store.getters.getCarvingDialogVisibleNew:this.centerDialogVisibleNormal},set:function(t){this.hasPhoto?this.$store.dispatch("setCarvingDialogVisibleNew",t):this.centerDialogVisibleNormal=t}}},methods:{open:function(){this.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody);var t=this;if(this.bigBaseImg&&fabric.Image.fromURL(this.bigBaseImg+"?"+Math.random(),function(e){e.scaleX=t.cWidth/t.bigCanvas.width,e.scaleY=t.cHeight/t.bigCanvas.height,e.left=(t.cWidth-e.width*e.scaleX)/2,e.top=(t.cHeight-e.height*e.scaleY)/2,t.carvingBigObj.canvas.setBackgroundImage(e),t.carvingBigObj.canvas.requestRenderAll(),t.carvingAble=!0},{crossOrigin:"Anonymous"}),t.oneSide){t.oneSideCheckPhoto?t.carvingAble=!1:t.carvingAble=!0;var e=JSON.parse(t.$store.getters.getCustomInfo),a="";"undefined"!=typeof e.photo?a=e.photo[0].crop:"undefined"!=typeof e.crop&&(a=e.crop[0].crop),a&&fabric.Image.fromURL(a+"?"+Math.random(),function(e){e.scaleX=Ot.carvingObj[t.param.index].canvas.width/e.width,e.scaleY=Ot.carvingObj[t.param.index].canvas.height/e.height,Ot.carvingObj[t.param.index].canvas.setBackgroundImage(e),Ot.carvingObj[t.param.index].canvas.requestRenderAll(),t.carvingAble=!0},{crossOrigin:"Anonymous"})}},openimage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeText:function(t,e){if("monogram"==Ot.carvingObj[this.param.index].text[t].fontFamily){for(var a=e.toUpperCase(),i=[],n=0;n<a.length;n++)" "!=a[n]&&i.push(a[n]);this.coors[t].text=i.join(" ")}if(this.coors[t].isUppercase&&(this.coors[t].text=this.coors[t].text.toUpperCase()),this.isAllowInput){var r="",o=this.isAllowInput;o.forEach(function(t,e){r+="num"==t?"0-9":"",r+="alphabet"==t?"a-zA-Z":""}),""!=r&&(this.coors[t].text=this.coors[t].text.replace(new RegExp("[^"+r+"]","g"),""))}if(this.coors[t].spaceFlag&&this.coors[t].text.length>=parseInt(this.coors[t].spaceFlag.index)+this.coors[t].spaceFlag.flag.length&&this.coors[t].text.indexOf(this.coors[t].spaceFlag.flag)<0){var s=parseInt(this.coors[t].spaceFlag.index)-1,l=this.coors[t].text.split("");l[s]+=this.coors[t].spaceFlag.flag,this.coors[t].text=l.join("")}this.coors[t].isWrapCanvasText_?this.coors[t].text=Ot.carvingObj[this.param.index].changeText(this.coors[t].text,t):Ot.carvingObj[this.param.index].changeText(this.coors[t].text,t),parseInt(this.coors[t].limit)-this.coors[t].text.length>0?this.nameLeftNum[t]=parseInt(this.coors[t].limit)-this.coors[t].text.length:this.nameLeftNum[t]=0,Ot.dispatchCustomEvent("EVENT_CARVING_CHANGE_AFTER",{index:t,data:e})},changeCurveText:function(t,e){Ot.carvingObj[this.param.index].changeCurveText(this.path[t].text,t),this.curveLeftNum[t]=parseInt(this.path[t].limit)-e.length},changeSize:function(t){var e=this;e.coors.forEach(function(a,i){Ot.carvingObj[e.param.index].changeSize(t,i,a.text)})},changeFont:function(t){var e=this;e.isCheckFont?(e.bgLoad=!0,e.coors.forEach(function(a,i){Ot.carvingObj[e.param.index].changeFont(t,i,function(){e.bgLoad=!1})})):e.coors.forEach(function(a,i){Ot.carvingObj[e.param.index].changeFont(t,i)})},changeCoorsFont:function(t,e){var a=this;Ot.carvingObj[a.param.index].changeFont(e,t),a.engravingFont[a.param.index]=a.coorsFont.join("|")},changeCoorsSize:function(t,e,a){var i=this;Ot.carvingObj[i.param.index].changeSize(e,t,a),i.engravingSize[i.param.index]=i.coorsSize.join("|")},changeTemplate:function(t,e,a){var i=this;i.templateOut?(i.photoLoad=!0,fabric.Image.fromURL(t+"?"+Math.random(),function(t){t.scaleX=Ot.carvingObj[i.param.index].canvas.width/t.width,t.scaleY=Ot.carvingObj[i.param.index].canvas.height/t.height,Ot.carvingObj[i.param.index].canvas.setOverlayImage(t),Ot.carvingObj[i.param.index].canvas.requestRenderAll(),i.photoLoad=!1},{crossOrigin:"Anonymous"})):Ot.carvingObj[i.param.index].changeTemplate(Ot.carvingObj[i.param.index],t),i.templateUrl=t,i.templateLabel=e,i.templateSelect.forEach(function(t,e){i.$set(i.templateSelect,e,!1)}),i.$set(i.templateSelect,a,!0)},changeCoord:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this;e?t.forEach(function(e,i){Ot.carvingObj[a.param.index].changeCoord(t[i],i)}):a.coors.forEach(function(e,i){Ot.carvingObj[a.param.index].changeCoord(t,i)})},getFontFamily:function(t){return"font-family:"+t+";"},cancelCanvas:function(){var t=this;t.centerDialogVisible=!1,Ot.dispatchCustomEvent("EVENT_ENGRAVING_CANCEL_AFTER",{index:t.param.index})},_loadFromJSON:function(t,e,a,i,n,r,o,s){var l=this;t.loadFromJSON(JSON.stringify(Ot.carvingObj[l.param.index].canvas),function(){if(l.isOtherImg){var c=t.getObjects(),d=t.width,h=t.height,p=0,g=0;c.forEach(function(t,e){console.log(t),t&&"text"===t.type&&0==e&&(d=t.width,h=t.height,p=t.left,g=t.top)}),t.setWidth(d),t.setHeight(h),t.renderAll(),console.log(t.width),console.log(t.height),c.forEach(function(e,a){e&&"text"===e.type&&0==a&&(e.set({left:d/2,top:h/2}),t.add(e),t.renderAll()),e&&"text"===e.type&&0!=a&&(e.set({left:e.left-(p-d/2),top:e.top-(g-h/2)}),t.add(e),t.renderAll())})}else{c=t.getObjects();c.forEach(function(e){e&&"text"===e.type&&(e.set({left:e.left-o,top:e.top-s}),t.renderAll())})}if(t.setBackgroundImage(null,t.renderAll.bind(t)),t.backgroundColor=l.bigBackgroundColor,l.isBigBG)t.setBackgroundImage(n,function(){t.setOverlayImage(null,t.renderAll.bind(t)),t.renderAll();var n=t.toDataURL({format:"png",multiplier:e,quality:.8}),r=Ot.asyncCdnUpload(n,a,null);Promise.all([r]).then(function(t){l.engravingBig[l.param.index]=t[0],console.log(l.engravingBig[l.param.index]),Ot.cdnUpload(i,function(t){l.btnText=l.btnChangeText,l.engravingCrop[l.param.index]=t.picture;var e={};l.$store.getters.getCustomInfo&&(e=JSON.parse(l.$store.getters.getCustomInfo)),Array.isArray(e.engraving)||(e.engraving=[]),e.engraving[l.param.index]={type:l.param.data.type?l.param.data.type:"",require:l.param.data.require?l.param.data.require:"",engravingCrop:t.picture,engravingBig:l.engravingBig[l.param.index],engravingText:l.engravingText[l.param.index],engravingSize:l.engravingSize[l.param.index],engravingFont:l.engravingFont[l.param.index],engravingFontColor:l.fontColor,templateUrl:l.templateUrl,templateLabel:l.templateLabel},l.$store.dispatch("setCustomInfo",JSON.stringify(e)),l.previewText=l.engravingText,l.isLoading=!1,l.centerDialogVisible=!1,l.percentage=0,l.showPhoto&&(l.$parent.$refs.PhotoDialog[0].engravingCrop=t.picture),l.hasSelect&&l.$parent.$refs.selectDialog.open(l.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:l.param.index,data:e}),"function"===typeof window.carvingCallback&&window.carvingCallback()},l)}).catch(function(t){console.log(t)})},{crossOrigin:"anonymous",scaleX:r,scaleY:r});else{t.setOverlayImage(null,t.renderAll.bind(t)),t.renderAll();var m=t.toDataURL({format:"png",multiplier:e,quality:.8}),u=Ot.asyncCdnUpload(m,a,null);Promise.all([u]).then(function(t){l.engravingBig[l.param.index]=t[0],console.log(l.engravingBig[l.param.index]),Ot.cdnUpload(i,function(t){l.btnText=l.btnChangeText,l.engravingCrop[l.param.index]=t.picture;var e={};l.$store.getters.getCustomInfo&&(e=JSON.parse(l.$store.getters.getCustomInfo)),Array.isArray(e.engraving)||(e.engraving=[]),e.engraving[l.param.index]={type:l.param.data.type?l.param.data.type:"",require:l.param.data.require?l.param.data.require:"",engravingCrop:t.picture,engravingBig:l.engravingBig[l.param.index],engravingText:l.engravingText[l.param.index],engravingSize:l.engravingSize[l.param.index],engravingFont:l.engravingFont[l.param.index],engravingFontColor:l.fontColor,templateUrl:l.templateUrl,templateLabel:l.templateLabel},l.$store.dispatch("setCustomInfo",JSON.stringify(e)),l.previewText=l.engravingText,l.isLoading=!1,l.centerDialogVisible=!1,l.percentage=0,l.showPhoto&&(l.$parent.$refs.PhotoDialog[0].engravingCrop=t.picture),l.hasSelect&&l.$parent.$refs.selectDialog.open(l.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:l.param.index,data:e}),"function"===typeof window.carvingCallback&&window.carvingCallback()},l)}).catch(function(t){console.log(t)})}})},getRectCoor:function(t){var e=[],a=[],i=0,n=0,r=[],o=[],s=0,l=0,c=[t.data[0],t.data[1],t.data[2],t.data[3]];console.log("rgb",c);for(var d=t.height,h=0;h<d;h++){for(var p=t.width,g=0;g<p;g++){var m=4*h*t.width+4*g,u=4*d*t.width-4*(g+1);if(t.data[m]==c[0]&&t.data[m+1]==c[1]&&t.data[m+2]==c[2]||0!=i||(e.w=g,e.h=h,i=1),t.data[u]==c[0]&&t.data[u+1]==c[1]&&t.data[u+2]==c[2]||0!=n||(a.w=g,a.h=h,n=1),s+l<2){for(var v=0;v<d;v++){var f=4*v*t.width+4*g,x=4*v*t.width+4*(p-1);if(t.data[f]==c[0]&&t.data[f+1]==c[1]&&t.data[f+2]==c[2]||0!=s||(r.w=g,r.h=v,s=1),t.data[x]==c[0]&&t.data[x+1]==c[1]&&t.data[x+2]==c[2]||0!=l||(o.w=g,o.h=v,l=1),s+l==2){console.log("最内层循环结束-break--");break}}p--}if(i+n+s+l==4){console.log("第二层循环结束-break;");break}}if(i+n+s+l==4){console.log("最外层循环结束--break;");break}d--}return{left:r.w,top:e.h,buttom:a.h,right:o.w}},replaceCanvasColor:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[247,248,249],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,0],i=1,n=t.height,r=0;r<n;r++){for(var o=0;o<t.width;o++){var s=4*r*t.width+4*o,l=4*n*t.width-4*(o+1);t.data[s]==e[0]&&t.data[s+1]==e[1]&&t.data[s+2]==e[2]&&i&&(t.data[s]=a[0],t.data[s+1]=a[1],t.data[s+2]=a[2],t.data[s+3]=a[3]),t.data[l]==e[0]&&t.data[l+1]==e[1]&&t.data[l+2]==e[2]&&i&&(t.data[l]=a[0],t.data[l+1]=a[1],t.data[l+2]=a[2],t.data[l+3]=a[3])}n--}return t},saveCanvas:function(){var t=this,e=[],a=!0,i=[];if(t.carvingNumoption){var n=0;t.coors.forEach(function(r,o){var s=r.text.replace(/(^\s*)|(\s*$)/g,"");if(s){n++;var l=0;"undefined"!=typeof r.spaceFlag&&s.indexOf(r.spaceFlag.flag)>-1&&(l=r.spaceFlag.flag.length),r.minLimit&&s.length-l<r.minLimit?(t.$set(t.carvingLimitError,o,!0),a=!1):1==Ot.getLen(r.text,t.codeArray)?(t.$set(t.carvingEmojiError,o,!0),a=!1):r.label?(i.indexOf(r.label)<0&&i.push(r.label),e.push(r.label+":"+r.text)):e.push(r.text)}}),n<1?(a=!1,t.carvingNumoptionErrorWord=!0):t.carvingNumoptionErrorWord=!1}else t.coors.forEach(function(n,r){t.$set(t.carvingEmojiError,r,!1),t.$set(t.carvingLimitError,r,!1);var o=n.text.replace(/(^\s*)|(\s*$)/g,"");if(o){var s=0;"undefined"!=typeof n.spaceFlag&&o.indexOf(n.spaceFlag.flag)>-1&&(s=n.spaceFlag.flag.length),n.minLimit&&o.length-s<n.minLimit?(t.$set(t.carvingLimitError,r,!0),a=!1):1==Ot.getLen(n.text,t.codeArray)?(t.$set(t.carvingEmojiError,r,!0),a=!1):(n.label?(i.indexOf(n.label)<0&&i.push(n.label),e.push(n.label+":"+n.text)):e.push(n.text),t.$set(t.isEmpty,r,!1))}else a=!1,t.$set(t.isEmpty,r,!0)});if(t.path.forEach(function(i,n){t.$set(t.curveEmojiError,n,!1);var r=i.text.replace(/(^\s*)|(\s*$)/g,"");r?1==Ot.getLen(i.text,t.codeArray)?(t.$set(t.curveEmojiError,n,!0),a=!1):(e.push(i.text),t.$set(t.isCurveEmpty,n,!1)):(a=!1,t.$set(t.isCurveEmpty,n,!0))}),i.length>0){var r=[];if(i.forEach(function(a){var i=0,n="";e.forEach(function(t){var e=t.split(":");a==e[0]&&(n+=i>0?"|"+t.replace(a+":",""):t.replace(a+":",""),i++)}),"pen"==a.toLowerCase()?n=t.coorSymbol+n:n+=t.coorSymbol,r.push(n)}),r.length>1){var o=[];r.forEach(function(e){o.push(e.replace(t.coorSymbol,""))}),t.engravingText[t.param.index]=o.join(t.coorSymbol)}else t.engravingText[t.param.index]=r[0]}else t.engravingText[t.param.index]=e.join("|");if(!a)return!1;if(t.uploadLoadingImage&&t.loadingFullScreen&&(t.centerDialogVisible=!1),t.isLoading=!0,t.isTrim||t.isMarginLucency){var s=Ot.carvingObj[t.param.index].canvas.getContext("2d"),l=Ot.carvingObj[t.param.index].canvas.width,c=Ot.carvingObj[t.param.index].canvas.height,d=s.getImageData(0,0,l,c),h=d,p=document.getElementById("newtrimcanvas"),g=p.getContext("2d"),m=d.width,u=d.height;if(p.width=m,p.height=u,t.isTrim){var v=t.getRectCoor(d);m=d.width-v.right-v.left,u=d.height-v.top-v.buttom,p.width=m,p.height=u,g.putImageData(d,-v.left,-v.top,v.left,v.top,m,u),h=g.getImageData(0,0,m,u)}t.isMarginLucency&&g.putImageData(t.replaceCanvasColor(h,t.marginLucencyColor),0,0);var f=p.toDataURL({format:"png",quality:1}),x=new fabric.Canvas;x.setWidth(p.width),x.setHeight(p.height),fabric.Image.fromURL(f,function(e){x.add(e),x.renderAll(),t.base64=x.toDataURL({format:"png",multiplier:t.aiEnlarge,quality:.8});var a=Ot.getFilename(12),i=a+".png",n="";if(n=i?{base64:t.base64,key:i}:t.base64,t.isBig){var r=new fabric.Canvas,o=a+"-1.png",s=t.bigParam.width?t.bigParam.width:800;t.bigParam.height&&t.bigParam.height,t.bigParam.fontWeight&&t.bigParam.fontWeight,t.bigParam.fontSize&&t.bigParam.fontSize;r.setWidth(Ot.carvingObj[t.param.index].canvas.width),r.setHeight(Ot.carvingObj[t.param.index].canvas.height);var l=s/Ot.carvingObj[t.param.index].canvas.width,c=1,d=0,h=0,p="";if(t.isBigBG){var g=Ot.carvingObj[t.param.index].canvas.width,m=Ot.carvingObj[t.param.index].canvas.height,u=new Image;u.src=kt.util.awcdn+kt.util.cdir+Ot.carving[t.param.index].sku+"-BIG.jpg",p=kt.util.awcdn+kt.util.cdir+Ot.carving[t.param.index].sku+"-BIG.jpg",u.onload=function(){console.log("bgimg-w-h:",u.width,u.height),u.width>u.height?(l=u.width/g,c=g/u.width,r.setWidth(g),r.setHeight(u.height*c),h=(m-u.height*c)/2):(l=u.height/m,c=m/u.height,r.setWidth(u.width*c),r.setHeight(m),d=(g-u.width*c)/2),console.log("multiplier",l),console.log("BIGscale",c),console.log(d,h),t._loadFromJSON(r,l,o,n,p,c,d,h)}}else t._loadFromJSON(r,l,o,n,p,c,d,h)}else{if(t.hasPhoto||t.bigBaseImg||t.isBigCarving>0){if(Ot.carvingObj[t.param.index].canvas.getObjects().length>0)if(t.isBigCarving>0){var v=Ot.carvingObj[t.param.index].canvas.getObjects();for(var f in kt.util.bigCarvingTexObj=[],v)"text"==v[f].type&&v[f].clone(function(t){kt.util.bigCarvingTexObj.push(t)});t.carvingBigObj.addMultiBigText()}else Ot.carvingObj[t.param.index].canvas.item(0).clone(function(t){kt.util.carvingTextObj=t}),t.coors.forEach(function(e,a){t.carvingBigObj.changeBigText(e.text,a)});Ot.zoomIt(t.carvingBigObj.canvas,t.bigCanvas.width/t.bigCanvasWidth);var b=t.carvingBigObj.canvas.getContext("2d"),C=t.carvingBigObj.canvas.width,y=t.carvingBigObj.canvas.height,w=b.getImageData(0,0,C,y),T=w,O=document.getElementById("newbigtrimcanvas"),I=O.getContext("2d"),S=w.width,_=w.height;O.width=S,O.height=_;var k=t.getRectCoor(w);S=w.width-k.right-k.left,_=w.height-k.top-k.buttom,O.width=S,O.height=_,I.putImageData(w,-k.left,-k.top,k.left,k.top,S,_),T=I.getImageData(0,0,S,_),I.putImageData(t.replaceCanvasColor(T,t.marginLucencyColor),0,0);var E=O.toDataURL({format:"png",quality:.8,multiplier:1})}Ot.cdnUpload(n,function(e){if(t.hasPhoto||t.bigBaseImg||t.isBigCarving>0)t.engravingCrop[t.param.index]=e.picture,t.hasPhoto&&t.isBigCarving<1&&(t.$parent.$refs.PhotoDialog[t.param.index].photoCrop[t.param.index]=e.picture),t.showPhoto&&(t.$parent.$refs.PhotoDialog[0].engravingCrop=e.picture),Ot.cdnUpload({base64:E,key:Ot.getFilename(12)+".png"},function(e){t.btnText=t.btnChangeText;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]);var i="";"undefined"!=typeof a.photo&&"undefined"!=typeof a.photo[0]&&(i=a.photo[0].origin),a.engraving[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",engravingCrop:t.engravingCrop[t.param.index],engravingAi:e.picture,engravingOrigin:i,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],engravingFontColor:t.fontColor,templateUrl:t.templateUrl,templateLabel:t.templateLabel},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.centerDialogVisible=!1,t.percentage=0,Ot.zoomIt(t.carvingBigObj.canvas,t.bigCanvasWidth/t.bigCanvas.width),t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a})});else{t.btnText=t.btnChangeText,t.engravingCrop[t.param.index]=e.picture;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]),a.engraving[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",engravingCrop:e.picture,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],engravingFontColor:t.fontColor,templateUrl:t.templateUrl,templateLabel:t.templateLabel},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.centerDialogVisible=!1,t.percentage=0,t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()}},t)}})}else{t.base64=Ot.carvingObj[t.param.index].canvas.toDataURL({format:"png",multiplier:t.aiEnlarge,quality:.8});var b=Ot.getFilename(12),C=b+".png",y="";if(y=C?{base64:t.base64,key:C}:t.base64,t.isBig){var w=new fabric.Canvas,T=b+"-1.png",O=t.bigParam.width?t.bigParam.width:800;t.bigParam.height&&t.bigParam.height,t.bigParam.fontWeight&&t.bigParam.fontWeight,t.bigParam.fontSize&&t.bigParam.fontSize;w.setWidth(Ot.carvingObj[t.param.index].canvas.width),w.setHeight(Ot.carvingObj[t.param.index].canvas.height);var I=O/Ot.carvingObj[t.param.index].canvas.width,S=1,_=0,k=0,E="";if(t.isBigBG){var j=Ot.carvingObj[t.param.index].canvas.width,L=Ot.carvingObj[t.param.index].canvas.height,A=new Image;A.src=kt.util.awcdn+kt.util.cdir+Ot.carving[t.param.index].sku+"-BIG.jpg",E=kt.util.awcdn+kt.util.cdir+Ot.carving[t.param.index].sku+"-BIG.jpg",A.onload=function(){console.log("bgimg-w-h:",A.width,A.height),A.width>A.height?(I=A.width/j,S=j/A.width,w.setWidth(j),w.setHeight(A.height*S),k=(L-A.height*S)/2):(I=A.height/L,S=L/A.height,w.setWidth(A.width*S),w.setHeight(L),_=(j-A.width*S)/2),console.log("multiplier",I),console.log("BIGscale",S),console.log(_,k),t._loadFromJSON(w,I,T,y,E,S,_,k)}}else t._loadFromJSON(w,I,T,y,E,S,_,k)}else{if(t.hasPhoto||t.bigBaseImg||t.isBigCarving>0){if(Ot.carvingObj[t.param.index].canvas.getObjects().length>0)if(t.isBigCarving>0){var N=Ot.carvingObj[t.param.index].canvas.getObjects();for(var F in kt.util.bigCarvingTexObj=[],N)"text"==N[F].type&&N[F].clone(function(t){kt.util.bigCarvingTexObj.push(t)});t.carvingBigObj.addMultiBigText()}else Ot.carvingObj[t.param.index].canvas.item(0).clone(function(t){kt.util.carvingTextObj=t}),t.coors.forEach(function(e,a){t.carvingBigObj.changeBigText(e.text,a)});Ot.zoomIt(t.carvingBigObj.canvas,t.bigCanvas.width/t.bigCanvasWidth);var B=t.carvingBigObj.canvas.getContext("2d"),P=t.carvingBigObj.canvas.width,D=t.carvingBigObj.canvas.height,z=B.getImageData(0,0,P,D),$=z,M=document.getElementById("newbigtrimcanvas"),W=M.getContext("2d"),U=z.width,R=z.height;M.width=U,M.height=R;var q=t.getRectCoor(z);U=z.width-q.right-q.left,R=z.height-q.top-q.buttom,M.width=U,M.height=R,W.putImageData(z,-q.left,-q.top,q.left,q.top,U,R),$=W.getImageData(0,0,U,R),W.putImageData(t.replaceCanvasColor($,t.marginLucencyColor),0,0);var V=M.toDataURL({format:"png",quality:.8,multiplier:1})}Ot.cdnUpload(y,function(e){if(t.hasPhoto||t.bigBaseImg||t.isBigCarving>0)t.engravingCrop[t.param.index]=e.picture,t.hasPhoto&&t.isBigCarving<0&&(t.$parent.$refs.PhotoDialog[t.param.index].photoCrop[t.param.index]=e.picture),t.showPhoto&&(t.$parent.$refs.PhotoDialog[0].engravingCrop=e.picture),Ot.cdnUpload({base64:V,key:Ot.getFilename(12)+".png"},function(e){t.btnText=t.btnChangeText;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]);var i="";"undefined"!=typeof a.photo&&"undefined"!=typeof a.photo[0]&&(i=a.photo[0].origin),a.engraving[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",engravingCrop:t.engravingCrop[t.param.index],engravingAi:e.picture,engravingOrigin:i,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],engravingFontColor:t.fontColor,templateUrl:t.templateUrl,templateLabel:t.templateLabel},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.centerDialogVisible=!1,t.percentage=0,Ot.zoomIt(t.carvingBigObj.canvas,t.bigCanvasWidth/t.bigCanvas.width),t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a})});else{t.btnText=t.btnChangeText,t.engravingCrop[t.param.index]=e.picture;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.engraving)||(a.engraving=[]),a.engraving[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",engravingCrop:e.picture,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],engravingFontColor:t.fontColor,templateUrl:t.templateUrl,templateLabel:t.templateLabel},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.centerDialogVisible=!1,t.percentage=0,t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param,1),Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()}},t)}}},changeCarvingMarkup:function(t){this.carvingMarkup=t},changeCarvingSku:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ot.carvingObj[e].canvas.width,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ot.carvingObj[e].canvas.height,n=this,r=Ot.textUrl?Ot.textUrl:Ot.photoUrl,o=r+t+"-OUT.png",s=r+t+"-IN.png";n.photoLoad=!0,a!=Ot.carvingObj[e].canvas.width&&(Ot.carvingObj[e].canvas.setWidth(a),Ot.carvingObj[e].canvas.requestRenderAll()),i!=Ot.carvingObj[e].canvas.height&&(Ot.carvingObj[e].canvas.setHeight(i),Ot.carvingObj[e].canvas.requestRenderAll()),fabric.Image.fromURL(s+"?"+Math.random(),function(t){t.scaleX=Ot.carvingObj[e].canvas.width/t.width,t.scaleY=Ot.carvingObj[e].canvas.height/t.height,Ot.carvingObj[e].canvas.setBackgroundImage(t),Ot.carvingObj[e].canvas.requestRenderAll(),n.photoLoad=!1},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(o+"?"+Math.random(),function(t){t.scaleX=Ot.carvingObj[e].canvas.width/t.width,t.scaleY=Ot.carvingObj[e].canvas.height/t.height,Ot.carvingObj[e].canvas.setOverlayImage(t),Ot.carvingObj[e].canvas.requestRenderAll(),n.photoLoad=!1},{crossOrigin:"Anonymous"})},changeCarving:function(){var t=this;Ot.carvingObj[this.param.index]=new Rt({canvasid:this.carvingCanvasId,type:2,sku:Ot.carving[this.param.index].sku,in:inImage,out:outImage,checkLimitAreaNew:t.checkLimitAreaNew,custom:{coors:Ot.carving[this.param.index].coors},cWidth:t.cWidth,cHeight:t.cHeight,baseWidth:t.baseWidth,fixWidth:t.fixWidth,textHasControls:t.textHasControls,centeredScaling:t.centeredScaling,originX:t.originX,originY:t.originY,customIcons:t.customIcons,fontColor:t.fontColor,isBigCarving:t.isBigCarving})},setText:function(t,e){this.coors[t].text=e,this.changeText(t,e)},setFontColor:function(t){this.fontColor=t}},mounted:function(){var t=this,e=kt.util.awcdn+kt.util.cdir+Ot.carving[this.param.index].in,a=kt.util.awcdn+kt.util.cdir+Ot.carving[this.param.index].out;if(Ot.textUrl&&(e=Ot.textUrl+Ot.carving[this.param.index].in,a=Ot.textUrl+Ot.carving[this.param.index].out),t.hasPhoto||t.bigBaseImg||t.isBigCarving>0){var i="";if(t.isBigCarving>0&&(i=a),t.carvingBigObj=new Rt({canvasid:"canvasBig",type:2,sku:Ot.carving[this.param.index].sku,in:e,out:i,checkLimitAreaNew:t.checkLimitAreaNew,custom:{coors:Ot.carving[this.param.index].coors},cWidth:t.cWidth,cHeight:t.cHeight,baseWidth:t.baseWidth,fixWidth:t.fixWidth,textHasControls:t.textHasControls,centeredScaling:t.centeredScaling,originX:t.originX,originY:t.originY,fontColor:t.fontColor,isDrag:Ot.carving[this.param.index].isDrag,path:t.path,isBigCarving:t.isBigCarving}),t.bigCanvasWidth=t.carvingBigObj.canvas.width,t.bigCanvasHeight=t.carvingBigObj.canvas.height,t.baseAiImg){var n=new Image;n.src=t.baseAiImg,n.onload=function(){t.bigCanvas.width=n.width,t.bigCanvas.height=n.height}}if(t.isBigCarving>0){var r=new Image;r.src=e,r.onload=function(){t.bigCanvas.width=r.width,t.bigCanvas.height=r.height}}t.bigBaseImg||0!=t.isBigCarving||(e=kt.util.awcdn+kt.util.pdir+Ot.carving[this.param.index].in,a=kt.util.awcdn+kt.util.pdir+Ot.carving[this.param.index].out)}window.changeCarvingSku=t.changeCarvingSku,window.changeCoord=t.changeCoord,window.setText=t.setText,window.setFontColor=t.setFontColor,window.changeCarvingMarkup=t.changeCarvingMarkup,Ot.carvingObj[this.param.index]=new Rt({canvasid:this.carvingCanvasId,type:2,sku:Ot.carving[this.param.index].sku,in:e,out:a,checkLimitAreaNew:t.checkLimitAreaNew,custom:{coors:Ot.carving[this.param.index].coors},cWidth:t.cWidth,cHeight:t.cHeight,baseWidth:t.baseWidth,fixWidth:t.fixWidth,textHasControls:t.textHasControls,centeredScaling:t.centeredScaling,originX:t.originX,originY:t.originY,customIcons:t.customIcons,fontColor:t.fontColor,time:t.time,path:t.path,imageSrc:t.templateImages?t.templateImages[0].url:t.templateImages,templateCoord:t.templateCoord,templateOut:t.templateOut,isBigCarving:t.isBigCarving,callback:function(){t.bgLoad=!1}}),t.templateImages&&(t.templateUrl=t.templateImages[0].url,t.templateLabel=t.templateImages[0].label,t.templateImages.forEach(function(e,a){a>0?t.templateSelect.push(!1):t.templateSelect.push(!0)}));var o=window.innerWidth,s=t.cWidth;o<=414?t.cWidth=o-70:o>768&&o<=1024&&(t.cWidth=240),t.cHeight=t.cWidth*t.cHeight/s,this.engravingSize[this.param.index]=Ot.carving[this.param.index].engravingSizeOptions[0].value?Ot.carving[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=Ot.carving[this.param.index].engravingFontOptions[0].value?Ot.carving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman";var l={};t.$store.getters.getCustomInfo&&(l=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(l.engraving)||(l.engraving=[]),l.engraving[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",templateUrl:t.templateUrl,templateLabel:t.templateLabel},t.$store.dispatch("setCustomInfo",JSON.stringify(l)),t.coors&&(t.coors.forEach(function(e,a){t.isEmpty.push(!1),t.nameLeftNum[a]=e.limit,t.carvingEmojiError.push(!1),t.carvingLimitError.push(!1),"undefined"!=typeof e.fontList?t.coorsFont.push(e.fontList[0].value):"emoji"!=e.type&&t.coorsFont.push(e.font),"undefined"!=typeof e.sizeList?t.coorsSize.push(e.sizeList[0].value):"emoji"!=e.type&&t.coorsSize.push(e.size),"undefined"!=typeof t.limitErrorField&&t.limitErrorField.indexOf("*")>-1&&(t.limitErrorField=t.limitErrorField.replace(/\*/g,e.minLimit)),"undefined"!=typeof e.spaceFlag&&"undefined"!=typeof e.spaceFlag.flag?t.textMaxlength.push(parseInt(e.limit)+e.spaceFlag.flag.length):t.textMaxlength.push(e.limit);var i=e.placeHolder?e.placeHolder:t.textPlaceHolder;t.textPlaceHolderList.push(i)}),t.engravingFont[t.param.index]=t.coorsFont.join("|"),t.engravingSize[t.param.index]=t.coorsSize.join("|")),t.path&&t.path.forEach(function(e,a){t.isCurveEmpty.push(!1),t.curveLeftNum[a]=e.limit,t.curveEmojiError.push(!1);var i=e.placeHolder?e.placeHolder:t.textPlaceHolder;t.curvePlaceholderText.push(i)}),t.hasPhoto&&(t.carvingAble=!1,window.addEventListener("EVENT_PHOTO_SAVE_AFTER",function(e){e.detail.index;var a=e.detail.data,i=a.photo[0].crop;if(i)if(t.carvingAble=!1,fabric.Image.fromURL(i,function(e){e.scaleX=Ot.carvingObj[t.param.index].canvas.width/e.width,e.scaleY=Ot.carvingObj[t.param.index].canvas.height/e.height,Ot.carvingObj[t.param.index].canvas.setBackgroundImage(e),Ot.carvingObj[t.param.index].canvas.requestRenderAll()},{crossOrigin:"Anonymous"}),t.isBigCarving>0){var n=Ot.carvingObj[t.param.index].canvas.getContext("2d"),r=Ot.carvingObj[t.param.index].canvas.width,o=Ot.carvingObj[t.param.index].canvas.height,s=n.getImageData(0,0,r,o),l=t.getRectCoor(s),c=t.carvingBigObj.canvas.width-l.left-l.right,d=t.carvingBigObj.canvas.height-l.top-l.buttom;fabric.Image.fromURL(a.photo[0].ai,function(e){e.scaleX=c/e.width,e.scaleY=d/e.height,e.left=l.left,e.top=l.top,t.carvingBigObj.canvas.setBackgroundImage(e),t.carvingAble=!0,t.carvingBigObj.canvas.requestRenderAll()},{crossOrigin:"Anonymous"})}else fabric.Image.fromURL(a.photo[0].ai,function(e){e.scaleX=t.cWidth/t.bigCanvas.width,e.scaleY=t.cHeight/t.bigCanvas.height,e.left=(t.cWidth-e.width*e.scaleX)/2,e.top=(t.cHeight-e.height*e.scaleY)/2,t.carvingBigObj.canvas.setBackgroundImage(e),t.carvingBigObj.canvas.requestRenderAll(),t.carvingAble=!0},{crossOrigin:"Anonymous"})}))},watch:{cropSource:function(){0!=Object.keys(this.$refs).length?(this.useOpen=!1,this.$refs.cropper.replace(this.cropSource)):this.useOpen=!0},fontColor:function(t){var e=this;e.coors.forEach(function(a,i){Ot.carvingObj[e.param.index].changeColor(t,i)})},centerDialogVisible:function(t){!0===t?Ot.dispatchCustomEvent("EVENT_CARVING_DIALOG",{index:this.param.index}):Ot.dispatchCustomEvent("EVENT_CARVING_DIALOG_CLOSE",{index:this.param.index})}}},Vt=qt,Ht=(a("641e"),Object(Ft["a"])(Vt,Dt,zt,!1,null,null,null)),Yt=Ht.exports,Xt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{class:t.areaCropUploadClass},[a("div",{staticClass:"area-crop-upload-flex"},[t.cropImg?a("img",{staticClass:"preview-thumbnail",attrs:{src:t.cropImg},on:{click:t.openimage}}):a("span",{staticClass:"area-crop-upload-text"},[t._v(t._s(t.uploadLabel)),t.requireVal?a("font",{attrs:{color:"red"}},[t._v("*")]):t._e()],1)]),a("div",{staticClass:"area-crop-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload,accept:t.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open crop-btn-upload-open",attrs:{type:"button"}},[t._v(t._s(this.btnUploadText))])])],1)]),a("el-dialog",{attrs:{title:"",width:t.dialogWidth,visible:t.centerDialogVisible,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened,close:t.cancelCanvas}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.showOption,expression:"showOption"}]},[a("div",{staticClass:"options-choose-tpl"},[t._v(t._s(t.templateLabel)+"*")]),a("vue-select-image",{attrs:{dataImages:t.dataImages,h:t.textureH,w:t.textureW,selectedImages:t.selectedImages},on:{onselectimage:t.changeStyle}}),a("div",{staticClass:"options-tpl-next"},[a("el-button",{on:{click:t.openCrop}},[t._v(t._s(t.optionsNextText))])],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCrop,expression:"showCrop"}],staticStyle:{"text-align":"center"}},[a("div",{staticStyle:{"text-align":"center"}},[a("div",{style:t.subDialogWidth},[a("vue-cropper",{ref:"cropper",staticClass:"custom-cropper",attrs:{"view-mode":1,"drag-mode":"move",background:!0,rotatable:!0,src:t.imgSrc,"min-container-width":300,"min-container-height":240,aspectRatio:t.aspectRatio,"img-style":t.imgStyle}})],1)]),a("div",{staticClass:"design-tool-bar"},[a("i",{staticClass:"el-icon-thirdrotate-left design-tool-bar-icon",on:{click:function(e){return t.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdsync design-tool-bar-icon",on:{click:function(e){return t.doAction("reset")}}}),a("i",{staticClass:"el-icon-thirdrotate-right design-tool-bar-icon",on:{click:function(e){return t.doAction("right")}}})]),a("div",{staticClass:"crop-prompt",domProps:{innerHTML:t._s(t.cropPrompt)}},[t._v(t._s(t.cropPrompt))]),t.hasPhoto?t._e():a("div",{directives:[{name:"show",rawName:"v-show",value:!t.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1),a("span",{staticClass:"dialog-footer edit-tpl-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{disabled:0==t.percentage&&!t.uploadLoadingImage},on:{click:t.cancelCanvas}},[t._v(t._s(t.cropCancelText))]),a("el-button",{attrs:{type:"primary",loading:t.isLoading},on:{click:t.saveCanvas}},[t._v(t._s(t.cropConfirmText))])],1)])]),t.isLoading&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.uploadLoadingImage}})])]):t._e()],1)},Jt=[],Gt=a("95c3"),Qt=a.n(Gt),Zt=a("f36a"),Kt=a.n(Zt);a("6ea1");var te={name:"CropDialog",props:["param"],components:{VueCropper:Qt.a,VueSelectImage:Kt.a},data:function(){return{areaCropUploadClass:"area-crop-upload area-crop-upload-"+this.param.index,uploadLabel:Ot.crop[this.param.index].uploadLabel?Ot.crop[this.param.index].uploadLabel:"Upload your Photo",btnUploadText:Ot.crop[this.param.index].btnUploadText?Ot.crop[this.param.index].btnUploadText:"Upload",crop:[],group:0,title:Ot.title?Ot.title:{},items:"",labels:"",info:"",params:"",cropBase64:"",cropPrompt:!1===Ot.cropPrompt?"":Ot.cropPrompt,requireVal:!1!==Ot.crop[this.param.index].require,cropCancelText:Ot.cropCancelText?Ot.cropCancelText:"Cancel",cropConfirmText:Ot.cropConfirmText?Ot.cropConfirmText:"Confirm",msgboxStyle:this.$device.mobile?"width: 95%; height: 95%;":"width: 500px; height: 400px;",centerDialogVisible:!1,percentage:0,cropQiniuObj:"",isLoading:!1,imgSrc:"",base64:"",dialogWidth:this.$device.mobile?"100%":"40%",subDialogWidth:this.$device.mobile?"width: 100%; border: 1px solid gray; display: inline-block;":"width: 500px; height:400px; border: 1px solid gray; display: inline-block;",imgStyle:this.$device.mobile?{}:{width:"500px",height:"400px"},isFullscreen:!!this.$device.mobile,hasPhoto:!0===Ot.crop[this.param.index].hasPhoto,showCrop:!0,showOption:!1,textureH:Ot.crop[this.param.index].textureH?Ot.crop[this.param.index].textureH:"50px",textureW:Ot.crop[this.param.index].textureW?Ot.crop[this.param.index].textureW:"50px",dataImages:Ot.crop[this.param.index].tplOptions?Ot.crop[this.param.index].tplOptions:[],optionsNextText:Ot.crop[this.param.index].optionsNextText?Ot.crop[this.param.index].optionsNextText:"Next",selectStyle:Ot.crop[this.param.index].tplOptions?Ot.crop[this.param.index].tplOptions[0].value:"",selectedImages:Ot.crop[this.param.index].tplOptions?[Ot.crop[this.param.index].tplOptions[0]]:[],templateLabel:Ot.crop[this.param.index].templateLabel?Ot.crop[this.param.index].templateLabel:"Choose Template",aspectRatio:Ot.crop[this.param.index].aspectRatio?Ot.crop[this.param.index].aspectRatio:0,uploadClear:!0===Ot.uploadClear,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,isModalAppendToBody:!1!==Ot.isModalAppendToBody,bgOpacity:Ot.bgOpacity?Ot.bgOpacity:.5,wrapperBackgroudColor:Ot.wrapperBackgroudColor?Ot.wrapperBackgroudColor:"#ffffff",uploadLoadingImage:Ot.uploadLoadingImage?Ot.uploadLoadingImage:"",hasSelect:!0===this.param.data.hasSelect,uploadAccept:Ot.uploadAccept?Ot.uploadAccept:"",compressSize:Ot.crop[this.param.index].compressSize?Ot.crop[this.param.index].compressSize:5e3,quality:Ot.crop[this.param.index].quality?Ot.crop[this.param.index].quality:.7,cropSizeWidth:!!Ot.crop[this.param.index].cropSizeWidth&&Ot.crop[this.param.index].cropSizeWidth,cropSizeHeight:!!Ot.crop[this.param.index].cropSizeHeight&&Ot.crop[this.param.index].cropSizeHeight,imageType:Ot.crop[this.param.index].imageType?Ot.crop[this.param.index].imageType:"png"}},computed:{cropImg:{get:function(){return this.hasPhoto?this.$store.getters.getCropPhoto(this.param.index):this.crop[this.param.index]},set:function(t){this.hasPhoto?this.$store.dispatch("setCropPhoto",t):this.crop[this.param.index]=t}}},methods:{openimage:function(){this.$parent.openimage(this.cropImg)},getItems:function(){var t=[];return Ot.items.forEach(function(e,a){var i=[];e.data.forEach(function(t,e){i.push(t)}),t.push(i)}),t||{}},getLabels:function(){var t=[];return Ot.items.forEach(function(e,a){e.label&&t.push(e.label)}),t||[]},open:function(t){this.centerDialogVisible=!0,this.isLoading=!1},onOpened:function(){var t=this;console.log(t.aspectRatio),this.$refs.cropper.setAspectRatio(t.aspectRatio),this.used||(this.$refs.cropper.replace(this.cropBase64),this.used=!0)},doAction:function(t){"reset"==t?this.$refs.cropper.reset():"left"==t?this.$refs.cropper.rotate(-45):"right"==t&&this.$refs.cropper.rotate(45)},getBgImg:function(t){return Ot.awcdn+"js/zen-crop-bobbleheads/img/"+t+"?"+Math.random()},avatarUpload:function(t){var e=this,a=this;a.params=t.data,a.hasPhoto&&(a.showOption=!0,a.showCrop=!1,a.$store.dispatch("setTemplateErrorMsg",""));var i=new FileReader;i.onload=function(a){e.open(t),e.cropBase64=a.target.result,e.used&&e.$refs.cropper.replace(e.cropBase64)},i.readAsDataURL(t.file)},rotate:function(){this.$refs.cropper.rotate(90)},_neat:function(){var t=this;t.$store.dispatch("setCustomInfo",JSON.stringify(Ot.neatenCustomInfo(t.$store.getters.getCustomInfo,t.items))),t.$parent.$refs.additionalOption.enable&&(t.$parent.$refs.additionalOption.status=!0),t.isLoading=!1,t.centerDialogVisible=!1,t.items[t.params.index1][t.params.index].hasCarving&&(t.items[t.params.index1][t.params.index].noSelect?t.$parent.$refs.carvingDialog.open(t.params):t.$parent.$refs.selectDialog.open(t.params)),t.percentage=0,Ot.dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:t.param.index,data:t.$store.getters.getCustomInfo})},changeAspectRatio:function(t){var e=this;e.aspectRatio=t},cancelCanvas:function(){var t=this;t.uploadLoadingImage||t.cropQiniuObj.unsubscribe(),t.percentage=0,t.centerDialogVisible=!1},saveCanvas:function(){var t=this;if(t.base64=this.$refs.cropper.getCroppedCanvas().toDataURL({format:t.imageType,quality:.8}),t.hasPhoto){t.$store.dispatch("setFusionPreview",""),t.$store.dispatch("setPhotoDialogVisibleNormal",!0),t.centerDialogVisible=!1,this.$store.dispatch("setIfChangeImage",!1);var e=new Image;e.src=t.base64,e.onload=function(){var a=1e3,i=.7,n=document.createElement("canvas"),r=n.getContext("2d"),o=Math.min(Math.min(a,e.width)/e.width,Math.min(a,e.height)/e.height);n.width=e.width*o,n.height=e.height*o,r.fillStyle="#fff",r.fillRect(0,0,n.width,n.height),r.drawImage(e,0,0,n.width,n.height);var s=n.toDataURL("image/jpeg",i);Ot.asyncFusion(Ot.crop[t.param.index].sku,t.selectStyle,s).then(function(e){0==e.data.error?(t.$store.dispatch("setTemplateErrorMsg",""),t.$store.dispatch("setFusionPreview",e.data.base64),_zenConfig.photoObj[t.param.index].change(_zenConfig.photoObj[t.param.index],e.data.base64),Ot.dispatchCustomEvent("EVENT_FUSION_COMFIRM",{data:e.data.base64})):(t.$store.dispatch("setTemplateErrorMsg",e.data.message),t.$store.dispatch("setIfChangeImage",!0),Ot.dispatchCustomEvent("EVENT_FUSION_ERROR",{data:e.data.message}))})}}else{t.uploadLoadingImage&&(t.centerDialogVisible=!1),t.isLoading=!0;var a={};if(t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.crop)||(console.log("_json.crop is not Array "),a.crop=[]),t.uploadClear){var i={crop:[]};i.crop[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",cropOrigin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(i))}if(Ot.crop[t.param.index].hasCropOrigin){e=new Image;e.src=t.base64,e.crossOrigin="Anonymous",e.onload=function(){var i=t.compressSize,n=t.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,e.width)/e.width,Math.min(i,e.height)/e.height);r.width=t.cropSizeWidth?t.cropSizeWidth:e.width*s,r.height=t.cropSizeHeight?t.cropSizeHeight:e.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(e,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n),c={base64:l,key:Ot.getFilename(12)+"."+t.imageType};Ot.cdnUploadNew(c,function(e){console.log(e),t.crop[t.param.index]=e.picture,a.crop[t.param.index].crop=e.picture,t.$store.dispatch("setCustomInfo",JSON.stringify(a)),Ot.dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:t.param.index,data:t.$store.getters.getCustomInfo});var i=new Image;i.src=t.cropBase64,i.crossOrigin="Anonymous",i.onload=function(){var e=t.compressSize,n=t.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(e,i.width)/i.width,Math.min(e,i.height)/i.height);r.width=i.width*s,r.height=i.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(i,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n),c={base64:l,key:Ot.getFilename(12)+"."+t.imageType};Ot.cdnUploadNew(c,function(e){a.crop[t.param.index].cropOrigin=e.picture,t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.isLoading=!1,t.centerDialogVisible=!1,t.percentage=0,t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param),Ot.dispatchCustomEvent("EVENT_CROPORIGIN_SAVE_AFTER",{index:t.param.index,data:t.$store.getters.getCustomInfo})},t)}},t)}}else{console.log("not hasCropOrigin");e=new Image;e.src=t.base64,e.crossOrigin="Anonymous",e.onload=function(){var i=t.compressSize,n=t.quality,r=document.createElement("canvas"),o=r.getContext("2d"),s=Math.min(Math.min(i,e.width)/e.width,Math.min(i,e.height)/e.height);r.width=t.cropSizeWidth?t.cropSizeWidth:e.width*s,r.height=t.cropSizeHeight?t.cropSizeHeight:e.height*s,o.fillStyle="#fff",o.fillRect(0,0,r.width,r.height),o.drawImage(e,0,0,r.width,r.height);var l=r.toDataURL("image/jpeg",n);"png"==t.imageType&&(l=l.replace("jpeg","png"));var c={base64:l,key:Ot.getFilename(12)+"."+t.imageType};Ot.cdnUploadNew(c,function(e){t.crop[t.param.index]=e.picture,a.crop[t.param.index].crop=e.picture,t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.isLoading=!1,t.centerDialogVisible=!1,t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param),Ot.dispatchCustomEvent("EVENT_CROP_SAVE_AFTER",{index:t.param.index,data:t.$store.getters.getCustomInfo})},t)}}console.log("string:",a)}},clearCrop:function(){var t=this;t.crop[t.param.index]="";var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.crop)||(e.crop=[]),e.crop[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",cropOrigin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e))},changeStyle:function(t){this.selectStyle=t.value,Ot.dispatchCustomEvent("EVENT_ETHNICITY_CHANGE",{style:t.value})},openCrop:function(){var t=this;t.showOption=!1,t.showCrop=!0,t.used&&t.$refs.cropper.replace(t.cropBase64)}},mounted:function(){var t=this;if(t.hasPhoto)t.showOption=!0,t.showCrop=!1;else{var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.crop)||(e.crop=[]),e.crop[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",cropOrigin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e))}window.changeAspectRatio=this.changeAspectRatio,window.clearCrop=this.clearCrop},watch:{cropSource:function(){}}},ee=te,ae=(a("0891"),Object(Ft["a"])(ee,Xt,Jt,!1,null,"7e0c9bcc",null)),ie=ae.exports,ne=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{class:t.crystalClass},[a("div",{staticClass:"crystal-preview-img"},[this.engravingCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[t.param.index],width:"50",height:"40"},on:{click:t.openImage}}):t._e()]),a("div",{staticClass:"crystal-preview-box",on:{click:t.open}},[a("div",{staticClass:"area-carving-preview-text crystal-preview-flex"},[this.engravingCrop[t.param.index]?t._e():a("span",[t._v(t._s(t.previewText))])]),a("div",{staticClass:"crystal-preview-flex"},[a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:t.open}},[t._v(t._s(t.btnText))])])]),a("el-dialog",{class:{loadingDialog:2==t.inLoading},attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,height:"600px",fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[1!=t.inLoading&&t.uploadLoadingImage?t._e():a("el-container",[a("el-aside",{attrs:{width:"50%"}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"})]),a("el-main",{attrs:{width:"50%"}},["CrystalName"==t.type||"CrystalCurveName"==t.type||"NameCarving"==t.type||"CurveName"==t.type?a("div",{staticClass:"namenecklace-photo"},[a("div",{staticClass:"view-name"},[a("span",[t._v(t._s(t.preview)+":")]),a("div",{staticClass:"showtext",style:"font-family:"+t.fontFamily,attrs:{id:"showtext"}},[t._l(t.lines,function(e){return a("span",{key:e,class:"showtext-in "+t.nameClass,style:t.style,attrs:{id:"showtext_"+e}},[t._v(t._s(t.showText[e]))])}),t._v("    \n                            ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),a("div",{staticClass:"carvingcanvas-content",class:{first:1==t.lines}},t._l(t.lines,function(e){return a("div",{key:e,staticClass:"pr"},[a("div",{staticClass:"curve-textarea",class:{crystalError:t.nameTextEmpty[e-1]&&t.errorBorderShow}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.nameText[e],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+e,type:"text","data-prefix":"ctext","data-index":e,id:"ctext"+e,maxlength:t.nameTextMaxLength[e],placeholder:t.enterName},domProps:{value:t.nameText[e]},on:{input:[function(a){a.target.composing||t.$set(t.nameText,e,a.target.value)},function(a){return t.changeAlphaText(e,t.nameText[e])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+e}},[t._v(t._s(t.nameLeftNum[e]))]),t._v(" "+t._s(t.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextEmpty[e-1]&&t.errorWordShow,expression:"nameTextEmpty[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextLimit[e-1]&&t.errorWordShow,expression:"nameTextLimit[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.atLeastField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameEmojiError[e-1]&&t.errorWordShow,expression:"nameEmojiError[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.emojiErrorField))])])}),0)]):t._e(),t.crystalHeaderShow?a("el-collapse",{attrs:{accordion:""},model:{value:t.crystalHeaderDisplay,callback:function(e){t.crystalHeaderDisplay=e},expression:"crystalHeaderDisplay"}},["NameCarving"!=t.type&&"CurveName"!=t.type?a("el-collapse-item",{attrs:{name:"crystalTitleName"}},[a("template",{staticClass:"crystal-header",slot:"title"},[a("div",{staticClass:"crystal-header-title-box"},[a("div",{staticClass:"crystal-header-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondHeaderDefaultImg}}),a("span",[t._v(t._s(t.crystalHeader))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[t._v(t._s(t.freeText))])])]),a("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.diamond,function(e,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondDefaultImg[i]}}),a("span",[t._v(t._s(t.crystalTitle)+t._s(i+1))])])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},t._l(e,function(e,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+t.picUrl+e.sku+".png?456);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":t.crystalColor[i],"data-index":i,"data-color":e.color,name:"color"+i,type:"radio"},domProps:{value:e.sku},on:{click:function(a){return t.changeColor(i,e.color,e.sku)}}}),a("div",{staticClass:"name"},[t._v(t._s(t.month[n]))])])}),0)])])])],2)}),1)],2):t._e(),"CrystalCurve"==t.type||"CrystalCarving"==t.type||"CrystalCurveName"==t.type||"NameCarving"==t.type||"CurveName"==t.type?a("el-collapse-item",{attrs:{name:"crystal-input-collapse"}},[a("template",{slot:"title"},[a("div",{staticClass:"engraving-title-box"},[a("div",{staticClass:"engraving-title"},[a("i",{staticClass:"header-icon el-icon-edit"}),a("span",[t._v(t._s(t.textTile))])]),t.isMarkup>0?a("span",{staticClass:"crystal-free",attrs:{"data-price":t.isMarkup}},[t._v(t._s(t.addPrice))]):a("div",{staticClass:"crystal-free"},[t._v(t._s(t.freeText))])])]),a("div",{staticClass:"card-body"},[t._l(t.coors,function(e,i){return a("div",{key:i},[a("div",{staticClass:"engravings"},[a("span",[t._v(t._s(t.textInputName)),t.coors.length>1?a("span",[t._v(t._s(i+1))]):t._e()]),t.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[i]"}],class:{crystalError:t.isEmpty[i]&&t.errorBorderShow},style:"font-family:"+t.engravingFont[t.param.index],attrs:{maxlength:e.textNum,id:"textInput"+i,"data-index":i,placeholder:t.textWords},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},function(e){return t.changeTextInput(i,t.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[i]"}],class:{crystalError:t.isEmpty[i]&&t.errorBorderShow},style:"font-family:"+t.engravingFont[t.param.index],attrs:{maxlength:e.textNum,id:"textInput"+i,"data-index":i,placeholder:t.textWords},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},function(e){return t.changeTextInput(i,t.textList[i])}]}}),a("span",{class:"num textNum"+i},[t._v(t._s(t.limitNum[i])+" "+t._s(t.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.isEmpty[i]&&t.errorWordShow,expression:"isEmpty[i] && errorWordShow"}],staticClass:"errorWord"},[t._v(t._s(t.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.isEmojiError[i]&&t.errorWordShow,expression:"isEmojiError[i] && errorWordShow"}],staticClass:"errorWord"},[t._v(t._s(t.emojiErrorField))])])}),t.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size crystal-font-size",attrs:{size:"large"},on:{change:t.changeSize},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),t.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[t._v(t._s(t.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},on:{change:t.changeFont},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},[a("el-col",t._l(t.engravingFontOptions,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1):t._e()],2)],2):t._e()],1):t._e(),t.crystalHeaderShow?t._e():a("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},["NameCarving"!=t.type&&"CurveName"!=t.type?a("div",t._l(t.diamond,function(e,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondDefaultImg[i]}}),a("span",[t._v(t._s(t.crystalTitle)+t._s(i+1))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[t._v(t._s(t.freeText))])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},t._l(e,function(e,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+t.picUrl+e.sku+".png?123);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":t.crystalColor[i],"data-index":i,"data-color":e.color,name:"color"+i,type:"radio"},domProps:{value:e.sku},on:{click:function(a){return t.changeColor(i,e.color,e.sku)}}}),a("div",{staticClass:"name"},[t._v(t._s(t.month[n]))])])}),0)])])])],2)}),1):t._e(),"CrystalCurve"==t.type||"CrystalCarving"==t.type||"CrystalCurveName"==t.type||"NameCarving"==t.type||"CurveName"==t.type?a("el-collapse-item",{attrs:{name:"crystal-input-collapse"}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("i",{staticClass:"header-icon el-icon-edit"}),a("span",[t._v(t._s(t.textTile))])]),t.isMarkup>0?a("span",{staticClass:"crystal-free",attrs:{"data-price":t.isMarkup}},[t._v(t._s(t.addPrice))]):a("div",{staticClass:"crystal-free"},[t._v(t._s(t.freeText))])])]),a("div",{staticClass:"card-body"},[t._l(t.coors,function(e,i){return a("div",{key:i,staticClass:"engravings"},[a("span",[t._v(t._s(t.textInputName)),t.coors.length>1?a("span",[t._v(t._s(i+1))]):t._e()]),t.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[i]"}],class:{crystalError:t.isEmpty[i]},attrs:{maxlength:e.textNum,id:"textInput"+i,"data-index":i,placeholder:t.textWords},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},function(e){return t.changeTextInput(i,t.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[i]"}],class:{crystalError:t.isEmpty[i]},attrs:{maxlength:e.textNum,id:"textInput"+i,"data-index":i,placeholder:t.textWords},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},t.changeTextInput]}}),a("span",{class:"num textNum"+i},[t._v(t._s(t.limitNum[i]))]),t._v(" "+t._s(t.leftText)+"\n                                ")])}),t.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:t.changeSize},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),t.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[t._v(t._s(t.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},on:{change:t.changeFont},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},[a("el-col",t._l(t.engravingFontOptions,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1):t._e()],2)],2):t._e()],1),a("div",[a("el-button",{staticClass:"btn-crystal-confirm",attrs:{type:"primary",disabled:t.photosLoad||t.bgLoad||t.photoLoad},on:{click:function(e){return t.saveCrystal(1)}}},[t._v(t._s(t.confirmText)),t.isMarkup>0?a("span",{staticClass:"is-markup",attrs:{"data-price":t.isMarkup}},[t._v(t._s(t.addPrice))]):t._e()]),t.isMarkup>0?a("el-button",{staticClass:"btn-crystal-cancel",on:{click:function(e){return t.saveCrystal(0)}}},[t._v("Without Engraving")]):t._e()],1)],1)],1),2==t.inLoading&&!t.loadingFullScreen&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:t.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1)]):t._e()],1),2==t.inLoading&&t.loadingFullScreen?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.uploadLoadingImage}})])]):t._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:t.crystalCanvasId}})])],1),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:"3000",height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}})])},re=[],oe=a("0342"),se=function(){function t(t){this.init(t)}return t.prototype=Object.assign(new kt,{init:function(t){this.config=t,this.canvas=new fabric.Canvas(t["canvasid"]),this.cWidth=t["cWidth"]||"",this.cHeight=t["cHeight"]||"",this.baseWidth=t["baseWidth"]||"",this.path=t["path"]||"",this.textBorderColor=t["textBorderColor"]||"#9FBDF7",this.text=[],this.textpath=[],this.custom=t["custom"]||"",this.defaultFont=t["defaultFont"]||"holyunion",this.lineHeight=t["lineHeight"]||1,this.isSinglelineInput=t["isSinglelineInput"],this.type=t["type"],this.canvas.selection=!1,this.setCanvaSize(),this.setBackground(),t["overLay"]&&this.setOverlay(),this.setBgAndObj(),this.canvas.renderAll()},setOverlay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.canvas.setOverlayImage(t.config["overLay"],t.canvas.renderAll.bind(t.canvas),{scaleX:t.scale,scaleY:t.scale,crossOrigin:"anonymous"})},setBackground:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.canvas.setBackgroundImage(t.config["bg"],t.canvas.renderAll.bind(t.canvas),{scaleX:t.scale,scaleY:t.scale,crossOrigin:"anonymous"})},setBgAndObj:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;if("NameCarving"==t.type||"CurveName"==t.type)t.config.callback(t);else{var e=0;this.config["diamond"][e]&&this.setDiamond(e)}},setDiamond:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;fabric.Image.fromURL(e.config["diamond"][t],function(a){a.lockMovementX=!0,a.lockMovementY=!0,a.selectable=!1,a.scaleX=e.scale,a.scaleY=e.scale,e.canvas.add(a),t++,e.config["diamond"][t]?e.setDiamond(t):e.config.callback(e)}.bind(this),{crossOrigin:"anonymous"})},getColor:function(t){var e={pomegranate:["#4d0875","0.011618","-0.235405","0.713477","-1.59"],hyacinth:["#4d0875","-0.0981","-0.0471","0.474296","-0.086"],bodegablue:["#006291","-0.000145","0.101801","-0.000145","0"],whitezirconium:["#4d0875","-0.01975","0.011618","-1","-0.524"],greenzirconium:["#4d0875","-0.086407","-0.160906","0.180221","-0.85"],pink:["#4d0875","-0.133459","0.172379","-0.039355","-1.604"],redsteel:["#4d0875","-0.204037","-0.243247","0.99971","-1.654"],olive:["#4d0875","-0.192274","-0.015829","-0.05896","-1.148"],bluezirconium:["#4d0875","-0.243247","-0.231484","0.368429","-0.322"],rosered:["#4d0875","-0.078565","-0.05896","0.733082","0.198"],champagne:["#4d0875","-0.141301","0.062591","0.733082","0.662"],spinel:["#4d0875","-0.035434","-0.086407","0.611531","1.646"],alexred:["#4d0875","0.023381","-0.211879","0.301772","-1.62"],alexpinkishpurple:["#130141","-0.031513","-0.031513","-0.337351","0"],alexseablue:["#4d0875","0.023381","-0.055039","-0.721609","-0.414"],alexwhite:["#4d0875","0.023381","-0.055039","-1","-0.414"],alexgreen:["#4d0875","-0.070723","-0.376561","0.552716","1.234"],alexlightpurple:["#4d0875","-0.011908","-0.149143","-0.478507","1.776"],alexrosepink:["#4d0875","0.101801","-0.086407","-0.160906","-1.66"],alexolive:["#4d0875","-0.000145","-0.13738","0.082196","-1.148"],alexblue:["#4d0875","-0.125617"," -0.125617"," 0.152774","1.582"],alexpink:["#4d0875","0.117485","0.015539","-0.68632","-1.52"],alexamber:["#4d0875","0.074354","-0.145222","0.168458","0.554"],alexlightblue:["#4d0875","0.074354","-0.047197","-0.109933","1.428"],originalwhite:["#707070","0.37235","0.117485","-0.000145","0"],originalcolorwhite:["#13e8ff","0.168458","0.13709","0.391955","0.136"],originalcolorblue:["#0b7477","0.270404","-0.000145","0.168458","0.034"],originallightyellow:["#7d6504","0.050828","0.035144","0.662504","0.034"],originalolive:["#4d0875","0.007697","-0.05896","-0.317746","-1.094"],originalperidot:["#4d0875","0.007697","-0.05896","-0.705925","-1.094"],originalaquamarine:["#016f7a","0.37235","0.117485","-0.000145","0"],originalblack:["#000000","0.13709","-0.031513","0.391955","-0.066"],originalblackdiamond:["#4d0875","-0.004066","-0.25501","-1","0.444"],originalred:["#750000","0.015539","-0.102091","-0.000145","0"],originalcitrine:["#b47501","-0.015829","-0.133459","-0.000145","0"],originalgold:["#4d0875","-0.207958","0.13709","0.517427","0.7"],originalstarlite:["#005757","0.050828","0.035144","0.662504","0.034"],originalblue:["#070093","0.37235","0.035144","0.391955","-0.066"],originalgreen:["#003939","-0.000145","0.066512","0.188063","-0.1"],originalrosered:["#4d0875","-0.188353","0.011618","0.41156"," 0.244"],originalcymbidium:["#4d0875","-0.188353","-0.325588","0.05867","1.606"],originalpinkishpurple:["#400080","-0.000145","0.050828","-0.000145","-0.1"],originallightred:["#750000","0.37235","0.117485","-0.000145","0"],originallightrosered:["#e37bbc","0.37235","0.117485","-0.000145","0"],originallightpurple:["#4d0875","-0.125617","0.070433","-0.404008","-2"],originalpink:["#70384b","-0.082486","0.117485","-0.423613","0"],originalpurplishred:["#930453","0.25472","0.101801","-0.000145","0"],originalviolet:["#4d0875","-0.102091","0.109643","-0.494191","-1.946"],originalpurple:["#6206d2","0.37235","0.035144","0.391955","0.034"],brightred:["#ff0000","-0.01975","0.104644","-0.031513","0"],purplevelvet:["#99004d","0.046907","-0.05896","-0.000145","0"],shallowbluejade:["#3d5ccb","-0.000145","0.101801","-0.000145","0"],newwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],emerald:["#0b5334","0.102091","-0.153064","-0.37264","0.096"],greyviolet:["#b02d68","-0.007987","0.090038","-0.129538","0.122"],darkred:["#6c0000","0.184142","-0.074644","-0.031513","-0.012"],fruitgreen:["#0c6d0c","-0.153064","0.082196","-0.37264","0.014"],cobaltblue:["#0c419a","0.046907","-0.05896","-0.000145","0"],softred:["#840042","-0.031513","-0.01975","-0.37264","0.096"],yellow:["#4d0875","-0.141301","0.062591","0.733082","0.662"],jadeblue:["#4f84aa","-0.007987","-0.074644","-0.007987","0"],janred:["#ff0000","-0.000145","0.101801","-0.000145","0"],febrose:["#b00058","-0.000145","0.101801","-0.000145","0"],marblue:["#1ab5ff","-0.000145","0.101801","-0.000145","0"],aprwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],maygreen:["#006834","-0.000145","0.101801","-0.000145","0"],junpurple:["#600048","-0.000145","0.101801","-0.000145","0"],jultangerine:["#d24400","-0.000145","0.101801","-0.000145","0"],auggreen:["#647640","0.231194","0.101801","-0.000145","0"],sepblue:["#5F8BBB","0.172379","-0.051118","-0.000145","0"],octpurple:["#c95891","-0.000145","0.101801","-0.000145","0"],novorange:["#fb7700","-0.000145","0.101801","-0.000145","0"],decblue:["#0020a2","-0.000145","0.101801","-0.000145","0"],garnet:["#ff0000","-0.000145","0.101801","-0.000145","0"],purpleblue:["#7642BC","-0.000145","0.101801","-0.000145","0"],shallowblue:["#8ef3ff","-0.000145","0.001801","-0.000145","0"],cerkonier:["#8B8387","-0.01975","0.011618","-1","-0.524"],greencerkonier:["#004529","-0.000145","0.101801","-0.000145","0"],pinkred:["#c67589","-0.000145","0.101801","-0.000145","0"],redsteelnew:["#4d0875","-0.204037","-0.143247","0.99971","-1.654"],middleolive:["#9E8847","0.231194","0.001801","-0.000145","0"],bluecerkonier:["#002C74","0.172379","-0.051118","-0.000145","0"],roseredsteel:["#c95891","-0.000145","0.101801","-0.000145","0"],champ:["#fec0ab","-0.000145","0.001801","-0.000145","0"],sharpcrystal:["#4D95CE","-0.000145","0.101801","-0.000145","0"]};return e[t]},setColor:function(t,e){var a=this.getColor(e);t.filters=[];var i=new fabric.Image.filters.BlendColor({color:a[0],mode:"add",alpha:1}),n=new fabric.Image.filters.Contrast({contrast:a[1]}),r=new fabric.Image.filters.Brightness({brightness:a[2]}),o=new fabric.Image.filters.Saturation({saturation:a[3]}),s=new fabric.Image.filters.HueRotation({rotation:a[4]});t.filters.push(i),t.applyFilters(),this.canvas.renderAll(),t.filters.push(n),t.applyFilters(),this.canvas.renderAll(),t.filters.push(r),t.applyFilters(),this.canvas.renderAll(),t.filters.push(o),t.applyFilters(),this.canvas.renderAll(),t.filters.push(s),t.applyFilters(),this.canvas.renderAll()},initPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.stage=new Mt.a.Stage({container:"container",width:t.cWidth,height:t.cHeight}),t.layer=new Mt.a.Layer,t.path.forEach(function(e,a){t.textpath[a]=new Mt.a.TextPath({x:0,y:0,align:"center",fill:"#000",fontSize:e.textFontSize,fontFamily:t.defaultFont,text:"",data:e.path}),t.layer.add(t.textpath[a])}),t.stage.add(t.layer),t.img=new Image,t.imgObj=new fabric.Image(t.img),t.imgObj.lockMovementX=!0,t.imgObj.lockMovementY=!0,t.imgObj.selectable=!1,t.canvas.add(t.imgObj),t.img.onload=function(){t.imgObj.setElement(t.img),t.imgObj.set({left:0,top:0,scaleX:t.scale,scaleY:t.scale}),t.canvas.renderAll(!0)}},initCarvingPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.custom.coors.forEach(function(e,a){var i=e.angle||0,n=parseFloat(e.lineHeight)||1;t.text[a]=new fabric.Text("",{originX:"center",originY:"center",left:e.left*t.scale,top:e.top*t.scale,angle:i,hasBorders:!0,hasControls:!1,borderColor:t.textBorderColor,fontSize:e.textFontSize*t.scale,lineHeight:n,textAlign:"center",fill:e.textColor||"black"}),e.defaultFont&&t.changeCarvingFont(e.defaultFont,a),t.canvas.add(t.text[a]),t.canvas.renderAll(!0)})},textToVertical:function(t){for(var e="",a=0;a<t.length;a++){if(a==t.length-1)var i="";else i="\n";e+=t[a]+i}return e},changeText:function(t,e){this.textpath[e].setText(t),this.layer.draw();var a=this.stage.toDataURL();this.img.src=a},changeCarvingText:function(t,e){var a=this,i=this.text[e];i&&("vertical"==this.custom.coors[e].direction&&(t=this.textToVertical(t)),this.isSinglelineInput||(t=this.wrapCanvasText(t,this.canvas,i.fontFamily,i.fontSize,this.custom.coors[e].limitArea.width*this.scale,this.custom.coors[e].limitArea.height*this.scale)),i.set("text",t),this.canvas.on("object:moving",function(){a.checkLimitArea(i,e)}),this.checkLimitArea(i,e,t),this.canvas._activeObject=i,this.canvas.renderAll())},changeSize:function(t,e){var a=this.textpath[t];if(a){a.setFontSize(e),this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}},changeCarvingSize:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=this.text[t];i&&(i.set("fontSize",e),"vertical"==this.custom.coors[t].direction&&(a=this.textToVertical(a)),i.set("text",a),this.checkLimitArea(i,t,a),this.canvas.renderAll())},loadAndUse:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=new oe(e);i.load().then(function(){var i=a.textpath[t];i&&(i.setFontFamily(e),a.layer.draw(),a.img.src=a.stage.toDataURL())}).catch(function(t){console.log(t)})},loadAndUseCarving:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=new oe(e);i.load().then(function(){var i=a.text[t];i&&(i.set("fontFamily",e),a.canvas.renderAll())}).catch(function(t){console.log(t)})},changeFont:function(t,e){this.loadAndUse(e,t)},changeCarvingFont:function(t,e){this.loadAndUseCarving(e,t)},checkQuantity:function(t,e,a){var i=0;return""==t?1:t.length<e?1:t.length>a?1:i},checkLimitArea:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("undefined"!==typeof this.custom.coors[e].limitArea){var i=this.custom.coors[e].limitArea,n=0;if(a){if(t.height>i.height*this.scale){var r=a.split(/[(\r\n)\r\n]+/);if(r.length>1){n=Math.ceil((t.height-i.height*this.scale)/(t.height/r.length)),a="";for(var o=0;o<r.length-n;o++)a+=o>0?"\n"+r[o]:r[o]}}t.set("text",a),this.canvas.renderAll(),t.width>i.width*this.scale&&(n=Math.ceil((t.width-i.width*this.scale)/(t.width/a.length)),a=a.substr(0,a.length-n)),t.set("text",a),this.canvas.renderAll()}var s=t.top,l=t.left,c=l,d=s,h=t.width/2,p=t.height/2;l-h<i.left*this.scale?c=i.left*this.scale+h:l+h>i.left*this.scale+i.width*this.scale&&(c=i.left*this.scale+i.width*this.scale-h),s-p<i.top*this.scale?d=i.top*this.scale+p:s+p>i.top*this.scale+i.height*this.scale&&(d=i.top*this.scale+i.height*this.scale-p),t.set({left:c,top:d}),this.canvas.renderAll()}},wrapCanvasText:function(t,e,a,i,n,r){"undefined"===typeof r&&(r=0);var o=t.split(" "),s="",l=(t.replace(/(\r\n|\n|\r)/gm,""),new fabric.Text("sdfsdf",{fontFamily:a,fontSize:25}).height),c=r>0?r-l:0,d=e.getContext("2d");d.font=i+"px "+a;for(var h="",p=0,g=0;g<o.length;g++){var m=""==h,u=h+" "+o[g],v=d.measureText(u).width;if(v<n)h+=o[g]+" ",s+=o[g]+=" ";else{if(m)for(var f="",x=0;x<o[g].length;++x){f+=o[g].charAt(x);var b=f+"-";if(d.measureText(b).width>=n){b=f.substr(0,f.length-1)+"",o[g]=o[g].substr(f.length-1,o[g].length),s+=b;break}}g--,s+="\n",p++,h=""}if(c>0&&p*l>c){s=s.substr(0,s.length-3)+"...\n";break}}return s=s.substr(0,s.length-1),s}}),t.prototype.constructor=t,t}(),le=se,ce=function(){function t(t){this.init(t)}return t.prototype=Object.assign(new kt,{init:function(t){this.tertiusType=t.json.tertiusType||"",this.secondType=t.json.secondtype||"",this.lines=t.json.lines||"",this.specialSymbol=t.json.specialSymbol||"",this.symbolPosition=t.json.symbolPosition||"",this.symbolSave=0===t.json.symbolSave?0:1,this.textType=t.json.textType||"",this.supportLanguage=t.json.supportLanguage||"",this.ischange=t.json.ischange||"",this.fontfamily=t.fontfamily||"BrushScriptStd",this.class=t.json.class||"silver",this.textInfo=t.json.text||[],this.isrometime=t.json.isrometime||"",this.iscenterchange=t.json.iscenterchange||"",this.text=[],this.setObject()},setObject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.textInfo.forEach(function(e,a){t.text[a]={},t.text[a].config=e})},process:function(t,e){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t=this.text[e].text=this.checkTextType(t),"MonogramsThree"==this.secondType?this.text[e].showText=this.text[e].text=this.convertMonogram(t):"MonogramsFive"==this.secondType?(this.text[e].showText=this.convertMonogramFive(t),this.text[e].text=((t[0]||"")+(t[1]||"")).toLowerCase()+(t[2].toUpperCase()||"")+((t[3]||"")+(t[4]||"")).toLowerCase()):"CircleThree"==this.secondType?(this.text[e].showText=this.convertCircleThree(t),this.text[e].text=(t[0]?t[0].toLowerCase():"")+(t[1]?t[1].toUpperCase():"")+(t[2]?t[2].toLowerCase():"")):"CircleTwo"==this.secondType?this.text[e].showText=this.text[e].text=this.convertCircleTwo(t):"HollowOut"==this.secondType?this.text[e].showText=this.text[e].text=t.toUpperCase():"Any"==this.secondType?(this.text[e].showText=this.text[e].text=this.tertiustypeSetval(t),a&&(this.text[e].showText=this.text[e].text=(t.charAt(0)?t.charAt(0).toUpperCase():"")+(t.substr(1)?t.substr(1):""))):(this.text[e].showText=this.text[e].text=this.tertiustypeSetval(this.text[e].text),a&&(this.text[e].showText=this.text[e].text=(t.charAt(0)?t.charAt(0).toUpperCase():"")+(t.substr(1)?t.substr(1):""))),this.text[e].showText=this.replaceShowtext(this.text[e].showText),this.text[e].showText=this.lastVariationTransformEn(this.text[e].showText),this.text[e].showText=this.showtextSpecialSymbol(this.text[e].showText,e)},tertiustypeSetval:function(t){return"initialUpper"==this.tertiusType?this.initialUpper(t):"upperCase"==this.tertiusType?t.toUpperCase():t},checkTextType:function(t){if(1==this.isrometime){if(t=t.replace(/[^0-9\/-]/g,""),""!=t.replace(/(^\s*)|(\s*$)/g,"")){var e=t.split("-");console.log("datetimeArr",e),t=this.convertToRome(e[0])+"  "+this.convertToRome(e[1])+"  "+this.convertToRome(e[2])}}else 1==this.textType?t=t.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZÀàÇÊËçêëáÁãÃàÀâÂçÇéÉêÊíÍóÓõÕòÒôÔúÚùÙûÛäÄöÖüÜßßñÑèÈëËïÏîÎœŒ]/g,""):2==this.textType?t=t.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZàÀâÂçÇéÉèÈêÊëËïÏîÎôÔùÙûÛœŒ]/g,""):3==this.textType?t=t.replace(/[^a-zA-Z]/g,""):4==this.textType?t=t.replace(/[^ؠءآأؤإئابةتثجحخدذرزسشصضطظعغػؼؽؾؿـفقكلمنهوىيپٿڀځڂڃڄڅچڇڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙښڛڜڝڞڟڠڡڢڣڤڥڦڧڨکڪګڬڭڮگڰڱڲڳڴڵڶڷڸڹںڻڼڽھڿۀہۂۃۄۅۆۇۈۉۊۋیۍێۏېۑےۓۮۯ]/g,""):5==this.textType?t=t.replace(/[^abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZؠءآأؤإئابةتثجحخدذرزسشصضطظعغػؼؽؾؿـفقكلمنهوىيپٿڀځڂڃڄڅچڇڈډڊڋڌڍڎڏڐڑڒړڔڕږڗژڙښڛڜڝڞڟڠڡڢڣڤڥڦڧڨکڪګڬڭڮگڰڱڲڳڴڵڶڷڸڹںڻڼڽھڿۀہۂۃۄۅۆۇۈۉۊۋیۍێۏېۑےۓۮۯ]/g,""):6==this.textType?t=t.replace(/[^0-9,]/g,""):7==this.guq.textType&&(text=text.replace(/[^0-9a-zA-Z.]/g,""));return t},convertToRome:function(t){for(var e="",a=Math.floor(t/1e3),i=Math.floor(t%1e3/100),n=Math.floor(t%100/10),r=t%10,o=["I","II","III","IV","V","VI","VII","VIII","IX"],s=["X","XX","XXX","XL","L","LX","LXX","LXXX","XC"],l=["C","CC","CCC","CD","D","DC","DCC","DCCC","CM"],c="M",d=0;d<a;d++)e+=c;return i&&(e+=l[i-1]),n&&(e+=s[n-1]),r&&(e+=o[r-1]),e},replaceShowtext:function(t){var e,a=(e={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ft["a"])(e,"ß","ss"),Object(ft["a"])(e,"ñ","n"),Object(ft["a"])(e,"Ñ","N"),Object(ft["a"])(e,"ö","o"),Object(ft["a"])(e,"Ö","O"),e);if(""==this.supportLanguage||1==this.supportLanguage||3==this.supportLanguage||4==this.supportLanguage){a={};4==this.supportLanguage&&(t=t.replace(/[abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ]/g,""))}else if(0==this.supportLanguage){var i;a=(i={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ft["a"])(i,"ß","ss"),Object(ft["a"])(i,"ñ","n"),Object(ft["a"])(i,"Ñ","N"),Object(ft["a"])(i,"ö","o"),Object(ft["a"])(i,"Ö","O"),i)}else if(2==this.supportLanguage)a={"á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};for(var n="",r=0;r<t.length;r++)"undefined"==typeof a[t.charAt(r)]?n+=t.charAt(r):n+=a[t.charAt(r)];return""!=n.trim()&&(t=n),t},showtextSpecialSymbol:function(t,e){return this.symbolPosition?1==this.symbolPosition?t=this.specialSymbol+t:t+=this.specialSymbol:("<"!=this.specialSymbol&&"."!=this.specialSymbol&&","!=this.specialSymbol&&"/"!=this.specialSymbol||(t="."==this.specialSymbol&&0==e?t:this.specialSymbol+t),"()"!=this.specialSymbol&&"[]"!=this.specialSymbol&&"{}"!=this.specialSymbol&&"-+"!=this.specialSymbol||(t=""==t.replace(/(^\s*)|(\s*$)/g,"")?"":this.specialSymbol[0]+t+this.specialSymbol[1])),t},lastVariationTransformEn:function(t){var e,a=(e={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss"},Object(ft["a"])(e,"ß","ss"),Object(ft["a"])(e,"ñ","n"),Object(ft["a"])(e,"Ñ","N"),Object(ft["a"])(e,"ö","o"),Object(ft["a"])(e,"Ö","O"),e);if(t.length>1){var i=t.charAt(t.length-1),n={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"};if(void 0!=a[i])return t=t.substr(0,t.length-1)+a[i],t;if(1==this.iscenterchange&&t.length>=3){var r=t.length/2;r=this.isInteger(r)?r-1:r-.5,t=t.substr(0,r)+(void 0==n[t.substr(r,1)]?t.substr(r,1):n[t.substr(r,1)])+t.substr(r+1)}if(1==this.ischange&&"undefined"!=typeof n[i])return t=t.substr(0,t.length-1)+n[i],t}return t},isInteger:function(t){return parseInt(t)==parseFloat(t)},convertCircleTwo:function(t){return(t[0]?t[0].toLowerCase():"")+(t[1]?t[1].toUpperCase():"")},convertCircleThree:function(t){return(t[0]?t[0].toLowerCase():"")+(t[1]?t[1].toUpperCase():"")+(t[2]?this.convertChar(t[2]):"")},convertMonogram:function(t){return(t[0]?t[0].toLowerCase():"")+(t[1]?t[1].toUpperCase():"")+(t[2]?t[2].toLowerCase():"")},initialUpper:function(t){return(t.substr(0,1)?t.substr(0,1).toUpperCase():"")+(t.substr(1)?t.substr(1).toLowerCase():"")},convertChar:function(t){var e={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};void 0!=e[t]&&(t=e[t]);var a={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"0",K:"!",L:"@",M:"#",N:"$",O:"%",P:"^",Q:"&",R:"*",S:"(",T:")",U:"-",V:"+",W:"[",X:"]",Y:"?",Z:";"};return a[t.toUpperCase()]},convertMonogramFive:function(t){var e={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"\\",z:";"};return(t[0]?e[t[0]]:"")+(t[1]?t[1].toLowerCase():"")+(t[2]?t[2].toUpperCase():"")+(t[3]?t[3].toLowerCase():"")+(t[4]?e[t[4]]:"")},setInputVal:function(t){var e=this.specialSymbol,a=this.symbolSave,i=this.symbolPosition,n="";if(1==t){var r=this.text[0].text;if(e&&1==a&&(i?1==i?r=e+r:r+=e:"="==e?r+=e:r="()"==e||"[]"==e||"{}"==e||"-+"==e?""==r.replace(/(^\s*)|(\s*$)/g,"")?"":e[0]+r+e[1]:e+r),this.ischange){var o={"à":"a","À":"A","â":"a","Â":"A","ç":"c","Ç":"C","é":"e","É":"E","ê":"e","Ê":"E","è":"e","È":"E","ë":"e","Ë":"E","ï":"i","Ï":"I","î":"i","Î":"I","ô":"o","Ô":"O","ù":"u","Ù":"U","û":"u","Û":"U","œ":"oe","Œ":"OE","á":"a","Á":"A","ã":"a","Ã":"A","í":"i","Í":"I","ó":"o","Ó":"O","õ":"o","Õ":"O","ò":"o","Ò":"O","ú":"u","Ú":"U","ä":"a","Ä":"A","ü":"u","Ü":"U","ß":"ss","ñ":"n","Ñ":"N","ö":"o","Ö":"O"};if(r.length>1){var s=r.charAt(r.length-1);void 0!=o[s]&&(r=r.substr(0,r.length-1)+o[s])}}if(1==this.iscenterchange&&r.length>=3){var l={a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"0",k:"!",l:"@",m:"#",n:"$",o:"%",p:"^",q:"&",r:"*",s:"(",t:")",u:"-",v:"+",w:"[",x:"]",y:"?",z:";"},c=r.length/2;c=this.isInteger(c)?c-1:c-.5,r=r.substr(0,c)+(void 0==l[r.substr(c,1)]?r.substr(c,1):l[r.substr(c,1)])+r.substr(c+1)}n=r}else if(2==t){var d=[this.text[0].text,this.text[1].text];if(e&&1==a)if(i)n=1==i?e+d[0]+"|"+e+d[1]:d[0]+e+"|"+d[1]+e;else{if("/"==e){d=this.text[1].text.length>this.text[0].text.length?[this.text[1].text,this.text[0].text]:d;var h=d[0].length/2;d[0].length%2==1&&(h=(d[0].length-1)/2);var p=d[1].length/2;d[1].length%2==1&&(p=(d[1].length-1)/2),d[0]=d[0].substr(0,h)+"/"+d[0].substr(h),d[1]=d[1].substr(0,p)+"/"+d[1].substr(p),e="|"}n=d[0]+e+d[1]}else n=d[0]+"|"+d[1]}else if(t>2)for(var g=0;g<t;g++)n+=g>0?"|"+this.text[g].text:this.text[g].text;return n},checkQuantity:function(t,e,a){var i=0;return""==t?(console.log("empty"),1):t.length<e?(console.log("str_min"),1):t.length>a?(console.log("str_max"),1):i}}),t}(),de=ce,he={name:"CrystalDialog",props:["param"],components:{},data:function(){return{activeName:"crystal0",crystalHeaderDisplay:"crystalTitleName",dialogWidth:this.param.data.dialogWidth?this.param.data.dialogWidth:"60%",inLoading:1,diamondHeaderDefaultImg:"",previewText:this.param.data.previewText?this.param.data.previewText:"Design Your Own",btnText:this.param.data.btnText?this.param.data.btnText:"Design",crystalHeaderShow:!!this.param.data.crystalHeaderShow&&this.param.data.crystalHeaderShow,crystalClass:"area-carving area-carving-"+this.param.index,crystalCanvasId:"crystalcanvas"+this.param.index,cWidth:this.param.data.cWidth,cHeight:this.param.data.cHeight,baseWidth:this.param.data.baseWidth,crystalTitle:this.param.data.crystalTitle?this.param.data.crystalTitle:"Select",crystalHeader:this.param.data.crystalHeader,diamond:this.param.data.diamond?this.param.data.diamond:"",textTile:this.param.data.textTile,textInputName:this.param.data.textInputName,isMarkup:this.param.data.isMarkup,freeText:this.param.data.freeText,month:this.param.data.month,isSinglelineInput:this.param.data.isSinglelineInput,textWords:this.param.data.textWords,leftText:this.param.data.leftText,productItem:this.param.data.productItem,uploadLoadingImage:this.param.data.uploadLoadingImage,confirmText:this.param.data.confirmText?this.param.data.confirmText:"Add Engravings",lineHeight:this.param.data.lineHeight?this.param.data.lineHeight:1,cancelText:this.param.data.cancelText,addPrice:this.param.data.addPrice,markupId:this.param.data.markupId,type:this.param.data.type,preview:this.param.data.preview,fontFamily:this.param.data.fontFamily,fontFamilyNew:this.param.data.fontFamily,lines:this.param.data.lines,enterName:this.param.data.enterName,requiredField:this.param.data.requiredField,emojiErrorField:this.param.data.emojiErrorField,atLeastText:this.param.data.atLeastText,charactersText:this.param.data.charactersText,changeText:this.param.data.changeText,fontText:this.param.data.fontText?this.param.data.fontText:"Font",nameText:[],showText:[],nameTextMaxLength:[],nameLeftNum:[],text:this.param.data.text,style:this.param.data.style,nameClass:this.param.data.class,code:this.param.data.code,picUrl:this.param.data.picUrl,loadingFullScreen:this.param.data.loadingFullScreen,bgOpacity:this.param.data.bgOpacity,wrapperBackgroudColor:this.param.data.wrapperBackgroudColor,errorWordShow:this.param.data.errorWordShow,errorBorderShow:this.param.data.errorBorderShow,firstUpperCase:this.param.data.firstUpperCase,clearNumberName:this.param.data.clearNumberName,nameTextEmpty:[],nameTextLimit:[],nameEmojiError:[],centerDialogVisible:!1,engravingCrop:[],engravingText:[],diamondColor:[],engravingSize:[],engravingFont:[],fontCode:[],alphaText:[],crystalColor:[],diamondDefaultImg:[],diamondDefaultColor:[],limitNum:[],textList:[],isEmpty:[],isEmojiError:[],percentage:0,base64:"",atLeastField:"",coors:this.param.data.coors,textBorderColor:this.param.data.textBorderColor?this.param.data.textBorderColor:"",isFullscreen:!!this.$device.mobile,engravingSizeOptions:Ot.crystal[this.param.index].engravingSizeOptions?Ot.crystal[this.param.index].engravingSizeOptions:{},engravingFontOptions:Ot.crystal[this.param.index].engravingFontOptions?Ot.crystal[this.param.index].engravingFontOptions:{},showSize:!0===Ot.crystal[this.param.index].showSize,showFont:!1!==Ot.crystal[this.param.index].showFont,imgRequire:!0===Ot.crystal[this.param.index].imgRequire,imgRequireNotice:Ot.crystal[this.param.index].imgRequireNotice,photosLoad:!0,bgLoad:!1,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,isModalAppendToBody:!1!==Ot.isModalAppendToBody,photoLoad:!1}},methods:{open:function(){var t=this,e=JSON.parse(t.$store.getters.getCustomInfo),a=!!e.photo&&e.photo[0].crop;a?(t.centerDialogVisible=!0,fabric.Image.fromURL(a+"?"+Math.random(),function(e){e.scaleX=Ot.crystalObj[t.param.index].canvas.width/e.width,e.scaleY=Ot.crystalObj[t.param.index].canvas.height/e.height,Ot.crystalObj[t.param.index].canvas.setBackgroundImage(e),Ot.crystalObj[t.param.index].canvas.requestRenderAll()},{crossOrigin:"Anonymous"})):t.imgRequire?alert(t.imgRequireNotice):t.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openImage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeFont:function(t){var e=this;e.coors.forEach(function(a,i){"CrystalCurve"==Ot.crystal[e.param.index].type||"CrystalCurveName"==Ot.crystal[e.param.index].type||"CurveName"==Ot.crystal[e.param.index].type?Ot.crystalObj[e.param.index].changeFont(t,i):"CrystalCarving"!=Ot.crystal[e.param.index].type&&"NameCarving"!=Ot.crystal[e.param.index].type||Ot.crystalObj[e.param.index].changeCarvingFont(t,i)})},changeSize:function(t){var e=this;e.coors.forEach(function(a,i){"CrystalCurve"==Ot.crystal[e.param.index].type||"CrystalCurveName"==Ot.crystal[e.param.index].type||"CurveName"==Ot.crystal[e.param.index].type?Ot.crystalObj[e.param.index].changeSize(i,t):"CrystalCarving"==Ot.crystal[e.param.index].type&&Ot.crystalObj[e.param.index].changeCarvingSize(i,t,e.textList[i])})},getFontFamily:function(t){return"font-family:"+t+";"},changeColor:function(t,e,a){var i=Ot.crystalObj[this.param.index].canvas.item(t);this.crystalColor[t]=a,this.$set(this.diamondDefaultImg,t,this.picUrl+a+".png?"+Math.random()),this.$set(this.diamondDefaultColor,t,e),Ot.crystalObj[this.param.index].setColor(i,e)},changeTextInput:function(t,e){var a=this;if(1==Ot.getLen(e))return!1;if("CrystalCurve"==Ot.crystal[this.param.index].type||"CrystalCurveName"==Ot.crystal[this.param.index].type||"CurveName"==Ot.crystal[this.param.index].type){if("monogram"==Ot.crystalObj[this.param.index].path[t].fontFamily){for(var i=e.toUpperCase(),n=[],r=0;r<i.length;r++)" "!=i[r]&&n.push(i[r]);this.textList[t]=n.join(" ")}e=a.formatText(t,e),Ot.crystalObj[this.param.index].changeText(e,t)}else"CrystalCarving"!=Ot.crystal[this.param.index].type&&"NameCarving"!=Ot.crystal[this.param.index].type||Ot.crystalObj[this.param.index].changeCarvingText(e,t);this.limitNum[t]=parseInt(this.coors[t].textNum)-e.length},formatText:function(t,e){var a=this;return e.indexOf("❤️")>-1&&(e=e.replace(/❤️/g,"❤"),a.textList[t]=e),e},changeAlphaText:function(t,e){if(1==Ot.getLen(e))return!1;var a=t-1;Ot.nameObj[this.param.index].process(e,a,this.firstUpperCase),this.nameText[t]=Ot.nameObj[this.param.index].text[a].text,this.showText[t]=Ot.nameObj[this.param.index].text[a].showText,this.nameLeftNum[t]=parseInt(this.nameTextMaxLength[t])-this.nameText[t].length},checkNametoBase64:function(){var t=this,e=0;if(t.text.forEach(function(a,i){e=1==Ot.nameObj[t.param.index].checkQuantity(t.nameText[i+1],a.limit.split("-")[0],a.limit.split("-")[1])}),1==e)return!1;var a=Ot.nameObj[t.param.index].setInputVal(t.lines);return a},getCtx:function(){var t=this,e="";t.showText.forEach(function(t,a){e+=" |"+t}),e=e.substring(2);var a=document.getElementById("myCanvas"),i=a.getContext("2d");i.fillStyle="rgba(255,255,255,1)",i.fillRect(0,0,3e3,100);var n=t.nameClass.trim();"silver"==n?(i.fillStyle="#808080",i.font="80px "+t.fontFamilyNew):"gold"==n?(i.fillStyle="#eac855",i.font="80px "+t.fontFamilyNew):"rosegold"==n&&(i.fillStyle="#c8977b",i.font="80px "+t.fontFamilyNew);var r=i.measureText(e).width,o=r+70;i.fillText(e,40,80);var s=document.getElementById("myCanvas2");s.width=o,s.height=100;var l=s.getContext("2d");l.drawImage(a,0,0,o,170,0,0,o,170);var c=s.toDataURL("image/png",.8),d=Ot.getFilename(6,!0)+".png";return{base64:c,key:d}},saveCrystal:function(t){var e=this,a=[],i=!0;if(("CrystalName"==e.type||"CrystalCurveName"==e.type||"NameCarving"==e.type||"CurveName"==e.type)&&(e.text.forEach(function(t,a){e.$set(e.nameEmojiError,a,!1),e.$set(e.nameTextLimit,a,!1),e.$set(e.nameTextEmpty,a,!1),e.nameText[a+1]?1==Ot.getLen(e.nameText[a+1])?(e.$set(e.nameEmojiError,a,!0),i=!1):e.nameText[a+1].length<parseInt(t.limit.split("-")[0])&&(e.atLeastField=e.atLeastText+t.limit.split("-")[0]+e.charactersText,e.$set(e.nameTextLimit,a,!0),i=!1):(e.$set(e.nameTextEmpty,a,!0),i=!1)}),i)){var n=e.checkNametoBase64();n?(e.alphaText[e.param.index]=n,e.fontCode[e.param.index]=e.code):i=!1}if("CrystalName"!=e.type&&"Crystal"!=e.type||(t=0),this.coors.forEach(function(n,r){t>0?(e.$set(e.isEmojiError,r,!1),e.$set(e.isEmpty,r,!1),e.textList[r]?1==Ot.getLen(e.textList[r])&&(e.$set(e.isEmojiError,r,!0),i=!1):(i=!1,e.$set(e.isEmpty,r,!0),e.crystalHeaderShow?e.crystalHeaderDisplay="crystal-input-collapse":e.activeName="crystal-input-collapse"),a.push(e.textList[r])):(e.textList[r]="",Ot.crystalObj[e.param.index].changeText("",r))}),e.engravingText[e.param.index]=a.join("|"),!i)return!1;if(e.loadingFullScreen&&(e.centerDialogVisible=!1),e.inLoading=2,e.crystalColor){var r=[];e.crystalColor.forEach(function(t,e){r.push(t)}),e.diamondColor[e.param.index]=r.join("|")}e.base64=Ot.crystalObj[this.param.index].canvas.toDataURL({format:"png",quality:.8});var o=Ot.getFilename(12),s=o+"-"+this.productItem+".png",l="";l=s?{base64:e.base64,key:s}:e.base64,Ot.cdnUpload(l,function(a){e.btnText=e.changeText,e.engravingCrop[e.param.index]=a.picture;var i={};if(e.$store.getters.getCustomInfo&&(i=JSON.parse(e.$store.getters.getCustomInfo)),"NameCarving"==e.type||"CurveName"==e.type){Array.isArray(i.nameCarving)||(i.nameCarving=[]),i.nameCarving[e.param.index]={carvingImage:a.picture,engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],fontCode:e.fontCode[e.param.index],alphaText:e.alphaText[e.param.index]},e.$store.dispatch("setCustomInfo",JSON.stringify(i));var n=e.getCtx();Ot.cdnUpload(n,function(t){i.nameCarving[e.param.index].nameCrop=t.picture,e.$store.dispatch("setCustomInfo",JSON.stringify(i))})}else{for(var r in Array.isArray(i.diamond)||(i.diamond=[]),i.diamond[e.param.index]={diamondImage:a.picture,engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],diamondCustom:e.diamondColor[e.param.index],fontCode:e.fontCode[e.param.index],alphaText:e.alphaText[e.param.index]},i.diamond[e.param.index])""==i.diamond[e.param.index][r]&&(delete i.diamond[e.param.index][r],"engravingText"==r&&(delete i.diamond[e.param.index]["engravingSize"],delete i.diamond[e.param.index]["engravingFont"]));if(e.$store.dispatch("setCustomInfo",JSON.stringify(i)),"CrystalName"==e.type){n=e.getCtx();Ot.cdnUpload(n,function(a){if(i.diamond[e.param.index].nameCrop=a.picture,e.$store.dispatch("setCustomInfo",JSON.stringify(i)),e.previewText=e.engravingText,e.percentage=0,e.inLoading=1,e.centerDialogVisible=!1,e.markupId){var n=document.getElementById(e.markupId);n.value=t>0?1:0;var r=new Event("change");n.dispatchEvent(r)}t>0?Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:i}):Ot.dispatchCustomEvent("EVENT_NO_ENGRAVING",{index:e.param.index,data:i}),"function"===typeof window.carvingCallback&&window.carvingCallback()})}else{if(e.previewText=e.engravingText,e.percentage=0,e.inLoading=1,e.centerDialogVisible=!1,e.markupId){var o=document.getElementById(e.markupId);o.value=t>0?1:0;var s=new Event("change");o.dispatchEvent(s)}t>0?Ot.dispatchCustomEvent("EVENT_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:i}):Ot.dispatchCustomEvent("EVENT_NO_ENGRAVING",{index:e.param.index,data:i}),"function"===typeof window.carvingCallback&&window.carvingCallback()}}},e)},changeCrystalBg:function(t){var e=this;e.bgLoad=!0,fabric.Image.fromURL(t+"?"+Math.random(),function(t){t.scaleX=Ot.crystalObj[e.param.index].canvas.width/t.width,t.scaleY=Ot.crystalObj[e.param.index].canvas.height/t.height,Ot.crystalObj[e.param.index].canvas.setBackgroundImage(t),Ot.crystalObj[e.param.index].canvas.requestRenderAll(),e.bgLoad=!1},{crossOrigin:"Anonymous"})},changeCrystalSku:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.param.index,a=this,i=Ot.crystalUrl?Ot.crystalUrl:Ot.photoUrl,n=i+t+"-OUT.png",r=i+t+"-IN.png";a.photoLoad=!0,fabric.Image.fromURL(r+"?"+Math.random(),function(t){t.scaleX=Ot.crystalObj[e].canvas.width/t.width,t.scaleY=Ot.crystalObj[e].canvas.height/t.height,Ot.crystalObj[e].canvas.setBackgroundImage(t),Ot.crystalObj[e].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"}),fabric.Image.fromURL(n+"?"+Math.random(),function(t){t.scaleX=Ot.crystalObj[e].canvas.width/t.width,t.scaleY=Ot.crystalObj[e].canvas.height/t.height,Ot.crystalObj[e].canvas.setOverlayImage(t),Ot.crystalObj[e].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"})},clearCrystal:function(){var t=this;t.engravingCrop[t.param.index]="";var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),"NameCarving"==t.type||"CurveName"==t.type?(Array.isArray(e.nameCarving)||(e.nameCarving=[]),e.nameCarving[t.param.index]={carvingImage:"",engravingText:"",engravingSize:"",engravingFont:"",fontCode:"",alphaText:""}):(Array.isArray(e.diamond)||(e.diamond=[]),e.diamond[t.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:"",fontCode:"",alphaText:""}),t.$store.dispatch("setCustomInfo",JSON.stringify(e)),t.previewText=t.param.data.previewText?t.param.data.previewText:"Design Your Own"}},mounted:function(){var t=this;window.changeCrystalBg=t.changeCrystalBg,window.changeCrystalSku=t.changeCrystalSku,window.clearCrystal=t.clearCrystal,t.diamond&&(t.diamond.forEach(function(e,a){t.crystalColor[a]=e[0].sku}),t.diamond.forEach(function(e,a){t.diamondDefaultImg.push(t.picUrl+e[0].sku+".png?"+Math.random()),t.diamondDefaultColor.push(e[0].color)}),t.diamondHeaderDefaultImg=t.picUrl+t.diamond[0][0].sku+".png?"+Math.random()),t.coors&&(t.coors.forEach(function(e,a){t.limitNum.push(parseInt(e.textNum))}),t.coors.forEach(function(e,a){t.isEmpty.push(!1),t.isEmojiError.push(!1)})),t.text&&t.text.forEach(function(e,a){t.nameTextEmpty.push(!1),t.nameTextLimit.push(!1),t.nameEmojiError.push(!1)}),Ot.crystalObj[this.param.index]=new le({bg:Ot.crystal[this.param.index].baseImg,overLay:Ot.crystal[this.param.index].overlayImg,cWidth:t.cWidth,cHeight:t.cHeight,baseWidth:t.baseWidth,canvasid:this.crystalCanvasId,defaultFont:Ot.crystal[this.param.index].engravingFontOptions[0].value,diamond:Ot.crystal[this.param.index].diamondImg,custom:Ot.crystal[this.param.index],path:Ot.crystal[this.param.index].coors,textBorderColor:t.textBorderColor,lineHeight:t.lineHeight,isSinglelineInput:t.isSinglelineInput,type:t.type,callback:function(e){"NameCarving"==t.type?e.custom["coors"].forEach(function(t,a){e.initCarvingPath()}):"CurveName"==t.type?e.initPath():(e.config["diamond"].forEach(function(a,i){"CrystalCurve"==e.custom.type||"Crystal"==e.custom.type||"CrystalCurveName"==e.custom.type?e.initPath():"CrystalCarving"==e.custom.type&&e.initCarvingPath(),e.setColor(e.canvas.item(i),t.diamondDefaultColor[i])}),t.photosLoad=!1)}}),this.engravingSize[this.param.index]=Ot.crystal[this.param.index].engravingSizeOptions[0].value?Ot.crystal[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=Ot.crystal[this.param.index].engravingFontOptions[0].value?Ot.crystal[this.param.index].engravingFontOptions[0].value:"TimesNewRoman","CrystalName"!=t.type&&"CrystalCurveName"!=t.type&&"NameCarving"!=t.type&&"CurveName"!=t.type||(Ot.nameObj[this.param.index]=new de({json:this.param.data}),t.text.forEach(function(e,a){t.nameTextMaxLength[a+1]=e.limit.split("-")[1],t.nameLeftNum[a+1]=e.limit.split("-")[1]}));var e={};"NameCarving"==t.type||"CurveName"==t.type?(Array.isArray(e.nameCarving)||(e.nameCarving=[]),e.nameCarving[t.param.index]={carvingImage:"",engravingText:"",engravingSize:"",engravingFont:"",fontCode:"",alphaText:""}):(t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.diamond)||(e.diamond=[]),e.diamond[t.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:"",fontCode:"",alphaText:""}),t.$store.dispatch("setCustomInfo",JSON.stringify(e))}},pe=he,ge=(a("e24f"),Object(Ft["a"])(pe,ne,re,!1,null,"2675e031",null)),me=ge.exports,ue=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{class:t.curveCarvingClass},[a("div",{staticClass:"area-carving-preview-text"},[this.engravingCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.engravingCrop[t.param.index],width:"50"},on:{click:t.openimage}}):a("span",[a("span",{staticClass:"curve-pre-text"},[t._v(t._s(t.previewText))]),a("font",{attrs:{color:"red"}},[t._v("*")])],1)]),a("div",{staticClass:"btn-box",on:{click:t.open}},[t.inputMark?a("span",{staticClass:"input-mark"},[t._v(t._s(t.inputMark))]):t._e(),a("button",{staticClass:"btn-carving-open",attrs:{type:"button"},on:{click:t.open}},[t._v(t._s(t.btnText))])])]),a("div",{class:t.requireCurveTextClass},[t._v(t._s(t.requirePrompt))]),a("div",{staticStyle:{display:"none"},attrs:{id:"container"}}),a("el-dialog",{class:{loadingDialog:2==t.inLoading},attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[1!=t.inLoading&&t.uploadLoadingImage?t._e():a("div",[a("el-container",[a("el-aside",{attrs:{width:"50%"}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),t.isBig?a("canvas",{staticStyle:{display:"none",position:"absolute",top:"0",left:"0","z-index":"0"},attrs:{id:"bigCurveCarvingCanvasId"}}):t._e()]),a("el-main",{attrs:{width:"50%"}},[a("div",{staticClass:"custom-carving-container"},[a("div",{staticClass:"label-input-text"},[t._v(t._s(t.inputTextLabel))]),t._l(t.coors,function(e,i){return a("div",{key:e.value,staticClass:"textarea-text"},[t.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[index]"}],class:{curveError:t.isEmpty[i]},attrs:{type:"text",placeholder:t.textPlaceHolder,maxlength:e.limit},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},function(e){return t.changeText(i,t.textList[i])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textList[i],expression:"textList[index]"}],class:{curveError:t.isEmpty[i]},attrs:{rows:t.rows,resize:t.resize,placeholder:t.textPlaceHolder,maxlength:e.limit},domProps:{value:t.textList[i]},on:{input:[function(e){e.target.composing||t.$set(t.textList,i,e.target.value)},function(e){return t.changeText(i,t.textList[i])}]}}),t.leftText?a("div",{staticClass:"leftnum"},[a("span",{class:"num textNum"+i},[t._v(t._s(t.textNum[i]))]),t._v(" "+t._s(t.leftText))]):t._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:t.curveEmojiError[i]&&t.errorWordShow,expression:"curveEmojiError[index] && errorWordShow"}],staticClass:"curveErrorWord"},[t._v(t._s(t.emojiErrorField))])])}),t.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size",attrs:{size:"large"},on:{change:t.changeSize},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),a("el-row",{directives:[{name:"show",rawName:"v-show",value:t.showChooseFont,expression:"showChooseFont"}],staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[t._v(t._s(t.fontFamilyLabel))]),a("el-radio-group",{staticClass:"font-radio-group",on:{change:t.changeFont},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},[a("el-col",t._l(t.engravingFontOptions,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1),a("div",[a("el-button",{staticClass:"btn-curve-confirm btn-carving",attrs:{type:"primary",disabled:t.photoLoad||t.bgLoad,loading:t.isLoading},on:{click:t.saveCanvas}},[t._v(t._s(t.confirmText)),t.isMarkup>0?a("span",{staticClass:"is-markup",attrs:{"data-price":t.isMarkup}},[t._v(t._s(t.addPrice))]):t._e()]),t.isMarkup>0?a("el-button",{staticClass:"btn-curve-cancel btn-carving",on:{click:t.cancelCanvas}},[t._v(t._s(t.cancelText))]):t._e()],1),t.please_note?a("div",[a("p",{staticClass:"product-reminder"},[t._v("\n                                    "+t._s(t.please_note)+"\n                                ")]),t.otherNote?a("p",{staticClass:"other-note",domProps:{innerHTML:t._s(t.otherNote)}},[t._v(t._s(t.otherNote))]):t._e()]):t._e()],2)])],1),a("div",{staticClass:"curve-carving-info-container carving-info"},[a("div",{staticClass:"carving-notice"},[t.actionInfo?a("div",{staticClass:"action-info"},[t._v(t._s(t.actionInfo))]):t._e(),t.noteInfo?a("div",{staticClass:"note-info"},[t._v(t._s(t.noteInfo))]):t._e()]),t.handcraftInfo?a("div",{staticClass:"handcraft-info"},[t._v(t._s(t.handcraftInfo))]):t._e()])],1),2==t.inLoading&&!t.soufeelLoadingImage&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container"},[a("div",[a("img",{attrs:{src:t.uploadLoadingImage}})]),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1)]):t._e()]),2==t.inLoading&&t.soufeelLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.soufeelLoadingImage}})])]):t._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:t.curveCarvingCanvasId}})])],1)},ve=[],fe=a("0342"),xe=function(){function t(t){this.picurl=t.picurl,this.cdir="img/textdesign/",this.init(t)}return t.prototype=Object.assign(new kt,{init:function(t){this.canvas=new fabric.Canvas(t["canvasid"]),this.config=t,this.cWidth=t["cWidth"]||"",this.cHeight=t["cHeight"]||"",this.baseWidth=t["baseWidth"]||"",this.sku=t["sku"]||"",this.type=t["type"]||"",this.baseImg=t["baseImg"]||"",this.path=t["path"]||"",this.scaleNew=t["scaleNew"]||1,this.textpath=[],this.defaultFont=t["font"]||"holyunion",this.defaultFontSize=t["size"]||30,this.pathNum=this.path.length,this.setCanvaSize(),this.setObject(),this.canvas.selection=!1,this.initPath()},setObject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;fabric.Image.fromURL(t.baseImg+"?"+Math.random(),function(e){t.canvas.setBackgroundImage(e),"undefined"!==typeof t.config.callbacknew&&e.width>0&&t.config.callbacknew(),t.canvas.requestRenderAll()},{originX:"left",originY:"top",scaleX:t.scale,scaleY:t.scale,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous"})},setTextSize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.textpath.forEach(function(e,a){var i=t.path[a].size?t.path[a].size:30;e.setFontSize(i)})},initPath:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;t.stage=new Mt.a.Stage({container:"container",width:t.cWidth,height:t.cHeight}),t.layer=new Mt.a.Layer,t.path.forEach(function(e,a){var i=e.path,n=e.size;t.scaleNew>1&&(i=e.bigPath,n=e.size*t.scaleNew);var r=t.defaultFont;"undefined"!=typeof e.family&&e.family&&(r=e.family);var o="undefined"!=typeof e.shadowEnabled&&e.shadowEnabled,s="undefined"!=typeof e.shadowColor?e.shadowColor:"#ffffff",l="undefined"!=typeof e.shadowOffsetX?e.shadowOffsetX:1.5,c="undefined"!=typeof e.shadowOffsetY?e.shadowOffsetY:1.5,d="undefined"!=typeof e.shadowBlur?e.shadowBlur:-10,h="undefined"!=typeof e.shadowOpacity?e.shadowOpacity:1,p="undefined"!=typeof e.fontStyle?e.fontStyle:"normal";if(t.textpath[a]=new Mt.a.TextPath({x:0,y:0,align:"center",fill:e.textColor||"#000",fontSize:n||50,fontFamily:r,text:"",data:i,shadowEnabled:o,shadowColor:s,shadowOffsetX:l,shadowOffsetY:c,shadowBlur:d,shadowOpacity:h,fontStyle:p}),t.layer.add(t.textpath[a]),"undefined"!=typeof e.initialCarving){var g=t.pathNum+a;e.initialCarving.forEach(function(e,a){var i="undefined"!=typeof e.shadowEnabled&&e.shadowEnabled,n="undefined"!=typeof e.shadowColor?e.shadowColor:"#ffffff",r="undefined"!=typeof e.shadowOffsetX?e.shadowOffsetX:1.5,o="undefined"!=typeof e.shadowOffsetY?e.shadowOffsetY:1.5,s="undefined"!=typeof e.shadowBlur?e.shadowBlur:-10,l="undefined"!=typeof e.shadowOpacity?e.shadowOpacity:1,c="undefined"!=typeof e.fontStyle?e.fontStyle:"normal";t.textpath[g+a]=new Mt.a.TextPath({x:0,y:0,align:"center",fill:e.textColor||"#000",fontSize:e.size||50,fontFamily:e.family,text:"",data:e.path,shadowEnabled:i,shadowColor:n,shadowOffsetX:r,shadowOffsetY:o,shadowBlur:s,shadowOpacity:l,fontStyle:c}),t.layer.add(t.textpath[g+a])})}}),t.stage.add(t.layer),t.img=new Image,t.imgObj=new fabric.Image(t.img),t.imgObj.lockMovementX=!0,t.imgObj.lockMovementY=!0,t.imgObj.selectable=!1,t.canvas.add(t.imgObj),t.img.onload=function(){t.imgObj.setElement(t.img),t.imgObj.set({left:0,top:0,scaleX:t.scale,scaleY:t.scale}),t.canvas.renderAll(!0),"undefined"!==typeof t.config.callback&&t.config.callback(t)}},loadAndUse:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,i=arguments.length>3?arguments[3]:void 0,n=new fe(e);n.load().then(function(){var n=a.textpath[t];n&&(n.setFontFamily(e),a.layer.draw(),a.img.src=a.stage.toDataURL(),t==a.textpath.length-1&&i())}).catch(function(e){console.log(e),t==a.textpath.length-1&&i()})},changeFont:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){console.log("ok")};this.loadAndUse(t,e,this,a)},changeSize:function(t,e){var a=this.textpath[t];if(a){a.setFontSize(e),this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}},changeText:function(t,e){if(this.textpath[e].setText(t),"undefined"!=typeof this.path[e].initialCarving){var a=this;this.path[e].initialCarving.forEach(function(i,n){a.textpath[a.pathNum+e+n].setText(t)})}this.layer.draw();var i=this.stage.toDataURL();this.img.src=i}}),t.prototype.constructor=t,t}(),be=xe,Ce={name:"CropDialog",props:["param"],components:{},data:function(){return{inLoading:1,dialogWidth:this.param.data.dialogWidth?this.param.data.dialogWidth:"60%",previewText:this.param.data.previewText?this.param.data.previewText:"Add Engraving",sku:this.param.data.sku,cWidth:this.param.data.cWidth,cHeight:this.param.data.cHeight,baseWidth:this.param.data.baseWidth,uploadLoadingImage:this.param.data.uploadLoadingImage,soufeelLoadingImage:Ot.uploadLoadingImage,bgOpacity:Ot.bgOpacity?Ot.bgOpacity:.5,wrapperBackgroudColor:Ot.wrapperBackgroudColor?Ot.wrapperBackgroudColor:"#ffffff",isSinglelineInput:this.param.data.isSinglelineInput,leftText:this.param.data.leftText,btnText:this.param.data.btnText?this.param.data.btnText:"Add",btnChangeText:this.param.data.btnChangeText?this.param.data.btnChangeText:"Change",inputMark:this.param.data.inputMark?this.param.data.inputMark:"",inputTextLabel:this.param.data.inputTextLabel?this.param.data.inputTextLabel:"",curveCarvingConfirmText:this.param.data.curveCarvingConfirmText?this.param.data.curveCarvingConfirmText:"Confirm Your Design ",textPlaceHolder:this.param.data.textPlaceHolder?this.param.data.textPlaceHolder:"Type words here... ",fontFamilyLabel:this.param.data.fontFamilyLabel?this.param.data.fontFamilyLabel:"FONT:",curveCarvingClass:"curve-area-carving curve-area-carving-"+this.param.index,curveCarvingCanvasId:"curvecanvas"+this.param.index,isMarkup:this.param.data.isMarkup,addPrice:this.param.data.addPrice,markupId:this.param.data.markupId,please_note:this.param.data.please_note?this.param.data.please_note:"Please Note: No colors or emoji can be used. e.g. A red heart icon will show a heart in color black.",otherNote:this.param.data.otherNote?this.param.data.otherNote:"",rows:this.param.data.rows?this.param.data.rows:1,resize:this.param.data.resize?this.param.data.resize:"none",confirmText:this.param.data.confirmText?this.param.data.confirmText:"Confirm",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",showChooseFont:this.param.data.showChooseFont,dialogVisible:!1,centerDialogVisible:!1,info:"",w:"50px",h:"50px",percentage:0,isLoading:!1,base64:"",blob:"",filename:"",isBig:!1!==Ot.curveCarving[this.param.index].isBig,isBigImage:!0===Ot.curveCarving[this.param.index].isBigImage,bigBackgroundColor:Ot.curveCarving[this.param.index].bigBackgroundColor?Ot.curveCarving[this.param.index].bigBackgroundColor:"white",bigParam:!!Ot.curveCarving[this.param.index].bigParam&&Ot.curveCarving[this.param.index].bigParam,coors:Ot.curveCarving[this.param.index].coors,isFullscreen:!!this.$device.mobile,showSize:!0===Ot.curveCarving[this.param.index].showSize,showFont:!1!==Ot.curveCarving[this.param.index].showFont,engravingCrop:[],engravingBig:[],engravingText:[],engravingSize:[],engravingFont:[],engravingSizeOptions:Ot.curveCarving[this.param.index].engravingSizeOptions?Ot.curveCarving[this.param.index].engravingSizeOptions:{},engravingFontOptions:Ot.curveCarving[this.param.index].engravingFontOptions?Ot.curveCarving[this.param.index].engravingFontOptions:{},textNum:[],textList:[],isEmpty:[],bigCurveObj:"",imgRequire:Ot.curveCarving[this.param.index].imgRequire,imgRequireNotice:Ot.curveCarving[this.param.index].imgRequireNotice,requireCurveTextClass:"require-curve-text require-curve-text-"+this.param.index,requirePrompt:Ot.requirePrompt,require:!1!==this.param.data.require,actionInfo:Ot.actionInfo?Ot.actionInfo:"",noteInfo:Ot.noteInfo?Ot.noteInfo:"",handcraftInfo:Ot.handcraftInfo?Ot.handcraftInfo:"",photoLoad:!1,isModalAppendToBody:!1!==Ot.isModalAppendToBody,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,emojiErrorField:this.param.data.emojiErrorField,errorWordShow:!0===this.param.data.errorWordShow,curveEmojiError:[],codeArray:Ot.codeArray?Ot.codeArray:[],bgLoad:!0,oneSide:!1!==this.param.data.oneSide,hasSelect:!0===Ot.curveCarving[this.param.index].hasSelect}},methods:{open:function(){var t=this;if(t.oneSide){var e=JSON.parse(t.$store.getters.getCustomInfo),a=!!e.photo&&e.photo[0].crop;a?(t.photoLoad=!0,t.centerDialogVisible=!0,Et["fabric"].Image.fromURL(a+"?"+Math.random(),function(e){e.scaleX=Ot.curveCarvingObj[t.param.index].canvas.width/e.width,e.scaleY=Ot.curveCarvingObj[t.param.index].canvas.height/e.height,Ot.curveCarvingObj[t.param.index].canvas.setBackgroundImage(e),Ot.curveCarvingObj[t.param.index].canvas.requestRenderAll(),t.photoLoad=!1},{crossOrigin:"Anonymous"})):t.imgRequire?alert(t.imgRequireNotice):t.centerDialogVisible=!0}else t.centerDialogVisible=!0},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="inline-block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openimage:function(){this.$parent.openimage(this.engravingCrop[this.param.index])},changeText:function(t,e){this.coors[t].isUppercase&&(this.textList[t]=this.textList[t].toUpperCase()),Ot.curveCarvingObj[this.param.index].changeText(this.textList[t],t),this.textNum[t]=parseInt(this.coors[t].limit)-this.textList[t].length},changeSize:function(t){var e=this;e.coors.forEach(function(a,i){Ot.curveCarvingObj[e.param.index].changeSize(i,t)})},changeFont:function(t){var e=this;e.bgLoad=!0,e.coors.forEach(function(a,i){Ot.curveCarvingObj[e.param.index].changeFont(i,t,function(){e.bgLoad=!1})})},getFontFamily:function(t){return"font-family:"+t+";"},saveCanvas:function(){var t=this,e=[],a=!0;if(this.coors.forEach(function(i,n){t.$set(t.curveEmojiError,n,!1),t.textList[n]?1==Ot.getLen(t.textList[n],t.codeArray)?(t.$set(t.curveEmojiError,n,!0),a=!1):t.$set(t.isEmpty,n,!1):(a=!1,t.$set(t.isEmpty,n,!0)),e.push(t.textList[n])}),!a)return!1;if(t.engravingText[t.param.index]=e.join("|"),t.soufeelLoadingImage&&(t.centerDialogVisible=!1),t.inLoading=2,t.isBig){var i=JSON.parse(t.$store.getters.getCustomInfo),n=t.bigCurveObj.canvas.width/t.bigParam.width,r=t.bigCurveObj.canvas.height/t.bigParam.height;"undefined"!=typeof i.photo&&t.bigCurveObj.canvas.setBackgroundImage(i.photo[0].ai,t.bigCurveObj.canvas.renderAll.bind(t.bigCurveObj.canvas),{originX:"left",originY:"top",scaleX:n,scaleY:r,backgroundImageOpacity:1,backgroundImageStretch:!1,crossOrigin:"anonymous",callback:function(){t.textList.forEach(function(e,a){t.bigCurveObj.changeText(t.textList[a],a)})}})}else if(t.isBigImage){t.filename=Ot.getFilename(6);var o=t.filename+"-"+t.sku+".png",s=new Et["fabric"].Canvas,l=t.filename+"-"+t.sku+"-1.png",c=t.bigParam.width?t.bigParam.width:800;t.bigParam.height&&t.bigParam.height,t.bigParam.fontWeight&&t.bigParam.fontWeight,t.bigParam.fontSize&&t.bigParam.fontSize;s.setWidth(Ot.curveCarvingObj[t.param.index].canvas.width),s.setHeight(Ot.curveCarvingObj[t.param.index].canvas.height);var d=c/Ot.curveCarvingObj[t.param.index].canvas.width;s.loadFromJSON(JSON.stringify(Ot.curveCarvingObj[t.param.index].canvas),function(){var e=s.getObjects();e.forEach(function(t){t&&"text"===t.type&&(t.set({left:t.left,top:t.top}),s.renderAll())}),s.setBackgroundImage(null,s.renderAll.bind(s)),s.backgroundColor=t.bigBackgroundColor,s.setOverlayImage(null,s.renderAll.bind(s)),s.renderAll();var a=s.toDataURL({format:"png",multiplier:d,quality:.8}),i=Ot.asyncCdnUpload(a,l,null);Promise.all([i]).then(function(e){t.engravingBig[t.param.index]=e[0],console.log(t.engravingBig[t.param.index]),t.base64=Ot.curveCarvingObj[t.param.index].canvas.toDataURL({format:"png",quality:.8,multiplier:500/Ot.curveCarvingObj[t.param.index].width}),t.blob=Ot.curveCarvingObj[t.param.index].convertBase64ToBlob(t.base64);var a="";a=o?{base64:t.base64,key:o}:t.base64,Ot.cdnUpload(a,function(e){t.btnText=t.btnChangeText,t.engravingCrop[t.param.index]=e.picture;var a={};if(t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[t.param.index]={engravingCrop:e.picture,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],require:t.param.data.require?t.param.data.require:""},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.percentage=0,t.inLoading=1,t.centerDialogVisible=!1,t.markupId){var i=document.getElementById(t.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}t.hasSelect&&t.$parent.$refs.selectDialog.open(t.param),Ot.dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},t)})})}else{t.base64=Ot.curveCarvingObj[t.param.index].canvas.toDataURL({format:"png",quality:.8,multiplier:500/Ot.curveCarvingObj[t.param.index].width}),t.blob=Ot.curveCarvingObj[t.param.index].convertBase64ToBlob(t.base64),t.filename=Ot.getFilename(6);o=t.filename+"-"+t.sku+".png";var h="";h=o?{base64:t.base64,key:o}:t.base64,Ot.cdnUpload(h,function(e){t.btnText=t.btnChangeText,t.engravingCrop[t.param.index]=e.picture;var a={};if(t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[t.param.index]={engravingCrop:e.picture,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],require:t.param.data.require?t.param.data.require:""},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.percentage=0,t.inLoading=1,t.centerDialogVisible=!1,t.markupId){var i=document.getElementById(t.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}console.log(t.hasSelect),t.hasSelect&&(console.log("--------------"),t.$parent.$refs.selectDialog.open(t.param)),Ot.dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},t)}},cancelCanvas:function(){var t=this;this.coors.forEach(function(e,a){t.textList[a]&&(t.textList[a]="",t.changeText(a,""))}),t.previewText=t.param.data.previewText,t.$set(t.engravingCrop,t.param.index,""),t.$set(t.engravingText,t.param.index,"");var e={};if(t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),e.engraving&&delete e.engraving,t.$store.dispatch("setCustomInfo",JSON.stringify(e)),t.markupId){var a=document.getElementById(t.markupId);a.value=0;var i=new Event("change");a.dispatchEvent(i)}t.centerDialogVisible=!1,Ot.dispatchCustomEvent("EVENT_CURVE_ENGRAVING_CANCEL_AFTER",{index:t.param.index})},changeBaseImg:function(t,e){var a=this;a.photoLoad=!0,Et["fabric"].Image.fromURL(t,function(t){t.scaleX=Ot.curveCarvingObj[a.param.index].canvas.width/t.width,t.scaleY=Ot.curveCarvingObj[a.param.index].canvas.height/t.height,Ot.curveCarvingObj[a.param.index].canvas.setBackgroundImage(t),Ot.curveCarvingObj[a.param.index].canvas.requestRenderAll(),a.photoLoad=!1},{crossOrigin:"Anonymous"}),a.$set(a,"sku",e),a.$set(Ot.curveCarving[this.param.index],"sku",e)},clearText:function(t,e){Ot.curveCarvingObj[this.param.index].changeText(e,t),this.$set(this.textList,t,e)},updateCoors:function(t){var e=this;e.coors.forEach(function(t,a){Ot.curveCarvingObj[e.param.index].changeText("",a)}),e.$set(e,"coors",t),Ot.curveCarvingObj[e.param.index].path=t,Ot.curveCarvingObj[e.param.index].initPath(),t.forEach(function(t,a){Ot.curveCarvingObj[e.param.index].changeText(e.textList[a],a)})},clearCurve:function(){var t=this;t.engravingCrop[t.param.index]="";var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.curve_engraving)||(e.curve_engraving=[]),e.curve_engraving[t.param.index]={engravingCrop:"",engravingText:"",engravingSize:"",engravingFont:"",require:t.param.data.require?t.param.data.require:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e)),t.previewText=t.param.data.previewText?t.param.data.previewText:"Add Engraving"}},mounted:function(){var t=this;if(t.coors&&t.coors.forEach(function(e,a){t.textNum.push(parseInt(e.limit)),t.isEmpty.push(!1),t.textList.push(""),t.curveEmojiError.push(!1)}),Ot.curveCarvingObj[this.param.index]=new be({canvasid:this.curveCarvingCanvasId,type:2,sku:Ot.curveCarving[this.param.index].sku,baseImg:Ot.curveCarving[this.param.index].baseImg,path:Ot.curveCarving[this.param.index].coors,cWidth:t.cWidth,cHeight:t.cHeight,baseWidth:t.baseWidth,font:Ot.curveCarving[this.param.index].engravingFontOptions[0].value?Ot.curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",callbacknew:function(){t.bgLoad=!1}}),t.isBig){var e=t.bigParam.width/t.baseWidth;t.bigCurveObj=new be({canvasid:"bigCurveCarvingCanvasId",type:2,sku:Ot.curveCarving[this.param.index].sku,baseImg:t.baseImg,path:Ot.curveCarving[this.param.index].coors,cWidth:t.bigParam.width,cHeight:t.bigParam.height,baseWidth:t.bigParam.width,scaleNew:e,textList:t.textList,font:Ot.curveCarving[this.param.index].engravingFontOptions[0].value?Ot.curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",callback:function(e){t.base64=e.canvas.toDataURL({format:"png",quality:.8,multiplier:e.canvas.width/t.bigParam.width}),t.blob=e.convertBase64ToBlob(t.base64),t.filename=Ot.getFilename(6);var a=t.filename+"-"+t.sku+".png",i="";i=a?{base64:t.base64,key:a}:t.base64,Ot.cdnUpload(i,function(e){t.btnText="Change",t.engravingCrop[t.param.index]=e.picture;var a={};if(t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[t.param.index]={engravingCrop:e.picture,engravingBig:t.engravingBig[t.param.index],engravingText:t.engravingText[t.param.index],engravingSize:t.engravingSize[t.param.index],engravingFont:t.engravingFont[t.param.index],require:t.param.data.require?t.param.data.require:""},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.previewText=t.engravingText,t.isLoading=!1,t.percentage=0,t.inLoading=1,t.centerDialogVisible=!1,t.markupId){var i=document.getElementById(t.markupId);i.value=1;var n=new Event("change");i.dispatchEvent(n)}console.log(t.hasSelect),t.hasSelect&&(console.log("================="),t.$parent.$refs.selectDialog.open(t.param)),Ot.dispatchCustomEvent("EVENT_CURVE_ENGRAVING_SAVE_AFTER",{index:t.param.index,data:a}),"function"===typeof window.carvingCallback&&window.carvingCallback()},t)}})}this.engravingSize[this.param.index]=Ot.curveCarving[this.param.index].engravingSizeOptions[0].value?Ot.curveCarving[this.param.index].engravingSizeOptions[0].value:"20",this.engravingFont[this.param.index]=Ot.curveCarving[this.param.index].engravingFontOptions[0].value?Ot.curveCarving[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",window.changeBaseImg=t.changeBaseImg,window.clearText=t.clearText,window.updateCoors=t.updateCoors,window.clearCurve=t.clearCurve;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.curve_engraving)||(a.curve_engraving=[]),a.curve_engraving[t.param.index]={engravingCrop:"",engravingBig:"",engravingText:"",engravingSize:"",engravingFont:"",require:t.param.data.require?t.param.data.require:""},t.$store.dispatch("setCustomInfo",JSON.stringify(a))},watch:{centerDialogVisible:function(t){!0===t?Ot.dispatchCustomEvent("EVENT_CURVE_DIALOG",{index:this.param.index}):Ot.dispatchCustomEvent("EVENT_CURVE_DIALOG_CLOSE",{index:this.param.index})}}},ye=Ce,we=(a("72fe"),Object(Ft["a"])(ye,ue,ve,!1,null,"7f9cf875",null)),Te=we.exports,Oe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._l(t.linesArr,function(e,i){return a("div",{key:i},[t.isCrystal?a("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-collapse-item",{attrs:{name:"crystal-list-collapse"+e}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondDefaultImg[e]}}),a("span",[t._v(t._s(t.crystalTitle)+t._s(e+1))])])])]),a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+e},[a("div",{staticClass:"crystal"},t._l(t.diamond[e],function(i,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+t.picUrl+i.sku+".png?123);"}),a("input",{class:"colorful color-"+e,attrs:{"v-model":t.crystalColor[e],"data-index":e,"data-color":i.color,name:"color"+e,type:"radio"},domProps:{value:i.sku},on:{click:function(a){return t.changeColor(e,i.color,i.sku)}}}),a("div",{staticClass:"name"},[t._v(t._s(t.month[n]))])])}),0)])])],2)],1):t._e(),t.isCarving?a("div",[a("div",[a("div",{staticClass:"engravings"},[a("span",[t._v(t._s(t.textInputName)+t._s(e+1))]),t.isSinglelineInput?a("input",{directives:[{name:"model",rawName:"v-model",value:t.textList[e],expression:"textList[c]"}],class:{crystalError:t.isEmpty[e]&&t.errorBorderShow},style:"font-family:"+t.engravingFont[t.param.index],attrs:{maxlength:t.textNum[e],id:"textInput"+e,"data-index":e,placeholder:t.textWords},domProps:{value:t.textList[e]},on:{input:[function(a){a.target.composing||t.$set(t.textList,e,a.target.value)},function(a){return t.changeTextInput(e,t.textList[e])}]}}):a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.textList[e],expression:"textList[c]"}],class:{crystalError:t.isEmpty[e]&&t.errorBorderShow},style:"font-family:"+t.engravingFont[t.param.index],attrs:{maxlength:t.textNum[e],id:"textInput"+e,"data-index":e,placeholder:t.textWords},domProps:{value:t.textList[e]},on:{input:[function(a){a.target.composing||t.$set(t.textList,e,a.target.value)},function(a){return t.changeTextInput(e,t.textList[e])}]}}),a("span",{class:"num textNum"+e},[t._v(t._s(t.limitNum[e])+" "+t._s(t.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.isEmpty[e]&&t.errorWordShow,expression:"isEmpty[c] && errorWordShow"}],staticClass:"errorWord"},[t._v(t._s(t.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.isEmojiError[e]&&t.errorWordShow,expression:"isEmojiError[c] && errorWordShow"}],staticClass:"errorWord"},[t._v(t._s(t.emojiErrorField))])])]):t._e()],1)}),t._m(0),t.showSize?a("el-row",[a("el-col",{attrs:{span:24}},[a("el-select",{staticClass:"slt-font-size crystal-font-size",attrs:{size:"large"},model:{value:t.engravingSize[t.param.index],callback:function(e){t.$set(t.engravingSize,t.param.index,e)},expression:"engravingSize[param.index]"}},t._l(t.engravingSizeOptions,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1):t._e(),t.showFont?a("el-row",{staticClass:"rad-font"},[a("div",{staticClass:"font-radio-title"},[t._v(t._s(t.fontText)+":")]),a("el-radio-group",{staticClass:"font-radio-group",attrs:{id:"btn-2"},model:{value:t.engravingFont[t.param.index],callback:function(e){t.$set(t.engravingFont,t.param.index,e)},expression:"engravingFont[param.index]"}},[a("el-col",t._l(t.engravingFontOptions,function(e){return a("el-radio",{key:e.value,style:t.getFontFamily(e.value),attrs:{label:e.value,border:""}},[t._v(t._s(e.demo?e.demo:"ABC"))])}),1)],1)],1):t._e(),t.isName?a("div",[a("div",{staticClass:"view-name"},[a("span",[t._v(t._s(t.namePreview)+":")]),a("div",{staticClass:"showtext",attrs:{id:"showtext"}},[t._l(t.linesArr,function(e,i){return a("span",{key:i,class:"showtext-in "+t.nameClass,style:"font-family:"+t.fontFamily[e],attrs:{id:"showtext_"+e}},[t._v(t._s(t.showText[e]))])}),t._v("    \n                ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),t._l(t.linesArr,function(e,i){return a("div",{key:i,staticClass:"carvingcanvas-content"},[a("div",{staticClass:"curve-textarea",class:{crystalError:t.nameTextEmpty[e]&&t.errorBorderShow}},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.nameText[e],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+e,type:"text","data-prefix":"ctext","data-index":e,id:"ctext"+e,maxlength:t.nameTextMaxLength[e],placeholder:t.enterName},domProps:{value:t.nameText[e]},on:{input:[function(a){a.target.composing||t.$set(t.nameText,e,a.target.value)},function(a){return t.changeAlphaText(e,t.nameText[e])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+e}},[t._v(t._s(t.nameLeftNum[e]))]),t._v(" "+t._s(t.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextEmpty[e]&&t.errorWordShow,expression:"nameTextEmpty[m] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextLimit[e]&&t.errorWordShow,expression:"nameTextLimit[m] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.atLeastField))])])}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:"3000",height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}})],2):t._e()],2)},Ie=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{height:"0px"}},[a("canvas",{staticStyle:{border:"1px solid #ff0000",display:"none"},attrs:{id:"crystalcanvas"}})])}],Se=(a("96cf"),a("3b8d")),_e={name:"CrystalText",props:["param"],components:{},data:function(){return{activeName:"",crystalHeaderDisplay:"crystalTitleName",isEmpty:[],diamond:this.param.data.diamond?this.param.data.diamond:[],crystalTitle:this.param.data.crystalTitle?this.param.data.crystalTitle:"Select",picUrl:this.param.data.picUrl?this.param.data.picUrl:"https://pic.stylelab.com/img/textdesign/diamond/",month:this.param.data.month?this.param.data.month:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sept","Oct","Nov","Dec"],textInputName:this.param.data.textInputName?this.param.data.textInputName:"Name",isSinglelineInput:!1!==this.param.data.isSinglelineInput,leftText:this.param.data.leftText?this.param.data.leftText:"Left",fontText:this.param.data.fontText?this.param.data.fontText:"Font",freeText:this.param.data.freeText?this.param.data.freeText:"free",requiredField:this.param.data.requiredField?this.param.data.requiredField:"This is a required field.",showSize:!0===this.param.data.showSize,showFont:!0===this.param.data.showFont,errorBorderShow:!1!==this.param.data.errorBorderShow,errorWordShow:!0===this.param.data.errorWordShow,engravingSizeOptions:this.param.data.engravingSizeOptions?this.param.data.engravingSizeOptions:[],engravingFontOptions:this.param.data.engravingFontOptions?this.param.data.engravingFontOptions:[],textWords:this.param.data.textWords?this.param.data.textWords:"Type words here...",fontFamily:[],namePreview:this.param.data.namePreview?this.param.data.namePreview:"Preview",isCarving:!0===this.param.data.isCarving,isName:!0===this.param.data.isName,isCrystal:!0===this.param.data.isCrystal,nameClass:this.param.data.class?this.param.data.class:"",text:this.param.data.text?this.param.data.text:[],enterName:this.param.data.enterName?this.param.data.enterName:"Enter Name or text here...",style:this.param.data.style?this.param.data.style:"",atLeastField:"",atLeastText:this.param.data.atLeastText?this.param.data.atLeastText:"At least ",charactersText:this.param.data.charactersText?this.param.data.charactersText:"characters.",textNum:[],diamondDefaultImg:[],crystalColor:[],engravingFont:[],engravingSize:[],engravingText:[],engravingCrop:[],textList:[],limitNum:[],diamondDefaultColor:[],nameTextEmpty:[],nameText:[],nameLeftNum:[],nameTextLimit:[],showText:[],nameTextMaxLength:[],code:[],isEmojiError:[],linesArr:this.param.data.linesArr?this.param.data.linesArr:[0],coors:this.param.data.coors?this.param.data.coors:[],productItem:this.param.data.productItem,emojiErrorField:this.param.data.emojiErrorField,crystalCanvas:""}},methods:{changeColor:function(t,e,a){this.crystalColor[t]=a,this.$set(this.diamondDefaultImg,t,this.picUrl+a+".png"),this.$set(this.diamondDefaultColor,t,e),this.setDiamond()},getFontFamily:function(t){return"font-family:"+t+";"},changeTextInput:function(t,e){if(1==Ot.getLen(e))return!1;this.limitNum[t]=parseInt(this.textNum[t])-e.length},changeAlphaText:function(t,e){Ot.nameObj[this.param.index].process(e,t,this.firstUpperCase),this.nameText[t]=Ot.nameObj[this.param.index].text[t].text,this.showText[t]=Ot.nameObj[this.param.index].text[t].showText,this.nameLeftNum[t]=parseInt(this.nameTextMaxLength[t])-this.nameText[t].length},getNameCtx:function(){var t=this,e=new fabric.StaticCanvas("myCanvas");e.setBackgroundColor("#ffffff"),e.selection=!1;var a=[],i=0,n="#808080",r=t.nameClass.trim();"gold"==r?n="#eac855":"rosegold"==r?n="#c8977b":"black"==r&&(n="#000000"),t.showText.forEach(function(e,r){r>0&&(e=" | "+e,i+=a[r-1].width),a[r]=new fabric.Text(e,{left:i,top:10,fontFamily:t.fontFamily[r],fill:n})});var o=new fabric.Group(a,{fontSize:80});e.add(o),e.setHeight(100),e.setWidth(o.width),e.renderAll();var s=Ot.convertBase64ToBlob(e.toDataURL({format:"png",quality:.8})),l=Ot.getFilename(6,!0)+".png";return{blob:s,filename:l}},checkNameToBase64:function(){var t=this,e=0;if(t.linesArr.forEach(function(a,i){if(!t.nameText[i])return e=1,void t.$set(t.nameTextEmpty,i,!0);(e=1==Ot.nameObj[t.param.index].checkQuantity(t.nameText[i],t.text[i].limit.split("-")[0],t.text[i].limit.split("-")[1]))?t.$set(t.nameTextEmpty,i,!0):t.$set(t.nameTextEmpty,i,!1)}),1==e)return!1;var a=Ot.nameObj[t.param.index].setInputVal(t.showText.length);return a},checkCode:function(){return this.code.join("|")},checkCarvingText:function(){var t=this,e=0;return t.linesArr.forEach(function(a,i){t.$set(t.isEmpty,i,!1),t.$set(t.isEmojiError,i,!1),t.textList[i]?1==Ot.getLen(t.textList[i])&&(t.$set(t.isEmojiError,i,!0),e=1):(e=1,t.$set(t.isEmpty,i,!0))}),1!=e&&(t.engravingText[t.param.index]=t.textList.join("|"),t.engravingText[t.param.index])},setDiamond:function(){var t=this,e=t.diamondDefaultImg.length;t.crystalCanvas.clear(),t.crystalCanvas.setWidth(73*e),t.diamondDefaultImg.forEach(function(e,a){fabric.Image.fromURL(e,function(e){e.lockMovementX=!0,e.lockMovementY=!0,e.selectable=!1,e.scaleX=1,e.scaleY=1,e.left=73*a,e.top=0,t.crystalCanvas.add(e)}.bind(this),{crossOrigin:"anonymous"})})},uploadDiamondImage:function(){var t=Object(Se["a"])(regeneratorRuntime.mark(function t(){var e,a,i,n,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this,a=e.crystalCanvas.toDataURL({format:"png",quality:.8}),i=Ot.convertBase64ToBlob(a),n=Ot.getFilename(12),r=new kt,t.next=7,r.cdnAsyncUpload(function(t,a){var r=n+"-"+e.productItem+".png",o={next:function(t){console.log("ok")},error:function(t){console.log("Upload Error, Please refresh now")},complete:function(t){e.engravingCrop[e.param.index]=Ot.qncdn+t.key;var i={};return e.$store.getters.getCustomInfo&&(i=JSON.parse(e.$store.getters.getCustomInfo)),Array.isArray(i.diamond)||(i.diamond=[]),i.diamond[e.param.index]={diamondImage:Ot.qncdn+t.key,engravingText:e.engravingText[e.param.index],engravingSize:e.engravingSize[e.param.index],engravingFont:e.engravingFont[e.param.index],diamondCustom:e.crystalColor.join("|")},e.$store.dispatch("setCustomInfo",JSON.stringify(i)),Ot.dispatchCustomEvent("EVENT_CRYSTAL_ENGRAVING_SAVE_AFTER",{index:e.param.index,data:i}),a(),!0}},s={region:yt["region"].na0,concurrentRequestLimit:3},l={fname:"",params:{},mimeType:null},c=yt["upload"](i,r,t,l,s);c.subscribe(o)});case 7:return t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),changeNumber:function(t){if(console.log(t),t>0){var e=this,a=e.linesArr.length,i=t-a;if(i>0)for(var n=0;n<i;n++){var r=a+n;e.linesArr.push(r),e.isName&&(e.$set(e.nameTextMaxLength,r,e.text[r].limit.split("-")[1]),e.$set(e.nameLeftNum,r,e.text[r].limit.split("-")[1]),e.$set(e.fontFamily,r,e.text[r].fontFamily),e.$set(e.code,r,e.text[r].code)),e.isCarving&&(e.$set(e.limitNum,r,e.coors[r].textNum),e.$set(e.textNum,r,e.coors[r].textNum)),e.isCrystal&&(e.$set(e.diamondDefaultImg,r,this.picUrl+e.diamond[r][0].sku+".png"),e.$set(e.crystalColor,r,e.diamond[r][0].sku))}else if(i<0)for(var o=a;o>t;o--)e.linesArr.splice(o-1,1),e.isName&&(e.nameText.splice(o-1,1),e.showText.splice(o-1,1),e.code.splice(o-1,1)),e.isCarving&&e.textList.splice(o-1,1),e.isCrystal&&(e.crystalColor.splice(o-1,1),e.diamondDefaultImg.splice(o-1,1));e.isCrystal&&e.setDiamond()}},changeClass:function(t){this.nameClass=t}},mounted:function(){var t=this;if(t.isCrystal){t.linesArr.forEach(function(e,a){t.diamondDefaultImg[e]=t.picUrl+t.diamond[e][0].sku+".png",t.diamondDefaultColor[e]=t.diamond[e][0].color,t.crystalColor[e]=t.diamond[e][0].sku}),t.crystalCanvas=new fabric.Canvas("crystalcanvas"),t.crystalCanvas.setHeight(73),t.crystalCanvas.selection=!1,t.crystalCanvas.renderAll(),t.setDiamond(),window.uploadDiamondImage=this.uploadDiamondImage;var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.diamond)||(e.diamond=[]),e.diamond[t.param.index]={diamondImage:"",engravingText:"",engravingSize:"",engravingFont:"",diamondCustom:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e))}t.isCarving&&(t.linesArr.forEach(function(e,a){t.limitNum[e]=t.coors[e].textNum,t.textNum[e]=t.coors[e].textNum,t.isEmpty[e]=!1,t.isEmojiError[e]=!1,t.textList[e]=""}),t.engravingSize[t.param.index]=Ot.crystalText[this.param.index].engravingSizeOptions[0].value?Ot.crystalText[this.param.index].engravingSizeOptions[0].value:"20",t.engravingFont[t.param.index]=Ot.crystalText[this.param.index].engravingFontOptions[0].value?Ot.crystalText[this.param.index].engravingFontOptions[0].value:"TimesNewRoman",window.checkCarvingText=this.checkCarvingText),t.isName&&(Ot.nameObj[t.param.index]=new de({json:t.param.data}),t.linesArr.forEach(function(e,a){t.$set(t.nameTextMaxLength,e,t.text[e].limit.split("-")[1]),t.$set(t.nameLeftNum,e,t.text[e].limit.split("-")[1]),t.$set(t.fontFamily,e,t.text[e].fontFamily),t.$set(t.code,e,t.text[e].code),t.nameTextEmpty[e]=!1,t.nameTextLimit[e]=!1}),window.getNameCtx=this.getNameCtx,window.checkNameToBase64=this.checkNameToBase64,window.changeClass=this.changeClass,window.checkCode=this.checkCode),window.changeNumber=this.changeNumber}},ke=_e,Ee=(a("4689"),Object(Ft["a"])(ke,Oe,Ie,!1,null,"688800fc",null)),je=Ee.exports,Le=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"",width:t.dialogWidth,visible:t.centerDialogVisible,"close-on-click-modal":t.closeOnClickModal,"modal-append-to-body":t.isModalAppendToBody,fullscreen:t.isFullscreen},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[a("div",{staticClass:"custom-select-container"},[a("div",{staticStyle:{"margin-bottom":"20px","text-align":"center"}},[t.previewPicture?a("div",[a("div",{staticClass:"previewPicture-container"},[a("img",{staticStyle:{width:"247px"},attrs:{src:t.previewPicture}})])]):a("div",[a("div",{staticClass:"lds-ring"},[a("div"),a("div"),a("div"),a("div")]),a("div",{domProps:{innerHTML:t._s(t.renderingText)}})]),t.ifSelectExample?a("div",[a("div",{staticClass:"carving-exaple-text"},[t._v(t._s(t.carvingExampleText))]),a("div",{staticClass:"carving-exaple-img"},t._l(t.carvingExampleImg,function(t,e){return a("img",{key:e,staticClass:"carving-exaple-img-item",attrs:{src:t}})}),0),a("div",{staticClass:"carving-prompt"},[t._v(t._s(t.carvingPrompt))])]):t._e()]),a("div",[a("el-button",{staticClass:"select-open-carving",staticStyle:{background:"#f14b59","border-color":"#f14b59"},attrs:{type:"danger"},on:{click:t.openCarving}},[t._v(t._s(t.selectBtnText))])],1),a("div",{staticStyle:{margin:"5px"}},[t._v(t._s(t.selectOrText))]),a("div",[a("el-button",{staticClass:"select-cancel-carving",staticStyle:{background:"#2f6dd1","border-color":"#2f6dd1"},attrs:{type:"primary"},on:{click:t.cancelCanvas}},[t._v(t._s(t.withoutBtnText))])],1),a("div",{staticClass:"notice-info"},[t._v(t._s(t.noticeInfo))])])])},Ae=[],Ne={name:"CropDialog",props:["crop-source"],data:function(){return{centerDialogVisible:!1,closeOnClickModal:!0===Ot.cropPrompt,params:"",selectOrText:Ot.selectOrText?Ot.selectOrText:"OR",selectBtnText:Ot.selectBtnText?Ot.selectBtnText:"Custom text on the bottom +$4.99",withoutBtnText:Ot.withoutBtnText?Ot.withoutBtnText:"Without text",previewPicture:"",dialogWidth:this.$device.mobile?"100%":"40%",subDialogWidth:this.$device.mobile?"width: 100%; border: 1px solid gray; display: inline-block;":"width: 500px; height:400px; border: 1px solid gray; display: inline-block;",imgStyle:this.$device.mobile?{}:{width:"500px",height:"400px"},isFullscreen:!!this.$device.mobile,renderingText:Ot.renderingText?Ot.renderingText:"",_json:{},carvingExampleText:Ot.carvingExampleText?Ot.carvingExampleText:"",carvingExampleImg:Ot.carvingExampleImg?Ot.carvingExampleImg:"",carvingPrompt:Ot.carvingPrompt?Ot.carvingPrompt:"",isModalAppendToBody:!1!==Ot.isModalAppendToBody,ifSelectExample:!0===Ot.ifSelectExample,carvingIndex:0,noticeInfo:Ot.carvingNoticeInfo?Ot.carvingNoticeInfo:""}},methods:{open:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.params=t,this.carvingIndex=e,this.$store.getters.getCustomInfo&&(this._json=JSON.parse(this.$store.getters.getCustomInfo)),this.centerDialogVisible=!0,0!=Object.keys(this._json).length?(console.log(this._json),"undefined"!=typeof this._json.photo?this.previewPicture=this._json.photo[t.index]["crop"]:"undefined"!=typeof this._json.crop?this.previewPicture=this._json.crop[t.index]["crop"]:"undefined"!=typeof this._json.curve_engraving?this.previewPicture=this._json.curve_engraving[t.index]["engravingCrop"]:"undefined"!=typeof this._json.engraving&&(this.previewPicture=this._json.engraving[t.index]["engravingCrop"]),this.centerDialogVisible=!0):console.log("_json object is null")},clearPreviewPicture:function(){this.previewPicture="",this.renderingErroText=""},openCarving:function(){this.centerDialogVisible=!1,this.$parent.$refs.CarvingDialog[this.carvingIndex].open(),Ot.dispatchCustomEvent("SELECT_CARVING_AFTER",{data:1})},cancelCanvas:function(){this.centerDialogVisible=!1,Ot.dispatchCustomEvent("SELECT_CARVING_AFTER",{data:0})}},mounted:function(){}},Fe=Ne,Be=(a("b36f"),Object(Ft["a"])(Fe,Le,Ae,!1,null,"475d19a0",null)),Pe=Be.exports,De=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[0==t.photoStyle?a("div",{class:t.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[t.photoCrop[t.param.index]?a("img",{staticClass:"preview-thumbnail",attrs:{src:t.photoCrop[t.param.index],width:"50",height:"40"},on:{click:t.openimage}}):a("span",{staticClass:"area-photo-upload-text"},[t._v(t._s(t.uploadLabel)),a("font",{attrs:{color:"red"}},[t._v("*")])],1)]),a("div",{staticClass:"area-photo-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[t._v(t._s(this.btnUploadText))])])],1)]):t._e(),1==t.photoStyle?a("div",{staticClass:"area-photo-upload-rect"},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload}},[this.photoCrop[this.param.index]?a("div",{staticClass:"area-photo-upload-rect-thumbnai"},[a("img",{staticClass:"avatar",attrs:{src:this.photoCrop[this.param.index]}})]):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1):t._e(),a("div",{class:t.requirePromptTextClass},[t._v(t._s(t.requirePrompt))]),a("el-dialog",{attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt"},[t._v(t._s(t.cropPrompt))]),a("div",[a("el-collapse",{attrs:{accordion:""},model:{value:t.crystalHeaderDisplay,callback:function(e){t.crystalHeaderDisplay=e},expression:"crystalHeaderDisplay"}},[a("el-collapse-item",{attrs:{name:"crystalTitleName"}},[a("template",{staticClass:"crystal-header",slot:"title"},[a("div",{staticClass:"crystal-header-title-box"},[a("div",{staticClass:"crystal-header-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondHeaderDefaultImg}}),a("span",[t._v(t._s(t.crystalHeader))])]),a("div",{staticClass:"crystal-free",attrs:{"data-price":""}},[t._v(t._s(t.freeText))])])]),a("el-collapse",{attrs:{accordion:""},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.diamond,function(e,i){return a("el-collapse-item",{key:i,attrs:{name:"crystal"+i}},[a("template",{slot:"title"},[a("div",{staticClass:"crystal-title-box"},[a("div",{staticClass:"crystal-title"},[a("img",{staticClass:"diamond-default-img",attrs:{src:t.diamondDefaultImg[i]}}),a("span",[t._v(t._s(t.crystalTitle)+t._s(i+1))])])])]),a("div",{attrs:{id:"collapse"+i,"aria-labelledby":"headingOne","data-parent":"#accordion"}},[a("div",{staticClass:"card-body"},[a("div",{class:"crystal-all"+i},[a("div",{staticClass:"crystal"},t._l(e,function(e,n){return a("div",{key:n,staticClass:"crystal-list"},[a("div",{staticClass:"img",style:"background-image:url("+t.picUrl+e.sku+".png?456);"}),a("input",{class:"colorful color-"+i,attrs:{"v-model":t.crystalColor[i],"data-index":i,"data-color":e.color,name:"color"+i,type:"radio"},domProps:{value:e.sku},on:{click:function(a){return t.changeColor(i,e.color,e.sku)}}}),a("div",{staticClass:"name"},[t._v(t._s(t.month[n]))])])}),0)])])])],2)}),1)],2)],1)],1),a("div",{staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1),a("div",{staticClass:"fuzzyMsg"},[t._v(t._s(t.fuzzyMsg))]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:function(e){t.centerDialogVisible=!1}}},[t._v(t._s(t.photoCancelText))]),a("el-button",{staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:t.isLoading},on:{click:t.photoImage}},[t._v(t._s(t.photoConfirmText))])],1)]),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("canvas",{attrs:{id:t.photoCanvasId}})])],1)},ze=[],$e=function(){function t(t){this.init(t)}return t.prototype=Object.assign(new kt,{request:{},init:function(t){this.canvas=new fabric.Canvas(t["canvasid"]),this.cWidth=t.cWidth,this.cHeight=t.cHeight,this.baseImg=!!t.baseImg&&t.baseImg,this.type=t.type,this.sku=t.sku,this.bgcolor=t.bgcolor?t.bgcolor:"",this.ainame=t.ainame?t.ainame:"",this.isAiLucid=t.isAiLucid?t.isAiLucid:0,this.hasCropImg=!0===t.hasCropImg,this.diamond=t.diamond,this.config=t,this.setCanvaSize(),this.setObject(this,this.baseImg),this.setBindMethod(this)},setObject:function(t,e){this.setCanvaSize(),t.canvas.setOverlayImage(e,t.canvas.renderAll.bind(t.canvas),{originX:"left",originY:"top",scaleX:t.scale,scaleY:t.scale,crossOrigin:"anonymous"});var a=0;t.diamond[a]&&t.setDiamond(a),t.canvas.on("object:selected",function(e){t.canvas.set("preserveObjectStacking",!1),t.canvas.renderAll()}),t.canvas.on("object:modified",function(e){var a=e.target;t.canvas.set("preserveObjectStacking",!0),t.canvas.sendToBack(a),t.canvas.renderAll(),t.setCoor()})},getMouseCoords:function(t){var e=this.canvas.getPointer(t.e),a=e.x,i=e.y;console.log(a+", "+i)},getBs:function(){if(this.canvas.getObjects().length>0)return this.canvas.item(0)},adjuster:function(t){var e=this.getBs();if(e){switch(t){case"move-left":e.set({left:e.left-5});break;case"move-right":e.set({left:e.left+5});break;case"move-up":e.set({top:e.top-5});break;case"move-down":e.set({top:e.top+5});break;case"zoom-big":e.set({scaleX:e.scaleX+.01,scaleY:e.scaleY+.01});break;case"zoom-small":e.set({scaleX:e.scaleX-.01,scaleY:e.scaleY-.01});break;case"rotate-left":e.set({angle:e.angle-45}).setCoords();break;case"rotate-right":e.set({angle:e.angle+45}).setCoords();break;case"reset":e.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords();break}this.setCoor()}},rotate:function(t){var e=this.getBs();if(e){var a="rotate_left"==t?-45:45;e.set({angle:e.angle+a}).setCoords(),this.setCoor()}},reset:function(){var t=this.getBs();t&&(t.set({left:this.cWidth/2,top:this.cHeight/2,angle:0}).setCoords(),this.setCoor())},setBindMethod:function(t){this.listenWheel(this,!0)},compress:function(t,e){var a=new Image;a.src=e,a.onload=function(){var a=.5,i=document.createElement("canvas"),n=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=this.width;var o=document.createAttribute("height");o.nodeValue=this.height,i.setAttributeNode(r),i.setAttributeNode(o),n.drawImage(this,0,0,this.width,this.height),e=i.toDataURL("image/png",a),t.request.originImage=e}},change:function(t,e){if(t.compress(t,e),t.canvas.getObjects().length>0)var a=this.getBs();console.log("obj.filters====="+a.filters),!a||"image"!==a.type||"undefined"!=typeof a.filters&&""!=a.filters?fabric.Image.fromURL(e,function(e){e.hasControls=!1,e.hasBorders=!1,e.set({originX:"center",originY:"center"}),t.scale=t.height>e.height?1:t.height/e.height,e.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale}),t.canvas.add(e),t.canvas.sendToBack(e),t.canvas.renderAll(),t.setCoor()}.bind(this),{crossOrigin:"anonymous"}):a.setSrc(e,function(){t.scale=t.height>a.height?1:t.height/a.height,a.set({left:t.width/2,top:t.height/2,scaleX:t.scale,scaleY:t.scale}),t.canvas.renderAll(!0),t.setCoor()})},setCoor:function(){var t=this.getBs();t&&(this.request.scaleX=t.scaleX,this.request.scaleY=t.scaleY,this.request.left=t.left,this.request.top=t.top,this.request.angle=t.angle,this.canvas.renderAll())},addObject:function(t,e){fabric.Image.fromURL(e[0],function(a){a.set({originX:"center",originY:"center"}),1==t.isMobile?a.set({left:t.width/2,top:t.height/2,scaleX:150/a.width,scaleY:150/a.width}):a.set({left:t.cWidth/2,top:t.cHeight/2,scaleX:300/a.width,scaleY:300/a.width});var i=e[1],n=t.canvas.item(i);a.opacity=e[2],a.selectable=e[3],a.hasBorders=e[4],a.hasControls=e[5],t.canvas.remove(n).add(a).moveTo(a,i).renderAll(),t.setCoor()})},listenWheel:function(t,e){var a=t.canvas.wrapperEl;if(void 0!=a){var i=function(e){var a=0;e=window.event||e,a=e.detail?-e.detail/3:e.wheelDelta/120;e.preventDefault&&e.preventDefault();var i=t.getBs();if(i){a=a/200;return i.width*i.scaleX>=50||a>0?(i.scaleX+=a,i.scaleY+=a):(i.scaleX=.01,i.scaleY=.01),i.setCoords(),t.setCoor(),!1}},n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";a.attachEvent?a.attachEvent("on"+n,i,e):a.addEventListener&&a.addEventListener(n,i,e)}},setDiamond:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;fabric.Image.fromURL(e.diamond[t],function(a){a.lockMovementX=!0,a.lockMovementY=!0,a.selectable=!1,a.scaleX=e.scale,a.scaleY=e.scale,e.canvas.add(a),t++,e.diamond[t]?e.setDiamond(t):e.config.callback(e)}.bind(this),{crossOrigin:"anonymous"})},getColor:function(t){var e={pomegranate:["#4d0875","0.011618","-0.235405","0.713477","-1.59"],hyacinth:["#4d0875","-0.0981","-0.0471","0.474296","-0.086"],bodegablue:["#006291","-0.000145","0.101801","-0.000145","0"],whitezirconium:["#4d0875","-0.01975","0.011618","-1","-0.524"],greenzirconium:["#4d0875","-0.086407","-0.160906","0.180221","-0.85"],pink:["#4d0875","-0.133459","0.172379","-0.039355","-1.604"],redsteel:["#4d0875","-0.204037","-0.243247","0.99971","-1.654"],olive:["#4d0875","-0.192274","-0.015829","-0.05896","-1.148"],bluezirconium:["#4d0875","-0.243247","-0.231484","0.368429","-0.322"],rosered:["#4d0875","-0.078565","-0.05896","0.733082","0.198"],champagne:["#4d0875","-0.141301","0.062591","0.733082","0.662"],spinel:["#4d0875","-0.035434","-0.086407","0.611531","1.646"],alexred:["#4d0875","0.023381","-0.211879","0.301772","-1.62"],alexpinkishpurple:["#130141","-0.031513","-0.031513","-0.337351","0"],alexseablue:["#4d0875","0.023381","-0.055039","-0.721609","-0.414"],alexwhite:["#4d0875","0.023381","-0.055039","-1","-0.414"],alexgreen:["#4d0875","-0.070723","-0.376561","0.552716","1.234"],alexlightpurple:["#4d0875","-0.011908","-0.149143","-0.478507","1.776"],alexrosepink:["#4d0875","0.101801","-0.086407","-0.160906","-1.66"],alexolive:["#4d0875","-0.000145","-0.13738","0.082196","-1.148"],alexblue:["#4d0875","-0.125617"," -0.125617"," 0.152774","1.582"],alexpink:["#4d0875","0.117485","0.015539","-0.68632","-1.52"],alexamber:["#4d0875","0.074354","-0.145222","0.168458","0.554"],alexlightblue:["#4d0875","0.074354","-0.047197","-0.109933","1.428"],originalwhite:["#707070","0.37235","0.117485","-0.000145","0"],originalcolorwhite:["#13e8ff","0.168458","0.13709","0.391955","0.136"],originalcolorblue:["#0b7477","0.270404","-0.000145","0.168458","0.034"],originallightyellow:["#7d6504","0.050828","0.035144","0.662504","0.034"],originalolive:["#4d0875","0.007697","-0.05896","-0.317746","-1.094"],originalperidot:["#4d0875","0.007697","-0.05896","-0.705925","-1.094"],originalaquamarine:["#016f7a","0.37235","0.117485","-0.000145","0"],originalblack:["#000000","0.13709","-0.031513","0.391955","-0.066"],originalblackdiamond:["#4d0875","-0.004066","-0.25501","-1","0.444"],originalred:["#750000","0.015539","-0.102091","-0.000145","0"],originalcitrine:["#b47501","-0.015829","-0.133459","-0.000145","0"],originalgold:["#4d0875","-0.207958","0.13709","0.517427","0.7"],originalstarlite:["#005757","0.050828","0.035144","0.662504","0.034"],originalblue:["#070093","0.37235","0.035144","0.391955","-0.066"],originalgreen:["#003939","-0.000145","0.066512","0.188063","-0.1"],originalrosered:["#4d0875","-0.188353","0.011618","0.41156"," 0.244"],originalcymbidium:["#4d0875","-0.188353","-0.325588","0.05867","1.606"],originalpinkishpurple:["#400080","-0.000145","0.050828","-0.000145","-0.1"],originallightred:["#750000","0.37235","0.117485","-0.000145","0"],originallightrosered:["#e37bbc","0.37235","0.117485","-0.000145","0"],originallightpurple:["#4d0875","-0.125617","0.070433","-0.404008","-2"],originalpink:["#70384b","-0.082486","0.117485","-0.423613","0"],originalpurplishred:["#930453","0.25472","0.101801","-0.000145","0"],originalviolet:["#4d0875","-0.102091","0.109643","-0.494191","-1.946"],originalpurple:["#6206d2","0.37235","0.035144","0.391955","0.034"],brightred:["#ff0000","-0.01975","0.104644","-0.031513","0"],purplevelvet:["#99004d","0.046907","-0.05896","-0.000145","0"],shallowbluejade:["#3d5ccb","-0.000145","0.101801","-0.000145","0"],newwhite:["#4d0875","-0.01975","0.011618","-1","-0.524"],emerald:["#0b5334","0.102091","-0.153064","-0.37264","0.096"],greyviolet:["#b02d68","-0.007987","0.090038","-0.129538","0.122"],darkred:["#6c0000","0.184142","-0.074644","-0.031513","-0.012"],fruitgreen:["#0c6d0c","-0.153064","0.082196","-0.37264","0.014"],cobaltblue:["#0c419a","0.046907","-0.05896","-0.000145","0"],softred:["#840042","-0.031513","-0.01975","-0.37264","0.096"],yellow:["#4d0875","-0.141301","0.062591","0.733082","0.662"],jadeblue:["#4f84aa","-0.007987","-0.074644","-0.007987","0"]};return e[t]},setColor:function(t,e){var a=this.getColor(e);t.filters=[];var i=new fabric.Image.filters.BlendColor({color:a[0],mode:"add",alpha:1}),n=new fabric.Image.filters.Contrast({contrast:a[1]}),r=new fabric.Image.filters.Brightness({brightness:a[2]}),o=new fabric.Image.filters.Saturation({saturation:a[3]}),s=new fabric.Image.filters.HueRotation({rotation:a[4]});t.filters.push(i),t.applyFilters(),this.canvas.renderAll(),t.filters.push(n),t.applyFilters(),this.canvas.renderAll(),t.filters.push(r),t.applyFilters(),this.canvas.renderAll(),t.filters.push(o),t.applyFilters(),this.canvas.renderAll(),t.filters.push(s),t.applyFilters(),this.canvas.renderAll()}}),t.prototype.constructor=t,t}(),Me=$e,We={name:"CropDialog",props:["param"],data:function(){var t;return t={uploadLabel:Ot.uploadLabel?Ot.uploadLabel:"Upload your Photo",btnUploadText:Ot.btnUploadText?Ot.btnUploadText:"Upload",photoCancelText:Ot.photoCancelText?Ot.photoCancelText:"Cancel",photoConfirmText:Ot.photoConfirmText?Ot.photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,requirePromptTextClass:"require-prompt-text require-prompt-text-"+this.param.index,photoStyle:Ot.photoCrystal[this.param.index].style?Ot.photoCrystal[this.param.index].style:0,checkFuzzy:!!Ot.photoCrystal[this.param.index].checkFuzzy&&Ot.photoCrystal[this.param.index].checkFuzzy,currentLanguage:Ot.photoCrystal[this.param.index].currentLanguage?Ot.photoCrystal[this.param.index].currentLanguage:"en",isUpload:0,isLoading:!1,photoBase64:"",cropPrompt:!1===Ot.cropPrompt?"":Ot.cropPrompt,requirePrompt:!1===Ot.requirePrompt?"":Ot.requirePrompt,imgSrc:"",photoCrop:[],photoAi:[],photoOrigin:[],diamondColor:[],photoCanvasId:"photo-canvas-"+this.param.index},Object(ft["a"])(t,"isLoading",!1),Object(ft["a"])(t,"dialogWidth",this.$device.mobile?"100%":"40%"),Object(ft["a"])(t,"isFullscreen",!!this.$device.mobile),Object(ft["a"])(t,"centerDialogVisible",!1),Object(ft["a"])(t,"percentage",0),Object(ft["a"])(t,"fuzzyMsg",""),Object(ft["a"])(t,"picUrl",this.param.data.picUrl),Object(ft["a"])(t,"activeName","crystal0"),Object(ft["a"])(t,"crystalHeaderDisplay","crystalTitleName"),Object(ft["a"])(t,"diamond",this.param.data.diamond?this.param.data.diamond:""),Object(ft["a"])(t,"diamondHeaderDefaultImg",""),Object(ft["a"])(t,"crystalTitle",this.param.data.crystalTitle?this.param.data.crystalTitle:"Select"),Object(ft["a"])(t,"crystalHeader",this.param.data.crystalHeader),Object(ft["a"])(t,"freeText",this.param.data.freeText),Object(ft["a"])(t,"month",this.param.data.month),Object(ft["a"])(t,"diamondDefaultImg",[]),Object(ft["a"])(t,"diamondDefaultColor",[]),Object(ft["a"])(t,"crystalColor",[]),Object(ft["a"])(t,"isCloseOnClickModal",!1!==Ot.isCloseOnClickModal),t},mounted:function(){var t=this;t.diamond&&(t.diamond.forEach(function(e,a){t.crystalColor[a]=e[0].sku,t.diamondDefaultImg.push(t.picUrl+e[0].sku+".png?"+Math.random()),t.diamondDefaultColor.push(e[0].color)}),t.diamondHeaderDefaultImg=t.picUrl+t.diamond[0][0].sku+".png?"+Math.random()),Ot.photoCrystalObj[this.param.index]=new Me({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",cWidth:500,cHeight:400,diamond:this.param.data.diamondImg,callback:function(e){e.diamond.forEach(function(a,i){e.setColor(e.canvas.item(i),t.diamondDefaultColor[i])})}});var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.photoCrystal)||(e.photoCrystal=[]),e.photoCrystal[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",ai:"",origin:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e))},methods:{avatarUpload:function(t){var e=this,a=this,i=new FileReader;i.onload=function(t){e.centerDialogVisible=!0,e.photoBase64=t.target.result,e.checkFuzzy&&e.checkImageFuzzy(e.photoBase64),_zenConfig.photoCrystalObj[a.param.index].change(_zenConfig.photoCrystalObj[a.param.index],e.photoBase64)},i.readAsDataURL(t.file)},onOpened:function(){this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody)},openimage:function(){this.$parent.openimage(this.photoCrop[this.param.index])},doAction:function(t){"reset"==t?this.getBs().set({left:Ot.photoCrystalObj[this.param.index].canvas.width/2,top:Ot.photoCrystalObj[this.param.index].canvas.height/2,angle:0}).setCoords():"left"==t?this.getBs().set({angle:this.getBs().angle-45}).setCoords():"right"==t?this.getBs().set({angle:this.getBs().angle+45}).setCoords():"sub"==t?this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords():"add"==t&&this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),Ot.photoCrystalObj[this.param.index].canvas.renderAll()},getBs:function(){return Ot.photoCrystalObj[this.param.index].canvas.item(0)},photoImage:function(){var t=this;this.isLoading=!0;var e=Ot.photoCrystalObj[t.param.index].getBs();t.sendImgBack(),Ot.awUpload({width:Ot.photoCrystalObj[t.param.index].cWidth,height:Ot.photoCrystalObj[t.param.index].cHeight,scaleX:e.scaleX*Ot.photoCrystalObj[t.param.index].cWidth/Ot.photoCrystalObj[t.param.index].width,scaleY:e.scaleY*Ot.photoCrystalObj[t.param.index].cWidth/Ot.photoCrystalObj[t.param.index].width,left:e.left*Ot.photoCrystalObj[t.param.index].cWidth/Ot.photoCrystalObj[t.param.index].width,top:e.top*Ot.photoCrystalObj[t.param.index].cWidth/Ot.photoCrystalObj[t.param.index].width,angle:e.angle,type:Ot.photoCrystalObj[t.param.index].type,sku:Ot.photoCrystalObj[t.param.index].sku,ainame:Ot.photoCrystalObj[t.param.index].ainame||"",isAiLucid:Ot.photoCrystalObj[t.param.index].isAiLucid||0,bgcolor:Ot.photoCrystalObj[t.param.index].bgcolor||"",origin_data:Ot.photoCrystalObj[t.param.index].request.originImage},function(e){if(t.photoAi[t.param.index]=Ot.awcdn+e.ai,t.photoOrigin[t.param.index]=Ot.awcdn+e.origin,t.crystalColor){var a=[];t.crystalColor.forEach(function(t,e){a.push(t)}),t.diamondColor[t.param.index]=a.join("|")}t.base64=Ot.photoCrystalObj[t.param.index].canvas.toDataURL({format:"png",quality:.8});var i=Ot.getFilename(12),n=i+"-"+t.param.data.sku+".png",r="";r=n?{base64:t.base64,key:n}:t.base64,Ot.cdnUpload(r,function(e){t.photoCrop[t.param.index]=e.picture;var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.photoCrystal)||(a.photoCrystal=[]),a.photoCrystal[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:t.photoCrop[t.param.index],ai:t.photoAi[t.param.index],origin:t.photoOrigin[t.param.index],diamondCustom:t.diamondColor[t.param.index],item:t.param.data.sku},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),t.centerDialogVisible=!1,t.isLoading=!1,t.percentage=0,Ot.dispatchCustomEvent("EVENT_PHOTO_CRYSTAL_SAVE_AFTER",{index:t.param.index,data:a})},t)},t)},sendImgBack:function(){var t=this,e=Ot.photoCrystalObj[t.param.index].getBs();Ot.photoCrystalObj[t.param.index].canvas.set("preserveObjectStacking",!0),Ot.photoCrystalObj[t.param.index].canvas.sendToBack(e),Ot.photoCrystalObj[t.param.index].canvas.renderAll()},checkImageFuzzy:function(t){var e=this;this.fuzzyMsg&&gtag("event","Fuzzy_Photo_Change",{event_category:"website"}),this.fuzzyMsg="",this.$ajax({method:"post",async:!1,url:"https://ai.soufeel.com/tencent/fuzzy?_language="+this.currentLanguage,data:{image:t}}).then(function(t){t.data.fuzzy&&(e.fuzzyMsg=t.data.msg,gtag("event","Fuzzy_Photo_Show",{event_category:"website"}))}).catch(function(t){console.log(t)})},changeColor:function(t,e,a){this.sendImgBack();var i=parseInt(t)+1,n=Ot.photoCrystalObj[this.param.index].canvas.item(i);this.crystalColor[t]=a,this.$set(this.diamondDefaultImg,t,this.picUrl+a+".png?"+Math.random()),this.$set(this.diamondDefaultColor,t,e),Ot.photoCrystalObj[this.param.index].setColor(n,e)}}},Ue=We,Re=(a("1bbc"),Object(Ft["a"])(Ue,De,ze,!1,null,"677fe106",null)),qe=Re.exports,Ve=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"name-carving-container"},[a("div",{staticClass:"view-name"},[a("span",[t._v(t._s(t.preview)+":")]),a("div",{staticClass:"showtext",style:"font-family:"+t.fontFamily,attrs:{id:"showtext"}},[t._l(t.lines,function(e){return a("span",{key:e,class:"showtext-in "+t.nameClass,style:t.style,attrs:{id:"showtext_"+e}},[t._v(t._s(t.showText[e]))])}),t._v("    \n        ")],2),a("div",{staticStyle:{display:"none"},attrs:{id:"hideShowText"}})]),a("div",{staticClass:"namecanvas-content",class:{first:1==t.lines}},t._l(t.lines,function(e){return a("div",{key:e,staticClass:"pr"},[a("div",{staticClass:"name-textarea",class:{nameError:(t.nameTextEmpty[e-1]||t.nameTextLimit[e-1]||t.nameEmojiError[e-1])&&t.errorBorderShow}},[t.isrometime?a("input",{directives:[{name:"model",rawName:"v-model",value:t.nameText[e],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+e,type:"text","data-prefix":"ctext","data-index":e,id:"ctext"+e,maxlength:t.nameTextMaxLength[e],placeholder:t.placeHolder[e-1]},domProps:{value:t.nameText[e]},on:{input:function(a){a.target.composing||t.$set(t.nameText,e,a.target.value)}}}):a("input",{directives:[{name:"model",rawName:"v-model",value:t.nameText[e],expression:"nameText[m]"}],staticClass:"alpha_text",attrs:{"data-leftnum":"leftnum"+e,type:"text","data-prefix":"ctext","data-index":e,id:"ctext"+e,maxlength:t.nameTextMaxLength[e],placeholder:t.placeHolder[e-1]},domProps:{value:t.nameText[e]},on:{input:[function(a){a.target.composing||t.$set(t.nameText,e,a.target.value)},function(a){return t.changeAlphaText(e,t.nameText[e])}]}}),a("div",{staticClass:"leftnum"},[a("span",{attrs:{id:"leftnum"+e}},[t._v(t._s(t.nameLeftNum[e]))]),t._v(" "+t._s(t.leftText))])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextEmpty[e-1]&&t.errorWordShow,expression:"nameTextEmpty[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.requiredField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameTextLimit[e-1]&&t.errorWordShow,expression:"nameTextLimit[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.atLeastField))]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.nameEmojiError[e-1]&&t.errorWordShow,expression:"nameEmojiError[m-1] && errorWordShow"}],staticClass:"nameErrorWord"},[t._v(t._s(t.emojiErrorField))])])}),0),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas",width:t.nameFillrectWidth,height:"170"}}),a("canvas",{staticStyle:{border:"1px solid #d3d3d3",display:"none"},attrs:{id:"myCanvas2"}})])},He=[];a("b9c1"),a("4e8c"),a("2b78"),a("ad94");var Ye={name:"CrystalDialog",props:["param"],components:{},data:function(){return{showText:[],nameText:[],nameTextMaxLength:[],nameLeftNum:[],nameTextEmpty:[],nameTextLimit:[],nameEmojiError:[],fontCode:[],alphaText:[],preview:this.param.data.preview,fontFamily:this.param.data.fontFamily,fontFamilyNew:this.param.data.fontFamily,nameClass:this.param.data.class,lines:this.param.data.lines,errorBorderShow:this.param.data.errorBorderShow,enterName:this.param.data.enterName,requiredField:this.param.data.requiredField,emojiErrorField:this.param.data.emojiErrorField,atLeastField:"",atLeastText:this.param.data.atLeastText,charactersText:this.param.data.charactersText,errorWordShow:this.param.data.errorWordShow,firstUpperCase:this.param.data.firstUpperCase,code:this.param.data.code,productItem:this.param.data.productItem,text:this.param.data.text,leftText:this.param.data.leftText,style:this.param.data.style,isrometime:!0===this.param.data.isrometime,placeHolder:this.param.data.placeHolder?this.param.data.placeHolder:[],nowText:this.param.data.nowText?this.param.data.nowText:"Now",cancelText:this.param.data.cancelText?this.param.data.cancelText:"Cancel",setText:this.param.data.setText?this.param.data.setText:"Set",dayText:this.param.data.dayText?this.param.data.dayText:"Day",monthText:this.param.data.monthText?this.param.data.monthText:"Day",yearText:this.param.data.yearText?this.param.data.yearText:"Day",dateLang:this.param.data.dateLang?this.param.data.dateLang:"en",nameCtxWidth:this.param.data.nameCtxWidth?this.param.data.nameCtxWidth:70,nameFillrectWidth:this.param.data.nameFillrectWidth?this.param.data.nameFillrectWidth:1e4}},methods:{changeAlphaText:function(t,e){if(1==Ot.getLen(e))return!1;var a=t-1;Ot.nameObj[this.param.index].process(e,a,this.firstUpperCase),this.nameText[t]=Ot.nameObj[this.param.index].text[a].text,this.showText[t]=Ot.nameObj[this.param.index].text[a].showText,this.nameLeftNum[t]=parseInt(this.nameTextMaxLength[t])-this.nameText[t].length},checkNametoBase64:function(){var t=this,e=0;if(t.text.forEach(function(a,i){e=1==Ot.nameObj[t.param.index].checkQuantity(t.nameText[i+1],a.limit.split("-")[0],a.limit.split("-")[1])}),1==e)return!1;var a=Ot.nameObj[t.param.index].setInputVal(t.lines);return a},getCtx:function(t){var e=this,a="";e.showText.forEach(function(t,e){a+=" |"+t}),a=a.substring(2);var i=document.getElementById("myCanvas"),n=i.getContext("2d");n.fillStyle="rgba(255,255,255,1)",n.fillRect(0,0,e.nameFillrectWidth,100);var r=t.trim();""==r&&(r=e.nameClass),"silver"==r?(n.fillStyle="#808080",n.font="80px "+e.fontFamilyNew):"gold"==r?(n.fillStyle="#eac855",n.font="80px "+e.fontFamilyNew):"rosegold"==r&&(n.fillStyle="#c8977b",n.font="80px "+e.fontFamilyNew);var o=n.measureText(a).width;console.log("txtWidth============",o);var s=o+e.nameCtxWidth;n.fillText(a,40,80);var l=document.getElementById("myCanvas2");l.width=s,l.height=100;var c=l.getContext("2d");c.drawImage(i,0,0,s,170,0,0,s,170);var d=l.toDataURL("image/png",.8);return d},saveNameCanvas:function(){var t=Object(Se["a"])(regeneratorRuntime.mark(function t(){var e,a,i,n,r,o,s,l=arguments;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:this.nameClass,a=this,i=!0,a.text.forEach(function(t,e){a.$set(a.nameEmojiError,e,!1),a.$set(a.nameTextLimit,e,!1),a.$set(a.nameTextEmpty,e,!1),a.nameText[e+1]?1==Ot.getLen(a.nameText[e+1])?(a.$set(a.nameEmojiError,e,!0),i=!1):a.nameText[e+1].length<parseInt(t.limit.split("-")[0])&&(a.atLeastField=a.atLeastText+t.limit.split("-")[0]+a.charactersText,a.$set(a.nameTextLimit,e,!0),i=!1):(a.$set(a.nameTextEmpty,e,!0),i=!1)}),i&&(n=a.checkNametoBase64(),n?(a.alphaText[a.param.index]=n,a.fontCode[a.param.index]=a.code):i=!1),i){t.next=7;break}return t.abrupt("return",!1);case 7:return r=a.getCtx(e),o=Ot.convertBase64ToBlob(r),s=new kt,t.next=12,s.cdnAsyncUpload(function(t,e){var i=Ot.getFilename(12)+".png",n={next:function(t){console.log("ok")},error:function(t){console.log("Upload Error, Please refresh now")},complete:function(t){var i={};a.$store.getters.getCustomInfo&&(i=JSON.parse(a.$store.getters.getCustomInfo)),Array.isArray(i.nameCarving)||(i.nameCarving=[]),i.nameCarving[a.param.index]={nameCrop:Ot.qncdn+t.key,fontCode:a.fontCode[a.param.index],alphaText:a.alphaText[a.param.index]},a.$store.dispatch("setCustomInfo",JSON.stringify(i)),Ot.dispatchCustomEvent("EVENT_NAME_CARVING_SAVE_AFTER",{index:a.param.index,data:i}),e()}},r={region:yt["region"].na0,concurrentRequestLimit:3},s={fname:"",params:{},mimeType:null},l=yt["upload"](o,i,t,s,r);l.subscribe(n)});case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=this,e=!1;t.placeHolder.length<1&&(e=!0),t.text.forEach(function(a,i){t.nameTextEmpty.push(!1),t.nameTextLimit.push(!1),t.nameEmojiError.push(!1),t.nameTextMaxLength[i+1]=a.limit.split("-")[1],t.nameLeftNum[i+1]=a.limit.split("-")[1],e&&t.placeHolder.push(t.enterName)}),Ot.nameObj[this.param.index]=new de({json:this.param.data});var a={};t.$store.getters.getCustomInfo&&(a=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(a.nameCarving)||(a.nameCarving=[]),a.nameCarving[t.param.index]={nameCrop:"",fontCode:t.fontCode[t.param.index],alphaText:t.alphaText[t.param.index]},t.$store.dispatch("setCustomInfo",JSON.stringify(a)),window.saveNameCanvas=t.saveNameCanvas,t.isrometime&&($(".alpha_text").each(function(e,a){var i=e+1,n=(new Date).getFullYear(),r={date:{preset:"date"},datetime:{preset:"datetime"},time:{preset:"time"}};r.default={theme:"android-ics light",display:"modal",mode:"scroller",dateFormat:"dd-mm-yyyy",lang:t.dateLang,showNow:!0,headerText:!1,startYear:n-50,endYear:n+10,yearText:t.yearText,monthText:t.monthText,dayText:t.dayText,setText:t.setText,cancelText:t.cancelText,nowText:t.nowText,onSelect:function(e,a){Ot.dispatchCustomEvent("EVENT_TIME_SELECT_AFTER",{index:t.param.index,data:e})}},jQuery("#ctext"+i).mobiscroll(jQuery.extend(r["date"],r["default"]))}),$(".alpha_text").bind("change",function(){var e=$(this).data("index"),a=parseInt(e)-1;Ot.nameObj[t.param.index].process($(this).val(),a,t.firstUpperCase),t.nameText[e]=Ot.nameObj[t.param.index].text[a].text,t.showText[e]=Ot.nameObj[t.param.index].text[a].showText,t.nameLeftNum[e]=parseInt(t.nameTextMaxLength[e])-t.nameText[e].length,$(this).val(Ot.nameObj[t.param.index].text[a].text),$("#showtext_"+e).html(0==Ot.nameObj[t.param.index].text[a].showText.indexOf("<")?Ot.nameObj[t.param.index].text[a].showText.replace(/</,"&lt;"):Ot.nameObj[t.param.index].text[a].showText),$("#leftnum"+e).html($(this).attr("maxlength")-Ot.nameObj[t.param.index].text[a].text.length<0?0:$(this).attr("maxlength")-Ot.nameObj[t.param.index].text[a].text.length)}))}},Xe=Ye,Je=(a("445d"),Object(Ft["a"])(Xe,Ve,He,!1,null,"2a26ad24",null)),Ge=Je.exports,Qe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"photo-box"},[a("div",{class:t.areaPhotoUploadClass},[a("div",{staticClass:"area-photo-upload-flex"},[this.flipCrop?a("img",{staticClass:"preview-thumbnail",attrs:{src:this.flipCrop,width:"50",height:"40"},on:{click:function(e){return t.openimage()}}}):t._e(),this.flipCrop?a("i",{staticClass:"show-img-icon",on:{click:function(e){return t.openimage()}}}):t._e(),this.flipCrop?t._e():a("span",{staticClass:"area-photo-upload-text"},[t._v(t._s(t.uploadLabel)),a("font",{attrs:{color:"red"}},[t._v("*")])],1)]),a("div",{staticClass:"area-photo-upload-flex"},[a("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":t.avatarUpload,accept:t.uploadAccept}},[a("button",{ref:"btnUpload",staticClass:"btn-upload-open",attrs:{type:"button"}},[t._v(t._s(this.btnUploadText))])])],1)]),a("el-dialog",{attrs:{title:"",visible:t.centerDialogVisible,width:t.dialogWidth,fullscreen:t.isFullscreen,"close-on-click-modal":t.isCloseOnClickModal,"modal-append-to-body":t.isModalAppendToBody,center:""},on:{"update:visible":function(e){t.centerDialogVisible=e},opened:t.onOpened}},[t.titleText?a("div",{staticClass:"title-box"},[t._v(t._s(t.titleText))]):t._e(),a("div",{ref:"photodesignbody",staticClass:"photo-design-body"}),a("div",{directives:[{name:"show",rawName:"v-show",value:t.toolShow,expression:"toolShow"}],staticClass:"photo-design-tool-bar"},[a("i",{staticClass:"el-icon-thirdzoomin photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("add")}}}),a("i",{staticClass:"el-icon-thirdzoomout photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("sub")}}}),a("i",{staticClass:"el-icon-thirdrotate-left photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("left")}}}),a("i",{staticClass:"el-icon-thirdrotate-right photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("right")}}}),a("i",{staticClass:"el-icon-thirdsync photo-design-tool-bar-icon",on:{click:function(e){return t.doAction("reset")}}})]),a("div",{staticClass:"crop-prompt photo-prompt",domProps:{innerHTML:t._s(t.cropPrompt)}}),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.uploadLoadingImage,expression:"!uploadLoadingImage"}],staticClass:"crop-progerss"},[a("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:t.percentage}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"photo-cancel-btn",on:{click:t.cancelCanvas}},[t._v(t._s(t.photoCancelText))]),a("el-button",{staticClass:"photo-confirm-btn",attrs:{type:"primary",loading:t.inLoading,disabled:t.photoLoad},on:{click:t.photoImage}},[t._v(t._s(t.photoConfirmText))])],1)]),t.inLoading&&t.uploadLoadingImage?a("div",{staticClass:"upload-loading-container-full"},[a("div",{staticClass:"loading-bg-overlay",style:"background:"+t.wrapperBackgroudColor+";opacity:"+t.bgOpacity}),a("div",{staticClass:"loading-img-box"},[a("img",{attrs:{src:t.uploadLoadingImage}})])]):t._e(),a("div",{ref:"preloadphotodesignbody",staticClass:"preloadphotodesignbody"},[a("div",{staticClass:"flip-canvas-container"},[a("canvas",{attrs:{id:t.photoCanvasId}}),a("canvas",{attrs:{id:t.flipPhotoCanvasId}})])])],1)},Ze=[],Ke={name:"FlipphotoDialog",props:["param"],data:function(){return{photoCanvasId:"photo-flip-canvas-"+this.param.index,flipPhotoCanvasId:"flip-photo-canvas-"+this.param.index,uploadLabel:Ot.flipPhoto[this.param.index].uploadLabel?Ot.flipPhoto[this.param.index].uploadLabel:Ot.uploadLabel?Ot.uploadLabel:"Upload your Photo",btnUploadText:Ot.btnUploadText?Ot.btnUploadText:"Upload",changeText:Ot.changeText?Ot.changeText:"Change",photoCancelText:Ot.photoCancelText?Ot.photoCancelText:"Cancel",photoConfirmText:Ot.photoConfirmText?Ot.photoConfirmText:"Confirm",areaPhotoUploadClass:"area-photo-upload area-photo-upload-"+this.param.index,titleText:this.param.data.titleText?this.param.data.titleText:"",inLoading:!1,photoBase64:"",cropPrompt:Ot.cropPrompt?Ot.cropPrompt:"",flipCrop:"",photoCrop:[],photoAi:[],photoOrigin:[],flipPhotoObj1:"",flipPhotoObj2:"",dialogWidth:this.$device.mobile?"100%":"40%",centerDialogVisible:!1,percentage:0,isFullscreen:!!this.$device.mobile,bgOpacity:Ot.bgOpacity?Ot.bgOpacity:.5,wrapperBackgroudColor:Ot.wrapperBackgroudColor?Ot.wrapperBackgroudColor:"#ffffff",uploadLoadingImage:Ot.uploadLoadingImage?Ot.uploadLoadingImage:"",require:!1!==this.param.data.require,photoLoad:!1,isCloseOnClickModal:!1!==Ot.isCloseOnClickModal,isModalAppendToBody:!1!==Ot.isModalAppendToBody,uploadAccept:Ot.uploadAccept?Ot.uploadAccept:"",dpi:this.param.data.dpi?this.param.data.dpi:72,coverPhoto:!0===Ot.coverPhoto,isLockRotate:!0===this.param.data.isLockRotate,toolShow:!1!==this.param.data.toolShow}},mounted:function(){var t=this;t.flipPhotoObj1=new Lt({canvasid:this.photoCanvasId,type:1,baseImg:this.param.data.basePhotoImg,sku:this.param.data.sku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:t.coverPhoto,isLockRotate:t.isLockRotate}),t.flipPhotoObj2=new Lt({canvasid:this.flipPhotoCanvasId,type:1,baseImg:this.param.data.flipBasePhotoImg,sku:this.param.data.flipSku,ainame:this.param.data.ainame?this.param.data.ainame:"",isAiLucid:this.param.data.isAiLucid?1:0,bgcolor:this.param.data.bgcolor?this.param.data.bgcolor:"",isAiColor:this.param.data.isAiColor?this.param.data.isAiColor:"",cWidth:this.param.data.cWidth?this.param.data.cWidth:500,cHeight:this.param.data.cHeight?this.param.data.cHeight:400,quality:this.param.data.quality,compressSize:this.param.data.compressSize,coverPhoto:t.coverPhoto,isLockRotate:t.isLockRotate,flipX:!0,selectable:!1});var e={};t.$store.getters.getCustomInfo&&(e=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(e.flipPhoto)||(e.flipPhoto=[]),e.flipPhoto[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",crop:"",origin:"",ai:"",flipAi:"",item:""},t.$store.dispatch("setCustomInfo",JSON.stringify(e)),window.changeFlipPhotoSku=this.changeFlipPhotoSku},methods:{cancelCanvas:function(){var t=this;t.centerDialogVisible=!1,Ot.dispatchCustomEvent("EVENT_FLIP_PHOTO_CANCEL_AFTER",{index:t.param.index})},avatarUpload:function(t){var e=this,a=this,i=new FileReader;i.onload=function(t){a.centerDialogVisible=!0,e.photoBase64=t.target.result;var i=e.photoBase64;a.flipPhotoObj1.change(a.flipPhotoObj1,i),a.flipPhotoObj2.change(a.flipPhotoObj2,i)},i.readAsDataURL(t.file)},onOpened:function(){var t=this;this.$refs.preloadphotodesignbody.style.display="block",this.$refs.photodesignbody.appendChild(this.$refs.preloadphotodesignbody),t.flipPhotoObj1.canvas.on("mouse:wheel",function(e){var a=e.target;a&&(t.getBs2().set({scaleX:a.scaleX,scaleY:a.scaleY}).setCoords(),t.flipPhotoObj2.canvas.renderAll())});var e=t.getBs().left;t.getBs().top;t.flipPhotoObj1.canvas.on("object:moving",function(a){var i=a.target;i&&(t.getBs2().set({left:e-(i.left-e),top:i.top}).setCoords(),t.flipPhotoObj2.canvas.renderAll())})},openimage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.flipCrop;this.$parent.openimage(t)},doAction:function(t){var e=this;"reset"==t?(this.getBs().set({left:e.flipPhotoObj1.canvas.width/2,top:e.flipPhotoObj1.canvas.height/2,angle:0,scaleX:e.flipPhotoObj1.scale,scaleY:e.flipPhotoObj1.scale}).setCoords(),this.getBs2().set({left:e.flipPhotoObj2.canvas.width/2,top:e.flipPhotoObj2.canvas.height/2,angle:0,scaleX:e.flipPhotoObj2.scale,scaleY:e.flipPhotoObj2.scale}).setCoords()):"left"==t?(this.getBs().set({angle:this.getBs().angle-45}).setCoords(),this.getBs2().set({angle:this.getBs2().angle+45}).setCoords()):"right"==t?(this.getBs().set({angle:this.getBs().angle+45}).setCoords(),this.getBs2().set({angle:this.getBs2().angle-45}).setCoords()):"sub"==t?(this.getBs().set({scaleX:this.getBs().scaleX-.01,scaleY:this.getBs().scaleY-.01}).setCoords(),this.getBs2().set({scaleX:this.getBs2().scaleX-.01,scaleY:this.getBs2().scaleY-.01}).setCoords()):"add"==t&&(this.getBs().set({scaleX:this.getBs().scaleX+.01,scaleY:this.getBs().scaleY+.01}).setCoords(),this.getBs2().set({scaleX:this.getBs2().scaleX+.01,scaleY:this.getBs2().scaleY+.01}).setCoords()),e.flipPhotoObj1.canvas.renderAll(),e.flipPhotoObj2.canvas.renderAll()},getBs:function(){return this.flipPhotoObj1.canvas.item(0)},getBs2:function(){return this.flipPhotoObj2.canvas.item(0)},photoImage:function(){var t=this;t.uploadLoadingImage&&(t.centerDialogVisible=!1),t.inLoading=!0;var e=t.flipPhotoObj1.request.originImage,a=t.getBs(),i=t.getBs2();Ot.awUpload({width:t.flipPhotoObj1.cWidth,height:t.flipPhotoObj1.cHeight,scaleX:a.scaleX*t.flipPhotoObj1.cWidth/t.flipPhotoObj1.width/t.flipPhotoObj1.request.scale,scaleY:a.scaleY*t.flipPhotoObj1.cWidth/t.flipPhotoObj1.width/t.flipPhotoObj1.request.scale,left:a.left*t.flipPhotoObj1.cWidth/t.flipPhotoObj1.width,top:a.top*t.flipPhotoObj1.cWidth/t.flipPhotoObj1.width,angle:a.angle,type:t.flipPhotoObj1.type,sku:t.flipPhotoObj1.sku,ainame:t.flipPhotoObj1.ainame||"",isAiLucid:t.flipPhotoObj1.isAiLucid||0,bgcolor:t.flipPhotoObj1.bgcolor||"",origin_data:e,isAiColor:t.flipPhotoObj1.isAiColor||"",isBgImg:t.isBgImg,dpi:t.dpi},function(a){void 0==a.crop?t.photoCrop[t.param.index]="":t.photoCrop.push(Ot.awcdn+a.crop),void 0==a.ai?t.photoAi[t.param.index]="":t.photoAi[t.param.index]=Ot.awcdn+a.ai,void 0==a.origin?t.photoOrigin[t.param.index]="":t.photoOrigin[t.param.index]=Ot.awcdn+a.origin;var n={};t.$store.getters.getCustomInfo&&(n=JSON.parse(t.$store.getters.getCustomInfo)),Array.isArray(n.flipPhoto)||(n.flipPhoto=[]),n.flipPhoto[t.param.index]={type:t.param.data.type?t.param.data.type:"",require:t.param.data.require?t.param.data.require:"",ai:t.photoAi[t.param.index],origin:t.photoOrigin[t.param.index]},Ot.awUpload({width:t.flipPhotoObj2.cWidth,height:t.flipPhotoObj2.cHeight,scaleX:i.scaleX*t.flipPhotoObj2.cWidth/t.flipPhotoObj2.width/t.flipPhotoObj2.request.scale,scaleY:i.scaleY*t.flipPhotoObj2.cWidth/t.flipPhotoObj2.width/t.flipPhotoObj2.request.scale,left:i.left*t.flipPhotoObj2.cWidth/t.flipPhotoObj2.width,top:i.top*t.flipPhotoObj2.cWidth/t.flipPhotoObj2.width,angle:i.angle,type:t.flipPhotoObj2.type,sku:t.flipPhotoObj2.sku,ainame:t.flipPhotoObj2.ainame||"",isAiLucid:t.flipPhotoObj2.isAiLucid||0,bgcolor:t.flipPhotoObj2.bgcolor||"",origin_data:e,isAiColor:t.flipPhotoObj2.isAiColor||"",isBgImg:t.isBgImg,dpi:t.dpi,flip:"x"},function(e){void 0==e.crop?t.photoCrop[t.param.index]="":t.photoCrop.push(Ot.awcdn+e.crop),void 0==e.ai?n.flipPhoto[t.param.index].flipAi="":n.flipPhoto[t.param.index].flipAi=Ot.awcdn+e.ai;var a=new fabric.Canvas,i=2*t.flipPhotoObj2.cWidth,r=[],o=0,s=t.flipPhotoObj2.cWidth,l=t.flipPhotoObj2.cHeight;a.setWidth(i).setHeight(l),t.photoCrop.forEach(function(t,e){var i=new Promise(function(e,i){fabric.Image.fromURL(t,function(t){t.scaleToHeight(l),a.add(t),a.renderAll(),e()}.bind(this),{crossOrigin:"anonymous",left:o})});r.push(i),o+=s});var c=new kt;Promise.all(r).then(function(){var e=Object(Se["a"])(regeneratorRuntime.mark(function e(i){var r,o,s;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:console.log(i,"1111"),r=a.toDataURL({format:"png",quality:.8}),o=Ot.convertBase64ToBlob(r),s="scrop/"+(new Date).Format("yyyyMMdd")+"/"+Ot.randomString(6),c.cdnAsyncUpload(function(e,a){var i=s+"-"+t.flipPhotoObj1.sku+".png",r={next:function(t){console.log("ok")},error:function(t){console.log(t.message)},complete:function(e){a(),t.flipCrop=Ot.qncdn+e.key,n.flipPhoto[t.param.index].crop=t.flipCrop,t.$store.dispatch("setCustomInfo",JSON.stringify(n)),t.centerDialogVisible=!1,t.inLoading=!1,t.percentage=0,t.btnUploadText=t.changeText,Ot.dispatchCustomEvent("EVENT_FLIP_PHOTO_SAVE_AFTER",{index:t.param.index,data:n})}},l=yt["upload"](o,i,e,kt.util.putExtra,kt.util.config);l.subscribe(r)});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},t)},t)}}},ta=Ke,ea=(a("fcc6"),Object(Ft["a"])(ta,Qe,Ze,!1,null,null,null)),aa=ea.exports,ia={name:"PhotoCarving",components:{PhotoDialog:Pt,CarvingDialog:Yt,CropDialog:ie,CrystalDialog:me,CurveCarvingDialog:Te,CrystalText:je,SelectDialog:Pe,PhotoCrystalDialog:qe,NameCarvingDialog:Ge,FlipPhotoDialog:aa},data:function(){return Object(ft["a"])({photoItems:Ot.photo,carvingItems:Ot.carving,cropItems:Ot.crop,crystalItems:Ot.crystal,curveCarvingItems:Ot.curveCarving,crystalTextItems:Ot.crystalText,photoCrystalItems:Ot.photoCrystal,nameCarvingItems:Ot.nameCarving,flipPhotoItems:Ot.flipPhoto,photoStyle:Ot.photo.style?Ot.photo.style:0,isLoading:!1,btnUploadText:"Upload",photoBase64:"",imgSrc:"",photoCrop:this.$store.getters.getPhotoCrop,photoAi:this.$store.getters.getPhotoAi,photoOrigin:this.$store.getters.getPhotoOrigin,cropType:1,previewText:"Add Engraving",dialogVisible:!1,centerDialogVisible:!1,info:"",w:"50px",h:"50px"},"btnUploadText","Add")},methods:{openimage:function(t){var e=this.$createElement;this.$msgbox({title:"",message:e("p",null,[e("img",{attrs:{src:t},style:"width: 95%; height: 95%;"})]),showConfirmButton:!1,center:!0,callback:function(){Ot.dispatchCustomEvent("EVENT_PREVIEW_DIALOG_CLOSE",{})}}),Ot.dispatchCustomEvent("EVENT_PREVIEW_DIALOG",{})}}},na=ia,ra=(a("a03d"),Object(Ft["a"])(na,ut,vt,!1,null,null,null)),oa=ra.exports,sa={name:"app",components:{PhotoCarving:oa}},la=sa,ca=Object(Ft["a"])(la,gt,mt,!1,null,null,null),da=ca.exports;n["default"].use(r["a"]),dt.a.use(lt.a),n["default"].use(ot),n["default"].use(pt.a),n["default"].config.productionTip=!1,n["default"].prototype.$ajax=Ct.a,new n["default"]({store:h,render:function(t){return t(da)}}).$mount("#zen-photocarving")},"641e":function(t,e,a){"use strict";var i=a("bdb0"),n=a.n(i);n.a},"69e3":function(t,e,a){},"72fe":function(t,e,a){"use strict";var i=a("b507"),n=a.n(i);n.a},"79f8":function(t,e,a){},"8d2a":function(t,e,a){},a03d:function(t,e,a){"use strict";var i=a("21b5"),n=a.n(i);n.a},ad94:function(t,e,a){"use strict";a.r(e);a("6b54");var i=a("7618");a("ac6a"),a("28a5"),a("a481"),a("55dd"),a("3b2b"),a("386d"),a("4917");(function(t){var e=t.mobiscroll,a=new Date,n={dateFormat:"mm/dd/yy",dateOrder:"mmddy",timeWheels:"hhiiA",timeFormat:"hh:ii A",startYear:a.getFullYear()-100,endYear:a.getFullYear()+1,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortYearCutoff:"+10",monthText:"Month",dayText:"Day",yearText:"Year",hourText:"Hours",minuteText:"Minutes",secText:"Seconds",ampmText:"&nbsp;",nowText:"Now",showNow:!1,stepHour:1,stepMinute:1,stepSecond:1,separator:" "},r=function(a){var i,r=t(this),o={};if(r.is("input")){switch(r.attr("type")){case"date":i="yy-mm-dd";break;case"datetime":i="yy-mm-ddTHH:ii:ssZ";break;case"datetime-local":i="yy-mm-ddTHH:ii:ss";break;case"month":i="yy-mm",o.dateOrder="mmyy";break;case"time":i="HH:ii:ss";break}var s=r.attr("min"),l=r.attr("max");s&&(o.minDate=e.parseDate(i,s)),l&&(o.maxDate=e.parseDate(i,l))}var c,d,h=t.extend({},n,o,a.settings),p=0,g=[],m=[],u={},v={y:"getFullYear",m:"getMonth",d:"getDate",h:D,i:z,s:$,a:M},f=h.preset,x=h.dateOrder,b=h.timeWheels,C=x.match(/D/),y=b.match(/a/i),w=b.match(/h/),T="datetime"==f?h.dateFormat+h.separator+h.timeFormat:"time"==f?h.timeFormat:h.dateFormat,O=new Date,I=h.stepHour,S=h.stepMinute,_=h.stepSecond,k=h.minDate||new Date(h.startYear,0,1),E=h.maxDate||new Date(h.endYear,11,31,23,59,59);if(a.settings=h,i=i||T,f.match(/date/i)){t.each(["y","m","d"],function(t,e){c=x.search(new RegExp(e,"i")),c>-1&&m.push({o:c,v:e})}),m.sort(function(t,e){return t.o>e.o?1:-1}),t.each(m,function(t,e){u[e.v]=t});var j={};for(d=0;d<3;d++)if(d==u.y){p++,j[h.yearText]={};var L=k.getFullYear(),A=E.getFullYear();for(c=L;c<=A;c++)j[h.yearText][c]=x.match(/yy/i)?c:(c+"").substr(2,2)}else if(d==u.m)for(p++,j[h.monthText]={},c=0;c<12;c++){var N=x.replace(/[dy]/gi,"").replace(/mm/,c<9?"0"+(c+1):c+1).replace(/m/,c+1);j[h.monthText][c]=N.match(/MM/)?N.replace(/MM/,'<span class="dw-mon">'+h.monthNames[c]+"</span>"):N.replace(/M/,'<span class="dw-mon">'+h.monthNamesShort[c]+"</span>")}else if(d==u.d)for(p++,j[h.dayText]={},c=1;c<32;c++)j[h.dayText][c]=x.match(/dd/i)&&c<10?"0"+c:c;g.push(j)}if(f.match(/time/i)){for(m=[],t.each(["h","i","s","a"],function(t,e){t=b.search(new RegExp(e,"i")),t>-1&&m.push({o:t,v:e})}),m.sort(function(t,e){return t.o>e.o?1:-1}),t.each(m,function(t,e){u[e.v]=p+t}),j={},d=p;d<p+4;d++)if(d==u.h)for(p++,j[h.hourText]={},c=0;c<(w?12:24);c+=I)j[h.hourText][c]=w&&0==c?12:b.match(/hh/i)&&c<10?"0"+c:c;else if(d==u.i)for(p++,j[h.minuteText]={},c=0;c<60;c+=S)j[h.minuteText][c]=b.match(/ii/)&&c<10?"0"+c:c;else if(d==u.s)for(p++,j[h.secText]={},c=0;c<60;c+=_)j[h.secText][c]=b.match(/ss/)&&c<10?"0"+c:c;else if(d==u.a){p++;var F=b.match(/A/);j[h.ampmText]={0:F?"AM":"am",1:F?"PM":"pm"}}g.push(j)}function B(t,e,a){return void 0!==u[e]?+t[u[e]]:void 0!==a?a:O[v[e]]?O[v[e]]():v[e](O)}function P(t,e){return Math.floor(t/e)*e}function D(t){var e=t.getHours();return e=w&&e>=12?e-12:e,P(e,I)}function z(t){return P(t.getMinutes(),S)}function $(t){return P(t.getSeconds(),_)}function M(t){return y&&t.getHours()>11?1:0}function W(t){var e=B(t,"h",0);return new Date(B(t,"y"),B(t,"m"),B(t,"d",1),B(t,"a")?e+12:e,B(t,"i",0),B(t,"s",0))}return a.setDate=function(t,e,a,i){var n;for(n in u)this.temp[u[n]]=t[v[n]]?t[v[n]]():v[n](t);this.setValue(!0,e,a,i)},a.getDate=function(t){return W(t)},{button3Text:h.showNow?h.nowText:void 0,button3:h.showNow?function(){a.setDate(new Date,!1,.3,!0)}:void 0,wheels:g,headerText:function(t){return e.formatDate(T,W(a.temp),h)},formatResult:function(t){return e.formatDate(i,W(t),h)},parseValue:function(t){var a,n=new Date,r=[];try{n=e.parseDate(i,t,h)}catch(o){}for(a in u)r[u[a]]=n[v[a]]?n[v[a]]():v[a](n);return r},validate:function(e,i){var n=a.temp,r={y:k.getFullYear(),m:0,d:1,h:0,i:0,s:0,a:0},o={y:E.getFullYear(),m:11,d:31,h:P(w?11:23,I),i:P(59,S),s:P(59,_),a:1},s=!0,l=!0;t.each(["y","m","d","a","h","i","s"],function(a,i){if(void 0!==u[i]){var c,d,p=r[i],g=o[i],m=31,f=B(n,i),b=t(".dw-ul",e).eq(u[i]);if("d"==i&&(c=B(n,"y"),d=B(n,"m"),m=32-new Date(c,d,32).getDate(),g=m,C&&t(".dw-li",b).each(function(){var e=t(this),a=e.data("val"),i=new Date(c,d,a).getDay(),n=x.replace(/[my]/gi,"").replace(/dd/,a<10?"0"+a:a).replace(/d/,a);t(".dw-i",e).html(n.match(/DD/)?n.replace(/DD/,'<span class="dw-day">'+h.dayNames[i]+"</span>"):n.replace(/D/,'<span class="dw-day">'+h.dayNamesShort[i]+"</span>"))})),s&&k&&(p=k[v[i]]?k[v[i]]():v[i](k)),l&&E&&(g=E[v[i]]?E[v[i]]():v[i](E)),"y"!=i){var y=t(".dw-li",b).index(t('.dw-li[data-val="'+p+'"]',b)),w=t(".dw-li",b).index(t('.dw-li[data-val="'+g+'"]',b));t(".dw-li",b).removeClass("dw-v").slice(y,w+1).addClass("dw-v"),"d"==i&&t(".dw-li",b).removeClass("dw-h").slice(m).addClass("dw-h")}if(f<p&&(f=p),f>g&&(f=g),s&&(s=f==p),l&&(l=f==g),h.invalid&&"d"==i){var T=[];if(h.invalid.dates&&t.each(h.invalid.dates,function(t,e){e.getFullYear()==c&&e.getMonth()==d&&T.push(e.getDate()-1)}),h.invalid.daysOfWeek){var O,I=new Date(c,d,1).getDay();t.each(h.invalid.daysOfWeek,function(t,e){for(O=e-I;O<m;O+=7)O>=0&&T.push(O)})}h.invalid.daysOfMonth&&t.each(h.invalid.daysOfMonth,function(t,e){e=(e+"").split("/"),e[1]?e[0]-1==d&&T.push(e[1]-1):T.push(e[0]-1)}),t.each(T,function(e,a){t(".dw-li",b).eq(a).removeClass("dw-v")})}n[u[i]]=f}})},methods:{getDate:function(e){var a=t(this).mobiscroll("getInst");if(a)return a.getDate(e?a.temp:a.values)},setDate:function(e,a,i,n){return void 0==a&&(a=!1),this.each(function(){var r=t(this).mobiscroll("getInst");r&&r.setDate(e,a,i,n)})}}}};t.each(["date","time","datetime"],function(t,a){e.presets[a]=r,e.presetShort(a)}),e.formatDate=function(e,a,i){if(!a)return null;var r,o=t.extend({},n,i),s=function(t){var a=0;while(r+1<e.length&&e.charAt(r+1)==t)a++,r++;return a},l=function(t,e,a){var i=""+e;if(s(t))while(i.length<a)i="0"+i;return i},c=function(t,e,a,i){return s(t)?i[e]:a[e]},d="",h=!1;for(r=0;r<e.length;r++)if(h)"'"!=e.charAt(r)||s("'")?d+=e.charAt(r):h=!1;else switch(e.charAt(r)){case"d":d+=l("d",a.getDate(),2);break;case"D":d+=c("D",a.getDay(),o.dayNamesShort,o.dayNames);break;case"o":d+=l("o",(a.getTime()-new Date(a.getFullYear(),0,0).getTime())/864e5,3);break;case"m":d+=l("m",a.getMonth()+1,2);break;case"M":d+=c("M",a.getMonth(),o.monthNamesShort,o.monthNames);break;case"y":d+=s("y")?a.getFullYear():(a.getYear()%100<10?"0":"")+a.getYear()%100;break;case"h":var p=a.getHours();d+=l("h",p>12?p-12:0==p?12:p,2);break;case"H":d+=l("H",a.getHours(),2);break;case"i":d+=l("i",a.getMinutes(),2);break;case"s":d+=l("s",a.getSeconds(),2);break;case"a":d+=a.getHours()>11?"pm":"am";break;case"A":d+=a.getHours()>11?"PM":"AM";break;case"'":s("'")?d+="'":h=!0;break;default:d+=e.charAt(r)}return d},e.parseDate=function(e,a,r){var o=new Date;if(!e||!a)return o;a="object"==Object(i["a"])(a)?a.toString():a+"";var s,l=t.extend({},n,r),c=l.shortYearCutoff,d=o.getFullYear(),h=o.getMonth()+1,p=o.getDate(),g=-1,m=o.getHours(),u=o.getMinutes(),v=0,f=-1,x=!1,b=function(t){var a=s+1<e.length&&e.charAt(s+1)==t;return a&&s++,a},C=function(t){b(t);var e="@"==t?14:"!"==t?20:"y"==t?4:"o"==t?3:2,i=new RegExp("^\\d{1,"+e+"}"),n=a.substr(T).match(i);return n?(T+=n[0].length,parseInt(n[0],10)):0},y=function(t,e,i){var n,r=b(t)?i:e;for(n=0;n<r.length;n++)if(a.substr(T,r[n].length).toLowerCase()==r[n].toLowerCase())return T+=r[n].length,n+1;return 0},w=function(){T++},T=0;for(s=0;s<e.length;s++)if(x)"'"!=e.charAt(s)||b("'")?w():x=!1;else switch(e.charAt(s)){case"d":p=C("d");break;case"D":y("D",l.dayNamesShort,l.dayNames);break;case"o":g=C("o");break;case"m":h=C("m");break;case"M":h=y("M",l.monthNamesShort,l.monthNames);break;case"y":d=C("y");break;case"H":m=C("H");break;case"h":m=C("h");break;case"i":u=C("i");break;case"s":v=C("s");break;case"a":f=y("a",["am","pm"],["am","pm"])-1;break;case"A":f=y("A",["am","pm"],["am","pm"])-1;break;case"'":b("'")?w():x=!0;break;default:w()}if(d<100&&(d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d<=("string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10))?0:-100)),g>-1){h=1,p=g;do{var O=32-new Date(d,h-1,32).getDate();if(p<=O)break;h++,p-=O}while(1)}m=-1==f?m:f&&m<12?m+12:f||12!=m?m:0;var I=new Date(d,h-1,p,m,u,v);if(I.getFullYear()!=d||I.getMonth()+1!=h||I.getDate()!=p)throw"Invalid date";return I}})(jQuery)},b36f:function(t,e,a){"use strict";var i=a("8d2a"),n=a.n(i);n.a},b507:function(t,e,a){},b9c1:function(t,e,a){},bdb0:function(t,e,a){},c19d:function(t,e,a){},e24f:function(t,e,a){"use strict";var i=a("54d7"),n=a.n(i);n.a},ed2c:function(t,e,a){},f49c:function(t,e,a){},fcc6:function(t,e,a){"use strict";var i=a("69e3"),n=a.n(i);n.a}});