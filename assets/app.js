(function(e){function t(t){for(var a,i,o=t[0],c=t[1],u=t[2],d=0,f=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&f.push(s[i][0]),s[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(f.length)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},s={app:0},r=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var a=n("8589"),s=n.n(a);s.a},1592:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("fe59"),n("053b"),n("fe8a"),n("08ba"),n("6a61");var a=n("cf7f"),s=n("1462"),r=n("a340"),i=n("ab5c"),o=(n("7db25"),n("5df4"),n("2d44")),c=n("8ca4"),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(s["a"])(this,e),this._body=JSON.parse(JSON.stringify(t)),this.token=i["a"].getSite().aiToken,this.url="https://api.wit.ai/message?v=20170307&q=",this.request={method:"GET",headers:{Authorization:"Bearer "+this.token}},this.failWitResult=!1,this.aiResult=n}return Object(r["a"])(e,null,[{key:"fetchAiResult",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=i["a"].getSite().aiToken,a="https://api.wit.ai/message?v=20170307&q=",s={method:"GET",headers:{Authorization:"Bearer "+n}},c["a"].info("MessengerAi::fetchAiResult req info",encodeURI(a+t),s),e.prev=2,e.next=5,Object(o["a"])(encodeURI(a+t),s);case 5:return r=e.sent,e.next=8,r.json();case 8:return r=e.sent,c["a"].info("MessengerAi::fetchAiResult Result",r),e.abrupt("return",r);case 13:return e.prev=13,e.t0=e["catch"](2),console.error("fetchAiResult:  AI FETCH ERROR",e.t0.message),e.abrupt("return",!1);case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));function t(t){return e.apply(this,arguments)}return t}()}]),Object(r["a"])(e,[{key:"setWit",value:function(e){var t={};this._wit={result:e,over:t},Object.keys(e.entities).forEach((function(n){var a=e.entities[n];a instanceof Array&&a.length>1&&a.sort((function(e,t){return e.confidence<t.confidence})),t[n]=a[0]}))}},{key:"match",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,a,s,r,u,l,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=this.allEntity,a=!1,s={},0!=this.aiResult){e.next=17;break}return e.prev=2,e.next=5,Object(o["a"])(encodeURI(this.url+t),this.request);case 5:return r=e.sent,e.next=8,r.json();case 8:r=e.sent,e.next=15;break;case 11:return e.prev=11,e.t0=e["catch"](2),console.error("AI FETCH ERROR"),e.abrupt("return",a);case 15:e.next=18;break;case 17:r=this.aiResult;case 18:if(this.failWitResult=!1,this.setWit(r),0==this.aiResult&&c["a"].debug("wit Result ",JSON.stringify(r,null,2)),!this.witIntent||this.witIntent.value!=this.intent){e.next=38;break}a={intent:{value:this.intent,confidence:this.witIntent.confidence},entity:{}},u=0;case 24:if(!(u<n.length)){e.next=35;break}if(l=n[u],d=this.witEntity[l.name],d&&(!l["value"]||l["value"]==d.value)){e.next=30;break}return this.failWitResult=r,e.abrupt("return",!1);case 30:a.entity[l.name]={value:d.value,confidence:d.confidence,type:d.type},s[l.name]=d.value;case 32:u++,e.next=24;break;case 35:a.witResult=r,s["intent"]=this.witIntent.value,i["a"].setAiVariable(s);case 38:return!1===a&&(this.failWitResult=r),e.abrupt("return",a);case 40:case"end":return e.stop()}}),e,this,[[2,11]])})));function t(t){return e.apply(this,arguments)}return t}()},{key:"intent",get:function(){return this._body.intent}},{key:"allEntity",get:function(){return this._body.entity?this._body.entity:[]}},{key:"witIntent",get:function(){return this._wit.over.intent}},{key:"witEntity",get:function(){return this._wit.over}}]),e}()},"183b":function(e,t,n){},"2b95":function(e,t,n){"use strict";var a=n("183b"),s=n.n(a);s.a},"56d7":function(e,t,n){"use strict";n.r(t);n("ecb4"),n("77ad"),n("e35a"),n("5e9f"),n("a133"),n("ed0d"),n("f09c"),n("e117");var a=n("0261"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-body"},[e.loaded?[n("header",{staticClass:"header"},[n("div",{staticClass:"header-content"},[n("div",{staticClass:"logo"},[n("img",{attrs:{src:e.cfgvar.logo,width:"120/"}}),n("span",{staticClass:"logo_label"},[e._v(e._s(e.config.locales.support))])]),n("ul",{staticClass:"main-menu"},[n("li",{staticClass:"active"},[n("a",{attrs:{href:"#"}},[e._v(e._s(e.config.locales.customerService))])]),n("li",{},[n("a",{attrs:{href:e.cfgvar.linkFaq,target:"_blank"}},[e._v(e._s(e.config.locales.faq))])])])])]),n("div",{staticClass:"body"},[n("main",{staticClass:"content"},[n("router-view")],1),n("nav",{staticClass:"nav"}),n("aside",{staticClass:"ads"})]),n("footer",{staticClass:"footer"},[n("span",[e._v(e._s(e.config.locales.footerCopyright.replace("#{year}#",e.year)))]),n("span",[e._v(e._s(e.config.locales.footerSupport))])])]:n("div",{staticClass:"body"},[n("div",{staticClass:"loading"},e._l(e.mywindow.ChatConfig.locales.loading,(function(t,a){return n("div",{key:a},[e._v(e._s(t))])})),0)])],2)},r=[],i=n("e793"),o=n("9f3a"),c=void 0,u={name:"App",data:function(){return{logo:null,linkFaq:null,brandName:null}},computed:Object(i["a"])({year:function(){return(new Date).getFullYear()},footerCopyright:function(){return ChatConfig.locales.footerCopyright.replace("#{year}#",c.year)}},Object(o["b"])(["config","cfgvar","loaded"])),created:function(){}},l=u,d=(n("034f"),n("9ca4")),f=Object(d["a"])(l,s,r,!1,null,null,null),g=f.exports,p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"main-body"})},y=[],h=(n("9f48"),{}),b=Object(d["a"])(h,p,y,!1,null,null,null),v=(b.exports,n("3491")),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"chatbox-main"},[n("div",{staticClass:"chatbox-header"},[n("div",{staticClass:"boxheader-in-pc",staticStyle:{width:"100%","justify-content":"space-between"}},[n("div",{staticStyle:{display:"flex"}},[n("img",{staticStyle:{width:"55px",height:"55px"},attrs:{src:e.cfgvar.chatLogo}}),n("ul",[n("li",{staticStyle:{"text-transform":"uppercase"}},[e._v(e._s(e.cfgvar.brandName))]),n("li",[e._v(" "+e._s(e.config.locales.customerSupport)+" ")])])]),n("div",[n("span",{staticStyle:{"line-height":"55px",cursor:"pointer"},on:{click:e.backPageHander}},[e._v(e._s(e.config.locales.goBack))])])]),n("div",{staticClass:"boxheader-in-mobile"},[n("div",{staticStyle:{"font-size":"12px","line-height":"22px"},on:{click:e.backPageHander}},[e._v(" < "+e._s(e.config.locales.goBack))]),n("div",{staticStyle:{width:"calc(100vw - 110px)","text-align":"center"}},[n("span",[e._v(e._s(e.config.locales.customerSupport))])])])]),n("div",{ref:"chatboxContent",staticClass:"chatbox-content"},[e._l(e.messageList,(function(t,a){return[!0===t.sysMsg&&"contactUs"==t.widgetType?n("sysContactUs",{key:a+"_"+t.key,attrs:{contactUs:t.contactUs}}):n("messageWrap",{key:a+"_"+t.key,attrs:{senderType:t.senderType,icon:t.icon,postback:t.postback,waiting:t.waiting,evaluate:t.evaluate},on:{postback:e.sendPostback}},["text"==t.widgetType?n("messageText",{attrs:{message:t.message}}):"listOrder"==t.widgetType||"listOrderOfShopify"==t.widgetType?n("messageOrderList",{attrs:{orderListType:t.widgetType,message:t.message}}):e._e()],1)]}))],2),n("div",{staticClass:"chatbox-footer"},[n("div",{staticClass:"chatbox-footer-quick_item"},[n("ul",[e._l(e.quickPostback,(function(t,a){return["weburl"==t.type?n("li",{key:a+t.id},[n("a",{staticStyle:{"text-decoration":"none",color:"#000"},attrs:{href:t.payload,target:"_blank"}},[e._v(e._s(t.title))])]):n("li",{key:a+t.id,on:{click:function(t){return e.quickPostbackClick(a)}}},[e._v(" "+e._s(t.title)+" ")])]}))],2)]),n("div",{staticClass:"sendbox"},[n("div",{staticClass:"InputAddOn"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.userSay,expression:"userSay"}],staticClass:"InputAddOn-field",attrs:{placeholder:e.config.locales.typeYourMessageHere},domProps:{value:e.userSay},on:{blur:function(t){return e.scrollMoveToBottom("blur")},focus:function(t){return e.scrollMoveToBottom("focus")},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendText(t)},input:function(t){t.target.composing||(e.userSay=t.target.value)}}}),n("button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"InputAddOn-item",on:{click:e.sendText}},[n("i",{staticClass:"fas fa-paper-plane"})]),n("button",{staticClass:"InputAddOn-item",on:{click:e.sendText}},[n("div",{staticStyle:{color:"#444",width:"1em",height:"1em"}},[n("svg",{staticClass:"svg-inline--fa fa-paper-plane fa-w-16 fa-3x",attrs:{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"paper-plane",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{fill:"currentColor",d:"M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"}})])])])])])])])},k=[],_=(n("ea69"),n("513c"),n("e18c"),n("1c2e"),n("f4e3"),n("b032"),n("6a61"),n("cf7f")),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:e.dialogueCssClass},[n("div",{},[n("img",{staticClass:"avatar",attrs:{src:e.icon}})]),n("div",{staticClass:"dialogue_item-body"},[n("div",{staticClass:"msg_content"},[e._m(0),e._t("default")],2),e.postback.length>0?n("ul",{staticClass:"postback"},e._l(e.postback,(function(t,a){return n("li",{key:a},["weburl"==t.type?n("a",{attrs:{href:t.payload,target:"_blank"}},[e._v(" "+e._s(t.title)+" ")]):n("a",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.postbackClick(a)}}},[e._v(" "+e._s(t.title))])])})),0):e._e(),null!=e.evaluate?n("div",{staticClass:"evaluate-body"},[n("i",{ref:"eval_good",class:e.evalGoodCssClass,staticStyle:{width:"1em",height:"1em"},on:{click:function(t){return e.evaluate_click(!0)}}},[n("svg",{staticClass:"svg-inline--fa fa-thumbs-up fa-w-16 fa-3x",attrs:{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"thumbs-up",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{fill:"currentColor",d:"M104 224H24c-13.255 0-24 10.745-24 24v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V248c0-13.255-10.745-24-24-24zM64 472c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zM384 81.452c0 42.416-25.97 66.208-33.277 94.548h101.723c33.397 0 59.397 27.746 59.553 58.098.084 17.938-7.546 37.249-19.439 49.197l-.11.11c9.836 23.337 8.237 56.037-9.308 79.469 8.681 25.895-.069 57.704-16.382 74.757 4.298 17.598 2.244 32.575-6.148 44.632C440.202 511.587 389.616 512 346.839 512l-2.845-.001c-48.287-.017-87.806-17.598-119.56-31.725-15.957-7.099-36.821-15.887-52.651-16.178-6.54-.12-11.783-5.457-11.783-11.998v-213.77c0-3.2 1.282-6.271 3.558-8.521 39.614-39.144 56.648-80.587 89.117-113.111 14.804-14.832 20.188-37.236 25.393-58.902C282.515 39.293 291.817 0 312 0c24 0 72 8 72 81.452z"}})])]),n("i",{ref:"eval_bad",class:e.evalBadCssClass,staticStyle:{width:"1em",height:"1em"},on:{click:function(t){return e.evaluate_click(!1)}}},[n("svg",{staticClass:"svg-inline--fa fa-thumbs-down fa-w-16 fa-3x",attrs:{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"thumbs-down",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"}},[n("path",{attrs:{fill:"currentColor",d:"M0 56v240c0 13.255 10.745 24 24 24h80c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H24C10.745 32 0 42.745 0 56zm40 200c0-13.255 10.745-24 24-24s24 10.745 24 24-10.745 24-24 24-24-10.745-24-24zm272 256c-20.183 0-29.485-39.293-33.931-57.795-5.206-21.666-10.589-44.07-25.393-58.902-32.469-32.524-49.503-73.967-89.117-113.111a11.98 11.98 0 0 1-3.558-8.521V59.901c0-6.541 5.243-11.878 11.783-11.998 15.831-.29 36.694-9.079 52.651-16.178C256.189 17.598 295.709.017 343.995 0h2.844c42.777 0 93.363.413 113.774 29.737 8.392 12.057 10.446 27.034 6.148 44.632 16.312 17.053 25.063 48.863 16.382 74.757 17.544 23.432 19.143 56.132 9.308 79.469l.11.11c11.893 11.949 19.523 31.259 19.439 49.197-.156 30.352-26.157 58.098-59.553 58.098H350.723C358.03 364.34 384 388.132 384 430.548 384 504 336 512 312 512z"}})])])]):e._e()])])},x=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"la-ball-pulse"},[n("div"),e._v(" "),n("div"),e._v(" "),n("div")])}],C=(n("fe59"),n("fe8a"),n("08ba"),n("ce3c")),O=(n("2eeb"),n("17842"),n("84c2"),n("f7f9")),S=n("1462"),M=n("a340"),A=n("bb06"),R=n("9691"),T=n("dfff"),j=n.n(T),U=function(e){return e.replace(/[^a-zA-Z0-9]+/g,"").toUpperCase()},I=U,E=function(e){Object(A["a"])(n,e);var t=Object(R["a"])(n);function n(e,a){var s;if(Object(S["a"])(this,n),s=t.call(this),!e||!a)throw new Error("You need to specify a BootBot instance and a userId");return s.bot=e,s.userId=a,s}return Object(M["a"])(n,[{key:"say",value:function(e,t){return this.bot.say(this.userId,e,t)}},{key:"sendTextMessage",value:function(e,t,n){return this.bot.sendTextMessage(this.userId,e,t,n)}},{key:"sendButtonTemplate",value:function(e,t,n){return this.bot.sendButtonTemplate(this.userId,e,t,n)}},{key:"sendGenericTemplate",value:function(e,t){return this.bot.sendGenericTemplate(this.userId,e,t)}},{key:"sendListTemplate",value:function(e,t,n){return this.bot.sendListTemplate(this.userId,e,t,n)}},{key:"sendTemplate",value:function(e,t){return this.bot.sendTemplate(this.userId,e,t)}},{key:"sendAttachment",value:function(e,t,n,a){return this.bot.sendAttachment(this.userId,e,t,n,a)}},{key:"sendMessage",value:function(e,t){return this.bot.sendMessage(this.userId,e,t)}},{key:"sendRequest",value:function(e,t,n){return this.bot.sendRequest(e,t,n)}},{key:"conversation",value:function(e){return this.bot.conversation(this.userId,e)}},{key:"conversationContext",value:function(e,t){return this.bot.conversationContext(this.userId,e,t)}},{key:"sendAction",value:function(e){this.bot.sendAction(this.userId,e)}}]),n}(j.a),q=E,N=(n("b4fb"),n("dbb3"),n("4194"),function(e,t){for(var n=Array.isArray(t)?t:[t],a=0;a<n.length;a+=1){var s=n[a];if("string"===typeof s&&s.toLowerCase()===e.toLowerCase())return{keyword:s};if(s instanceof RegExp&&s.test(e))return{keyword:s,match:e.match(s)}}return!1}),L=N,B=function(e){Object(A["a"])(n,e);var t=Object(R["a"])(n);function n(e,a){var s;return Object(S["a"])(this,n),s=t.call(this,e,a),s.bot=e,s.userId=a,s.context={},s.waitingForAnswer=!1,s.start(),s}return Object(M["a"])(n,[{key:"isActive",value:function(){return this.active}},{key:"isWaitingForAnswer",value:function(){return this.waitingForAnswer}},{key:"stopWaitingForAnswer",value:function(){this.waitingForAnswer=!1,this.listeningCallbacks=[]}},{key:"respond",value:function(e,t){if(this.isWaitingForAnswer()){if("postback"===t.type||"quick_reply"===t.type){var n="postback"===t.type?e.postback.payload:e.message.quick_reply.payload,a=this.listeningCallbacks.find((function(e){return e.event==="".concat(t.type,":").concat(n)}));if(a&&"function"===typeof a.callback)return this.stopWaitingForAnswer(),a.callback.apply(this,[e,this,t]);var s=this.listeningCallbacks.find((function(e){return e.event===t.type}));if(s&&"function"===typeof s.callback)return this.stopWaitingForAnswer(),s.callback.apply(this,[e,this,t])}if("attachment"===t.type){var r=this.listeningCallbacks.find((function(e){return"attachment"===e.event}));if(r&&"function"===typeof r.callback)return this.stopWaitingForAnswer(),r.callback.apply(this,[e,this,t])}var i=this.listeningCallbacks.filter((function(e){return void 0!==e.pattern}));if("message"===t.type&&i.length>0)for(var o=0;o<i.length;o+=1){var c=L(e.message.text,i[o].pattern);if(!1!==c)return this.stopWaitingForAnswer(),t.keyword=c.keyword,c.match&&(t.match=c.match),i[o].callback.apply(this,[e,this,t])}if("message"===t.type&&e.message.quick_reply&&e.message.quick_reply.payload){var u=this.listeningCallbacks.find((function(t){return"quick_reply"===t.event||t.event==="quick_reply:".concat(e.message.quick_reply.payload)}));if(u&&"function"===typeof u.callback)return}if("quick_reply"!==t.type){if(this.listeningAnswer&&"function"===typeof this.listeningAnswer){var l=this.listeningAnswer;return this.listeningAnswer=null,l.apply(this,[e,this,t]),this}return this.end()}}}},{key:"ask",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e&&t&&"function"===typeof t?("function"===typeof e?e.apply(this,[this]):this.say(e,a),this.waitingForAnswer=!0,this.listeningAnswer=t,this.listeningCallbacks=Array.isArray(n)?n:n?[n]:[],this):console.error("You need to specify a question and answer to ask")}},{key:"start",value:function(){return this.active=!0,this.emit("start",this),this}},{key:"end",value:function(){return this.active=!1,this.emit("end",this),this}},{key:"get",value:function(e){return this.context[e]}},{key:"set",value:function(e,t){return this.context[e]=t,this.context[e]}}]),n}(q),$=B;try{window.setImmediate||(window.setImmediate=function(e,t){return window.setTimeout(e,0,t)},window.clearImmediate=window.clearTimeout)}catch(ct){var P="\n================================================================\n";console.error(P+"=== Not running in the browser! Use setImmdiate of node.js! ==="+P)}var V=function(e){Object(A["a"])(n,e);var t=Object(R["a"])(n);function n(e){var a;return Object(S["a"])(this,n),a=t.call(this),a._hearMap=[],a._conversations=[],a}return Object(M["a"])(n,[{key:"sendTextMessage",value:function(e,t,n,a){var s={text:t},r=this._formatQuickReplies(n);return r&&r.length>0&&(s.quick_replies=r),this.sendMessage(e,s,a)}},{key:"sendAttachment",value:function(e,t,n,a,s){var r={attachment:{type:t,payload:{url:n}}},i=this._formatQuickReplies(a);return i&&i.length>0&&(r.quick_replies=i),this.sendMessage(e,r,s)}},{key:"sendButtonTemplate",value:function(e,t,n,a){var s={template_type:"button",text:t},r=this._formatButtons(n);return s.buttons=r,this.sendTemplate(e,s,a)}},{key:"sendListTemplate",value:function(e,t,n,a){var s={template_type:"list",elements:t};return a&&a.topElementStyle&&(s.top_element_style=a.topElementStyle)&&delete a.topElementStyle,n&&n.length&&(s.buttons=this._formatButtons([n[0]])),this.sendTemplate(e,s,a)}},{key:"sendGenericTemplate",value:function(e,t,n){var a={template_type:"generic",elements:t};return n&&n.imageAspectRatio&&(a.image_aspect_ratio=n.imageAspectRatio)&&delete n.imageAspectRatio,this.sendTemplate(e,a,n)}},{key:"sendTemplate",value:function(e,t,n){var a={attachment:{type:"template",payload:t}};return this.sendMessage(e,a,n)}},{key:"_createRecipient",value:function(e){return"object"===Object(O["a"])(e)?e:{id:e}}},{key:"sendMessage",value:function(e,t,n){var a=this._createRecipient(e),s=n&&n.messagingType,r=n&&n.tag,i=n&&n.onDelivery,o=n&&n.onRead,c=n&&n.evaluate,u=n&&n.contactUs,l=n&&n.uiId,d={recipient:a,message:t,messaging_type:s||"RESPONSE"};return r&&(d.tag=r),c&&(d.evaluate=c),u&&(d.contactUs=u),l&&(d.uiId=l),"function"===typeof i&&this.once("delivery",i),"function"===typeof o&&this.once("read",o),this.sendRequest(d)}},{key:"sendRequest",value:function(e){var t=this,n=new Promise((function(n,a){setImmediate((function(){t.emit("response",e),n(!0)}))}));return n}},{key:"messageAppendOptions",value:function(e,t){e.evaluate&&(t.evaluate=e.evaluate),e.contactUs&&(t.contactUs=e.contactUs)}},{key:"say",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.messageAppendOptions(t,a),"string"===typeof t?this.sendTextMessage(e,t,[],a):t&&t.text?t.quickReplies&&t.quickReplies.length>0?this.sendTextMessage(e,t.text,t.quickReplies,a):t.buttons&&t.buttons.length>0?this.sendButtonTemplate(e,t.text,t.buttons,a):this.sendTextMessage(e,t.text,[],a):t&&t.attachment?this.sendAttachment(e,t.attachment,t.url,t.quickReplies,a):t&&t.elements&&t.buttons?this.sendListTemplate(e,t.elements,t.buttons,a):t&&t.cards?this.sendGenericTemplate(e,t.cards,a):Array.isArray(t)?t.reduce((function(t,s){return t.then((function(){return n.say(e,s,a)}))}),Promise.resolve()):void console.error("Invalid format for .say() message.")}},{key:"hear",value:function(e,t){var n=this;return e=Array.isArray(e)?e:[e],e.forEach((function(e){return n._hearMap.push({keyword:e,callback:t})})),this}},{key:"module",value:function(e){return e.apply(this,[this])}},{key:"_formatButtons",value:function(e){return e&&e.map((function(e){return"string"===typeof e?{type:"postback",title:e,payload:"BOOTBOT_BUTTON_"+I(e)}:e&&e.type?e:{}}))}},{key:"_formatQuickReplies",value:function(e){return e&&e.map((function(e){return"string"===typeof e?{content_type:"text",title:e,payload:"BOOTBOT_QR_"+I(e)}:e&&e.title?Object.assign({content_type:"text",payload:"BOOTBOT_QR_"+I(e.title)},e):e}))}},{key:"sendAction",value:function(e,t){this.emit(t)}},{key:"handelRequest",value:function(e){var t=this;e.entry.forEach((function(e){e.messaging.forEach((function(e){e.message&&e.message.text?(t._handleMessageEvent(e),e.message.quick_reply&&t._handleQuickReplyEvent(e)):e.message&&e.message.attachments?t._handleAttachmentEvent(e):e.postback?t._handlePostbackEvent(e):e.delivery?t._handleEvent("delivery",e):e.read?t._handleEvent("read",e):console.log("Webhook received unknown event: ",e)}))}))}},{key:"conversation",value:function(e,t){var n=this;if(!e||!t||"function"!==typeof t)return console.error("You need to specify a recipient and a callback to start a conversation");var a=new $(this,e);return this._conversations.push(a),a.on("end",(function(e){var t=n._conversations.indexOf(e);n._conversations.splice(t,1)})),t.apply(this,[a]),a}},{key:"conversationContext",value:function(e,t,n){var a=this;if(!e||!t||"function"!==typeof t||!n)return console.error("You need to specify a recipient and a callback and askAnswers to start a conversation");var s=new $(this,e);return this._conversations.push(s),s.on("end",(function(e){var t=a._conversations.indexOf(e);a._conversations.splice(t,1)})),t.apply(this,[s,n]),s}},{key:"_handleEvent",value:function(e,t,n){var a=t.sender.id,s=new q(this,a);this.emit(e,t,s,n)}},{key:"_handleMessageEvent",value:function(e){var t=this;if(!this._handleConversationResponse("message",e)){var n=e.message.text,a=e.sender.id,s=!1;n&&(this._hearMap.forEach((function(r){if("string"===typeof r.keyword&&r.keyword.toLowerCase()===n.toLowerCase()){var i=r.callback.apply(t,[e,new q(t,a),{keyword:r.keyword,captured:s}]);return s=!0,i}if(r.keyword instanceof RegExp&&r.keyword.test(n)){var o=r.callback.apply(t,[e,new q(t,a),{keyword:r.keyword,match:n.match(r.keyword),captured:s}]);return s=!0,o}})),this._handleEvent("message",e,{captured:s}))}}},{key:"_handleQuickReplyEvent",value:function(e){if(!this._handleConversationResponse("quick_reply",e)){var t=e.message.quick_reply&&e.message.quick_reply.payload;t&&this._handleEvent("quick_reply:".concat(t),e),this._handleEvent("quick_reply",e)}}},{key:"_handlePostbackEvent",value:function(e){if(!this._handleConversationResponse("postback",e)){var t=e.postback.payload;t&&this._handleEvent("postback:".concat(t),e),this._handleEvent("postback",e)}}},{key:"_handleAttachmentEvent",value:function(e){this._handleConversationResponse("attachment",e)||this._handleEvent("attachment",e)}},{key:"_handleConversationResponse",value:function(e,t){var n=t.sender.id,a=!1;return this._conversations.forEach((function(s){if(n&&n===s.userId&&s.isActive())return a=!0,s.respond(t,{type:e})})),a}}]),n}(j.a),J=V,D=n("ab5c"),W=n("74f8"),F=n("1592"),H=n("8ca4"),K=new J;function G(e,t){H["a"].debug("================doNotify action is RUN================="),H["a"].debug(JSON.stringify(e,null,4),JSON.stringify(t,null,4)),H["a"].debug("================doNotify action is END================="),D["a"].sysChatLog(t)}function z(e,t){D["a"].sysChatLog({type:"not_match_"+e,userSayData:t})}function Q(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t?"good":"bad";n={result:n},D["a"].sysChatLog({type:"evaluate_"+e.type,userSayData:n,target_id:e.refId,target_body:e})}function Y(e){D["a"].sysChatLog({type:"contact_us_"+e.type,target_id:e.refId,target_body:e})}function Z(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"context",s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"success",i={};"context"==a?(i={type:a,uid:t.uid,target_id:t.id,target_body:t.body,userSay:e},null!=n&&(i.userSayData=n),G(t.notify,i)):(i={type:"context_askanswer",uid:t.uid,result:r,target_id:t.id,target_body:t.body,answer_variable:s,userSay:e},null!=n&&(i.userSayData=n),G(t.notify,i))}function X(e,t,n){var a=ee(e.type,t);return"ask answer fial"!=a&&a}function ee(e,t){var n;return n="message"==e&&t.message?t.message.text:"quick_reply"==e&&t.message.quick_reply?t.message.quick_reply.payload:!!t.postback&&t.postback.payload,n}function te(e,t){var n;return n="message"==e&&t.message?Object.assign({},t.message):!!t.postback&&Object.assign({},t.postback),!1!==n&&(n.id=t.id),n}function ne(e){var t={},n=["_askAnswers","_context","_userSay"];return Object.keys(e.context).forEach((function(a){-1==n.indexOf(a)&&(t[a]=e.context[a])})),t}function ae(e,t,n){var a,s,r,i,o=t.get("_askAnswers"),c=t.get("_context"),u=t.get("_userSay"),l=t.get("_userSayData"),d={uiId:e.id},f=!1;if(o.length<0)t.end();else if(r=o.shift(),o.length>0&&(f=o[0]),i=X(n,e,r),!1===i)s=ee(n.type,e),t.set(r.answerVariableName,s),a=ne(t),D["a"].setConvoVariable(a),t.say(r.failAsk.message,d),Z(u,c,l,"context_askanswer",a,"fail"),t.end();else if(t.set(r.answerVariableName,i),a=ne(t),D["a"].setConvoVariable(a),!1!==f){var g=f.hitAsk.message;t.ask(g,ae,null,d)}else{if(c.replyMsg){var p=c.replyMsg.message;t.say(p,d)}Z(u,c,l,"context_askanswer",a),t.end()}}function se(e,t){var n=Object.assign([],t.askAnswers);e.set("_context",t.context),e.set("_askAnswers",n),e.set("_userSay",t.userSay),e.set("_userSayData",t.userSayData);var a=n[0];e.ask(a.hitAsk.message,ae,null,{uiId:t.uiId})}function re(e,t,n){var a=/^_sys_replyMessage_(\d+)$/;if(a.test(t)){t=t.match(a);var s=D["a"].getReplyMessage(t[1]);return!!s&&(e.say(s.message,{uiId:n.id}),G(s.notify,{type:"reply_message",uid:s.uid,target_id:s.id,target_body:s.message,userSay:t[0],userSayData:n}),!0)}return!1}function ie(e,t,n){return oe.apply(this,arguments)}function oe(){return oe=Object(_["a"])(regeneratorRuntime.mark((function e(t,n,a){var s,r,i,o,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=/^_sys_Action_(\d+)$/,!s.test(n)){e.next=26;break}if(n=n.match(s),r=D["a"].getAction(n[1]),!r||"message"!=r.requestType){e.next=16;break}return e.next=7,r.send();case 7:return i=e.sent,o=Object.assign({id:0,siteId:D["a"].getSite().id,actionId:r.id},i.result),H["a"].debug("replySysAction-RESULT: ",JSON.stringify(i,null,2)),c=new W["a"](o),t.say(c.message,{uiId:a.id}),G(c.notify,{type:"action_message",uid:c.uid,target_id:r.id,target_body:i.request,message_body:c.message,userSay:n[0],userSayData:a}),e.abrupt("return",!0);case 16:if(!r||"outside"!=r.requestType){e.next=25;break}return e.next=19,r.send();case 19:return u=e.sent,t.say("_sys_Action_outside_"+r.id,{uiId:a.id}),G(Object(C["a"])({action:!1},"action",null),{type:"action_outside",target_id:r.id,target_body:u,userSay:n[0],userSayData:a}),e.abrupt("return",!0);case 25:return e.abrupt("return",!1);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}function ce(e,t){return ue.apply(this,arguments)}function ue(){return ue=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=!1,"ai"!=n.filterUserSay[0].type){e.next=5;break}return e.next=4,F["a"].fetchAiResult(t);case 4:a=e.sent;case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),ue.apply(this,arguments)}function le(e,t,n,a){return de.apply(this,arguments)}function de(){return de=Object(_["a"])(regeneratorRuntime.mark((function e(t,n,a,s){var r,i,o,c,u,l,d,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=D["a"].getContext(),u=!1,i=ee(t,n),o=te(t,n),!1!==i){e.next=5;break}return e.abrupt("return");case 5:if(D["a"].setVariable("_curUserSay",i),null==D["a"].getVariable("_preUserSay")&&D["a"].setVariable("_preUserSay",""),l=!1,!re(a,i,o)){e.next=12;break}l=!0,e.next=16;break;case 12:return e.next=14,ie(a,i,o);case 14:if(!e.sent){e.next=16;break}l=!0;case 16:if(!l){e.next=19;break}return D["a"].setVariable("_preUserSay",i),e.abrupt("return",!0);case 19:d=!1,f=0;case 21:if(!(f<r.length)){e.next=36;break}if(c=r[f],"ai"!=c.filterUserSayType||!1!==d){e.next=27;break}return e.next=26,ce(i,c);case 26:d=e.sent;case 27:return H["a"].debug("runContext-context",c.id,c.title),e.next=30,c.hearUserSay(i,d);case 30:if(u=e.sent,!1===u){e.next=33;break}return e.abrupt("break",36);case 33:f++,e.next=21;break;case 36:return!1!==u&&(c.askAnswer&&c.askAnswer.length>0?a.conversationContext(se,{uiId:o.id,userSay:i,context:c,askAnswers:c.askAnswer,userSayData:o}):(a.say(c.replyMsg.message,{uiId:o.id}),Z(i,c,o))),D["a"].setVariable("_preUserSay",i),e.abrupt("return",u);case 39:case"end":return e.stop()}}),e)}))),de.apply(this,arguments)}K.on("message",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(1!=a.captured){e.next=3;break}return H["a"].debug("message: captured == true -> return"),e.abrupt("return");case 3:if(!t.message.quick_reply){e.next=6;break}return H["a"].debug("message: is quick_reply -> return"),e.abrupt("return");case 6:return H["a"].debug("on-message",t),e.next=9,le("message",t,n,a);case 9:s=e.sent,!1===s&&(we("typing_off",{match:!1,uiId:t.id,userSay:t}),z("message",t));case 11:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}()),K.on("quick_reply",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,le("quick_reply",t,n);case 2:a=e.sent,!1===a&&(we("typing_off",{match:!1,uiId:t.id,userSay:t}),z("quick_reply",t));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),K.on("postback",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,le("postback",t,n);case 2:a=e.sent,!1===a&&(we("typing_off",{match:!1,uiId:t.id,userSay:t}),z("postback",t));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),K.on("attachment",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,le("attachment",t,n);case 2:a=e.sent,!1===a&&(we("typing_off",{match:!1,uiId:t.id,userSay:t}),z("attachment",t));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),K.on("response",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:we("typing_off",{match:!0,uiId:t.uiId}),we("response",t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),K.on("typing_on",Object(_["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:H["a"].debug("typing_on");case 1:case"end":return e.stop()}}),e)})))),K.on("typing_off",Object(_["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:H["a"].debug("typing_off");case 1:case"end":return e.stop()}}),e)})))),K.on("delivery",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:H["a"].debug("delivery: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),K.on("read",function(){var e=Object(_["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:H["a"].debug("read: ",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());var fe,ge,pe={object:"page",entry:[{id:"619465755149895",time:1561342828991,messaging:[]}]},ye={sender:{id:"1992865537477845"},recipient:{id:"619465755149895"},timestamp:1561342828431,message:{text:"hi"}},he={sender:{id:"1992865537477845"},recipient:{id:"619465755149895"},timestamp:1561343090095,postback:{title:"Track My Order",payload:"TRACK_ORDER"}};function be(e){return ve.apply(this,arguments)}function ve(){return ve=Object(_["a"])(regeneratorRuntime.mark((function e(t){var n,a,s,r=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:null,we("typing_on",n),a=JSON.parse(JSON.stringify(ye)),s=JSON.parse(JSON.stringify(pe)),n&&(a.id=n),a.message.text=t,s.entry[0].messaging=[a],H["a"].debug("sendTextMessage",JSON.stringify(s,null,4)),e.next=9,K.handelRequest(s);case 9:case"end":return e.stop()}}),e)}))),ve.apply(this,arguments)}function me(e,t){return ke.apply(this,arguments)}function ke(){return ke=Object(_["a"])(regeneratorRuntime.mark((function e(t,n){var a,s,r,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=i.length>2&&void 0!==i[2]?i[2]:null,we("typing_on",a),s=JSON.parse(JSON.stringify(he)),r=JSON.parse(JSON.stringify(pe)),a&&(s.id=a),s.postback.title=t,s.postback.payload=n,H["a"].debug("sendPostbackMessage",JSON.stringify(s,null,4)),r.entry[0].messaging=[s],e.next=10,K.handelRequest(r);case 10:case"end":return e.stop()}}),e)}))),ke.apply(this,arguments)}function _e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;fe=e,ge={context:t,bot:K}}function we(e,t){fe.apply(ge.bot,[e,{context:ge.context,bot:ge.bot,body:t}])}function xe(e){return Ce.apply(this,arguments)}function Ce(){return Ce=Object(_["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,D["a"].init(t);case 2:t.responseCallback&&_e(t.responseCallback,t.responseCallbackContext);case 3:case"end":return e.stop()}}),e)}))),Ce.apply(this,arguments)}var Oe,Se={init:xe,registerCallback:_e,sendTextMessage:be,sendPostbackMessage:me,bot:K,evaluateLog:Q,contactUsLog:Y},Me={name:"MessageWrapTemplate",data:function(){return{dialogueCssClass:{dialogue_item:!0,waiting:!0,right:!1},evalGoodCssClass:{active:!1},evalBadCssClass:{active:!1},evaluate_clicked:!1}},props:{senderType:{type:String,default:"robot"},icon:{type:String,default:"@/assets/image/robot_icon.jpg"},postback:{type:Array,default:[]},waiting:{type:Boolean,default:!1},evaluate:{type:Object,default:null}},computed:Object(i["a"])({},Object(o["b"])(["config","cfgvar"])),created:function(){this.dialogueCssClass.right="robot"!==this.senderType,this.dialogueCssClass.waiting=this.waiting},methods:{evaluate_click:function(e){if(this.evaluate_clicked)return!0;this.evaluate_clicked=!0;var t=e?"evalGoodCssClass":"evalBadCssClass";this[t].active=!0,this.config.messageCallback({ontype:"evaluate",result:e}),Se.evaluateLog(this.evaluate,e)},postbackClick:function(e){var t=this.postback[e];console.log(t),this.$emit("postback",t)}}},Ae=Me,Re=Object(d["a"])(Ae,w,x,!1,null,null,null),Te=Re.exports,je=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{domProps:{innerHTML:e._s(e.message)}})},Ue=[],Ie={name:"MessageTextTemplate",data:function(){return{}},computed:{},props:{message:{type:String,required:!0}},created:function(){},methods:{}},Ee=Ie,qe=Object(d["a"])(Ee,je,Ue,!1,null,null,null),Ne=qe.exports,Le=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["listOrder"==e.orderListType?n("ul",{staticClass:"msg_order_list"},[e._l(e.message.elements,(function(t,a){return n("li",{key:a},[n("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{href:t.link,target:"_blank"}}),n("img",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.imageUrl}}),n("div",{staticClass:"order_status"},[n("div",[n("a",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{href:t.link,target:"_blank"}}),n("strong",[e._v(e._s(t.title))])]),n("div",[e._v(e._s(t.status))]),n("div",[n("div"),n("div",[e._v(e._s(t.price))])])])])})),e.message.buttons&&e.message.buttons.length>0?n("li",[n("div",{staticClass:"msg_order_list_more"},[n("a",{attrs:{href:e.message.buttons[0].link,target:"_blank"}},[e._v(e._s(e.message.buttons[0].title))])])]):e._e()],2):n("ul",{},e._l(e.message.elements,(function(t,a){return n("li",{key:a},e._l(t,(function(t,a,s){return n("p",{key:s},["order_status_url"==a?n("a",{attrs:{href:t.value,target:"_blank"}},[e._v(" "+e._s(t.key)+" ")]):n("span",[n("strong",[e._v(e._s(a)+" : ")]),e._v(" "),n("span",{domProps:{innerHTML:e._s(t)}})])])})),0)})),0)])},Be=[],$e={name:"MessageOrderListTemplate",data:function(){return{}},computed:{},props:{message:{type:Object,required:!0},orderListType:{type:String,required:!0}},created:function(){console.log(this.message,this.message.buttons)},methods:{}},Pe=$e,Ve=Object(d["a"])(Pe,Le,Be,!1,null,null,null),Je=Ve.exports,De=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"dialogue-contact_us"},[e._v(" "+e._s(e.config.locales.contactUs[0])+" "),n("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){return e.toggleMessenger()}}},[e._v(e._s(e.config.locales.contactUs[1]))])])},We=[],Fe=(Oe={name:"SystemMessageContactUsTemplate",data:function(){return{clicked:!1,message:"Contact Us"}},computed:Object(i["a"])({},Object(o["b"])(["config","cfgvar","loaded"])),props:{defaultKayako:{type:Boolean,default:!0},contactUs:{type:Object,required:!0}}},Object(C["a"])(Oe,"computed",Object(i["a"])({},Object(o["b"])(["config","cfgvar"]))),Object(C["a"])(Oe,"created",(function(){})),Object(C["a"])(Oe,"methods",{toggleMessenger:function(e){return 1==this.defaultKayako&&0==this.clicked&&(this.clicked=!0,Se.contactUsLog(this.contactUs)),this.config.messageCallback({ontype:"contact-us",body:this.contactUs}),!0}}),Oe),He=Fe,Ke=Object(d["a"])(He,De,We,!1,null,null,null),Ge=Ke.exports,ze={name:"ChatBox",data:function(){return{userSay:"",messageList:[],quickPostback:[],notMatchUserSayMessage:null,welcomeMessage:null,isAnonymous:!1}},computed:Object(i["a"])({},Object(o["b"])(["config","cfgvar"])),methods:{backPageHander:function(){console.log("backPageHander","config.backUrl",this.config.backUrl),!1===this.config.backUrl?window.history.go(-1):window.location.href=unescape(this.config.backUrl)},scrollMoveToBottom:function(e){console.log("scrollMoveToBottom",e),this.$refs.chatboxContent.scrollTop=this.$refs.chatboxContent.scrollHeight+50},quickPostbackClick:function(e){var t=this.quickPostback[e];console.log(t),this.sendPostback(t)},generateKey:function(){return Number(Math.random().toString().substr(3,6)+Date.now()).toString(36)},isNotAnonymous:function(e){var t=this;if(!0===this.isAnonymous){this.messageList.push({key:this.generateKey(),widgetType:"text",senderType:"user",icon:this.cfgvar.userIcon,postback:[],waiting:!1,message:e});var n=/([\w\-\.]+@[\w\-\.]+\.[\w\-\.]+)/;if(n.test(e)){var a=e.match(n);return D["a"].setVariable("userMail",a[0]),this.config.messageCallback({ontype:"get_mail",body:a}),this.sendWelcomeMessage(),this.isAnonymous=!1,!1}var s={key:this.generateKey(),widgetType:"text",senderType:"robot",icon:this.cfgvar.robotIcon,waiting:!1,message:this.config.locales.emailError,postback:[]};return this.messageList.push(s),setImmediate((function(){t.scrollMoveToBottom("isNotAnonymous anonymous")})),!1}return!0},sendPostback:function(e){var t=this;this.isNotAnonymous(e.title)&&this.sendMessage(e.title,(function(n,a){t.config.messageCallback({ontype:"user_postback",postback:e}),Se.sendPostbackMessage(e.title,e.payload,a)}))},sendText:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.scrollMoveToBottom("sendText"),null!==t&&t instanceof String||(t=this.userSay,this.userSay=""),t.length<1)return!0;this.isNotAnonymous(t)&&this.sendMessage(t,(function(t,n){e.config.messageCallback({ontype:"user_say",userSay:t}),Se.sendTextMessage(t,n)}))},sendMessage:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.messageList.push({key:this.generateKey(),widgetType:"text",senderType:"user",icon:this.cfgvar.userIcon,postback:[],waiting:!1,message:e}),t=this.messageList.push({key:this.generateKey(),widgetType:"text",senderType:"robot",icon:this.cfgvar.robotIcon,postback:[],waiting:!0,message:""}),t-=1,console.log("$$$$$$$$$$---"+t+"---$$$$$$$$$$$$$$$$$"),this.scrollMoveToBottom("sendMessage"),null===n?Se.sendTextMessage(e,t):n(e,t)},messageType:function(e){return e.text?e.quick_replies?"text_quick":"text":!!e.attachment&&("template"==e.attachment.type?e.attachment.payload.template_type:"attachment")},widgetType:function(e){var t=this.messageType(e);if(["text","text_quick","button"].indexOf(t)>-1)return"text";if("list"==t&&e.attachment.payload.elements.length>0){if(e.attachment.payload.elements[0].price)return"listOrder";if(e.attachment.payload.elements[0].order_status_url)return"listOrderOfShopify"}return t},responseCallback:function(e,t){var n=this;return Object(_["a"])(regeneratorRuntime.mark((function a(){var s,r,i,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(t.bot,t.context,s=t.body,r=s.uiId,n.config.messageCallback({ontype:e,body:s}),"response"!=e){a.next=17;break}if(i=n.messageType(s.message),"text"!=i||0!=s.message.text.indexOf("_sys_")){a.next=7;break}return n.messageList.splice(r,1),a.abrupt("return");case 7:o=n.messageList[r],o.widgetType=n.widgetType(s.message),o.key=n.generateKey(),o.waiting=!1,["text","text_quick","button"].indexOf(i)>-1?o.message=s.message.text||s.message.attachment.payload.text:"list"==i&&(o.message=s.message.attachment.payload),"list"!=i&&s.message.attachment&&s.message.attachment.payload&&s.message.attachment.payload.buttons&&(o.postback=s.message.attachment.payload.buttons),s.evaluate&&(o.evaluate=s.evaluate),s.contactUs&&n.messageList.push({sysMsg:!0,key:n.generateKey(),widgetType:"contactUs",contactUs:s.contactUs}),a.next=18;break;case 17:"typing_off"==e?0==s.match&&(n.notMatchUserSayMessage?(console.log("typing_off notMatchUserSayMessage: ",n.notMatchUserSayMessage),o=n.messageList[r],o.key=n.generateKey(),o.waiting=!1,o.message=n.notMatchUserSayMessage.message.text,n.notMatchUserSayMessage.message.buttons&&(o.postback=n.notMatchUserSayMessage.message.buttons),n.notMatchUserSayMessage.evaluate&&(o.evaluate=n.notMatchUserSayMessage.message.evaluate),n.notMatchUserSayMessage.contactUs&&n.messageList.push({sysMsg:!0,key:n.generateKey(),widgetType:"contactUs",contactUs:n.notMatchUserSayMessage.message.contactUs})):n.messageList.splice(r,1)):"typing_on"==e||console.log("!!!nothing response!!!",s);case 18:setImmediate((function(){n.scrollMoveToBottom("responseCallback")}));case 19:case"end":return a.stop()}}),a)})))()},sendWelcomeMessage:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(null!=e.welcomeMessage){t.next=2;break}return t.abrupt("return");case 2:n={key:e.generateKey(),widgetType:"text",senderType:"robot",icon:e.cfgvar.robotIcon,waiting:!1,message:e.welcomeMessage.message.text},n.postback=[],e.welcomeMessage.message.buttons&&(n.postback=e.welcomeMessage.message.buttons),e.welcomeMessage.evaluate&&(n.evaluate=e.welcomeMessage.message.evaluate),e.messageList.push(n),e.welcomeMessage.contactUs&&e.messageList.push({sysMsg:!0,key:e.generateKey(),widgetType:"contactUs",contactUs:e.welcomeMessage.message.contactUs}),setImmediate((function(){e.scrollMoveToBottom("sendWelcomeMessage")}));case 9:case"end":return t.stop()}}),t)})))()}},created:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){var n,a,s,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("ChatBox: Created"),e.quickPostback=D["a"].getQuickPostback(),n=D["a"].getSite(),console.log("site: ",n),n.notMatchMessageId?(a=D["a"].getReplyMessage(n.notMatchMessageId),console.log("tempMsg-not match",a),a&&(e.notMatchUserSayMessage=a)):console.log("not have notMatchMessage"),"anonymous"==e.cfgvar.userMail&&(e.isAnonymous=!0,s=n.anonymousReply?n.anonymousReply:"",s=s.replace(/^\s+|\s+$/g,""),s.length<=0&&(s="<p>Please provide your email address in order to provide services <br>(only enter your email address, do not include other information)</p>"),r={key:e.generateKey(),widgetType:"text",senderType:"robot",icon:e.cfgvar.robotIcon,waiting:!1,message:s},r.postback=[],e.messageList.push(r),setImmediate((function(){e.scrollMoveToBottom("send anonymousReply Begin")}))),n.welcomeMessageId?(e.welcomeMessage=D["a"].getReplyMessage(n.welcomeMessageId),console.log("tempMsg-welcome",a),e.welcomeMessage&&0==e.isAnonymous&&e.sendWelcomeMessage()):console.log("not have welcomeMessageId");case 7:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this;return Object(_["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("ChatBox: Mounted"),Se.registerCallback(e.responseCallback,e);case 2:case"end":return t.stop()}}),t)})))()},components:{messageWrap:Te,messageText:Ne,messageOrderList:Je,sysContactUs:Ge}},Qe=ze,Ye=(n("2b95"),Object(d["a"])(Qe,m,k,!1,null,"9dec72d2",null)),Ze=Ye.exports;a["a"].use(v["a"]);var Xe=new v["a"]({routes:[{path:"/",redirect:"/chatbox"},{path:"/chatbox",name:"chatbox",component:Ze}]});a["a"].use(o["a"]);var et=new o["a"].Store({state:{loaded:!1,config:{variable:null}},getters:{config:function(e){return e.config},cfgvar:function(e){return e.config.variable},loaded:function(e){return e.loaded}},mutations:{config:function(e,t){e.config=t},loaded:function(e,t){e.loaded=t}},actions:{}}),tt=n("2d44"),nt=!1;function at(e){var t=document.location.href,n=t.indexOf(e+"=");if(-1==n)return!1;var a=t.slice(e.length+n+1),s=a.indexOf("&");return-1!=s&&(a=a.slice(0,s)),a}var st=at("do_not_log");nt=!st,console.log("canLog: ",nt,st);var rt=at("back_url");function it(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0!=n)try{var a;a=/(iPhone|iPad|iPod)/i.test(navigator.userAgent)?"iPhone/iPad/iPod":/iOS|Macintosh|Mac OS/i.test(navigator.userAgent)?"iOS":/(Android)/i.test(navigator.userAgent)?"Android":"PC";var s=e.replace("/graphql","/pageview?platform="+a);Object(tt["a"])(s,{method:"GET",headers:{accessTokenValue:t,origin:"*"},mode:"cors"}).then((function(e){return e.json()})).then((function(e){return console.log("page view",e)})).catch((function(e){return console.error("page view",e.message)}))}catch(ct){console.error(ct)}}function ot(){return console.log("begin bootstrap","version 1.10"),ChatConfig.userName&&(ChatConfig.variable.userName=ChatConfig.userName),ChatConfig.userMail||(ChatConfig.userMail="anonymous"),ChatConfig.backUrl=rt,it(ChatConfig.datasource,ChatConfig.accessToken,nt),Se.init({sysLogRequestEnable:nt,datasource:ChatConfig.datasource,accessToken:ChatConfig.accessToken,userMail:ChatConfig.userMail,variable:ChatConfig.variable,locales:ChatConfig.locales})}n("7340"),a["a"].config.productionTip=!1,a["a"].prototype.mywindow=window,ChatConfig.locales?ChatConfig.locales.loading||(ChatConfig.locales.loading=["L","o","a","d","i","n","g",".",".","."]):ChatConfig.locales={loading:["L","o","a","d","i","n","g",".",".","."]},new a["a"]({router:Xe,store:et,render:function(e){return e(g)}}).$mount("#app"),ot().then((function(e){console.log("bootstrap resolve: ",e),ChatConfig.variable=D["a"].getVariable(),ChatConfig.locales=D["a"].getLocales(),console.log("ChatConfig: ",ChatConfig),et.commit("config",ChatConfig),et.commit("loaded",!0)}),(function(e){console.log("bootstrap rejecte: loading error: ",e)}))},"6dba":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("ecb4"),n("513c"),n("e18c"),n("84c2"),n("e35a"),n("1c2e"),n("f4e3"),n("0d7a"),n("6a61");var a=n("cf7f"),s=n("1462"),r=n("a340"),i=n("ab5c"),o=n("1592"),c=n("74f8"),u=(n("8ca4"),n("420d"),function(){function e(t){if(Object(s["a"])(this,e),this._body=JSON.parse(JSON.stringify(t)),this.generateUid(),this._body.replyMessage=!1,this._body.askAnswer)for(var n,a=this._body.askAnswer.items,r=0;r<a.length;r++)n=a[r],/^\d+$/.test(n.hitAsk)?(n.hitAsk=i["a"].getReplyMessage(n.hitAsk),n.hitAsk instanceof c["a"]?(n.hitAsk.evaluate=!1,n.hitAsk.contactUs=!1):n.hitAsk={message:{text:"Error: hitAsk reference the replyMessage information is loss"}}):"string"==typeof n.hitAsk&&(n.hitAsk={message:{text:i["a"].injectVariable(n.hitAsk)}}),/^\d+$/.test(n.failAsk)?(n.failAsk=i["a"].getReplyMessage(n.failAsk),n.failAsk instanceof c["a"]?(n.failAsk.evaluate=!1,n.failAsk.contactUs=!1):n.failAsk={message:{text:"Error: failAsk reference the replyMessage information is loss"}}):"string"==typeof n.failAsk&&(n.failAsk={message:{text:i["a"].injectVariable(n.failAsk)}});if(this._body.replyMsgId&&(this._body.replyMessage=i["a"].getReplyMessage(this._body.replyMsgId),this._body.replyMessage instanceof c["a"]?this._body.replyMessage.setContext(this):this._body.replyMessage={message:{text:"Error: Context reference the replyMessage information is loss"}}),!this._body.replyMessage&&!this._body.askAnswer.items)throw new Error("MessengerContext: ask_ansver or reply_msg must be has one")}return Object(r["a"])(e,[{key:"generateUid",value:function(){this._body.uid=Number(Math.random().toString().substr(3,6)+Date.now()).toString(36);var e=i["a"].getVariable("userMail");e=e||"nothing",this._body.uid="context_"+i["a"].getSite().id+"_"+e+"_"+this._body.uid}},{key:"hearUserSay",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var a,s,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=!1,r=0;case 2:if(!(r<this._body.filterUserSay.length)){e.next=25;break}if(a=this._body.filterUserSay[r],"text"!=a.type){e.next=8;break}s=this._filterText(a.value,t,a.opMode),e.next=20;break;case 8:if("regexp"!=a.type){e.next=12;break}s=this._filterRegexp(a.value,t),e.next=20;break;case 12:if("quick_reply"!=a.type&&"postback"!=a.type){e.next=16;break}s=this._filterText(a.value,t),e.next=20;break;case 16:if("ai"!=a.type){e.next=20;break}return e.next=19,this._filterAi(a.value,t,n);case 19:s=e.sent;case 20:if(!1===s){e.next=22;break}return e.abrupt("break",25);case 22:r++,e.next=2;break;case 25:return e.abrupt("return",s);case 26:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"_filterAi",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n,a){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=new o["a"](t,a),e.next=3,s.match(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));function t(t,n,a){return e.apply(this,arguments)}return t}()},{key:"_filterText",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"equal",a=!1;t=t.toLocaleUpperCase();for(var s=0;s<e.length;s++){var r=e[s].toLocaleUpperCase();if("equal"==n&&r==t){a=!0;break}if("equal"!=n&&-1!==t.indexOf(r)){a=!0;break}}return a}},{key:"_getRegexpConfig",value:function(e){var t={},n=e.split("/");if(1==n.length)t.regstr=n[0],t.flag="";else{if(!n[1])return!1;t.regstr=n[1],t.flag=n[2]?n[2]:""}return t}},{key:"_filterRegexp",value:function(e,t){for(var n,a,s=!1,r=0;r<e.length;r++)if(a=this._getRegexpConfig(e[r]),a&&(n=new RegExp(a.regstr,a.flag),n instanceof RegExp&&n.test(t))){s=t.match(n),s=!0;break}return s}},{key:"uid",get:function(){return this._body.uid}},{key:"body",get:function(){var e;return this.replyMsg?(this._body.replyMessage.context=!1,e=JSON.parse(JSON.stringify(this._body)),this._body.replyMessage.setContext(this),e.replyMessage=this.replyMsg.body):e=JSON.parse(JSON.stringify(this._body)),e}},{key:"askAnswer",get:function(){return!(!this._body.askAnswer||!this._body.askAnswer.items)&&this._body.askAnswer.items}},{key:"replyMsg",get:function(){return this._body.replyMessage}},{key:"evaluate",get:function(){return this._body.evaluate}},{key:"contactUs",get:function(){return this._body.contactUs}},{key:"id",get:function(){return this._body.id}},{key:"siteId",get:function(){return this._body.siteId}},{key:"title",get:function(){return this._body.title}},{key:"filterUserSay",get:function(){return this._body.filterUserSay}},{key:"filterUserSayType",get:function(){return this._body.filterUserSayType}},{key:"notify",get:function(){return{}}}]),e}())},7340:function(e,t,n){},"74f8":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n("fe59"),n("513c"),n("e18c"),n("1c2e"),n("08ba");var a=n("1462"),s=n("a340"),r=n("ab5c"),i=function(){function e(t){Object(a["a"])(this,e),this._body=JSON.parse(JSON.stringify(t)),this._body.uid=null,this.context=!1,this.generateUid()}return Object(s["a"])(e,[{key:"setContext",value:function(e){this.context=e}},{key:"generateUid",value:function(){this._body.uid=Number(Math.random().toString().substr(3,6)+Date.now()).toString(36);var e=r["a"].getVariable("userMail");e=e||"nothing",this._body.uid="reply_"+r["a"].getSite().id+"_"+e+"_"+this._body.uid}},{key:"body",get:function(){var e=JSON.parse(JSON.stringify(this._body));return Object.assign(e,{message:this.message})}},{key:"evaluate",get:function(){return this._body.evaluate},set:function(e){"boolean"==typeof e&&(this._body.evaluate=e)}},{key:"contactUs",get:function(){return this._body.contactUs},set:function(e){"boolean"==typeof e&&(this._body.contactUs=e)}},{key:"id",get:function(){return this._body.id}},{key:"title",get:function(){return this._body.title}},{key:"message",get:function(){var t=this._body.message?JSON.parse(JSON.stringify(this._body.message)):{};return 0==this.id&&this._body.actionId?(this._body.evaluate&&(t["evaluate"]={type:"action",refId:this._body.actionId,refUid:this._body.uid}),this._body.contactUs&&(t["contactUs"]={type:"action",refId:this._body.actionId,refUid:this._body.uid})):(this.context&&this.context.evaluate?t["evaluate"]={type:"context",refId:this.context.id,refUid:this.context.uid}:this.context||!0!==this._body.evaluate||(t["evaluate"]={type:"reply_message",refId:this.id,refUid:this._body.uid}),this.context&&this.context.contactUs?t["contactUs"]={type:"context",refId:this.context.id,refUid:this.context.uid}:this.context||!0!==this._body.contactUs||(t["contactUs"]={type:"reply_message",refId:this.id,refUid:this._body.uid})),e.injectVariable(t,(function(e){return r["a"].injectVariable(e)})),t}},{key:"uid",get:function(){return this._body.uid}},{key:"notify",get:function(){return{}}},{key:"siteId",get:function(){return this._body.siteId}}],[{key:"injectVariable",value:function(e,t){e.text?(e.text=t(e.text),e.quickReplies?e.quickReplies.forEach((function(e){e.title=t(e.title),e.payload&&(e.payload=t(e.payload)),e.url&&(e.url=t(e.url))})):e.buttons&&e.buttons.forEach((function(e){e.title=t(e.title),e.payload&&(e.payload=t(e.payload)),e.url&&(e.url=t(e.url))}))):e.elements?(e.elements.forEach((function(e){e.title&&(e.title=t(e.title)),e.subtitle&&(e.subtitle=t(e.subtitle)),e.buttons&&e.buttons.forEach((function(e){e.title=t(e.title),e.payload&&(e.payload=t(e.payload)),e.url&&(e.url=t(e.url))}))})),e.buttons&&e.buttons.forEach((function(e){e.title=t(e.title),e.payload&&(e.payload=t(e.payload)),e.url&&(e.url=t(e.url))}))):e.cards&&e.cards.forEach((function(e){e.title=t(e.title),e.subtitle&&(e.subtitle=t(e.subtitle)),e.buttons&&e.buttons.forEach((function(e){e.title=t(e.title),e.payload&&(e.payload=t(e.payload)),e.url&&(e.url=t(e.url))}))}))}}]),e}()},8589:function(e,t,n){},"8c78":function(e,t,n){},"8ca4":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n("77ad"),n("4885");var a=3,s={enable:a,small:!0,getHead:function(e){return this.small?"===".concat(e," : "):"=====================================\n===".concat(e,"\n=====================================\n")},log:function(e,t,n){if(this.enable==a||0!=(this.enable&n)){var s=s="[46m%s[0m";1==n?s="[35m%s[0m":2==n&&(s="[36m%s[0m"),"string"==typeof t&&(t=[t]),t?(t.unshift(s,this.getHead(e)),console.log.apply(console,t)):console.log(s,this.getHead(e))}},debug:function(){arguments.length>0&&this.log(arguments[0],Array.prototype.slice.call(arguments,1),1)},info:function(){arguments.length>0&&this.log(arguments[0],Array.prototype.slice.call(arguments,1),2)}};s.debug("header-1","DEBUG",2,{name:"DEBUG"}),s.info("header-1","INFO",1,{name:"INFO"}),s.log("header-1",["LOG",3,{name:"LOG"}])},9638:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));n("fe59"),n("053b"),n("fe8a"),n("e18c"),n("96db"),n("08ba"),n("af86"),n("f1a9"),n("6a61");var a=n("cf7f"),s=n("1462"),r=n("a340"),i=n("ab5c"),o=n("8ca4"),c=(n("7db25"),n("5df4"),n("2d44")),u=(n("420d"),function(){function e(t){Object(s["a"])(this,e),this._body=JSON.parse(JSON.stringify(t)),this._body.headers||(this._body.headers={})}return Object(r["a"])(e,[{key:"send",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:null,"message"!=this.requestType){e.next=5;break}return e.next=4,this.serverSend();case 4:return e.abrupt("return",e.sent);case 5:return e.abrupt("return",this.clientSend(t));case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"serverSend",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,n,a,s,r,u,l,d,f=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("message"==this.requestType){e.next=2;break}return e.abrupt("return",!1);case 2:return s={},t="POST"==this.method.toLocaleUpperCase()?"POST":"GET",n=this.getHeader("Content-Type"),0!=n&&this.bodyData&&"application/x-www-form-urlencoded"==n.value?(a=new URLSearchParams,Object.keys(this.bodyData).forEach((function(e){var t=i["a"].injectVariable(f.bodyData[e]);a.append(e,t),s[e]=t}))):(0==n&&(this.headers["Content-Type"]="application/json"),a=JSON.stringify(this.bodyData),a=s=i["a"].injectVariable(a)),r=this.headers?this.headers:{},r["origin"]="*",u={method:t,headers:r,body:a,mode:"cors"},l=i["a"].injectVariable(this.url),o["a"].debug("action request , server: ",this.url,u),e.next=12,Object(c["a"])(l,u);case 12:return d=e.sent,e.next=15,d.json();case 15:return d=e.sent,u=Object.assign(u,{url:l,body:s}),e.abrupt("return",{request:u,result:d});case 18:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"clientSend",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if("post"!=this.method||"outside"!=this.requestType)return!1;null==t&&(t=window.document);var n={},a=t.createElement("form");return a.id="request_form",a.method="post",a.target="_blank",a.action=i["a"].injectVariable(this.url),this.bodyData&&Object.keys(this.bodyData).forEach((function(s){var r=t.createElement("input");r.type="hidden",r.name=s,r.value=i["a"].injectVariable(e.bodyData[s]),n[s]=r.value,a.appendChild(r)})),t.body.appendChild(a),a.submit(),setTimeout((function(){t.body.querySelector("#request_form").remove()}),0),{url:a.action,body:n}}},{key:"getHeader",value:function(e){if(!this.headers)return!1;for(var t=Object.keys(this.headers),n=null,a=0;a<t.length;a++)if(e.toLocaleUpperCase()==t[a].toLocaleUpperCase()){n=t[a];break}return!(!n||!this.headers[n])&&{key:n,value:this.headers[n]}}},{key:"body",get:function(){return this._body}},{key:"id",get:function(){return this._body.id}},{key:"requestType",get:function(){return this._body.requestType}},{key:"title",get:function(){return this._body.title}},{key:"method",get:function(){return this._body.method}},{key:"url",get:function(){return this._body.url}},{key:"headers",get:function(){return this._body.headers}},{key:"bodyData",get:function(){return this._body.body}},{key:"siteid",get:function(){return this._body.siteId}}]),e}())},"9ab1":function(e,t,n){"use strict";var a="\n{\n  site: allSites{\n    nodes{\n      id\n      name\n      domain\n      aiToken\n      brandName\n      logo\n      chatLogo\n      robotIcon\n      userIcon\n      linkFaq\n      welcomeMessageId\n      notMatchMessageId\n      createdAt\n      updatedAt\n      lastUpdatedAt\n      anonymousReply\n      localization\n    }\n  }\n  quick_postback: allQuickPostbacks{\n    nodes{\n      id\n      type\n      title\n      payload\n      siteId\n      createdAt\n      updatedAt\n    }\n  }\n  action: allActions{\n    nodes{\n      id\n      title\n      method\n      url\n      headers\n      body\n      siteId\n      requestType\n      createdAt\n      updatedAt\n    }\n  }\n  reply_message: allReplyMessages{\n    nodes{\n      id\n      type\n      message\n      title\n      siteId\n      evaluate\n      contactUs\n      notifyEnable\n      notifyActionId\n      createdAt\n      updatedAt\n    }\n  }\n  context: allContexts(filter: {\n    isDraft: { equalTo: false }\n  }){\n    nodes{\n      id\n      title\n      filterUserSayType\n      filterUserSay\n\t\t\treplyMsgId\n      askAnswer\n      siteId\n      evaluate\n      contactUs\n      notifyEnable\n      notifyActionId\n      createdAt\n      updatedAt\n      sort\n    }\n  }\n}\n";t["a"]=a},"9f48":function(e,t,n){"use strict";var a=n("8c78"),s=n.n(a);s.a},ab5c:function(e,t,n){"use strict";(function(e){n("fe59"),n("ecb4"),n("053b"),n("fe8a"),n("e18c"),n("84c2"),n("e35a"),n("1c2e"),n("5e9f"),n("0d7a"),n("08ba");var a,s=n("e171"),r=(n("6a61"),n("cf7f")),i=n("2d44"),o=n("3b5e"),c=n("c726"),u=n.n(c),l=n("9b2d"),d=n.n(l),f=n("6dba"),g=n("74f8"),p=n("9638"),y=n("8ca4"),h=n("9ab1");function b(){var e=Object(s["a"])(["{\n      siteById(id:","){\n        lastUpdatedAt\n      }\n    }"]);return b=function(){return e},e}function v(){var e=Object(s["a"])(["\n          mutation authenticate($input:AuthenticateInput!){\n            authenticate(input:$input){\n              jwtToken\n            }\n          }\n        "]);return v=function(){return e},e}console.log(Object({NODE_ENV:"production",BASE_URL:"/"}));try{window.fetch,a=decode64}catch(Q){var m="\n================================================================\n";y["a"].info(m+"=== Not running in the browser! Use node-fetch of node.js! ==="+m),i["a"],a=function(t){return e.from(t,"base64").toString("utf8")}}var k,_=!0;function w(e){if(void 0==e||""==e||"string"!=typeof e)return!1;var t=e.split(".");if(3!=t.length)return!1;var n=JSON.parse(a(t[1]));return!(Date.parse(new Date)/1e3>n.exp)&&(n.token=e,n)}function x(e,t){return C.apply(this,arguments)}function C(){return C=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){var a,s,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=d.a.get("access_token"),n!=a?(console.log("##access_token##","is Changed"),d.a.clearAll(),d.a.set("access_token",n)):console.log("##access_token##","Not Changed"),s=w(d.a.get("messengerbot_jwt_token")),s){e.next=19;break}return r=new o["a"]({uri:t,fetch:i["a"]}),e.prev=5,e.next=8,r.mutate({mutation:u()(v()),variables:{input:{accessToken:n}}});case 8:c=e.sent,c.errors&&(console.error("ACCESSON TOKEN not find ON result error message"),s=!1),e.next=16;break;case 12:return e.prev=12,e.t0=e["catch"](5),console.error("ACCESSON TOKEN not find"),e.abrupt("return",!1);case 16:y["a"].info("TOKEN NEW QUERY"),s=w(c.data.authenticate.jwtToken),d.a.set("messengerbot_jwt_token",s.token);case 19:return e.abrupt("return",s);case 20:case"end":return e.stop()}}),e,null,[[5,12]])}))),C.apply(this,arguments)}function O(){var e=h["a"];return e}function S(e){return M.apply(this,arguments)}function M(){return M=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k.query({query:u()(b(),t)});case 2:return n=e.sent,e.abrupt("return",n.data.siteById.lastUpdatedAt);case 4:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}function A(e){return R.apply(this,arguments)}function R(){return R=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,a,s,r,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n="messengerbot_data",a=d.a.get(n),e.next=4,S(t);case 4:if(s=e.sent,a&&!(s>a.site.lastUpdatedAt)){e.next=19;break}return y["a"].info("MESSENGER BOT DATA NEW QUERY"),a={},r=O(),e.next=11,k.query({query:u()(r)});case 11:i=e.sent,Object.keys(i.data).forEach((function(e){var t=i.data[e];t.hasOwnProperty("nodes")?a[e]=t.nodes:a[e]=t})),a.site=a.site[0],a.context.sort((function(e,t){var n,a,s;switch(e.filterUserSayType){case"text":n=1;break;case"regexp":n=2;break;default:n=3}switch(t.filterUserSayType){case"text":a=1;break;case"regexp":a=2;break;default:a=3}return s=n-a,0==s?e.sort-t.sort:s})),o=[],a.context.forEach((function(e){o.push(e.id+", "+e.title+", "+e.sort)})),y["a"].debug("Context Sort",o),d.a.set(n,a);case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}var T={variable:{}};function j(e){return U.apply(this,arguments)}function U(){return U=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,a,s,r,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.datasource&&t.accessToken&&t.userMail){e.next=2;break}throw new Error("You need to specify datasource, accessToken and userMail");case 2:return _=!t.hasOwnProperty("sysLogRequestEnable")||t.sysLogRequestEnable,console.log("sysLogRequestEnable = ",_?"True":"False"),e.next=6,x(t.datasource,t.accessToken);case 6:return n=e.sent,y["a"].info("JWT TOKEN",n),0==n&&console.error("get jwt token is field"),k=new o["a"]({uri:t.datasource,headers:{Authorization:"Bearer "+n.token},fetch:i["a"]}),e.next=12,A(n.site_id);case 12:T=e.sent,a=D(),s={siteName:a.name,siteDomain:a.domain,brandName:a.brandName,logo:a.logo,chatLogo:a.chatLogo,robotIcon:a.robotIcon,userIcon:a.userIcon,linkFaq:a.linkFaq},t.variable&&(s=Object.assign(s,t.variable)),s.siteId=a.id,s.userMail=t.userMail,T["variable"]=s,r={support:"SUPPORT",customerService:"Customer Service",faq:"FAQ",customerSupport:"Customer support",goBack:"Go back",typeYourMessageHere:"Type your message here",footerCopyright:"Copyright © 2014-#{year}# Soufeel. All rights reserved.",footerSupport:"Robot customer support service",emailError:"Email format is wrong, please re-enter",contactUs:["Need more support? ","Contact Us"]},c=Object.assign(r,a.localization?a.localization:{}),t.locales&&(c=Object.assign(c,t.locales)),T["locales"]=c;case 23:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?T["locales"][e]||""==T["locales"][e]?T["locales"][e]:t||null:JSON.parse(JSON.stringify(T["locales"]))}function E(e,t){t||""==t?T["variable"][e]=t:delete T["variable"][e]}function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?T["variable"][e]||""==T["variable"][e]?T["variable"][e]:t||null:JSON.parse(JSON.stringify(T["variable"]))}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;E("__aiVariable",e)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q("__aiVariable",e)}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;E("__convoVariable",e)}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q("__convoVariable",e)}function P(e){return T["variable"]["__aiVariable"]&&Object.keys(T["variable"]["__aiVariable"]).forEach((function(t){e=e.replace(new RegExp("#"+t+"#","g"),T["variable"]["__aiVariable"][t])})),T["variable"]["__convoVariable"]&&Object.keys(T["variable"]["__convoVariable"]).forEach((function(t){e=e.replace(new RegExp("#"+t+"#","g"),T["variable"]["__convoVariable"][t])})),Object.keys(T["variable"]).forEach((function(t){e=e.replace(new RegExp("#"+t+"#","g"),T["variable"][t])})),e}function V(e){return T[e]?T[e]:null}function J(e,t){var n,a=[];if(!t)return e;for(var s=0;s<e.length;s++)if(n=e[s],Array.isArray(t)&&t.indexOf(n.id)>-1)a.push(n);else if(n.id==t){a.push(n);break}return Array.isArray(t)?a:a[0]}function D(){return V("site")}function W(e){var t=V("action"),n=J(t,e);if(void 0==n)return null;if(Array.isArray(n)){for(var a=[],s=0;s<n.length;s++)a.push(new p["a"](n[s]));return a}return new p["a"](n)}function F(e){var t=V("context"),n=J(t,e);if(void 0==n)return null;if(Array.isArray(n)){for(var a=[],s=0;s<n.length;s++)a.push(new f["a"](n[s]));return a}return new f["a"](n)}function H(e){var t=V("reply_message"),n=J(t,e);if(void 0==n)return null;if(Array.isArray(n)){for(var a=[],s=0;s<n.length;s++)a.push(new g["a"](n[s]));return a}return new g["a"](n)}function K(e){var t=V("quick_postback"),n=J(t,e);if(void 0==n)return null;if(Array.isArray(n)){for(var a=[],s=0;s<n.length;s++)a.push(n[s]);return a}return n}function G(e){if(1==_){var t,n="mutation createSysNotifyLog($input:CreateSysNotifyLogInput!){\n    createSysNotifyLog(input:$input){\n      sysNotifyLog{\n        id\n      }\n    }\n  }";t={uid:e.uid,siteId:D().id,userMail:q("userMail"),userSay:e.userSay,type:e.type,targetId:e.target_id},"aciton_message"==e.type?t.body={action:e.target_body,actionResult:e.message_body}:"action_outside"==e.type?t.body=e.target_body:"context_askanswer"==e.type?(t.body={context:e.target_body,answerVariable:e.answer_variable},t.result=e.result):t.body=e.target_body,y["a"].debug("sysNotifyLog variable: ",t),k.mutate({mutation:u()(n),variables:{input:{sysNotifyLog:t}}}),y["a"].info("Sys Notify Loged!")}}function z(e){if(1==_){var t="mutation createSysChatLog($input:CreateSysChatLogInput!){\n    createSysChatLog(input:$input){\n      sysChatLog{\n        id\n      }\n    }\n  }",n={siteId:D().id,userMail:q("userMail"),replyType:e.type};e.userSayData&&(n.userSay=e.userSayData),e.target_id&&(n.classId=e.target_id),e.uid&&(n.instanceId=e.uid),"action_message"==e.type?(n.replyResult=e.message_body,n.data={request:e.target_body}):"action_outside"==e.type?n.data={request:e.target_body}:"reply_message"==e.type?n.replyResult=e.target_body:"context"==e.type?(n.replyResult=e.target_body.replyMessage.message,e.target_body.replyMessage.message=null,n.data=e.target_body):"context_askanswer"==e.type?(n.replyResult=e.target_body.replyMessage.message,e.target_body.replyMessage.message=null,n.data={body:e.target_body,result:e.result,answerVariable:e.answer_variable}):0!=e.type.indexOf("evaluate_")&&0!=e.type.indexOf("contact_us_")||(n.classId=e.target_body.refId,n.refId=e.target_body.refUid),y["a"].debug("sysChatLog variable: ",n),k.mutate({mutation:u()(t),variables:{input:{sysChatLog:n}}}),y["a"].info("sysChatLog already logged")}else console.log("sysChatLog not request log")}t["a"]={init:j,getSite:D,getAction:W,getContext:F,getReplyMessage:H,getQuickPostback:K,getLocales:I,setVariable:E,getVariable:q,setAiVariable:N,getAiVariable:L,setConvoVariable:B,getConvoVariable:$,injectVariable:P,sysLog:G,sysChatLog:z}}).call(this,n("fd40").Buffer)}});